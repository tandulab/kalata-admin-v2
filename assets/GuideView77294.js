import{o as y,a as U,l as _,c as k,x as A,i as M,_ as x,r as f,p as j,b as S,v as T,w as b,h as R,f as a,t as h,g as i,q as w,m as N,e as q,F as z}from"../index77294.js";import{e as D,p as P,a as W,s as V,u as H}from"./helpers77294.js";import{f as J,a as K,b as B}from"./formatData77294.js";import{u as I}from"./guide77294.js";import{c as Q,a as G}from"./index.esm77294.js";import{F as O}from"./vee-validate.esm77294.js";import{I as X}from"./InputTextWithValidation77294.js";import{D as E}from"./datetime77294.js";import"./_commonjsHelpers77294.js";/* empty css                                                                            */const Y={setup(){y(()=>{u.value=!0,n.value={first:0,rows:o.value.rows,sortField:null,sortOrder:null},n.value.page=0,v()});const d=U(),o=_(),l=_(),e=_(),p=_(),u=_(!0),n=_(),r=_(0),c=I(),s=k(()=>c.responseGuides),t=A(),m=k(()=>t.submitDialog);function v(){u.value=!0,setTimeout(()=>{C()},Math.random()*1e3+250)}const C=async function(){await c.fetchAllGuides().then(()=>{u.value=!1}).catch(g=>{u.value=!1,D(d,g)})},$=function(g){p.value=g;let L="Sei sicuro di voler eliminare questa guida?";t.setDialog("Elimina guida","Elimina","Annulla",L),t.setBtnSubmit(!1),t.setDynamicDialogVisibility(!0)},F=async function(){await c.deleteGuide(p.value).then(()=>{u.value=!1,V(d,{message:"Guida eliminata correttamente",error:!1}),C()}).catch(g=>{u.value=!1,D(d,g)})};return M(m,g=>{g&&F()}),{dt:o,responseGuides:s,loading:u,totalRecords:r,lazyParams:n,currentOrder:l,op:e,loadLazyData:v,onDeleteGuide:F,confirmDelete:$,formatDataAndHourFromUnixTimestamps:J,formatPrettyDate:K,prettyPaymentStatus:P,prettyTicketType:W}}},Z=["href"],ee=["href"],oe={class:"flex justify-content-center"};function te(d,o,l,e,p,u){const n=f("Column"),r=f("Button"),c=f("DataTable"),s=j("tooltip");return S(),T(c,{value:e.responseGuides.guides,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:""},{empty:b(()=>[R(" Nessuna guida trovata. ")]),default:b(()=>[a(n,{header:"Guida",field:"name"},{body:b(({data:t})=>[R(h(t.last_name)+" "+h(t.first_name),1)]),_:1}),a(n,{header:"Email",field:"email"},{body:b(({data:t})=>[i("a",{href:"https://mail.google.com/mail/?view=cm&fs=1&tf=1&to="+t.email,target:"_blank"},h(t.email),9,Z)]),_:1}),a(n,{header:"Telefono",field:"phone_number"},{body:b(({data:t})=>[i("a",{href:"https://api.whatsapp.com/send?phone="+t.phone_number,target:"_blank"},h(t.phone_number),9,ee)]),_:1}),a(n,{header:"Ente",field:"notes"}),a(n,{header:""},{body:b(({data:t})=>[i("div",oe,[w(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:m=>d.$emit("onEdit",t)},null,8,["onClick"]),[[s,"Modifica",void 0,{top:!0}]]),w(a(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:m=>e.confirmDelete(t.id)},null,8,["onClick"]),[[s,"Elimina",void 0,{top:!0}]]),w(a(r,{link:"",icon:"pi pi-download",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:m=>d.$emit("onDownloadReport",t)},null,8,["onClick"]),[[s,"Download Report",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const ne=x(Y,[["render",te]]),ae={props:["guide"],setup(d,o){y(()=>{d.guide&&(l.value=Object.assign({},d.guide))});const l=_({}),e=Q({first_name:G().required("Nome obbligatorio"),last_name:G().required("Cognome obbligatorio"),email:G().required("Email obbligatoria")}),{showLoader:p,hideLoader:u}=H(),n=U(),r=I(),c=function(){p();const m={guide:l.value};r.addGuide(m).then(()=>{u(),V(n,{message:"Guida aggiunta correttamente",error:!1}),o.emit("onSubmit")}).catch(v=>{D(n,v)})},s=function(){p();const m={guide:l.value};r.updateGuide(m).then(()=>{u(),V(n,{message:"Guida modificata correttamente",error:!1}),o.emit("onSubmit")}).catch(v=>{u(),D(n,v)})};return{form:l,schema:e,onSubmit:function(){l.value.id?s():c()}}},components:{Form:O,InputTextWithValidation:X}},ie={class:"formgrid grid mt-3"},le={class:"field col-6 flex flex-column mb-0"},se={class:"field col-6 mb-0"},de={class:"formgrid grid"},re={class:"field col-6 flex flex-column"},ue={class:"field col-6 flex flex-column"},me=i("label",{for:"phone_number"},"Telefono",-1),ce={class:"formgrid grid"},fe={class:"field col-12 flex flex-column"},_e=i("label",{for:"notes"},"Ente",-1),pe={class:"flex align-items-center justify-content-end mt-6"};function be(d,o,l,e,p,u){const n=f("InputTextWithValidation"),r=f("InputText"),c=f("Button"),s=f("Form");return S(),T(s,{"validation-schema":e.schema,onSubmit:e.onSubmit},{default:b(()=>[i("div",ie,[i("div",le,[a(n,{name:"first_name",label:"Nome*",modelValue:e.form.first_name,"onUpdate:modelValue":o[0]||(o[0]=t=>e.form.first_name=t)},null,8,["modelValue"])]),i("div",se,[a(n,{name:"last_name",label:"Cognome*",modelValue:e.form.last_name,"onUpdate:modelValue":o[1]||(o[1]=t=>e.form.last_name=t)},null,8,["modelValue"])])]),i("div",de,[i("div",re,[a(n,{name:"email",label:"Email*",modelValue:e.form.email,"onUpdate:modelValue":o[2]||(o[2]=t=>e.form.email=t)},null,8,["modelValue"])]),i("div",ue,[me,a(r,{name:"phone_number",modelValue:e.form.phone_number,"onUpdate:modelValue":o[3]||(o[3]=t=>e.form.phone_number=t)},null,8,["modelValue"])])]),i("div",ce,[i("div",fe,[_e,a(r,{name:"notes",modelValue:e.form.notes,"onUpdate:modelValue":o[4]||(o[4]=t=>e.form.notes=t)},null,8,["modelValue"])])]),i("div",pe,[a(c,{label:"Annulla",text:""}),a(c,{label:"Conferma",type:"submit"})])]),_:1},8,["validation-schema","onSubmit"])}const ge=x(ae,[["render",be]]),ve={props:["guide"],setup(d,o){y(()=>{l.value.start_date=E.now().minus({months:1}).toFormat("dd/MM/yyyy"),l.value.end_date=E.now().toFormat("dd/MM/yyyy")});const l=_({});return{form:l,onSubmit:function(){let p="/admin/guides/download?start_date="+B(l.value.start_date)+"&end_date="+B(l.value.end_date)+"&guide_id="+d.guide.id;N.get(p,{responseType:"blob"}).then(u=>{var n=new Blob([u.data],{type:"application/pdf"}),r=URL.createObjectURL(n);window.open(r),o.emit("onSubmit")})}}},components:{Form:O}},he={class:"formgrid grid mt-3"},De={class:"field col-6 flex flex-column"},ye=i("label",{from:"start_date"},"Filtra Dal",-1),xe={class:"field col-6 flex flex-column"},Se=i("label",{from:"end_date"},"Al",-1),we={class:"flex align-items-center justify-content-end mt-6"};function Ge(d,o,l,e,p,u){const n=f("Calendar"),r=f("Button"),c=f("Form");return S(),T(c,{onSubmit:e.onSubmit},{default:b(()=>[i("div",he,[i("div",De,[ye,a(n,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.start_date=s),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),i("div",xe,[Se,a(n,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.end_date=s),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),i("div",we,[a(r,{label:"Annulla",text:""}),a(r,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const Ve=x(ve,[["render",Ge]]),Te={setup(){y(()=>{});const d=_(!1),o=_(!1),l=_(),e=_({});return{visibleDialog:d,guideTable:l,currentGuide:e,visibleFilterDialog:o,onSubmit:function(){d.value=!1,l.value.loadLazyData(),e.value={}},onShowDialog:function(){e.value={},d.value=!0},onEdit:function(s){e.value=s,d.value=!0},onDownloadReport:function(s){e.value=s,o.value=!0},closeDialog:function(){o.value=!1}}},components:{GuideTable:ne,GuideDialog:ge,ReportGuideDialog:Ve}},Ce=i("h1",null,"Guide",-1),Fe={class:"flex justify-content-end mt-4 mb-3"};function ke(d,o,l,e,p,u){const n=f("Button"),r=f("GuideTable"),c=f("GuideDialog"),s=f("Dialog"),t=f("ReportGuideDialog");return S(),q(z,null,[Ce,i("div",Fe,[a(n,{label:"Guida",icon:"pi pi-plus",rounded:"",outlined:"",onClick:o[0]||(o[0]=m=>e.onShowDialog())})]),a(r,{ref:"guideTable",onOnEdit:o[1]||(o[1]=m=>e.onEdit(m)),onOnDownloadReport:o[2]||(o[2]=m=>e.onDownloadReport(m))},null,512),a(s,{visible:e.visibleDialog,"onUpdate:visible":o[3]||(o[3]=m=>e.visibleDialog=m),modal:"",header:"Guida",style:{width:"50rem"}},{default:b(()=>[a(c,{guide:e.currentGuide,onOnSubmit:e.onSubmit},null,8,["guide","onOnSubmit"])]),_:1},8,["visible"]),a(s,{visible:e.visibleFilterDialog,"onUpdate:visible":o[4]||(o[4]=m=>e.visibleFilterDialog=m),modal:"",header:"Report guida",style:{width:"50rem"}},{default:b(()=>[a(t,{guide:e.currentGuide,onOnSubmit:e.closeDialog},null,8,["guide","onOnSubmit"])]),_:1},8,["visible"])],64)}const je=x(Te,[["render",ke]]);export{je as default};
