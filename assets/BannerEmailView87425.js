import{y as $,C as j,B as L,o as E,a as I,l as g,c as N,_ as C,r as h,p as A,b as i,x,w as k,h as S,f as r,t as M,e as u,g as t,q as D,A as V,m as y,z as P,i as q,s as B}from"../index87425.js";import{e as R,u as G,s as H}from"./helpers87425.js";import{F as J}from"./vee-validate.esm87425.js";class T{static async fetchAll(){return(await $("/admin/banners")).data}static async updateBanner(e){return(await j(`/admin/banners/${e.banner.id}`,e)).data}}const z=L({id:"banner",state:()=>({banner:{},banners:[],response_banners:{}}),getters:{allBanners:n=>n.banners,responseBanners:n=>n.response_banners,getTotalBanners:n=>n.response_banners?n.response_banners.total:0,getCurrentBanner:n=>n.banner},actions:{async fetchAll(){await T.fetchAll().then(n=>{this.response_banners=n})},async updateBanner(n){await T.updateBanner(n).then()}}}),K={setup(){E(()=>{p.value=!0,f.value={first:0,rows:e.value.rows,sortField:null,sortOrder:null},f.value.page=0,_()});const n=I(),e=g(),l=g(),o=g(),p=g(!0),f=g(),d=g(0),c=z(),m=N(()=>c.responseBanners);function _(){p.value=!0,setTimeout(()=>{a()},Math.random()*1e3+250)}const a=async function(){await c.fetchAll().then(()=>{p.value=!1}).catch(s=>{p.value=!1,R(n,s)})};return{dt:e,responseBanners:m,loading:p,totalRecords:d,lazyParams:f,currentOrder:l,op:o,loadLazyData:_}}};const Q=["src"],W={key:1,class:"block"},X=["href"],Y={key:3},Z=["src"],ee={key:1,class:"block"},oe=["href"],ne={key:3,class:"block"},te=["src"],ae={key:1,class:"block"},le=["href"],se={key:3,class:"block"},ie={class:"flex justify-content-center"};function re(n,e,l,o,p,f){const d=h("Column"),c=h("Button"),m=h("DataTable"),_=A("tooltip");return i(),x(m,{value:o.responseBanners.banners,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:"",class:"banner"},{empty:k(()=>[S(" Nessun codice sconto trovato. ")]),default:k(()=>[r(d,{header:"Location",field:"location"},{body:k(({data:a})=>{var s;return[S(M(((s=a.location)==null?void 0:s.name)||"Tutte le location"),1)]}),_:1}),r(d,{header:"Banner header"},{body:k(({data:a})=>[a.image_url?(i(),u("img",{key:0,src:a.image_url},null,8,Q)):(i(),u("i",W,"Nessuna immagine caricata")),a.link?(i(),u("a",{key:2,href:a.link,class:"block",target:"_blank"},"Link",8,X)):(i(),u("i",Y,"Nessun link impostato"))]),_:1}),r(d,{header:"Banner footer (up)"},{body:k(({data:a})=>[a.image_foot_up_url?(i(),u("img",{key:0,src:a.image_foot_up_url},null,8,Z)):(i(),u("i",ee,"Nessuna immagine caricata")),a.link_foot_up?(i(),u("a",{key:2,href:a.link_foot_up,class:"block",target:"_blank"},"Link",8,oe)):(i(),u("i",ne,"Nessun link impostato"))]),_:1}),r(d,{header:"Banner footer (down)"},{body:k(({data:a})=>[a.image_foot_down_url?(i(),u("img",{key:0,src:a.image_foot_down_url},null,8,te)):(i(),u("i",ae,"Nessuna immagine caricata")),a.link_foot_down?(i(),u("a",{key:2,href:a.link_foot_down,class:"block",target:"_blank"},"Link",8,le)):(i(),u("i",se,"Nessun link impostato"))]),_:1}),r(d,{header:""},{body:k(({data:a})=>[t("div",ie,[D(r(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:s=>n.$emit("onEditBanner",a)},null,8,["onClick"]),[[_,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const de=C(K,[["render",re]]);class w{static async uploadFile(e){return(await V("uploads",e)).data}static async uploadResponse(e){const l={headers:{"Content-Type":e.file.type}};return delete y.defaults.headers.common.uid,delete y.defaults.headers.common.Uid,delete y.defaults.headers.common["token-type"],delete y.defaults.headers.common["access-token"],delete y.defaults.headers.common.client,await y.put(e.upload_url,e.file,l)}static async uploadDone(e){return(await V(`/uploads/${e}/done`,{})).data}static async deleteFile(e){const l=new Map;return(await P(`/uploads/${e}`,l)).data}}const ce=L({id:"upload",state:()=>({upload:{},uploads:[],response_uploads:{},upload_id:""}),getters:{allUploads:n=>n.uploads,responseUploads:n=>n.response_uploads,getCurrentUpload:n=>n.upload},actions:{async uploadFile(n){const e=n.file;await w.uploadFile(n).then(l=>{const o={file:e,upload_url:l.upload_url};return this.upload_id=l.upload.id,this.uploadResponse(o)})},async uploadResponse(n){await w.uploadResponse(n).then(()=>this.uploadDone())},async uploadDone(){await w.uploadDone(this.upload_id).then(n=>{this.response_uploads=n})},async deleteFile(n){await w.deleteFile(n)}}}),ue={props:["banner"],setup(n,e){E(()=>{n.banner&&(l.value=Object.assign({},n.banner))});const l=g({}),{showLoader:o,hideLoader:p}=G(),f=I(),d=z(),c=ce(),m=N(()=>c.responseUploads),_=function(b,v){const U=b.files[0],O={upload:{filename:U.name,type:U.type,owner_id:n.banner.id,owner_type:"Banner",banner_type:v},file:U};c.uploadFile(O)},a=function(){o();const b={banner:l.value};d.updateBanner(b).then(()=>{p(),H(f,{message:"Banner aggiornato correttamente",error:!1}),e.emit("onSubmit")}).catch(v=>{R(f,v)})},s=function(b,v){c.deleteFile(b).then(()=>{F(v,null)})},F=function(b,v){b=="header"?l.value.image_url=v:b=="footer_up"?l.value.image_foot_up_url=v:l.value.image_foot_down_url=v};return q(m,()=>{let b=m.value.url;F(m.value.banner_type,b)}),{form:l,uploadedImage:m,onSubmit:a,onUploadImage:_,onDeleteFile:s}},components:{Form:J}};const me={class:"formgrid grid flex-column mt-3"},_e={class:"field col-12 flex flex-column"},pe=t("label",{for:"location"},"Location",-1),fe={class:"formgrid grid card mt-3"},be=t("h3",{class:"col-12 mt-0 p-0"},"Banner header",-1),ge={class:"field col-6 flex flex-column"},he=t("label",null,"Immagine",-1),ve={key:0,class:"relative wrp-delete"},ke=["src"],ye={class:"field col-6 flex flex-column"},Be=t("label",{from:"to_date"},"Link banner header",-1),we={class:"formgrid grid card mt-3"},xe=t("h3",{class:"col-12 mt-0 p-0"},"Banner footer (up)",-1),De={class:"field col-6 flex flex-column"},Ue=t("label",null,"Immagine",-1),Ee={key:0,class:"relative wrp-delete"},Ce=["src"],Fe={class:"field col-6 flex flex-column"},Se=t("label",{from:"to_date"},"Link banner footer (up)",-1),Ve={class:"formgrid grid card mt-3"},Te=t("h3",{class:"col-12 mt-0 p-0"},"Banner footer (down)",-1),Le={class:"field col-6 flex flex-column"},Ie=t("label",null,"Immagine",-1),Ne={key:0,class:"relative wrp-delete"},Ae=["src"],Re={class:"field col-6 flex flex-column"},ze=t("label",{from:"to_date"},"Link banner footer (down)",-1),Oe={class:"flex align-items-center justify-content-end mt-6"};function $e(n,e,l,o,p,f){const d=h("InputText"),c=h("Button"),m=h("FileUpload"),_=h("Form"),a=A("tooltip");return o.form?(i(),x(_,{key:0,onSubmit:o.onSubmit,class:"banner"},{default:k(()=>[t("div",me,[t("div",_e,[pe,o.form.location?(i(),x(d,{key:0,modelValue:o.form.location.name,"onUpdate:modelValue":e[0]||(e[0]=s=>o.form.location.name=s),disabled:""},null,8,["modelValue"])):B("",!0)])]),t("div",fe,[be,t("div",ge,[he,o.form.image_url?(i(),u("div",ve,[o.form.image_url?D((i(),x(c,{key:0,icon:"pi pi-times",rounded:"","aria-label":"Cancel",class:"btn-delete-img",onClick:e[1]||(e[1]=s=>o.onDeleteFile(o.form.image.id,"header"))},null,512)),[[a,"Elimina",void 0,{top:!0}]]):B("",!0),t("img",{src:o.form.image_url},null,8,ke)])):B("",!0),r(m,{mode:"basic",name:"demo[]",url:"/api/upload",accept:"image/*",customUpload:"",auto:!0,onUploader:e[2]||(e[2]=s=>o.onUploadImage(s,"header")),class:"mt-3"})]),t("div",ye,[Be,r(d,{modelValue:o.form.link,"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.link=s)},null,8,["modelValue"])])]),t("div",we,[xe,t("div",De,[Ue,o.form.image_foot_up_url?(i(),u("div",Ee,[D(r(c,{icon:"pi pi-times",rounded:"","aria-label":"Cancel",class:"btn-delete-img",onClick:e[4]||(e[4]=s=>o.onDeleteFile(o.form.image_foot_up.id,"footer_up"))},null,512),[[a,"Elimina",void 0,{top:!0}]]),t("img",{src:o.form.image_foot_up_url},null,8,Ce)])):B("",!0),r(m,{mode:"basic",name:"demo[]",url:"/api/upload",accept:"image/*",customUpload:"",auto:!0,onUploader:e[5]||(e[5]=s=>o.onUploadImage(s,"footer_up")),class:"mt-3"})]),t("div",Fe,[Se,r(d,{modelValue:o.form.link_foot_up,"onUpdate:modelValue":e[6]||(e[6]=s=>o.form.link_foot_up=s)},null,8,["modelValue"])])]),t("div",Ve,[Te,t("div",Le,[Ie,o.form.image_foot_down_url?(i(),u("div",Ne,[D(r(c,{icon:"pi pi-times",rounded:"","aria-label":"Cancel",class:"btn-delete-img",onClick:e[7]||(e[7]=s=>o.onDeleteFile(o.form.image_foot_down.id,"footer_down"))},null,512),[[a,"Elimina",void 0,{top:!0}]]),t("img",{src:o.form.image_foot_down_url},null,8,Ae)])):B("",!0),r(m,{mode:"basic",name:"demo[]",url:"/api/upload",accept:"image/*",customUpload:"",auto:!0,onUploader:e[8]||(e[8]=s=>o.onUploadImage(s,"footer_down")),class:"mt-3"})]),t("div",Re,[ze,r(d,{modelValue:o.form.link_foot_down,"onUpdate:modelValue":e[9]||(e[9]=s=>o.form.link_foot_down=s)},null,8,["modelValue"])])]),t("div",Oe,[r(c,{label:"Annulla",text:""}),r(c,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit"])):B("",!0)}const je=C(ue,[["render",$e]]),Me={setup(){E(()=>{});const n=g(!1),e=g(),l=g({});return{visibleDialog:n,bannerEmailTable:e,currentBanner:l,onSubmit:function(){n.value=!1,e.value.loadLazyData()},openEditDialog:function(f){n.value=!0,l.value=f}}},components:{BannerEmailTable:de,BannerEmailDialog:je}},Pe=t("h1",null,"Banner email",-1);function qe(n,e,l,o,p,f){const d=h("BannerEmailTable"),c=h("BannerEmailDialog"),m=h("Dialog");return i(),u("div",null,[Pe,r(d,{ref:"bannerEmailTable",onOnEditBanner:e[0]||(e[0]=_=>o.openEditDialog(_))},null,512),r(m,{visible:o.visibleDialog,"onUpdate:visible":e[2]||(e[2]=_=>o.visibleDialog=_),modal:"",header:"Banner Email",style:{width:"50rem"}},{default:k(()=>[r(c,{onOnSubmit:e[1]||(e[1]=_=>o.onSubmit()),banner:o.currentBanner},null,8,["banner"])]),_:1},8,["visible"])])}const Ke=C(Me,[["render",qe]]);export{Ke as default};
