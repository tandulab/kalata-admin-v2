import{o as C,a as j,l as u,c as A,x as F,i as E,_ as T,r as m,p as N,b as B,v as I,w as h,h as O,f as i,g as f,q as L,e as z}from"../index59605.js";import{e as V,p as q,a as M,s as x,u as P}from"./helpers59605.js";import{f as W,a as $}from"./formatData59605.js";import{u as U}from"./attraction59605.js";import{c as R,a as w}from"./index.esm59605.js";import{F as H}from"./vee-validate.esm59605.js";import{I as G}from"./InputTextWithValidation59605.js";import{u as J}from"./category59605.js";import"./datetime59605.js";import"./_commonjsHelpers59605.js";/* empty css                                                                            */const K={props:["attraction_id"],setup(c){C(()=>{e.value=!0,s.value={first:0,rows:a.value.rows,sortField:null,sortOrder:null},s.value.page=0,y()});const o=j(),a=u(),t=u(),_=u(),p=u(),e=u(!0),s=u(),r=u(0),d=U(),l=A(()=>d.responseAttractions),n=F(),g=A(()=>n.submitDialog);function y(){e.value=!0,setTimeout(()=>{S()},Math.random()*1e3+250)}const S=async function(){await d.fetchAllAttractions().then(()=>{e.value=!1}).catch(b=>{e.value=!1,V(o,b)})},k=function(b){p.value=b;let D="Sei sicuro di voler eliminare questo bene?";n.setDialog("Elimina bene","Elimina","Annulla",D),n.setBtnSubmit(!1),n.setDynamicDialogVisibility(!0)},v=async function(){await d.deleteAttraction(p.value).then(()=>{e.value=!1,x(o,{message:"Bene eliminato correttamente",error:!1}),y()}).catch(b=>{e.value=!1,V(o,b)})};return E(g,b=>{b&&v()}),{dt:a,responseAttractions:l,loading:e,totalRecords:r,lazyParams:s,currentOrder:t,op:_,loadLazyData:y,onDeleteAttraction:v,confirmDelete:k,formatDataAndHourFromUnixTimestamps:W,formatPrettyDate:$,prettyPaymentStatus:q,prettyTicketType:M}}},Q={class:"flex justify-content-center"};function X(c,o,a,t,_,p){const e=m("Column"),s=m("InputSwitch"),r=m("Button"),d=m("DataTable"),l=N("tooltip");return B(),I(d,{value:t.responseAttractions.attractions,lazy:!0,paginator:!1,ref:"dt",loading:t.loading,stripedRows:""},{empty:h(()=>[O(" Nessun bene trovato. ")]),default:h(()=>[i(e,{header:"Nome",field:"name"}),i(e,{header:"Link prenotazione biglietti",field:"permalink"}),i(e,{header:""},{body:h(({data:n})=>[i(s,{modelValue:n.online,"onUpdate:modelValue":g=>n.online=g},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(e,{header:""},{body:h(({data:n})=>[f("div",Q,[L(i(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:g=>c.$emit("onEdit",n)},null,8,["onClick"]),[[l,"Modifica",void 0,{top:!0}]]),L(i(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:g=>t.confirmDelete(n.id)},null,8,["onClick"]),[[l,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const Y=T(K,[["render",X]]),Z={props:["attraction"],setup(c,o){C(()=>{var v;c.attraction&&c.attraction.id&&(a.value=Object.assign({},c.attraction),a.value.price=(v=a.value.ticket_configurations[0])==null?void 0:v.price,delete a.value.ticket_configurations),S()});const a=u({}),t=R({name:w().required("Nome bene obbligatorio"),address:w().required("Luogo di ritrovo obbligatorio"),price:w().required("Importo biglietto obbligatorio")}),{showLoader:_,hideLoader:p}=P(),e=j(),s=U(),r=J(),d=A(()=>s.allAttractions),l=A(()=>r.allCategories),n=function(){_();const v=Object.assign({},a.value);v.ticket_configurations=[{price:v.price,name:"Biglietto intero"}];const b={attraction:v};s.addAttraction(b).then(()=>{p(),x(e,{message:"Bene aggiunto correttamente",error:!1}),o.emit("onSubmit")}).catch(D=>{p(),V(e,D)})},g=function(){_();const b={attraction:Object.assign({},a.value)};s.updateAttraction(b).then(()=>{p(),x(e,{message:"Chiusura modificata correttamente",error:!1}),o.emit("onSubmit")}).catch(D=>{p(),V(e,D)})},y=function(){a.value.id?g():n()},S=async function(){await r.fetchAllCategories()},k=function(){o.emit("onSubmit",a.value)};return E(l,()=>{a.value.category||(a.value.category=l.value[0])}),{form:a,schema:t,onSubmit:y,resetForm:k,attractions:d,categories:l}},components:{Form:H,InputTextWithValidation:G}},tt={class:"formgrid grid mt-3"},ot={class:"field col-12"},et={class:"field col-12"},nt={class:"field col-12"},at={class:"field col-12 flex flex-column"},it=f("label",{for:"category"},"Categoria",-1),lt={class:"flex align-items-center col-12"},rt=f("label",{for:"free_ticket",class:"ml-2"}," Biglietto gratuito ",-1),st={class:"flex align-items-center justify-content-end mt-6"};function ct(c,o,a,t,_,p){const e=m("InputTextWithValidation"),s=m("Dropdown"),r=m("Checkbox"),d=m("Button"),l=m("Form");return B(),I(l,{onSubmit:t.onSubmit,"validation-schema":t.schema},{default:h(()=>[f("div",tt,[f("div",ot,[i(e,{name:"name",label:"Nome bene*",modelValue:t.form.name,"onUpdate:modelValue":o[0]||(o[0]=n=>t.form.name=n)},null,8,["modelValue"])]),f("div",et,[i(e,{name:"address",label:"Luogo di ritrovo*",modelValue:t.form.address,"onUpdate:modelValue":o[1]||(o[1]=n=>t.form.address=n)},null,8,["modelValue"])]),f("div",nt,[i(e,{name:"price",label:"Importo biglietto*",modelValue:t.form.price,"onUpdate:modelValue":o[2]||(o[2]=n=>t.form.price=n)},null,8,["modelValue"])]),f("div",at,[it,i(s,{modelValue:t.form.category,"onUpdate:modelValue":o[3]||(o[3]=n=>t.form.category=n),options:t.categories,optionLabel:"label",optionValue:"value",placeholder:"",name:"category"},null,8,["modelValue","options"])])]),f("div",lt,[i(r,{modelValue:t.form.free_ticket,"onUpdate:modelValue":o[4]||(o[4]=n=>t.form.free_ticket=n),inputId:"free_ticket",binary:""},null,8,["modelValue"]),rt]),f("div",st,[i(d,{label:"Annulla",text:"",onClick:o[5]||(o[5]=n=>t.resetForm())}),i(d,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const mt=T(Z,[["render",ct]]),dt={setup(){C(()=>{});const c=u(!1),o=u({}),a=u(),t=u();return{form:o,attractionTable:a,visibleDialog:c,currentAttraction:t,filterTable:function(r){o.value=r,a.value.loadLazyData()},onShowDialog:function(){t.value={},c.value=!0},onEdit:function(r){t.value=r,c.value=!0},onSubmit:function(){a.value.loadLazyData(),c.value=!1}}},components:{AttractionTable:Y,AttractionDialog:mt}},ut=f("h1",null,"Beni",-1),ft={class:"flex justify-content-end mt-4 mb-3"};function pt(c,o,a,t,_,p){const e=m("Button"),s=m("AttractionTable"),r=m("AttractionDialog"),d=m("Dialog");return B(),z("div",null,[ut,f("div",ft,[i(e,{label:"Bene",icon:"pi pi-plus",rounded:"",outlined:"",onClick:o[0]||(o[0]=l=>t.onShowDialog())})]),i(s,{filters:t.form,ref:"attractionTable",onOnEdit:o[1]||(o[1]=l=>t.onEdit(l))},null,8,["filters"]),i(d,{visible:t.visibleDialog,"onUpdate:visible":o[3]||(o[3]=l=>t.visibleDialog=l),modal:"",header:"Bene",style:{width:"35rem"}},{default:h(()=>[i(r,{attraction:t.currentAttraction,onOnSubmit:o[2]||(o[2]=l=>t.onSubmit())},null,8,["attraction"])]),_:1},8,["visible"])])}const wt=T(dt,[["render",pt]]);export{wt as default};
