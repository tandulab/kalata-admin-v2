import{y as $,C as F,B as E,o as B,a as T,l as f,c as N,_ as w,r as b,p as I,b as r,x as v,w as h,h as x,f as i,t as A,e as c,g as a,q as R,A as D,m as k,s as U}from"../index66612.js";import{e as V,u as j,s as O}from"./helpers66612.js";import{F as z}from"./vee-validate.esm66612.js";class S{static async fetchAll(){return(await $("/admin/banners")).data}static async updateBanner(o){return(await F(`/admin/banners/${o.banner.id}`,o)).data}}const C=E({id:"banner",state:()=>({banner:{},banners:[],response_banners:{}}),getters:{allBanners:e=>e.banners,responseBanners:e=>e.response_banners,getTotalBanners:e=>e.response_banners?e.response_banners.total:0,getCurrentBanner:e=>e.banner},actions:{async fetchAll(){await S.fetchAll().then(e=>{this.response_banners=e})},async updateBanner(e){await S.updateBanner(e).then()}}}),M={setup(){B(()=>{u.value=!0,_.value={first:0,rows:o.value.rows,sortField:null,sortOrder:null},_.value.page=0,d()});const e=T(),o=f(),s=f(),n=f(),u=f(!0),_=f(),l=f(0),p=C(),g=N(()=>p.responseBanners);function d(){u.value=!0,setTimeout(()=>{t()},Math.random()*1e3+250)}const t=async function(){await p.fetchAll().then(()=>{u.value=!1}).catch(m=>{u.value=!1,V(e,m)})};return{dt:o,responseBanners:g,loading:u,totalRecords:l,lazyParams:_,currentOrder:s,op:n,loadLazyData:d}}};const P=["src"],q={key:1,class:"block"},G=["href"],H={key:3},J=["src"],K={key:1,class:"block"},Q=["href"],W={key:3,class:"block"},X=["src"],Y={key:1,class:"block"},Z=["href"],ee={key:3,class:"block"},oe={class:"flex justify-content-center"};function ne(e,o,s,n,u,_){const l=b("Column"),p=b("Button"),g=b("DataTable"),d=I("tooltip");return r(),v(g,{value:n.responseBanners.banners,lazy:!0,paginator:!1,ref:"dt",loading:n.loading,stripedRows:"",class:"banner"},{empty:h(()=>[x(" Nessun codice sconto trovato. ")]),default:h(()=>[i(l,{header:"Location",field:"location"},{body:h(({data:t})=>{var m;return[x(A(((m=t.location)==null?void 0:m.name)||"Tutte le location"),1)]}),_:1}),i(l,{header:"Banner header"},{body:h(({data:t})=>[t.image_url?(r(),c("img",{key:0,src:t.image_url},null,8,P)):(r(),c("i",q,"Nessuna immagine caricata")),t.link?(r(),c("a",{key:2,href:t.link,class:"block",target:"_blank"},"Link",8,G)):(r(),c("i",H,"Nessun link impostato"))]),_:1}),i(l,{header:"Banner footer (up)"},{body:h(({data:t})=>[t.image_foot_up?(r(),c("img",{key:0,src:t.image_foot_up},null,8,J)):(r(),c("i",K,"Nessuna immagine caricata")),t.link_foot_up?(r(),c("a",{key:2,href:t.link_foot_up,class:"block",target:"_blank"},"Link",8,Q)):(r(),c("i",W,"Nessun link impostato"))]),_:1}),i(l,{header:"Banner footer (down)"},{body:h(({data:t})=>[t.image_foot_down?(r(),c("img",{key:0,src:t.image_foot_down},null,8,X)):(r(),c("i",Y,"Nessuna immagine caricata")),t.link_foot_down?(r(),c("a",{key:2,href:t.link_foot_down,class:"block",target:"_blank"},"Link",8,Z)):(r(),c("i",ee,"Nessun link impostato"))]),_:1}),i(l,{header:""},{body:h(({data:t})=>[a("div",oe,[R(i(p,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:m=>e.$emit("onEditBanner",t)},null,8,["onClick"]),[[d,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const te=w(M,[["render",ne]]);class y{static async uploadFile(o){return(await D("uploads",o)).data}static async uploadResponse(o){debugger;const s={headers:{"Content-Type":"application/json"}};delete k.defaults.headers.common.uid,delete k.defaults.headers.common.Uid,delete k.defaults.headers.common["token-type"],delete k.defaults.headers.common["access-token"],delete k.defaults.headers.common.client;debugger;try{return await k.put(o.upload_url,o.file,s)}catch{debugger}debugger;return{}}static async uploadDone(o){const s=await D(`/uploads/${o}/done`,{});debugger;return s}}const ae=E({id:"upload",state:()=>({upload:{},uploads:[],response_uploads:{}}),getters:{allUploads:e=>e.uploads,responseUploads:e=>e.response_uploads,getTotalUploads:e=>e.response_uploads?e.response_uploads.total:0,getCurrentUpload:e=>e.upload},actions:{async uploadFile(e){debugger;const o=e.file;await y.uploadFile(e).then(s=>{debugger;const n={file:o,upload_url:s.upload_url};return this.uploadResponse(n)})},async uploadResponse(e){await y.uploadResponse(e).then(o=>{debugger;return this.uploadDone(e)})},async uploadDone(e){await y.uploadDone(e.uploadId).then(o=>{debugger})}}}),se={props:["banner"],setup(e,o){B(()=>{e.banner&&(s.value=Object.assign({},e.banner))});const s=f({}),{showLoader:n,hideLoader:u}=j(),_=T(),l=C(),p=ae();return{form:s,onSubmit:function(){n();const t={banner:s.value};debugger;l.updateBanner(t).then(()=>{u(),O(_,{message:"Banner aggiornato correttamente",error:!1}),o.emit("onSubmit")}).catch(m=>{V(_,m)})},onUploadImage:function(t){const m=t.files[0];debugger;const L={upload:{filename:m.name,type:m.type,owner_id:e.banner.id,owner_type:"Banner",banner_type:"header"},file:m};p.uploadFile(L)}}},components:{Form:z}};const le={class:"formgrid grid flex-column mt-3"},re={class:"field col-12 flex flex-column"},ie=a("label",{for:"location"},"Location",-1),ce={class:"formgrid grid card mt-3"},de=a("h3",{class:"col-12 mt-0 p-0"},"Banner header",-1),ue={class:"field col-6 flex flex-column"},_e=a("label",null,"Immagine",-1),me=["src"],pe={class:"field col-6 flex flex-column"},fe=a("label",{from:"to_date"},"Link banner header",-1),be={class:"formgrid grid card mt-3"},ge=a("h3",{class:"col-12 mt-0 p-0"},"Banner footer (up)",-1),he={class:"field col-6 flex flex-column"},ke=a("label",null,"Immagine",-1),ye=["src"],ve={class:"field col-6 flex flex-column"},Be=a("label",{from:"to_date"},"Link banner footer (up)",-1),we={class:"formgrid grid card mt-3"},xe=a("h3",{class:"col-12 mt-0 p-0"},"Banner footer (down)",-1),De={class:"field col-6 flex flex-column"},Ue=a("label",null,"Immagine",-1),Se=["src"],Ee={class:"field col-6 flex flex-column"},Te=a("label",{from:"to_date"},"Link banner footer (down)",-1),Ve={class:"flex align-items-center justify-content-end mt-6"};function Ce(e,o,s,n,u,_){const l=b("InputText"),p=b("FileUpload"),g=b("Button"),d=b("Form");return n.form?(r(),v(d,{key:0,onSubmit:n.onSubmit,class:"banner"},{default:h(()=>[a("div",le,[a("div",re,[ie,n.form.location?(r(),v(l,{key:0,modelValue:n.form.location.name,"onUpdate:modelValue":o[0]||(o[0]=t=>n.form.location.name=t),disabled:""},null,8,["modelValue"])):U("",!0)])]),a("div",ce,[de,a("div",ue,[_e,a("img",{src:n.form.image_url},null,8,me),i(p,{mode:"basic",name:"demo[]",url:"/api/upload",accept:"image/*",customUpload:"",auto:!0,onUploader:n.onUploadImage,class:"mt-3"},null,8,["onUploader"])]),a("div",pe,[fe,i(l,{modelValue:n.form.link,"onUpdate:modelValue":o[1]||(o[1]=t=>n.form.link=t)},null,8,["modelValue"])])]),a("div",be,[ge,a("div",he,[ke,a("img",{src:n.form.image_foot_up_url},null,8,ye)]),a("div",ve,[Be,i(l,{modelValue:n.form.link_foot_up,"onUpdate:modelValue":o[2]||(o[2]=t=>n.form.link_foot_up=t)},null,8,["modelValue"])])]),a("div",we,[xe,a("div",De,[Ue,a("img",{src:n.form.image_foot_down_url},null,8,Se)]),a("div",Ee,[Te,i(l,{modelValue:n.form.link_foot_down,"onUpdate:modelValue":o[3]||(o[3]=t=>n.form.link_foot_down=t)},null,8,["modelValue"])])]),a("div",Ve,[i(g,{label:"Annulla",text:""}),i(g,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit"])):U("",!0)}const Le=w(se,[["render",Ce]]),$e={setup(){B(()=>{});const e=f(!1),o=f(),s=f({});return{visibleDialog:e,bannerEmailTable:o,currentBanner:s,onSubmit:function(){e.value=!1,o.value.loadLazyData()},openEditDialog:function(_){e.value=!0,s.value=_}}},components:{BannerEmailTable:te,BannerEmailDialog:Le}},Fe=a("h1",null,"Banner email",-1);function Ne(e,o,s,n,u,_){const l=b("BannerEmailTable"),p=b("BannerEmailDialog"),g=b("Dialog");return r(),c("div",null,[Fe,i(l,{ref:"bannerEmailTable",onOnEditBanner:o[0]||(o[0]=d=>n.openEditDialog(d))},null,512),i(g,{visible:n.visibleDialog,"onUpdate:visible":o[2]||(o[2]=d=>n.visibleDialog=d),modal:"",header:"Banner Email",style:{width:"50rem"}},{default:h(()=>[i(p,{onOnSubmit:o[1]||(o[1]=d=>n.onSubmit()),banner:n.currentBanner},null,8,["banner"])]),_:1},8,["visible"])])}const je=w($e,[["render",Ne]]);export{je as default};
