import{y as R,A as G,C as H,z as J,B as K,o as B,a as P,l as _,c as w,x as Q,i as U,_ as L,r as g,p as W,b as S,v as M,w as b,h as T,f as l,t as j,g as s,q as E,e as X,s as Y,F as Z}from"../index72611.js";import{e as x,p as $,a as tt,s as k,u as N}from"./helpers72611.js";import{f as ot,a as F,b as y}from"./formatData72611.js";import"./index.esm72611.js";import{F as et}from"./vee-validate.esm72611.js";import{u as I}from"./attraction72611.js";import{D as O}from"./datetime72611.js";import"./_commonjsHelpers72611.js";class D{static async fetchAll(t){return(await R("/admin/closings",t)).data}static async addClosing(t){return await G("/admin/closings",t)}static async updateClosing(t){return await H(`/admin/closings/${t.closing.id}`,t)}static async deleteClosing(t){return await J(`/admin/closings/${t}`)}}const q=K({id:"closing",state:()=>({closing:{},closings:[],response_closings:{}}),getters:{allClosings:e=>e.closings,responseClosings:e=>e.response_closings,getCurrentClosing:e=>e.closing},actions:{async fetchAllClosings(e){await D.fetchAll(e).then(t=>{this.response_closings=t})},async addClosing(e){await D.addClosing(e).then()},async updateClosing(e){await D.updateClosing(e).then()},async deleteClosing(e){await D.deleteClosing(e).then()}}}),at={props:["attraction_id"],setup(e){B(()=>{i.value=!0,r.value={first:0,rows:a.value.rows,sortField:null,sortOrder:null},r.value.page=0,v()});const t=P(),a=_(),o=_(),p=_(),m=_(),i=_(!0),r=_(),f=_(0),d=q(),c=w(()=>d.responseClosings),n=Q(),u=w(()=>n.submitDialog);function v(){i.value=!0,setTimeout(()=>{C()},Math.random()*1e3+250)}const C=async function(){const h=new Map;h.set("attraction_id",e.attraction_id),await d.fetchAllClosings(h).then(()=>{i.value=!1}).catch(V=>{i.value=!1,x(t,V)})},A=function(h){m.value=h;let V="Sei sicuro di voler eliminare questa chiusura?";n.setDialog("Elimina chiusura","Elimina","Annulla",V),n.setBtnSubmit(!1),n.setDynamicDialogVisibility(!0)},z=async function(){await d.deleteClosing(m.value).then(()=>{i.value=!1,k(t,{message:"Chiusura eliminata correttamente",error:!1}),C()}).catch(h=>{i.value=!1,x(t,h)})};return U(u,h=>{h&&z()}),{dt:a,responseClosings:c,loading:i,totalRecords:f,lazyParams:r,currentOrder:o,op:p,loadLazyData:v,onDeleteClosing:z,confirmDelete:A,formatDataAndHourFromUnixTimestamps:ot,formatPrettyDate:F,prettyPaymentStatus:$,prettyTicketType:tt}}},nt={class:"flex justify-content-center"};function it(e,t,a,o,p,m){const i=g("Column"),r=g("Button"),f=g("DataTable"),d=W("tooltip");return S(),M(f,{value:o.responseClosings.closings,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[T(" Nessuna chiusura trovata. ")]),default:b(()=>[l(i,{header:"Attrazione",field:"attraction.name"}),l(i,{header:"Dal"},{body:b(({data:c})=>[T(j(o.formatPrettyDate(c.from_date)),1)]),_:1}),l(i,{header:"Al"},{body:b(({data:c})=>[T(j(o.formatPrettyDate(c.to_date)),1)]),_:1}),l(i,{header:"Motivo",field:"description"}),l(i,{header:""},{body:b(({data:c})=>[s("div",nt,[E(l(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:n=>e.$emit("onEdit",c)},null,8,["onClick"]),[[d,"Modifica",void 0,{top:!0}]]),E(l(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:n=>o.confirmDelete(c.id)},null,8,["onClick"]),[[d,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const st=L(at,[["render",it]]),lt={props:["attraction","attraction_id","closing"],setup(e,t){B(()=>{e.attraction&&(a.value.attraction_id=e.attraction.id),e.attraction_id&&(a.value.attraction_id=e.attraction_id),e.closing&&e.closing.attraction?(a.value=Object.assign({},e.closing),a.value.attraction_id=e.closing.attraction.id,a.value.from_date=F(a.value.from_date),a.value.to_date=F(a.value.to_date),delete a.value.attraction):(a.value.from_date=O.local().toFormat("dd/MM/yyyy"),a.value.to_date=O.local().toFormat("dd/MM/yyyy"))});const a=_({}),{showLoader:o,hideLoader:p}=N(),m=P(),i=I(),r=q(),f=w(()=>i.allAttractions),d=function(){o();const u=Object.assign({},a.value);u.from_date=y(u.from_date),u.to_date=y(u.to_date);const v={closing:u};r.addClosing(v).then(()=>{p(),k(m,{message:"Chiusura aggiunta correttamente",error:!1}),t.emit("onSubmit")}).catch(C=>{p(),x(m,C)})},c=function(){o();const u=Object.assign({},a.value);u.from_date=y(u.from_date),u.to_date=y(u.to_date);const v={closing:u};r.updateClosing(v).then(()=>{p(),k(m,{message:"Chiusura modificata correttamente",error:!1}),t.emit("onSubmit")}).catch(C=>{p(),x(m,C)})};return{form:a,onSubmit:function(){a.value.id?c():d()},attractions:f}},components:{Form:et}},rt={class:"formgrid grid mt-3"},ct={class:"field col-12 flex flex-column"},dt=s("label",{for:"location"},"Attrazione",-1),ut={class:"formgrid grid"},mt={class:"field col-6 flex flex-column"},ft=s("label",{from:"from_date"},"Chiusura Dal",-1),_t={class:"field col-6 flex flex-column"},gt=s("label",{from:"to_date"},"Al",-1),pt={class:"formgrid grid"},vt={class:"field col-12 flex flex-column"},Ct=s("label",null,"Motivo",-1),ht={class:"flex align-items-center justify-content-end mt-6"};function bt(e,t,a,o,p,m){const i=g("Dropdown"),r=g("Calendar"),f=g("Textarea"),d=g("Button"),c=g("Form");return S(),M(c,{onSubmit:o.onSubmit},{default:b(()=>[s("div",rt,[s("div",ct,[dt,l(i,{modelValue:o.form.attraction_id,"onUpdate:modelValue":t[0]||(t[0]=n=>o.form.attraction_id=n),options:o.attractions,optionLabel:"name",optionValue:"id",placeholder:"",name:"location"},null,8,["modelValue","options"])])]),s("div",ut,[s("div",mt,[ft,l(r,{inputId:"from_date",modelValue:o.form.from_date,"onUpdate:modelValue":t[1]||(t[1]=n=>o.form.from_date=n),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),s("div",_t,[gt,l(r,{inputId:"to_date",modelValue:o.form.to_date,"onUpdate:modelValue":t[2]||(t[2]=n=>o.form.to_date=n),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),s("div",pt,[s("div",vt,[Ct,l(f,{modelValue:o.form.description,"onUpdate:modelValue":t[3]||(t[3]=n=>o.form.description=n),rows:"5",cols:"30"},null,8,["modelValue"])])]),s("div",ht,[l(d,{label:"Annulla",text:""}),l(d,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit"])}const yt=L(lt,[["render",bt]]),Dt={setup(){B(()=>{d()});const e=_(!1),t=_(!1),a=_(),o=_({}),p=_(),m=I(),{showLoader:i,hideLoader:r}=N(),f=w(()=>m.allAttractions),d=async function(){i(),await m.fetchAllAttractions().then(()=>{r()})},c=function(){o.value={},e.value=!0},n=function(){e.value=!1,a.value.loadLazyData(),o.value={}},u=function(A){o.value=A,e.value=!0},v=function(){a.value.loadLazyData()},C=function(){t.value=!1};return U(f,()=>{p.value=f.value[0].id}),{visibleDialog:e,closingTable:a,currentClosing:o,visibleFilterDialog:t,attraction_id:p,onSubmit:n,onShowDialog:c,onEdit:u,closeDialog:C,onChangeAttraction:v,attractions:f}},components:{ClosingTable:st,ClosingDialog:yt}},wt=s("h1",null,"Chiusure",-1),St={class:"flex justify-content-between mt-4 mb-3 align-items-center"},xt={class:"field col-4 flex flex-column"},At=s("label",{for:"location"},"Attrazione",-1);function Vt(e,t,a,o,p,m){const i=g("Dropdown"),r=g("Button"),f=g("ClosingTable"),d=g("ClosingDialog"),c=g("Dialog");return S(),X(Z,null,[wt,s("div",St,[s("div",xt,[At,l(i,{modelValue:o.attraction_id,"onUpdate:modelValue":t[0]||(t[0]=n=>o.attraction_id=n),options:o.attractions,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:t[1]||(t[1]=n=>o.onChangeAttraction())},null,8,["modelValue","options"])]),l(r,{label:"Chiusura",icon:"pi pi-plus",rounded:"",outlined:"",onClick:t[2]||(t[2]=n=>o.onShowDialog())})]),o.attraction_id?(S(),M(f,{key:0,ref:"closingTable",onOnEdit:t[3]||(t[3]=n=>o.onEdit(n)),attraction_id:o.attraction_id},null,8,["attraction_id"])):Y("",!0),l(c,{visible:o.visibleDialog,"onUpdate:visible":t[4]||(t[4]=n=>o.visibleDialog=n),modal:"",header:"Chiusura",style:{width:"50rem"}},{default:b(()=>[l(d,{closing:o.currentClosing,onOnSubmit:o.onSubmit,attraction_id:o.attraction_id},null,8,["closing","onOnSubmit","attraction_id"])]),_:1},8,["visible"])],64)}const Et=L(Dt,[["render",Vt]]);export{Et as default};
