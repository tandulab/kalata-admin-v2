import"./location85482.js";import{D as w}from"./datetime85482.js";import{u as P}from"./order85482.js";import{u as G,e as V,s as B}from"./helpers85482.js";import{o as R,a as $,l as p,c as S,i as H,_ as A,r as v,b as F,s as q,w as g,f as s,g as d,x as W,z as J,B as K,y as Q,A as X,v as Y,m as Z,e as M,h as x,t as D,p as L,q as ee,d as te}from"../index85482.js";import{u as z}from"./attraction85482.js";import{h as ae,b as O,g as N}from"./formatData85482.js";import{u as oe}from"./guide85482.js";import{F as ne}from"./vee-validate.esm85482.js";import{c as le,a as U}from"./index.esm85482.js";import{I as ie}from"./InputTextWithValidation85482.js";import"./_commonjsHelpers85482.js";/* empty css                                                                            */const se={setup(n,t){R(()=>{y(),i()});const o=$(),a=p({}),c=z(),_=P(),{showLoader:r,hideLoader:u}=G(),m=S(()=>c.allAttractions),f=S(()=>_.paymentStatus),i=function(){const b=w.local(),C=b.minus({months:1}).startOf("month");a.value.from_date=C.toFormat("dd/LL/yyyy"),a.value.to_date=b.toFormat("dd/LL/yyyy")},e=function(){i(),t.emit("onSubmit",a.value)},y=async function(){r(),await c.fetchAttractionsList().then(()=>{u(),t.emit("onSubmit",a.value)}).catch(b=>{u(),V(o,b)})};return H(m,()=>{a.value.attraction_id=m.value[0].id}),{form:a,attractions:m,attractionStore:c,statuses:f,resetForm:e}}},re={class:"formgrid grid px-0 align-items-center"},de={class:"field col-3 flex flex-column"},ue=d("label",{for:"typology"},"Bene",-1),ce={class:"field col-2"},me=d("label",{from:"from_date"},"Dal",-1),fe={class:"field col-2"},ve=d("label",{from:"to_date"},"Al",-1),_e={class:"flex col-12 justify-content-end pt-1"};function pe(n,t,o,a,c,_){const r=v("Dropdown"),u=v("Calendar"),m=v("Button"),f=v("AccordionTab"),i=v("Accordion");return F(),q(i,{activeIndex:0},{default:g(()=>[s(f,{header:"FILTRI"},{default:g(()=>[d("div",re,[d("div",de,[ue,s(r,{modelValue:a.form.attraction_id,"onUpdate:modelValue":t[0]||(t[0]=e=>a.form.attraction_id=e),options:a.attractions,optionLabel:"name",optionValue:"id"},null,8,["modelValue","options"])]),d("div",ce,[me,s(u,{inputId:"from_date",modelValue:a.form.from_date,"onUpdate:modelValue":t[1]||(t[1]=e=>a.form.from_date=e),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),d("div",fe,[ve,s(u,{inputId:"to_date",modelValue:a.form.to_date,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.to_date=e),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),d("div",_e,[s(m,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=e=>n.$emit("onSubmit",a.form))}),s(m,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=e=>a.resetForm())})])]),_:1})]),_:1})}const ge=A(se,[["render",pe]]);class T{static async fetchAllReveliaCalendar(t){return(await W("/admin/events/calendar",t)).data.calendar}static async addEventToCalendar(t){return(await J("/admin/events",t)).data}static async updateEventToCalendar(t){return(await K(`/admin/events/${t.id}`,t)).data}static async deleteEvent(t){return await Q(`/admin/events/${t}`)}}const j=X({id:"calendar",state:()=>({calendar:[]}),getters:{getCurrentCalendar:n=>n.calendar},actions:{async fetchAllReveliaCalendar(n){await T.fetchAllReveliaCalendar(n).then(t=>{const o=Object.keys(t)[0];this.calendar=t[o]})},async addEventToCalendar(n){await T.addEventToCalendar(n)},async deleteEvent(n){await T.deleteEvent(n)},async updateEventToCalendar(n){await T.updateEventToCalendar(n)}}}),ye={props:["filters"],setup(n){R(()=>{i.value=!0,e.value={first:0,rows:m.value.rows,sortField:null,sortOrder:null},e.value.page=0});const t=S(()=>c.getCurrentCalendar),o=Y(),a=S(()=>o.submitDialog),c=j(),{showLoader:_,hideLoader:r}=G(),u=$(),m=p(),f=p(),i=p(!0),e=p(),y=p();function b(){setTimeout(()=>{C()},Math.random()*1e3+250)}const C=async function(){const h=new Map;if(n.filters)for(let l in n.filters)l.includes("date")?h.set(l,O(n.filters[l])):h.set(l,n.filters[l]);i.value=!0,await c.fetchAllReveliaCalendar(h).then(()=>{i.value=!1}).catch(l=>{i.value=!1,V(u,l)})},k=function(h){y.value=h;let l="Sei sicuro di voler eliminare questo evento?";o.setDialog("Elimina Evento","Elimina","Annulla",l),o.setBtnSubmit(!1),o.setDynamicDialogVisibility(!0)},I=async function(){_(),await c.deleteEvent(y.value).then(()=>{r(),B(u,{message:"Evento eliminato correttamente",error:!1}),b()}).catch(h=>{r(),V(u,h)})};return H(a,h=>{h&&I()}),{dt:m,loading:i,lazyParams:e,op:f,reveliaCalendar:t,loadLazyData:b,formatDataFromSql:ae,confirmDelete:k}}},be={class:"order-table mt-3"};function he(n,t,o,a,c,_){const r=v("Column"),u=v("Button"),m=v("DataTable"),f=Z("tooltip");return F(),M("div",be,[s(m,{value:a.reveliaCalendar,lazy:!0,paginator:!1,rows:30,ref:"dt",loading:a.loading,stripedRows:""},{empty:g(()=>[x(" Nessuna configurazione trovata. ")]),default:g(()=>[s(r,{header:"Data"},{body:g(({data:i})=>{var e;return[x(D(a.formatDataFromSql((e=i.date_configuration)==null?void 0:e.date_event)),1)]}),_:1}),s(r,{header:"Ora"},{body:g(({data:i})=>{var e,y;return[x(D((e=i.date_configuration)==null?void 0:e.start_at)+" - "+D((y=i.date_configuration)==null?void 0:y.end_at),1)]}),_:1}),s(r,{header:"Guida"},{body:g(({data:i})=>{var e,y,b,C;return[x(D((y=(e=i.date_configuration)==null?void 0:e.guide)==null?void 0:y.first_name)+" "+D((C=(b=i.date_configuration)==null?void 0:b.guide)==null?void 0:C.last_name),1)]}),_:1}),s(r,{header:"Posti liberi",field:"available_tickets"}),s(r,{header:"Posti totali"},{body:g(({data:i})=>{var e;return[x(D((e=i.date_configuration)==null?void 0:e.max_seats),1)]}),_:1}),s(r,{style:{width:"10rem"}},{body:g(({data:i})=>[L(s(u,{link:"",icon:"pi pi-pencil",href:i.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:e=>n.$emit("onEditEvent",i)},null,8,["href","onClick"]),[[f,"Modifica",void 0,{top:!0}]]),L(s(u,{link:"",icon:"pi pi-clone",href:i.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:e=>n.$emit("onDuplicateEvent",i)},null,8,["href","onClick"]),[[f,"Duplica",void 0,{top:!0}]]),L(s(u,{link:"",icon:"pi pi-trash",href:i.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:e=>a.confirmDelete(i.id)},null,8,["href","onClick"]),[[f,"Elimina",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","loading"])])}const De=A(ye,[["render",he]]),Ce={props:["filters","current_event","duplicate"],setup(n,t){R(()=>{C(),n.current_event&&n.current_event.id&&b()});const o=p({}),a=z(),c=j(),_=oe(),r=p(!0),u=$(),m=S(()=>a.allAttractions),f=S(()=>_.allGuides),i=function(){t.emit("onSubmit",o.value)},e=le({max_seats:U().required("Campo obbligatorio"),min_seats:U().required("Campo obbligatorio")}),y=function(){o.value.date_event=w.now().toFormat("dd/MM/yyyy"),o.value.expire_at=w.now().toFormat("dd/MM/yyyy"),o.value.start_at=w.now().toFormat("HH:mm"),o.value.end_at=w.now().toFormat("HH:mm"),o.value.guide_id=f.value[0],n.filters&&(o.value.attraction_id=n.filters.attraction_id)},b=function(){o.value=Object.assign({},n.current_event),o.value.date_configuration&&(o.value.date_event=N(o.value.date_configuration.date_event),o.value.expire_at=N(o.value.date_configuration.expire_at),o.value.guide_id=o.value.date_configuration.guide,o.value.max_seats=o.value.date_configuration.max_seats,o.value.min_seats=o.value.date_configuration.min_seats,o.value.start_at=o.value.date_configuration.start_at,o.value.end_at=o.value.date_configuration.end_at)},C=async function(){r.value=!0,await _.fetchAllGuides().then(()=>{r.value=!1}).catch(l=>{r.value=!1,V(u,l)})},k=function(){let l=Object.assign({},o.value);if(l.date_event=O(l.date_event),l.expire_at=O(l.expire_at),l.guide_id=l.guide_id.id,(l.start_at+"").includes("GMT")&&(l.start_at=w.fromJSDate(new Date(l.start_at)).toFormat("HH:mm")),(l.end_at+"").includes("GMT")&&(l.end_at=w.fromJSDate(new Date(l.end_at)).toFormat("HH:mm")),l.id&&!n.duplicate){delete l.date_configuration;const E={id:l.id,attraction_id:l.attraction_id,date_configuration:l};h(E)}else{const E={attraction_id:l.attraction_id,date_configuration:l};I(E)}},I=async function(l){r.value=!0,await c.addEventToCalendar(l).then(()=>{r.value=!1,B(u,{message:"Evento aggiunto correttamente",error:!1}),t.emit("onAddEvent")}).catch(E=>{r.value=!1,V(u,E)})},h=async function(l){r.value=!0,await c.updateEventToCalendar(l).then(()=>{r.value=!1,B(u,{message:"Evento aggiornato correttamente",error:!1}),t.emit("onAddEvent")}).catch(E=>{r.value=!1,V(u,E)})};return H(f,()=>{o.value.id||y()}),{form:o,schema:e,attractions:m,guides:f,resetForm:i,onSubmit:k}},components:{Form:ne,InputTextWithValidation:ie}},Ee={class:"formgrid grid px-0 align-items-center mt-3"},we={class:"field col-12 flex flex-column"},Ve=d("label",{for:"typology"},"Bene",-1),Se={class:"field col-12"},xe=d("label",{from:"date_event"},"Data evento (Giorno in cui si effettuera la visita)",-1),Fe={class:"field col-3"},Te=d("label",{from:"start_at"},"Dalle",-1),Ae={class:"field col-3"},ke=d("label",{from:"end_at"},"Alle",-1),Ie={class:"field col-12"},Le=d("label",{from:"expire_at"},"Deadline acquisto",-1),Be={class:"field col-12 flex flex-column mb-1"},Oe=d("label",{for:"typology"},"Guida",-1),Re={key:0,class:"flex align-items-center"},$e={class:"flex align-items-center"},He={class:"field col-6 flex flex-column mt-3"},Me={class:"field col-6 flex flex-column mt-3"},Ne={class:"flex align-items-center justify-content-end mt-2"};function Ue(n,t,o,a,c,_){const r=v("Dropdown"),u=v("Calendar"),m=v("InputTextWithValidation"),f=v("Button"),i=v("Form");return F(),q(i,{onSubmit:a.onSubmit,"validation-schema":a.schema},{default:g(()=>[d("div",Ee,[d("div",we,[Ve,s(r,{modelValue:a.form.attraction_id,"onUpdate:modelValue":t[0]||(t[0]=e=>a.form.attraction_id=e),options:a.attractions,optionLabel:"name",optionValue:"id"},null,8,["modelValue","options"])]),d("div",Se,[xe,s(u,{inputId:"date_event",modelValue:a.form.date_event,"onUpdate:modelValue":t[1]||(t[1]=e=>a.form.date_event=e),dateFormat:"dd/mm/yy",manualInput:!1},null,8,["modelValue"])]),d("div",Fe,[Te,s(u,{inputId:"start_at",modelValue:a.form.start_at,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.start_at=e),dateFormat:"HH:mm",manualInput:!1,timeOnly:""},null,8,["modelValue"])]),d("div",Ae,[ke,s(u,{inputId:"end_at",modelValue:a.form.end_at,"onUpdate:modelValue":t[3]||(t[3]=e=>a.form.end_at=e),dateFormat:"HH:mm",manualInput:!1,timeOnly:""},null,8,["modelValue"])]),d("div",Ie,[Le,s(u,{inputId:"expire_at",modelValue:a.form.expire_at,"onUpdate:modelValue":t[4]||(t[4]=e=>a.form.expire_at=e),dateFormat:"dd/mm/yy",manualInput:!1},null,8,["modelValue"])]),d("div",Be,[Oe,s(r,{modelValue:a.form.guide_id,"onUpdate:modelValue":t[5]||(t[5]=e=>a.form.guide_id=e),options:a.guides},{value:g(e=>[e.value?(F(),M("div",Re,[d("div",null,D(e.value.first_name)+" "+D(e.value.last_name),1)])):ee("",!0)]),option:g(e=>[d("div",$e,[d("div",null,D(e.option.first_name)+" "+D(e.option.last_name),1)])]),_:1},8,["modelValue","options"])]),d("div",He,[s(m,{name:"min_seats",type:"number",label:"N.ro minimo partecipanti",modelValue:a.form.min_seats,"onUpdate:modelValue":t[6]||(t[6]=e=>a.form.min_seats=e)},null,8,["label","modelValue"])]),d("div",Me,[s(m,{name:"max_seats",type:"number",label:"N.ro massimo partecipanti",modelValue:a.form.max_seats,"onUpdate:modelValue":t[7]||(t[7]=e=>a.form.max_seats=e)},null,8,["label","modelValue"])])]),d("div",Ne,[s(f,{label:"Annulla",text:"",onClick:t[8]||(t[8]=e=>a.resetForm())}),s(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const Ge=A(Ce,[["render",Ue]]),qe=te({setup(){const n=p(),t=p({}),o=p(!1),a=p(),c=p(!1),_=p("Nuovo evento");return{reveliaCalendarTable:n,filters:t,visibleDialog:o,currentEvent:a,duplicate:c,headerDialog:_,onSubmit:function(e){a.value={},o.value=!1,t.value=e,n.value&&n.value.loadLazyData()},onShowDialog:function(){a.value={},c.value=!1,o.value=!0,_.value="Nuovo evento"},onEditEvent:function(e){a.value=e,c.value=!1,o.value=!0,_.value="Modifica evento"},onAddEvent:function(){a.value={},o.value=!1,n.value&&n.value.loadLazyData()},onDuplicateEvent:function(e){a.value=e,o.value=!0,c.value=!0,_.value="Duplica evento"}}},components:{ReveliaFiltersCalendar:ge,ReveliaCalendarTable:De,NewEventDialog:Ge}}),ze=d("h1",null,"Calendario",-1),je={class:"flex mt-6 justify-content-end"};function Pe(n,t,o,a,c,_){const r=v("ReveliaFiltersCalendar"),u=v("Button"),m=v("NewEventDialog"),f=v("Dialog"),i=v("ReveliaCalendarTable");return F(),M("div",null,[ze,s(r,{onOnSubmit:t[0]||(t[0]=e=>n.onSubmit(e))}),d("div",je,[s(u,{label:"Evento",icon:"pi pi-plus",rounded:"",outlined:"",onClick:t[1]||(t[1]=e=>n.onShowDialog())}),s(f,{visible:n.visibleDialog,"onUpdate:visible":t[2]||(t[2]=e=>n.visibleDialog=e),modal:"",header:n.headerDialog,style:{width:"30rem"}},{default:g(()=>[s(m,{current_event:n.currentEvent,onOnAddEvent:n.onAddEvent,filters:n.filters,duplicate:n.duplicate},null,8,["current_event","onOnAddEvent","filters","duplicate"])]),_:1},8,["visible","header"])]),s(i,{ref:"reveliaCalendarTable",filters:n.filters,onOnEditEvent:t[3]||(t[3]=e=>n.onEditEvent(e)),onOnDuplicateEvent:t[4]||(t[4]=e=>n.onDuplicateEvent(e))},null,8,["filters"])])}const it=A(qe,[["render",Pe]]);export{it as default};
