import{u as he}from"./location60418.js";import{u as te,e as B,s as N}from"./helpers60418.js";import{y as W,A as ne,C as ie,z as ae,B as se,o as H,l as y,a as Q,c as A,i as R,_ as G,r as m,p as X,b as U,v as Y,w as b,g as s,f as i,e as I,s as ce,h as F,t as O,q as P,F as q,D as oe,x as pe}from"../index60418.js";import{c as de,a as ue}from"./index.esm60418.js";import{F as me}from"./vee-validate.esm60418.js";import{I as _e}from"./InputTextWithValidation60418.js";import{u as fe}from"./category60418.js";import{e as re,g as Z,a as ve,b as ge}from"./formatData60418.js";import{D as Ce}from"./datetime60418.js";import"./attraction60418.js";import"./_commonjsHelpers60418.js";/* empty css                                                                            */class ${static async fetchAll(e){return(await W(`/admin/locations/${e}/courses`)).data}static async addCourse(e){return(await ne(`/admin/locations/${e.location_id}/courses`,e)).data.course}static async updateCourse(e){return(await ie(`/admin/locations/${e.location_id}/courses/${e.course.id}`,e)).data.course}static async deleteCourse(e){return await ae(`/admin/courses/${e}`)}}const be=se({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:t=>t.courses,responseCourses:t=>t.response_courses,getTotalCourses:t=>t.response_courses?t.response_courses.total:0,getCurrentCourse:t=>t.course},actions:{async fetchAllCourses(t){await $.fetchAll(t).then(e=>{this.response_courses=e,this.courses=e.courses})},async addCourse(t){await $.addCourse(t).then(e=>{this.course=e})},async updateCourse(t){await $.updateCourse(t).then(e=>{this.course=e})},async deleteCourse(t){await $.deleteCourse(t).then()}}});class ee{static async fetchAll(e){return(await W(`/admin/courses/${e}/tickets`)).data}static async addTicket(e){return await ne(`/admin/courses/${e.course_id}/tickets`,e)}static async updateTicket(e){return await ie(`/admin/courses/${e.course_id}/tickets`,e)}static async deleteTicket(e){return await ae(`/admin/courses/${e.course_id}/tickets/${e.ticket_id}`)}}const ye=se({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{}}),getters:{allTickets:t=>t.tickets,responseTickets:t=>t.response_tickets,getTotalTickets:t=>t.response_tickets?t.response_tickets.total:0,getCurrentTicket:t=>t.ticket},actions:{async fetchAllTickets(t){await ee.fetchAll(t).then(e=>{this.response_tickets=e,this.tickets=e.tickets})},async addTicket(t){await ee.addTicket(t).then()},async updateTicket(t){await ee.updateTicket(t).then()},async deleteTicket(t){await ee.deleteTicket(t).then()}}}),we={props:["course","location_id"],setup(t,e){H(()=>{t.course&&t.course.id&&(n.value=Object.assign({},t.course),l()),n.value.tickets=[]});const n=y({}),o=y([]),S=de({name:ue().required("Nome percorso obbligatorio")}),{showLoader:x,hideLoader:c}=te(),r=Q(),p=be(),w=fe(),f=ye(),h=y(!1),C=A(()=>p.allCourses),_=A(()=>w.allCategories),a=A(()=>f.responseTickets),v=A(()=>p.getCurrentCourse),g=function(){x();const T={course:Object.assign({},n.value),location_id:t.location_id};p.addCourse(T).then(()=>{c(),N(r,{message:"Percorso aggiunto correttamente",error:!1}),e.emit("onSubmit")}).catch(z=>{c(),B(r,z)})},l=async function(){let d=t.course.id?t.course.id:v.value.id;x(),await f.fetchAllTickets(d).then(()=>{c()}).catch(T=>{c(),B(r,T)})},D=function(){x();const T={course:Object.assign({},n.value),location_id:t.location_id};p.updateCourse(T).then(()=>{c(),N(r,{message:"Percorso modificato correttamente",error:!1}),e.emit("onSubmit")}).catch(z=>{c(),B(r,z)})},E=function(){n.value.id?D():g()},M=function(){let d={name:"",description:"",price:0};n.value.tickets.push(d),o.value.push(d)},L=function(d,T){d.id?V(d):n.value.tickets.splice(T,1)},V=async function(d){const T={course_id:t.course.id?t.course.id:v.value.id,ticket_id:d.id};x(),await f.deleteTicket(T).then(()=>{c(),N(r,{message:"Biglietto eliminato correttamente",error:!1}),l()}).catch(z=>{c(),B(r,z)})},j=function(d){let{newData:T,index:z}=d;n.value.tickets[z]=T,T.id?k(T):u(T)},u=async function(d){const T={course_id:t.course.id?t.course.id:v.value.id,ticket:d};await f.addTicket(T).then(()=>{c(),N(r,{message:"Biglietto aggiunto correttamente",error:!1}),l()}).catch(z=>{c(),B(r,z)})},k=async function(d){const T={course_id:t.course.id?t.course.id:v.value.id,ticket:d};await f.updateTicket(T).then(()=>{c(),N(r,{message:"Biglietto aggiornato correttamente",error:!1}),l()}).catch(z=>{c(),B(r,z)})};return R(_,()=>{n.value.category||(n.value.category=_.value[0])}),R(a,()=>{a.value&&a.value.tickets.length>0&&(n.value.tickets=Object.assign([],a.value.tickets))}),R(v,()=>{n.value=Object.assign({},v.value)}),{form:n,schema:S,loading:h,editingRows:o,response_tickets:a,onSubmit:E,addTicket:M,onDeleteTicket:L,onRowEditSave:j,courses:C,categories:_}},components:{Form:me,InputTextWithValidation:_e}},xe={class:"formgrid grid mt-3"},Ve={class:"field col-12"},De={class:"field col-12"},Te=s("label",{for:"description"},"Descrizione",-1),Se={key:0,class:"flex justify-content-end mt-4 mb-3"},Ee={class:"w-full"},Be={class:"flex justify-content-center"},Ae={class:"flex align-items-center justify-content-end mt-6"};function Ue(t,e,n,o,S,x){const c=m("InputTextWithValidation"),r=m("Textarea"),p=m("Button"),w=m("InputText"),f=m("Column"),h=m("DataTable"),C=m("Form"),_=X("tooltip");return U(),Y(C,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:b(()=>[s("div",xe,[s("div",Ve,[i(c,{name:"name",label:"Nome percorso*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=a=>o.form.name=a)},null,8,["modelValue"])]),s("div",De,[Te,i(r,{rows:"5",cols:"30",name:"description",label:"Nome percorso*",modelValue:o.form.description,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.description=a),class:"w-full"},null,8,["modelValue"])])]),o.form.id?(U(),I("div",Se,[i(p,{label:"Tipologia biglietto",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=a=>o.addTicket())})])):ce("",!0),o.form.id?(U(),Y(h,{key:1,value:o.form.tickets,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[3]||(e[3]=a=>o.editingRows=a),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:b(()=>[F(" Nessun biglietto trovato. ")]),default:b(()=>[i(f,{header:"Tipo biglietto",field:"name",style:{"min-width":"150px"}},{editor:b(({data:a,field:v})=>[i(w,{modelValue:a[v],"onUpdate:modelValue":g=>a[v]=g},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(f,{header:"Descrizione",field:"description"},{editor:b(({data:a,field:v})=>[s("div",Ee,[i(r,{modelValue:a[v],"onUpdate:modelValue":g=>a[v]=g,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),i(f,{header:"Prezzo",field:"price",bodyStyle:"min-width: 6rem"},{body:b(({data:a})=>[F(" € "+O((+a.price).toFixed(2)),1)]),editor:b(({data:a,field:v})=>[i(w,{modelValue:a[v],"onUpdate:modelValue":g=>a[v]=g},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(f,{rowEditor:!0,bodyStyle:"text-align:center; padding-right:0;min-width: 6rem"}),i(f,{header:"",style:{width:"3rem","padding-left":"0"}},{body:b(({data:a,index:v})=>[s("div",Be,[P(i(p,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:g=>o.onDeleteTicket(a,v)},null,8,["onClick"]),[[_,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])):ce("",!0),s("div",Ae,[i(p,{label:"Annulla",text:"",onClick:e[4]||(e[4]=a=>t.$emit("onClose"))}),i(p,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const je=G(we,[["render",Ue]]),ze={props:["location_id"],setup(t){H(()=>{x.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,_()});const e=Q(),n=y(),o=y(),S=y(),x=y(!0),c=y(),r=y(0),p=y(!1),{showLoader:w,hideLoader:f}=te(),h=be(),C=A(()=>h.responseCourses);function _(){w(),setTimeout(()=>{a()},Math.random()*1e3+250)}const a=async function(){x.value=!0,await h.fetchAllCourses(t.location_id).then(()=>{x.value=!1,f()}).catch(E=>{x.value=!1,f(),B(e,E)})},v=function(E){S.value=E,p.value=!0},g=function(E){w();const M={course:E,location_id:t.location_id};h.updateCourse(M).then(()=>{f(),N(e,{message:"Percorso modificato correttamente",error:!1})}).catch(L=>{f(),B(e,L)})},l=function(){return S.value&&S.value.id?"Modifica percorso":"Aggiungi percorso"},D=function(){a()};return R(t,()=>{t.location_id&&a()}),{dt:n,responseCourses:C,loading:x,totalRecords:r,lazyParams:c,op:o,visible:p,currentCourse:S,loadLazyData:_,onEditCourse:v,closeDialog:D,getHeader:l,updateCourse:g}},components:{CourseDialog:je}},Ie={class:"flex justify-content-end mt-4 mb-3"},Re={class:"flex justify-content-center"};function Me(t,e,n,o,S,x){const c=m("Button"),r=m("Column"),p=m("InputSwitch"),w=m("DataTable"),f=m("CourseDialog"),h=m("Dialog"),C=X("tooltip");return U(),I(q,null,[s("div",Ie,[i(c,{label:"Percorso",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=_=>o.onEditCourse({}))})]),i(w,{value:o.responseCourses.courses,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[F(" Nessun percorso trovato. ")]),default:b(()=>[i(r,{header:"Nome",field:"name"}),i(r,{header:"Tipologie biglietti"},{body:b(({data:_})=>[(U(!0),I(q,null,oe(_.tickets,a=>(U(),I("div",{key:a.id},O(a.name),1))),128))]),_:1}),i(r,{header:"Prezzo"},{body:b(({data:_})=>[(U(!0),I(q,null,oe(_.tickets,a=>(U(),I("div",{key:a.id}," € "+O((+a.price).toFixed(2)),1))),128))]),_:1}),i(r,{header:"Stato"},{body:b(({data:_})=>[i(p,{modelValue:_.public,"onUpdate:modelValue":a=>_.public=a,onChange:a=>o.updateCourse(_)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),i(r,{header:""},{body:b(({data:_})=>[s("div",Re,[P(i(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:a=>o.onEditCourse(_)},null,8,["onClick"]),[[C,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),i(h,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=_=>o.visible=_),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:b(()=>[i(f,{course:o.currentCourse,location_id:n.location_id,onOnSubmit:e[1]||(e[1]=_=>o.closeDialog()),onOnClose:e[2]||(e[2]=_=>o.visible=!1)},null,8,["course","location_id"])]),_:1},8,["visible","header"])],64)}const Le=G(ze,[["render",Me]]);class K{static async fetchAll(e){return e?(await W("/admin/booking_rules",e)).data:{}}static async getCourses(e){return(await W("/admin/booking_rules/courses",e)).data}static async getTickets(e){return(await W("/admin/booking_rules/tickets",e)).data}static async addConfiguration(e){return await ne("/admin/booking_rules",e)}static async updateConfiguration(e){return await ie(`/admin/booking_rules/${e.booking_rule.id}`,e)}static async deleteConfiguration(e){return e==null?{}:await ae(`/admin/booking_rules/${e}`)}}const le=se({id:"configuration",state:()=>({configuration:{},configurations:[],response_configurations:{},response_courses:{},response_tickets:{}}),getters:{allConfigurations:t=>t.configurations,responseConfigurations:t=>t.response_configurations,getTotalConfigurations:t=>t.response_configurations?t.response_configurations.total:0,getCurrentConfiguration:t=>t.configuration,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets},actions:{async fetchAllConfigurations(t){await K.fetchAll(t).then(e=>{this.response_configurations=e,this.configurations=e.configurations})},async getAllCourses(t){await K.getCourses(t).then(e=>{this.response_courses=e})},async getAllTickets(t){await K.getTickets(t).then(e=>{this.response_tickets=e})},async addConfiguration(t){await K.addConfiguration(t).then()},async updateConfiguration(t){await K.updateConfiguration(t).then()},async deleteConfiguration(t){t!=null&&await K.deleteConfiguration(t).then()}}}),Ne={props:["config","location_id","course_id","duplicate"],setup(t,e){H(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.from_date&&(n.value.from_date=re(n.value.from_date)),n.value.to_date&&(n.value.to_date=re(n.value.to_date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_rule_slots=[]),j()});const n=y({}),o=y([]),S=y(!1),x=de({name_config:ue().required("Nome configurazione obbligatoria")}),{showLoader:c,hideLoader:r}=te(),p=Q(),w=fe(),f=y(!1),h=le(),C=A(()=>w.allCategories),_=A(()=>h.responseTickets),a=A(()=>h.responseCourses),v=function(){c();const u=Object.assign({},n.value);u.from_date&&(u.from_date=Z(u.from_date)),u.to_date&&(u.to_date=Z(u.to_date)),u.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(d=>{d.available_seats!=""&&d.start_at!=""&&u.booking_rule_slots.push(d)});const k={booking_rule:u};h.addConfiguration(k).then(()=>{r(),N(p,{message:"Configurazione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(d=>{r(),B(p,d)})},g=function(){c();const u=Object.assign({},n.value);u.from_date&&(u.from_date=Z(u.from_date)),u.to_date&&(u.to_date=Z(u.to_date)),u.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(d=>{d.available_seats!=""&&d.start_at!=""&&u.booking_rule_slots.push(d)});const k={booking_rule:u};h.updateConfiguration(k).then(()=>{r(),N(p,{message:"Configurazione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(d=>{r(),B(p,d)})},l=function(){n.value.id?g():v()},D=function(){let u={};u.price=0,n.value.tickets.unshift(u),o.value.push(n.value.tickets[0])},E=function(u){let{newData:k,index:d}=u;n.value.booking_rule_slots[d]=k;let z={start_at:"",available_seats:"",id:+n.value.booking_rule_slots[n.value.booking_rule_slots.length-1].id-1};n.value.booking_rule_slots.push(z),o.value=[z]},M=function(){let u={start_at:"",available_seats:"",id:"-1"};n.value.booking_rule_slots.push(u),o.value.push(u)},L=function(u,k){n.value.booking_rule_slots.splice(k,1)},V=function(u){u?n.value.wdays=[0,1,2,3,4,5,6]:n.value.wdays=[]},j=function(){const u=new Map;u.set("location_id",n.value.location_id),u.set("course_id",n.value.course_id),h.getAllTickets(u).catch(k=>{B(p,k)})};return R(C,()=>{n.value.category||(n.value.category=C.value[0])}),{form:n,schema:x,loading:f,editingRows:o,check_all:S,onSubmit:l,addTicket:D,onRowEditSave:E,checkAll:V,deleteSlot:L,addSlot:M,categories:C,responseCourses:a,responseTickets:_}},components:{Form:me,InputTextWithValidation:_e}};const Oe={class:"formgrid grid mt-3"},Pe={class:"field col-12"},Fe={class:"field flex flex-column col-6"},We=s("label",{for:"location"},"Percorso",-1),qe={class:"field col-3"},He=s("label",{from:"date_from"},"Dal",-1),Ge={class:"field col-3"},Ke=s("label",{from:"date_to"},"Al",-1),Je={class:"field col-12 mt-3"},Qe=s("label",null,"Giorni",-1),Xe={class:"card flex flex-wrap gap-3 mt-2"},Ye={class:"flex align-items-center mr-4"},Ze=s("label",{for:"all",class:"ml-2"}," Tutti i giorni ",-1),$e={class:"flex align-items-center"},eo=s("label",{for:"lun",class:"ml-2"}," Lun ",-1),oo={class:"flex align-items-center"},to=s("label",{for:"mar",class:"ml-2"}," Mar ",-1),no={class:"flex align-items-center"},io=s("label",{for:"mer",class:"ml-2"}," Mer ",-1),ao={class:"flex align-items-center"},so=s("label",{for:"gio",class:"ml-2"}," Gio ",-1),lo={class:"flex align-items-center"},co=s("label",{for:"ven",class:"ml-2"}," Ven ",-1),ro={class:"flex align-items-center"},uo=s("label",{for:"sab",class:"ml-2"}," Sab ",-1),mo={class:"flex align-items-center"},_o=s("label",{for:"dom",class:"ml-2"}," Dom ",-1),fo={class:"field col-3 mt-3"},go=s("label",null,"Biglietti",-1),po={for:"ticket.id",class:"ml-2 flex align-items-center"},vo={class:"inline-block",style:{"min-width":"150px"}},bo={class:"text-right"},ko=s("div",{class:"col-9"},null,-1),ho={class:"col-8 mt-3"},Co={class:"field flex justify-content-between align-items-end mt-4 mb-3"},yo=s("label",null,"Orari",-1),wo={class:"flex justify-content-center"},xo={class:"flex align-items-center justify-content-end mt-6"};function Vo(t,e,n,o,S,x){const c=m("InputTextWithValidation"),r=m("Dropdown"),p=m("Calendar"),w=m("Checkbox"),f=m("Button"),h=m("InputMask"),C=m("Column"),_=m("InputNumber"),a=m("DataTable"),v=m("Form"),g=X("tooltip");return U(),Y(v,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:b(()=>[s("div",Oe,[s("div",Pe,[i(c,{name:"name_config",label:"Nome configurazione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.form.name=l),id:"name_config",type:"text"},null,8,["modelValue"])]),s("div",Fe,[We,i(r,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=l=>o.form.course_id=l),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location"},null,8,["modelValue","options"])]),s("div",qe,[He,i(p,{inputId:"date_from",modelValue:o.form.from_date,"onUpdate:modelValue":e[2]||(e[2]=l=>o.form.from_date=l),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),s("div",Ge,[Ke,i(p,{inputId:"date_to",modelValue:o.form.to_date,"onUpdate:modelValue":e[3]||(e[3]=l=>o.form.to_date=l),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),s("div",Je,[Qe,s("div",Xe,[s("div",Ye,[i(w,{modelValue:o.check_all,"onUpdate:modelValue":[e[4]||(e[4]=l=>o.check_all=l),e[5]||(e[5]=l=>o.checkAll(l))],inputId:"all",name:"week",binary:!0},null,8,["modelValue"]),Ze]),s("div",$e,[i(w,{modelValue:o.form.wdays,"onUpdate:modelValue":e[6]||(e[6]=l=>o.form.wdays=l),inputId:"lun",name:"week",value:1},null,8,["modelValue"]),eo]),s("div",oo,[i(w,{modelValue:o.form.wdays,"onUpdate:modelValue":e[7]||(e[7]=l=>o.form.wdays=l),inputId:"mar",name:"week",value:2},null,8,["modelValue"]),to]),s("div",no,[i(w,{modelValue:o.form.wdays,"onUpdate:modelValue":e[8]||(e[8]=l=>o.form.wdays=l),inputId:"mer",name:"week",value:3},null,8,["modelValue"]),io]),s("div",ao,[i(w,{modelValue:o.form.wdays,"onUpdate:modelValue":e[9]||(e[9]=l=>o.form.wdays=l),inputId:"gio",name:"week",value:4},null,8,["modelValue"]),so]),s("div",lo,[i(w,{modelValue:o.form.wdays,"onUpdate:modelValue":e[10]||(e[10]=l=>o.form.wdays=l),inputId:"ven",name:"week",value:5},null,8,["modelValue"]),co]),s("div",ro,[i(w,{modelValue:o.form.wdays,"onUpdate:modelValue":e[11]||(e[11]=l=>o.form.wdays=l),inputId:"sab",name:"week",value:6},null,8,["modelValue"]),uo]),s("div",mo,[i(w,{modelValue:o.form.wdays,"onUpdate:modelValue":e[12]||(e[12]=l=>o.form.wdays=l),inputId:"dom",name:"week",value:0},null,8,["modelValue"]),_o])])]),s("div",fo,[go,(U(!0),I(q,null,oe(o.responseTickets.tickets,l=>(U(),I("div",{key:l.id,class:"flex align-items-center mb-2"},[i(w,{modelValue:o.form.booking_rule_ticket_ids,"onUpdate:modelValue":e[13]||(e[13]=D=>o.form.booking_rule_ticket_ids=D),inputId:"ticket.id",name:"category",value:l.id},null,8,["modelValue","value"]),s("label",po,[s("div",vo,O(l.name),1),s("div",bo,"€ "+O(l.price),1)])]))),128))]),ko,s("div",ho,[s("div",Co,[yo,i(f,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[14]||(e[14]=l=>o.addSlot())})]),i(a,{value:o.form.booking_rule_slots,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[15]||(e[15]=l=>o.editingRows=l),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:b(()=>[F(" Nessuno slot orario trovato. ")]),default:b(()=>[i(C,{header:"Ora",field:"start_at"},{editor:b(({data:l,field:D})=>[i(h,{id:"basic",modelValue:l[D],"onUpdate:modelValue":E=>l[D]=E,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(C,{header:"Posti",field:"available_seats"},{editor:b(({data:l,field:D})=>[i(_,{modelValue:l[D],"onUpdate:modelValue":E=>l[D]=E,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(C,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),i(C,{header:"",style:{width:"3rem","padding-left":"0"}},{body:b(({data:l,index:D})=>[s("div",wo,[P(i(f,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:E=>o.deleteSlot(l,D)},null,8,["onClick"]),[[g,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","editingRows","onRowEditSave"])])]),s("div",xo,[i(f,{label:"Annulla",text:"",onClick:e[16]||(e[16]=l=>t.$emit("onClose"))}),i(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const Do=G(Ne,[["render",Vo]]),To={props:["location_id"],setup(t){H(()=>{c.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,t.location_id&&l(t.location_id)});const e=Q(),n=y(),o=y(),S=y(),x=y(),c=y(!0),r=y(),p=y(0),w=y(!1),f=y(),h=y(!1),C=le(),_=A(()=>C.responseConfigurations),a=pe(),v=A(()=>a.submitDialog),g=A(()=>C.responseCourses),l=async function(k){const d=new Map;d.set("location_id",k),await C.getAllCourses(d).then(()=>{c.value=!1}).catch(T=>{c.value=!1,B(e,T)})},D=async function(k){if(!k)return;c.value=!0;const d=new Map;d.set("location_id",t.location_id),d.set("course_id",k),await C.fetchAllConfigurations(d).then(()=>{c.value=!1}).catch(T=>{c.value=!1,B(e,T)})},E=function(k){S.value=k;let d="Sei sicuro di voler eliminare questa configurazione?";a.setDialog("Elimina configurazione","Elimina","Annulla",d),a.setBtnSubmit(!1),a.setDynamicDialogVisibility(!0)},M=async function(){S.value&&await C.deleteConfiguration(S.value).then(()=>{c.value=!1,N(e,{message:"Configurazione eliminata correttamente",error:!1}),D(f.value)}).catch(k=>{c.value=!1,B(e,k)})},L=function(k,d){x.value=k,w.value=!0,h.value=d},V=function(k){return k.map(T=>Ce.local(2022,1,2+T).setLocale("it").toFormat("ccc")).join(", ")},j=function(k){D(k),w.value=!1},u=function(){return h.value?"Duplica configurazione":x.value&&x.value.id&&!h.value?"Modifica configurazione":"Nuova configurazione"};return R(v,k=>{v.value&&M()}),R(g,()=>{g.value.courses&&g.value.courses[0]&&(f.value=g.value.courses[0].id,D(f.value))}),R(t,()=>{t.location_id&&l(t.location_id)}),{dt:n,responseConfigurations:_,loading:c,totalRecords:p,lazyParams:r,op:o,visible:w,currentConfiguration:x,responseCourses:g,course_id:f,flag_duplicate:h,fromMMDDtoDDMM:re,onDeleteConfiguration:M,confirmDelete:E,onEditConfiguration:L,fetchAllConfigurations:D,convertWdays:V,closeDialog:j,getHeader:u}},components:{ConfigurationDialog:Do}},So={class:"flex justify-content-between mt-4 mb-3"},Eo={class:"field flex flex-column"},Bo=s("label",{for:"location"},"Percorso",-1),Ao={class:"capitalize"},Uo={class:"flex justify-content-center"};function jo(t,e,n,o,S,x){const c=m("Dropdown"),r=m("Button"),p=m("Column"),w=m("InputSwitch"),f=m("DataTable"),h=m("ConfigurationDialog"),C=m("Dialog"),_=X("tooltip");return U(),I(q,null,[s("div",So,[s("div",Eo,[Bo,i(c,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=a=>o.course_id=a),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=a=>o.fetchAllConfigurations(o.course_id))},null,8,["modelValue","options"])]),i(r,{label:"Configurazione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=a=>o.onEditConfiguration({},!1))})]),i(f,{value:o.responseConfigurations.booking_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[F(" Nessuna configurazione trovata. ")]),default:b(()=>[i(p,{header:"Nome",field:"name"}),i(p,{header:"Dal Al"},{body:b(({data:a})=>[F(O(o.fromMMDDtoDDMM(a.from_date))+" - "+O(o.fromMMDDtoDDMM(a.to_date)),1)]),_:1}),i(p,{header:"Valida il",field:"week"},{body:b(({data:a})=>[s("div",Ao,O(o.convertWdays(a.wdays)),1)]),_:1}),i(p,{header:"Stato"},{body:b(({data:a})=>[i(w,{modelValue:a.enabled,"onUpdate:modelValue":v=>a.enabled=v},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(p,{header:""},{body:b(({data:a})=>[s("div",Uo,[P(i(r,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditConfiguration(a,!0)},null,8,["onClick"]),[[_,"Duplica",void 0,{top:!0}]]),P(i(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditConfiguration(a,!1)},null,8,["onClick"]),[[_,"Modifica",void 0,{top:!0}]]),P(i(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.confirmDelete(a.id)},null,8,["onClick"]),[[_,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),i(C,{visible:o.visible,"onUpdate:visible":e[5]||(e[5]=a=>o.visible=a),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:b(()=>[i(h,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=a=>o.closeDialog(a)),onOnClose:e[4]||(e[4]=a=>o.visible=!1),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const zo=G(To,[["render",jo]]);class J{static async fetchAll(e){return e?(await W("/admin/booking_exception_rules",e)).data:{}}static async getCourses(e){return(await W("/admin/booking_exception_rules/courses",e)).data}static async getTickets(e){return(await W("/admin/booking_exception_rules/tickets",e)).data}static async addBookingException(e){return await ne("/admin/booking_exception_rules",e)}static async updateBookingException(e){return await ie(`/admin/booking_exception_rules/${e.booking_rule.id}`,e)}static async deleteBookingException(e){return e==null?{}:await ae(`/admin/booking_exception_rules/${e}`)}}const ke=se({id:"booking_exception",state:()=>({booking_exception:{},booking_exceptions:[],response_booking_exceptions:{},response_courses:{},response_tickets:{}}),getters:{allBookingExceptions:t=>t.booking_exceptions,responseBookingExceptions:t=>t.response_booking_exceptions,getTotalBookingExceptions:t=>t.response_booking_exceptions?t.response_booking_exceptions.total:0,getCurrentBookingException:t=>t.booking_exception,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets},actions:{async fetchAllBookingExceptions(t){await J.fetchAll(t).then(e=>{this.response_booking_exceptions=e,this.booking_exceptions=e.booking_exceptions})},async getAllCourses(t){await J.getCourses(t).then(e=>{this.response_courses=e})},async getAllTickets(t){await J.getTickets(t).then(e=>{this.response_tickets=e})},async addBookingException(t){await J.addBookingException(t).then()},async updateBookingException(t){await J.updateBookingException(t).then()},async deleteBookingException(t){t!=null&&await J.deleteBookingException(t).then()}}}),Io={props:["config","location_id","course_id","duplicate"],setup(t,e){H(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.date&&(n.value.date=ve(n.value.date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_exception_rule_slots=[]),L();let V={start_at:"",available_seats:"",id:"-1"};n.value.booking_exception_rule_slots.push(V)});const n=y({}),o=y([]),S=de({name:ue().required("Nome eccezione obbligatoria")}),{showLoader:x,hideLoader:c}=te(),r=Q(),p=fe(),w=y(!1),f=le(),h=ke(),C=A(()=>p.allCategories),_=A(()=>f.responseTickets),a=A(()=>f.responseCourses),v=function(){x();const V=Object.assign({},n.value);V.date&&(V.date=ge(V.date)),V.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(u=>{u.available_seats!=""&&u.start_at!=""&&V.booking_exception_rule_slots.push(u)});const j={booking_exception_rule:V};h.addBookingException(j).then(()=>{c(),N(r,{message:"Eccezione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(u=>{c(),B(r,u)})},g=function(){x();const V=Object.assign({},n.value);V.date&&(V.date=ge(V.date)),V.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(u=>{u.available_seats!=""&&u.start_at!=""&&V.booking_exception_rule_slots.push(u)});const j={booking_exception_rule:V};h.updateBookingException(j).then(()=>{c(),N(r,{message:"Eccezione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(u=>{c(),B(r,u)})},l=function(){n.value.id?g():v()},D=function(){let V={};V.price=0,n.value.tickets.unshift(V),o.value.push(n.value.tickets[0])},E=function(V){let{newData:j,index:u}=V;n.value.booking_exception_rule_slots[u]=j;let d={start_at:"",available_seats:"",id:+n.value.booking_exception_rule_slots[n.value.booking_exception_rule_slots.length-1].id-1};n.value.booking_exception_rule_slots.push(d),o.value=[d]},M=function(V,j){n.value.booking_exception_rule_slots.splice(j,1)},L=function(){const V=new Map;V.set("location_id",n.value.location_id),V.set("course_id",n.value.course_id),f.getAllTickets(V).catch(j=>{B(r,j)})};return R(C,()=>{n.value.category||(n.value.category=C.value[0])}),{form:n,schema:S,loading:w,editingRows:o,onSubmit:l,addTicket:D,onRowEditSave:E,deleteSlot:M,categories:C,responseTickets:_,responseCourses:a}},components:{Form:me,InputTextWithValidation:_e}},Ro={class:"formgrid grid mt-3"},Mo={class:"field col-12"},Lo={class:"field flex flex-column col-6"},No=s("label",{for:"location"},"Percorso",-1),Oo={class:"field col-3"},Po=s("label",{from:"date"},"Il",-1),Fo=s("div",{class:"field col-3"},null,-1),Wo={class:"field col-3 mt-3"},qo=s("label",null,"Biglietti",-1),Ho=["for"],Go={class:"inline-block",style:{"min-width":"150px"}},Ko={class:"text-right"},Jo=s("div",{class:"col-9"},null,-1),Qo={class:"field col-8 mt-3"},Xo=s("label",null,"Orari",-1),Yo={class:"flex justify-content-center"},Zo={class:"flex align-items-center justify-content-end mt-6"};function $o(t,e,n,o,S,x){const c=m("InputTextWithValidation"),r=m("Dropdown"),p=m("Calendar"),w=m("Checkbox"),f=m("InputText"),h=m("Column"),C=m("Button"),_=m("DataTable"),a=m("Form"),v=X("tooltip");return U(),Y(a,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:b(()=>[s("div",Ro,[s("div",Mo,[i(c,{name:"name",label:"Nome eccezione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=g=>o.form.name=g)},null,8,["modelValue"])]),s("div",Lo,[No,i(r,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=g=>o.form.course_id=g),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location"},null,8,["modelValue","options"])]),s("div",Oo,[Po,i(p,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[2]||(e[2]=g=>o.form.date=g),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),Fo,s("div",Wo,[qo,(U(!0),I(q,null,oe(o.responseTickets.tickets,g=>(U(),I("div",{key:g.id,class:"flex align-items-center mb-2"},[i(w,{modelValue:o.form.booking_exception_rule_ticket_ids,"onUpdate:modelValue":e[3]||(e[3]=l=>o.form.booking_exception_rule_ticket_ids=l),inputId:g.id+"",name:"category",value:g.id},null,8,["modelValue","inputId","value"]),s("label",{for:g.id+"",class:"ml-2 flex align-items-center"},[s("div",Go,O(g.name),1),s("div",Ko,"€ "+O(g.price),1)],8,Ho)]))),128))]),Jo,s("div",Qo,[Xo,i(_,{value:o.form.booking_exception_rule_slots,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[4]||(e[4]=g=>o.editingRows=g),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:b(()=>[F(" Nessuno slot orario trovato. ")]),default:b(()=>[i(h,{header:"Ora",field:"start_at"},{editor:b(({data:g,field:l})=>[i(f,{modelValue:g[l],"onUpdate:modelValue":D=>g[l]=D},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(h,{header:"Posti",field:"available_seats"},{editor:b(({data:g,field:l})=>[i(f,{modelValue:g[l],"onUpdate:modelValue":D=>g[l]=D},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(h,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),i(h,{header:"",style:{width:"3rem","padding-left":"0"}},{body:b(({data:g,index:l})=>[s("div",Yo,[P(i(C,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:D=>o.deleteSlot(g,l)},null,8,["onClick"]),[[v,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])])]),s("div",Zo,[i(C,{label:"Annulla",text:""}),i(C,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const et=G(Io,[["render",$o]]),ot={props:["location_id"],setup(t){H(()=>{c.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,t.location_id&&D(t.location_id)});const e=Q(),n=y(),o=y(),S=y(),x=y(),c=y(!0),r=y(),p=y(0),w=y(!1);y([]);const f=y(),h=y(!1),C=le(),_=ke(),a=A(()=>_.responseBookingExceptions),v=pe(),g=A(()=>v.submitDialog),l=A(()=>C.responseCourses),D=async function(k){const d=new Map;d.set("location_id",k),await C.getAllCourses(d).then(()=>{c.value=!1}).catch(T=>{c.value=!1,B(e,T)})},E=async function(k){if(!k)return;c.value=!0;const d=new Map;d.set("location_id",t.location_id),d.set("course_id",k),await _.fetchAllBookingExceptions(d).then(()=>{c.value=!1}).catch(T=>{c.value=!1,B(e,T)})},M=function(k){S.value=k;let d="Sei sicuro di voler eliminare questa eccezione?";v.setDialog("Elimina eccezione","Elimina","Annulla",d),v.setBtnSubmit(!1),v.setDynamicDialogVisibility(!0)},L=async function(){S.value&&await _.deleteBookingException(S.value).then(()=>{c.value=!1,N(e,{message:"Eccezione eliminata correttamente",error:!1}),E(f.value)}).catch(k=>{c.value=!1,B(e,k)})},V=function(k,d){x.value=k,w.value=!0,h.value=d},j=function(k){E(k),w.value=!1},u=function(){return h.value?"Duplica eccezione":x.value&&x.value.id&&!h.value?"Modifica eccezione":"Nuova eccezione"};return R(g,k=>{k&&L()}),R(l,()=>{f.value=l.value.courses[0].id,E(f.value)}),R(t,()=>{t.location_id&&D(t.location_id)}),{dt:n,responseBookingExceptions:a,loading:c,totalRecords:p,lazyParams:r,op:o,visible:w,currentConfiguration:x,responseCourses:l,course_id:f,flag_duplicate:h,onDeleteConfigurationException:L,confirmDelete:M,onEditConfiguration:V,getHeader:u,closeDialog:j,fetchAllBookingExceptions:E,formatPrettyDate:ve}},components:{BookingExceptionDialog:et}},tt={class:"flex justify-content-between mt-4 mb-3"},nt={class:"field flex flex-column"},it=s("label",{for:"location"},"Percorso",-1),at={class:"flex justify-content-center"};function st(t,e,n,o,S,x){const c=m("Dropdown"),r=m("Button"),p=m("Column"),w=m("InputSwitch"),f=m("DataTable"),h=m("BookingExceptionDialog"),C=m("Dialog"),_=X("tooltip");return U(),I(q,null,[s("div",tt,[s("div",nt,[it,i(c,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=a=>o.course_id=a),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=a=>o.fetchAllBookingExceptions(o.course_id))},null,8,["modelValue","options"])]),i(r,{label:"Eccezione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=a=>o.onEditConfiguration({},!1))})]),i(f,{value:o.responseBookingExceptions.booking_exception_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[F(" Nessuna eccezione trovata. ")]),default:b(()=>[i(p,{header:"Nome",field:"name"}),i(p,{header:"Il"},{body:b(({data:a})=>[F(O(o.formatPrettyDate(a.date)),1)]),_:1}),i(p,{header:"Stato"},{body:b(({data:a})=>[i(w,{modelValue:a.enabled,"onUpdate:modelValue":v=>a.enabled=v},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(p,{header:""},{body:b(({data:a})=>[s("div",at,[P(i(r,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditConfiguration(a,!0)},null,8,["onClick"]),[[_,"Duplica",void 0,{top:!0}]]),P(i(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditConfiguration(a,!1)},null,8,["onClick"]),[[_,"Modifica",void 0,{top:!0}]]),P(i(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.confirmDelete(a.id)},null,8,["onClick"]),[[_,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),i(C,{visible:o.visible,"onUpdate:visible":e[4]||(e[4]=a=>o.visible=a),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:b(()=>[i(h,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=a=>o.closeDialog(a)),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const lt=G(ot,[["render",st]]),ct={setup(){H(()=>{x()});const t=y({}),e=he(),n=y(),o=A(()=>e.allLocations),S=A(()=>e.getCurrentLocation),x=async function(){await e.fetchAllLocations().then(()=>{S.value&&(t.value.location=S.value)})},c=function(){e.updateCurrenLocation(t.value.location)};return R(o,()=>{t.value.location_id=o.value[0].id}),{form:t,courseTable:n,locations:o,onChangeLocation:c}},components:{CourseTable:Le,OpeningsTable:zo,BookingExceptionTable:lt}},rt=s("h1",null,"Configurazioni",-1),dt={class:"field col-3 flex flex-column"},ut=s("label",{for:"location"},"Location",-1);function mt(t,e,n,o,S,x){var C;const c=m("Dropdown"),r=m("CourseTable"),p=m("TabPanel"),w=m("OpeningsTable"),f=m("BookingExceptionTable"),h=m("TabView");return U(),I("div",null,[rt,s("div",dt,[ut,i(c,{modelValue:o.form.location,"onUpdate:modelValue":e[0]||(e[0]=_=>o.form.location=_),options:o.locations,optionLabel:"name",placeholder:"",name:"location",onChange:e[1]||(e[1]=_=>o.onChangeLocation())},null,8,["modelValue","options"])]),(C=o.form.location)!=null&&C.id?(U(),Y(h,{key:0},{default:b(()=>[i(p,{header:"Percorsi"},{default:b(()=>{var _;return[i(r,{location_id:(_=o.form.location)==null?void 0:_.id,ref:"courseTable"},null,8,["location_id"])]}),_:1}),i(p,{header:"Aperture"},{default:b(()=>[i(w,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),i(p,{header:"Eccezioni"},{default:b(()=>[i(f,{location_id:o.form.location.id},null,8,["location_id"])]),_:1})]),_:1})):ce("",!0)])}const Vt=G(ct,[["render",mt]]);export{Vt as default};
