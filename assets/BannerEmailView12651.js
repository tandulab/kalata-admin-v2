import{y as G,C as H,B as z,o as F,a as R,l as h,c as S,_ as T,r as f,p as j,b as i,v as V,w as y,h as I,f as r,t as C,e as d,g as t,q as E,A as N,m as B,z as J,u as K,i as Q,s as w}from"../index12651.js";import{e as O,u as W,s as X}from"./helpers12651.js";import{F as Y}from"./vee-validate.esm12651.js";class A{static async fetchAll(){return(await G("/admin/banners")).data}static async updateBanner(o){return(await H(`/admin/banners/${o.banner.id}`,o)).data}}const M=z({id:"banner",state:()=>({banner:{},banners:[],response_banners:{}}),getters:{allBanners:n=>n.banners,responseBanners:n=>n.response_banners,getTotalBanners:n=>n.response_banners?n.response_banners.total:0,getCurrentBanner:n=>n.banner},actions:{async fetchAll(){await A.fetchAll().then(n=>{this.response_banners=n})},async updateBanner(n){await A.updateBanner(n).then()}}}),Z={setup(){F(()=>{g.value=!0,b.value={first:0,rows:o.value.rows,sortField:null,sortOrder:null},b.value.page=0,u()});const n=R(),o=h(),a=h(),e=h(),g=h(!0),b=h(),c=h(0),m=M(),_=S(()=>m.responseBanners);function u(){g.value=!0,setTimeout(()=>{l()},Math.random()*1e3+250)}const l=async function(){await m.fetchAll().then(()=>{g.value=!1}).catch(p=>{g.value=!1,O(n,p)})};return{dt:o,responseBanners:_,loading:g,totalRecords:c,lazyParams:b,currentOrder:a,op:e,loadLazyData:u}}};const $=["src"],ee={key:1,class:"block"},oe=["href"],ne={key:3},te=["src"],ae={key:1,class:"block"},le=["href"],se={key:3,class:"block"},ie=["src"],re={key:1,class:"block"},de=["href"],ce={key:3,class:"block"},me={class:"flex justify-content-center"};function _e(n,o,a,e,g,b){const c=f("Column"),m=f("Button"),_=f("DataTable"),u=j("tooltip");return i(),V(_,{value:e.responseBanners.banners,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",class:"banner"},{empty:y(()=>[I(" Nessun banner email trovato. ")]),default:y(()=>[r(c,{header:"Location",field:"location"},{body:y(({data:l})=>{var p;return[I(C(((p=l.location)==null?void 0:p.name)||"Tutte le location"),1)]}),_:1}),r(c,{header:"Banner header"},{body:y(({data:l})=>[l.image_url?(i(),d("img",{key:0,src:l.image_url},null,8,$)):(i(),d("i",ee,"Nessuna immagine caricata")),l.link?(i(),d("a",{key:2,href:l.link,class:"block",target:"_blank"},"Link",8,oe)):(i(),d("i",ne,"Nessun link impostato"))]),_:1}),r(c,{header:"Banner footer (up)"},{body:y(({data:l})=>[l.image_foot_up_url?(i(),d("img",{key:0,src:l.image_foot_up_url},null,8,te)):(i(),d("i",ae,"Nessuna immagine caricata")),l.link_foot_up?(i(),d("a",{key:2,href:l.link_foot_up,class:"block",target:"_blank"},"Link",8,le)):(i(),d("i",se,"Nessun link impostato"))]),_:1}),r(c,{header:"Banner footer (down)"},{body:y(({data:l})=>[l.image_foot_down_url?(i(),d("img",{key:0,src:l.image_foot_down_url},null,8,ie)):(i(),d("i",re,"Nessuna immagine caricata")),l.link_foot_down?(i(),d("a",{key:2,href:l.link_foot_down,class:"block",target:"_blank"},"Link",8,de)):(i(),d("i",ce,"Nessun link impostato"))]),_:1}),r(c,{header:""},{body:y(({data:l})=>[t("div",me,[E(r(m,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:p=>n.$emit("onEditBanner",l)},null,8,["onClick"]),[[u,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const ue=T(Z,[["render",_e]]);class D{static async uploadFile(o){return(await N("uploads",o)).data}static async uploadResponse(o){const a={headers:{"Content-Type":o.file.type}};return delete B.defaults.headers.common.uid,delete B.defaults.headers.common.Uid,delete B.defaults.headers.common["token-type"],delete B.defaults.headers.common["access-token"],delete B.defaults.headers.common.client,await B.put(o.upload_url,o.file,a)}static async uploadDone(o){return(await N(`/uploads/${o}/done`,{})).data}static async deleteFile(o){const a=new Map;return(await J(`/uploads/${o}`,a)).data}}const pe=z({id:"upload",state:()=>({upload:{},uploads:[],response_uploads:{},upload_id:""}),getters:{allUploads:n=>n.uploads,responseUploads:n=>n.response_uploads,getCurrentUpload:n=>n.upload},actions:{async uploadFile(n){const o=n.file;await D.uploadFile(n).then(a=>{const e={file:o,upload_url:a.upload_url};return this.upload_id=a.upload.id,this.uploadResponse(e)})},async uploadResponse(n){await D.uploadResponse(n).then(()=>this.uploadDone())},async uploadDone(){await D.uploadDone(this.upload_id).then(n=>{this.response_uploads=n})},async deleteFile(n){await D.deleteFile(n)}}}),fe={props:["banner"],setup(n,o){F(()=>{n.banner&&(a.value=Object.assign({},n.banner))});const a=h({}),{showLoader:e,hideLoader:g}=W(),b=R(),c=h("it"),m=M(),_=pe(),u=K(),l=S(()=>u.languages),p=S(()=>_.responseUploads),x=function(v,k){const U=v.files[0],q={upload:{filename:U.name,type:U.type,owner_id:n.banner.id,owner_type:"Banner",banner_type:k},file:U};_.uploadFile(q)},s=function(){e();let v={it:{standard_ticket_email:a.value.translations.it.standard_ticket_email.text,open_ticket_email:a.value.translations.it.open_ticket_email.text},en:{standard_ticket_email:a.value.translations.en.standard_ticket_email.text,open_ticket_email:a.value.translations.en.open_ticket_email.text}};const k={banner:a.value};k.banner.translations=v,m.updateBanner(k).then(()=>{g(),X(b,{message:"Banner aggiornato correttamente",error:!1}),o.emit("onSubmit")}).catch(U=>{O(b,U)})},P=function(v,k){_.deleteFile(v).then(()=>{L(k,null)})},L=function(v,k){v=="header"?a.value.image_url=k:v=="footer_up"?a.value.image_foot_up_url=k:a.value.image_foot_down_url=k};return Q(p,()=>{let v=p.value.url;L(p.value.banner_type,v)}),{form:a,lang_selected:c,uploadedImage:p,languages:l,onSubmit:s,onUploadImage:x,onDeleteFile:P}},components:{Form:Y}};const ge={class:"formgrid grid flex-column mt-3"},be={class:"field col-12 flex flex-column"},he=t("label",{for:"location"},"Location",-1),ve={class:"formgrid grid card mt-3"},ke=t("h3",{class:"col-12 mt-0 p-0"},"Banner header",-1),ye={class:"field col-6 flex flex-column"},we=t("label",null,"Immagine",-1),Be={key:0,class:"relative wrp-delete"},xe=["src"],Ue={class:"field col-6 flex flex-column"},De=t("label",{from:"to_date"},"Link banner header",-1),Ve={class:"formgrid grid card mt-3"},Ee=t("h3",{class:"col-12 mt-0 p-0"},"Banner footer (up)",-1),Se={class:"field col-6 flex flex-column"},Ce=t("label",null,"Immagine",-1),Fe={key:0,class:"relative wrp-delete"},Te=["src"],Le={class:"field col-6 flex flex-column"},Ie=t("label",{from:"to_date"},"Link banner footer (up)",-1),Ne={class:"formgrid grid card mt-3"},Ae=t("h3",{class:"col-12 mt-0 p-0"},"Banner footer (down)",-1),ze={class:"field col-6 flex flex-column"},Re=t("label",null,"Immagine",-1),je={key:0,class:"relative wrp-delete"},Oe=["src"],Me={class:"field col-6 flex flex-column"},Pe=t("label",{from:"to_date"},"Link banner footer (down)",-1),qe={class:"col-12 flex justify-content-end m-0 p-0 align-items-center mt-4"},Ge={key:0,class:"formgrid grid card mt-3"},He={class:"col-12 mt-0 p-0"},Je={class:"field"},Ke={key:1,class:"formgrid grid card mt-3"},Qe={class:"col-12 mt-0 p-0"},We={class:"field"},Xe={class:"flex align-items-center justify-content-end mt-6"};function Ye(n,o,a,e,g,b){const c=f("InputText"),m=f("Button"),_=f("FileUpload"),u=f("Dropdown"),l=f("Editor"),p=f("Form"),x=j("tooltip");return e.form?(i(),V(p,{key:0,onSubmit:e.onSubmit,class:"banner"},{default:y(()=>[t("div",ge,[t("div",be,[he,e.form.location?(i(),V(c,{key:0,modelValue:e.form.location.name,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.location.name=s),disabled:""},null,8,["modelValue"])):w("",!0)])]),t("div",ve,[ke,t("div",ye,[we,e.form.image_url?(i(),d("div",Be,[e.form.image_url?E((i(),V(m,{key:0,icon:"pi pi-times",rounded:"","aria-label":"Cancel",class:"btn-delete-img",onClick:o[1]||(o[1]=s=>e.onDeleteFile(e.form.image.id,"header"))},null,512)),[[x,"Elimina",void 0,{top:!0}]]):w("",!0),t("img",{src:e.form.image_url},null,8,xe)])):w("",!0),r(_,{mode:"basic",name:"demo[]",url:"/api/upload",accept:"image/*",customUpload:"",auto:!0,onUploader:o[2]||(o[2]=s=>e.onUploadImage(s,"header")),class:"mt-3"})]),t("div",Ue,[De,r(c,{modelValue:e.form.link,"onUpdate:modelValue":o[3]||(o[3]=s=>e.form.link=s)},null,8,["modelValue"])])]),t("div",Ve,[Ee,t("div",Se,[Ce,e.form.image_foot_up_url?(i(),d("div",Fe,[E(r(m,{icon:"pi pi-times",rounded:"","aria-label":"Cancel",class:"btn-delete-img",onClick:o[4]||(o[4]=s=>e.onDeleteFile(e.form.image_foot_up.id,"footer_up"))},null,512),[[x,"Elimina",void 0,{top:!0}]]),t("img",{src:e.form.image_foot_up_url},null,8,Te)])):w("",!0),r(_,{mode:"basic",name:"demo[]",url:"/api/upload",accept:"image/*",customUpload:"",auto:!0,onUploader:o[5]||(o[5]=s=>e.onUploadImage(s,"footer_up")),class:"mt-3"})]),t("div",Le,[Ie,r(c,{modelValue:e.form.link_foot_up,"onUpdate:modelValue":o[6]||(o[6]=s=>e.form.link_foot_up=s)},null,8,["modelValue"])])]),t("div",Ne,[Ae,t("div",ze,[Re,e.form.image_foot_down_url?(i(),d("div",je,[E(r(m,{icon:"pi pi-times",rounded:"","aria-label":"Cancel",class:"btn-delete-img",onClick:o[7]||(o[7]=s=>e.onDeleteFile(e.form.image_foot_down.id,"footer_down"))},null,512),[[x,"Elimina",void 0,{top:!0}]]),t("img",{src:e.form.image_foot_down_url},null,8,Oe)])):w("",!0),r(_,{mode:"basic",name:"demo[]",url:"/api/upload",accept:"image/*",customUpload:"",auto:!0,onUploader:o[8]||(o[8]=s=>e.onUploadImage(s,"footer_down")),class:"mt-3"})]),t("div",Me,[Pe,r(c,{modelValue:e.form.link_foot_down,"onUpdate:modelValue":o[9]||(o[9]=s=>e.form.link_foot_down=s)},null,8,["modelValue"])])]),t("div",qe,[r(u,{options:e.languages,optionLabel:"name",optionValue:"value",class:"m-2 capitalize dropdown-lng",modelValue:e.lang_selected,"onUpdate:modelValue":o[10]||(o[10]=s=>e.lang_selected=s)},null,8,["options","modelValue"])]),e.form.translations?(i(),d("div",Ge,[t("h3",He," Testo email (biglietti standard) ("+C(e.lang_selected.toUpperCase())+") ",1),t("div",Je,[r(l,{modelValue:e.form.translations[e.lang_selected].standard_ticket_email.text,"onUpdate:modelValue":o[11]||(o[11]=s=>e.form.translations[e.lang_selected].standard_ticket_email.text=s),editorStyle:"height: 320px"},null,8,["modelValue"])])])):w("",!0),e.form.translations?(i(),d("div",Ke,[t("h3",Qe," Testo email (biglietti a data aperta)("+C(e.lang_selected.toUpperCase())+") ",1),t("div",We,[r(l,{modelValue:e.form.translations[e.lang_selected].open_ticket_email.text,"onUpdate:modelValue":o[12]||(o[12]=s=>e.form.translations[e.lang_selected].open_ticket_email.text=s),editorStyle:"height: 320px"},null,8,["modelValue"])])])):w("",!0),t("div",Xe,[r(m,{label:"Annulla",text:""}),r(m,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit"])):w("",!0)}const Ze=T(fe,[["render",Ye]]),$e={setup(){F(()=>{});const n=h(!1),o=h(),a=h({});return{visibleDialog:n,bannerEmailTable:o,currentBanner:a,onSubmit:function(){n.value=!1,o.value.loadLazyData()},openEditDialog:function(b){n.value=!0,a.value=b}}},components:{BannerEmailTable:ue,BannerEmailDialog:Ze}},eo=t("h1",null,"Banner email",-1);function oo(n,o,a,e,g,b){const c=f("BannerEmailTable"),m=f("BannerEmailDialog"),_=f("Dialog");return i(),d("div",null,[eo,r(c,{ref:"bannerEmailTable",onOnEditBanner:o[0]||(o[0]=u=>e.openEditDialog(u))},null,512),r(_,{visible:e.visibleDialog,"onUpdate:visible":o[2]||(o[2]=u=>e.visibleDialog=u),modal:"",header:"Banner Email",style:{width:"50rem"}},{default:y(()=>[r(m,{onOnSubmit:o[1]||(o[1]=u=>e.onSubmit()),banner:e.currentBanner},null,8,["banner"])]),_:1},8,["visible"])])}const lo=T($e,[["render",oo]]);export{lo as default};
