import{o as L,a as j,l as d,c as C,v as P,i as F,_ as E,r as f,m as q,b as I,s as N,w as D,h as M,f as r,g as v,p as U,e as R}from"../index28428.js";import{e as S,p as W,a as H,s as w,u as $}from"./helpers28428.js";import{f as G,a as J}from"./formatData28428.js";import{u as O}from"./attraction28428.js";import{c as K,a as T}from"./index.esm28428.js";import{F as Q}from"./vee-validate.esm28428.js";import{I as X}from"./InputTextWithValidation28428.js";import{u as Y}from"./category28428.js";import"./datetime28428.js";import"./_commonjsHelpers28428.js";/* empty css                                                                            */const Z={props:["attraction_id"],setup(m){L(()=>{o.value=!0,l.value={first:0,rows:a.value.rows,sortField:null,sortOrder:null},l.value.page=0,A()});const t=j(),a=d(),e=d(),h=d(),g=d(),o=d(!0),l=d(),s=d(0),c=O(),u=C(()=>c.responseAttractions),n=P(),b=C(()=>n.submitDialog);function A(){o.value=!0,setTimeout(()=>{V()},Math.random()*1e3+250)}const V=async function(){const i=new Map;i.set("page",l.value.page+1),i.set("per_page",l.value.rows),await c.fetchAllAttractions(i).then(()=>{o.value=!1}).catch(y=>{o.value=!1,S(t,y)})},x=function(i){g.value=i;let y="Sei sicuro di voler eliminare questo bene?";n.setDialog("Elimina bene","Elimina","Annulla",y),n.setBtnSubmit(!1),n.setDynamicDialogVisibility(!0)},B=async function(){await c.deleteAttraction(g.value).then(()=>{o.value=!1,w(t,{message:"Bene eliminato correttamente",error:!1}),A()}).catch(i=>{o.value=!1,S(t,i)})},p=function(i){i.online?_(i):k(i)},_=async function(i){await c.publishAttraction(i).then(()=>{o.value=!1,w(t,{message:"Bene attivato correttamente",error:!1}),V()}).catch(y=>{o.value=!1,S(t,y)})},k=async function(i){await c.unpublishAttraction(i).then(()=>{o.value=!1,w(t,{message:"Bene disattivato correttamente",error:!1}),V()}).catch(y=>{o.value=!1,S(t,y)})},z=i=>{l.value=i,A()};return F(b,i=>{i&&B()}),{dt:a,responseAttractions:u,loading:o,totalRecords:s,lazyParams:l,currentOrder:e,op:h,loadLazyData:A,onDeleteAttraction:B,confirmDelete:x,changeStatus:p,onPage:z,formatDataAndHourFromUnixTimestamps:G,formatPrettyDate:J,prettyPaymentStatus:W,prettyTicketType:H}}},tt={class:"flex justify-content-center"};function et(m,t,a,e,h,g){const o=f("Column"),l=f("InputSwitch"),s=f("Button"),c=f("DataTable"),u=q("tooltip");return I(),N(c,{value:e.responseAttractions.attractions,totalRecords:e.responseAttractions.total,lazy:!0,paginator:!0,rows:15,ref:"dt",loading:e.loading,onPage:t[0]||(t[0]=n=>e.onPage(n)),stripedRows:""},{empty:D(()=>[M(" Nessun bene trovato. ")]),default:D(()=>[r(o,{header:"Nome",field:"name"}),r(o,{header:"Link prenotazione biglietti",field:"permalink"}),r(o,{header:""},{body:D(({data:n})=>[r(l,{modelValue:n.online,"onUpdate:modelValue":b=>n.online=b,onChange:b=>e.changeStatus(n)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),r(o,{header:""},{body:D(({data:n})=>[v("div",tt,[U(r(s,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:b=>m.$emit("onEdit",n)},null,8,["onClick"]),[[u,"Modifica",void 0,{top:!0}]]),U(r(s,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:b=>e.confirmDelete(n.id)},null,8,["onClick"]),[[u,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","totalRecords","loading"])}const ot=E(Z,[["render",et]]),nt={props:["attraction"],setup(m,t){L(()=>{var p,_;m.attraction&&m.attraction.id&&(a.value=Object.assign({},m.attraction),a.value.price=(p=a.value.ticket_configurations[0])==null?void 0:p.price,e.value=(_=a.value.ticket_configurations[0])==null?void 0:_.id,delete a.value.ticket_configurations),x()});const a=d({}),e=d(null),h=K({name:T().required("Nome bene obbligatorio"),address:T().required("Luogo di ritrovo obbligatorio"),price:T().required("Importo biglietto obbligatorio")}),{showLoader:g,hideLoader:o}=$(),l=j(),s=O(),c=Y(),u=C(()=>s.allAttractions),n=C(()=>c.allCategories),b=function(){g();const p=Object.assign({},a.value);p.ticket_configurations=[{price:p.price,name:"Biglietto intero"}];const _={attraction:p};s.addAttraction(_).then(()=>{o(),w(l,{message:"Bene aggiunto correttamente",error:!1}),t.emit("onSubmit")}).catch(k=>{o(),S(l,k)})},A=function(){g();const p=Object.assign({},a.value);p.ticket_configurations=[{price:p.price,name:"Biglietto intero",id:e.value}];const _={attraction:p};s.updateAttraction(_).then(()=>{o(),w(l,{message:"Bene modificato correttamente",error:!1}),t.emit("onSubmit")}).catch(k=>{o(),S(l,k)})},V=function(){a.value.id?A():b()},x=async function(){await c.fetchAllCategories()},B=function(){t.emit("onSubmit",a.value)};return F(n,()=>{a.value.category||(a.value.category=n.value[0])}),{form:a,schema:h,onSubmit:V,resetForm:B,attractions:u,categories:n}},components:{Form:Q,InputTextWithValidation:X}},at={class:"formgrid grid mt-3"},it={class:"field col-12"},lt={class:"field col-12"},rt={class:"field col-12"},st={class:"field col-12 flex flex-column"},ct=v("label",{for:"category"},"Categoria",-1),ut={class:"flex align-items-center col-12"},mt=v("label",{for:"free_ticket",class:"ml-2"}," Biglietto gratuito ",-1),dt={class:"flex align-items-center justify-content-end mt-6"};function ft(m,t,a,e,h,g){const o=f("InputTextWithValidation"),l=f("Dropdown"),s=f("Checkbox"),c=f("Button"),u=f("Form");return I(),N(u,{onSubmit:e.onSubmit,"validation-schema":e.schema},{default:D(()=>[v("div",at,[v("div",it,[r(o,{name:"name",label:"Nome bene*",modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=n=>e.form.name=n)},null,8,["modelValue"])]),v("div",lt,[r(o,{name:"address",label:"Luogo di ritrovo*",modelValue:e.form.address,"onUpdate:modelValue":t[1]||(t[1]=n=>e.form.address=n)},null,8,["modelValue"])]),v("div",rt,[r(o,{name:"price",label:"Importo biglietto*",modelValue:e.form.price,"onUpdate:modelValue":t[2]||(t[2]=n=>e.form.price=n)},null,8,["modelValue"])]),v("div",st,[ct,r(l,{modelValue:e.form.category,"onUpdate:modelValue":t[3]||(t[3]=n=>e.form.category=n),options:e.categories,optionLabel:"label",optionValue:"value",placeholder:"",name:"category"},null,8,["modelValue","options"])])]),v("div",ut,[r(s,{modelValue:e.form.free_ticket,"onUpdate:modelValue":t[4]||(t[4]=n=>e.form.free_ticket=n),inputId:"free_ticket",binary:""},null,8,["modelValue"]),mt]),v("div",dt,[r(c,{label:"Annulla",text:"",onClick:t[5]||(t[5]=n=>e.resetForm())}),r(c,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const pt=E(nt,[["render",ft]]),vt={setup(){L(()=>{});const m=d(!1),t=d({}),a=d(),e=d();return{form:t,attractionTable:a,visibleDialog:m,currentAttraction:e,filterTable:function(s){t.value=s,a.value.loadLazyData()},onShowDialog:function(){e.value={},m.value=!0},onEdit:function(s){e.value=s,m.value=!0},onSubmit:function(){a.value.loadLazyData(),m.value=!1}}},components:{AttractionTable:ot,AttractionDialog:pt}},gt=v("h1",null,"Beni",-1),bt={class:"flex justify-content-end mt-4 mb-3"};function _t(m,t,a,e,h,g){const o=f("Button"),l=f("AttractionTable"),s=f("AttractionDialog"),c=f("Dialog");return I(),R("div",null,[gt,v("div",bt,[r(o,{label:"Bene",icon:"pi pi-plus",rounded:"",outlined:"",onClick:t[0]||(t[0]=u=>e.onShowDialog())})]),r(l,{filters:e.form,ref:"attractionTable",onOnEdit:t[1]||(t[1]=u=>e.onEdit(u))},null,8,["filters"]),r(c,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=u=>e.visibleDialog=u),modal:"",header:"Bene",style:{width:"35rem"}},{default:D(()=>[r(s,{attraction:e.currentAttraction,onOnSubmit:t[2]||(t[2]=u=>e.onSubmit())},null,8,["attraction"])]),_:1},8,["visible"])])}const Tt=E(vt,[["render",_t]]);export{Tt as default};
