import{u as ye}from"./location28428.js";import{u as oe,e as B,s as O,f as ze}from"./helpers28428.js";import{x as X,z as $,B as de,y as ue,A as me,o as J,l as k,a as G,u as Te,c as I,i as N,_ as K,r as _,m as te,b as U,s as Z,w as b,g as s,f as a,e as z,t as M,q,h as P,p as H,v as _e,F as Y,D as re}from"../index28428.js";import{c as fe,a as ge}from"./index.esm28428.js";import{F as se}from"./vee-validate.esm28428.js";import{I as pe}from"./InputTextWithValidation28428.js";import{u as xe}from"./category28428.js";import{u as Ee}from"./upload28428.js";import{d as Ce,e as le,a as ee,b as ae,g as Se}from"./formatData28428.js";import{D as Le}from"./datetime28428.js";import"./attraction28428.js";import"./_commonjsHelpers28428.js";/* empty css                                                                            */class ce{static async fetchAll(e){return(await X(`/admin/locations/${e}/courses`)).data}static async addCourse(e){return(await $(`/admin/locations/${e.location_id}/courses`,e)).data.course}static async updateCourse(e){return(await de(`/admin/locations/${e.location_id}/courses/${e.course.id}`,e)).data.course}static async deleteCourse(e){return await ue(`/admin/courses/${e}`)}}const Ue=me({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:t=>t.courses,responseCourses:t=>t.response_courses,getTotalCourses:t=>t.response_courses?t.response_courses.total:0,getCurrentCourse:t=>t.course},actions:{async fetchAllCourses(t){await ce.fetchAll(t).then(e=>{this.response_courses=e,this.courses=e.courses})},async addCourse(t){await ce.addCourse(t).then(e=>{this.course=e})},async updateCourse(t){await ce.updateCourse(t).then(e=>{this.course=e})},async deleteCourse(t){await ce.deleteCourse(t).then()}}});class ie{static async fetchAll(e){return(await X(`/admin/courses/${e}/tickets`)).data}static async addTicket(e){return await $(`/admin/courses/${e.course_id}/tickets`,e)}static async updateTicket(e){return await de(`/admin/courses/${e.course_id}/tickets/${e.ticket.id}`,e)}static async updateAllTickets(e){const n=e.course_id;return delete e.course_id,await $(`/admin/courses/${n}/tickets/update_tickets`,e)}static async deleteTicket(e){return await ue(`/admin/courses/${e.course_id}/tickets/${e.ticket_id}`)}}const Me=me({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{}}),getters:{allTickets:t=>t.tickets,responseTickets:t=>t.response_tickets,getTotalTickets:t=>t.response_tickets?t.response_tickets.total:0,getCurrentTicket:t=>t.ticket},actions:{async fetchAllTickets(t){await ie.fetchAll(t).then(e=>{this.response_tickets=e,this.tickets=e.tickets})},async addTicket(t){await ie.addTicket(t).then()},async updateTicket(t){await ie.updateTicket(t).then()},async deleteTicket(t){await ie.deleteTicket(t).then()},async updateAllTickets(t){await ie.updateAllTickets(t)}}}),Fe={props:["course","location_id"],setup(t,e){J(()=>{t.course&&t.course.id?(n.value=Object.assign({},t.course),R()):n.value.translations={it:{name:{id:null,text:""},description:{id:null,text:""}},en:{name:{id:null,text:""},description:{id:null,text:""}}},n.value.tickets=[]});const n=k({}),o=k([]),V=k("it"),x=fe({name:ge().required("Nome percorso obbligatorio")}),{showLoader:d,hideLoader:r}=oe(),f=G(),h=Ue(),u=xe(),g=Me(),p=Te(),l=k(!1),v=Ee(),S=I(()=>h.allCourses),E=I(()=>u.allCategories),i=I(()=>g.responseTickets),c=I(()=>h.getCurrentCourse),C=I(()=>p.languages),L=I(()=>v.responseUploads),F=function(w){d(),h.addCourse(w).then(()=>{r(),O(f,{message:"Percorso aggiunto correttamente",error:!1}),e.emit("onSubmit")}).catch(T=>{r(),B(f,T)})},R=async function(){let w=t.course.id?t.course.id:c.value.id;d(),await g.fetchAllTickets(w).then(()=>{r()}).catch(T=>{r(),B(f,T)})},W=function(w){d(),h.updateCourse(w).then(()=>{r(),O(f,{message:"Percorso modificato correttamente",error:!1}),e.emit("onSubmit")}).catch(T=>{r(),B(f,T)})},D=function(){const w=Object.assign({},n.value);let T={it:{name:w.translations.it.name.text,description:w.translations.it.description.text},en:{name:w.translations.en.name.text,description:w.translations.en.description.text}};w.translations=T,w.name=w.translations.it.name,w.description=w.translations.it.description;const A={course:w,location_id:t.location_id};n.value.id?W(A):F(A)},m=function(){let T={translations:{en:{name:{text:"",id:null},description:{text:"",id:null}},it:{name:{text:"",id:null},description:{text:"",id:null}}},price:0};n.value.tickets.push(T),o.value.push(T)},y=function(w,T){w.id?j(w):n.value.tickets.splice(T,1)},j=async function(w){const T={course_id:t.course.id?t.course.id:c.value.id,ticket_id:w.id};d(),await g.deleteTicket(T).then(()=>{r(),O(f,{message:"Biglietto eliminato correttamente",error:!1}),R()}).catch(A=>{r(),B(f,A)})},we=function(w){let{newData:T,index:A}=w;n.value.tickets[A]=T;let ke={it:{name:T.translations.it.name.text,description:T.translations.it.description.text},en:{name:T.translations.en.name.text,description:T.translations.en.description.text}};T.translations=ke,T.name=T.translations.it.name,T.description=T.translations.it.description,T.id?he(T):Ve(T)},Ve=async function(w){const T={course_id:t.course.id?t.course.id:c.value.id,ticket:w};await g.addTicket(T).then(()=>{r(),O(f,{message:"Biglietto aggiunto correttamente",error:!1}),R()}).catch(A=>{r(),B(f,A)})},he=async function(w){const T={course_id:t.course.id?t.course.id:c.value.id,ticket:w};await g.updateTicket(T).then(()=>{r(),O(f,{message:"Biglietto aggiornato correttamente",error:!1}),R()}).catch(A=>{r(),B(f,A)})},De=function(w){n.value.image_url=w},Ae=function(w){let T={it:{name:w.translations.it.name.text,description:w.translations.it.description.text},en:{name:w.translations.en.name.text,description:w.translations.en.description.text}};w.translations=T,w.id?he(w):Ve(w)},Be=async w=>{let T=w.value;T.forEach((A,ke)=>{A.position=ke+1;let Re={it:{name:A.translations.it.name.text,description:A.translations.it.description.text},en:{name:A.translations.en.name.text,description:A.translations.en.description.text}};A.translations=Re,A.name=A.translations.it.name,A.description=A.translations.it.description});try{const A={course_id:t.course.id?t.course.id:c.value.id,tickets:T};await g.updateAllTickets(A),R(),O(f,{message:"Ordine biglietti aggiornato",error:!1})}catch(A){B(f,A)}},Ie=function(w){const T=w.files[0],A={upload:{filename:T.name,type:T.type,owner_id:t.course.id,owner_type:"Course"},file:T};v.uploadFile(A)},je=function(w){v.deleteFile(w).then(()=>{De(null)})};return N(E,()=>{n.value.category||(n.value.category=E.value[0])}),N(i,()=>{i.value&&i.value.tickets.length>0?n.value.tickets=Object.assign([],i.value.tickets):n.value.tickets=[]}),N(c,()=>{n.value=Object.assign({},c.value)}),N(L,()=>{debugger;let w=L.value.url;De(w)}),{form:n,schema:x,loading:l,editingRows:o,response_tickets:i,lang_selected:V,uploadedImage:L,onSubmit:D,addTicket:m,onDeleteTicket:y,onRowEditSave:we,updateTicketsApi:he,onPublicTicket:Ae,onRowReorder:Be,onUploadImage:Ie,onDeleteFile:je,courses:S,categories:E,languages:C}},components:{Form:se,InputTextWithValidation:pe}};const Oe={class:"col-12 flex justify-content-end m-0 p-0 align-items-center"},Ne={key:0,class:"formgrid grid mt-3"},Pe={class:"field col-12"},We={class:"field col-12"},qe={for:"description"},He={class:"formgrid grid mt-3 banner"},Je={class:"field col-6 flex flex-column"},Ge=s("label",null,"Immagine",-1),Ke={key:0,class:"relative wrp-delete"},Qe=["src"],Xe={key:1,class:"flex justify-content-end mt-4 mb-3"},Ye={key:0},Ze={key:0},$e={class:"w-full"},eo={class:"flex justify-content-center"},oo={class:"flex align-items-center justify-content-end mt-6"};function to(t,e,n,o,V,x){const d=_("Dropdown"),r=_("InputTextWithValidation"),f=_("Textarea"),h=_("FileUpload"),u=_("Button"),g=_("Column"),p=_("InputText"),l=_("InputSwitch"),v=_("DataTable"),S=_("Form"),E=te("tooltip");return U(),Z(S,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:b(()=>[s("div",Oe,[a(d,{options:o.languages,optionLabel:"name",optionValue:"value",class:"m-2 capitalize dropdown-lng",modelValue:o.lang_selected,"onUpdate:modelValue":e[0]||(e[0]=i=>o.lang_selected=i)},null,8,["options","modelValue"])]),o.lang_selected&&o.form&&o.form.translations?(U(),z("div",Ne,[s("div",Pe,[a(r,{name:"name",label:"Nome percorso* ("+o.lang_selected.toUpperCase()+")",modelValue:o.form.translations[o.lang_selected].name.text,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.translations[o.lang_selected].name.text=i)},null,8,["label","modelValue"])]),s("div",We,[s("label",qe,"Descrizione ("+M(o.lang_selected.toUpperCase())+")",1),a(f,{rows:"5",cols:"30",name:"description",id:"description",label:"Nome percorso*",modelValue:o.form.translations[o.lang_selected].description.text,"onUpdate:modelValue":e[2]||(e[2]=i=>o.form.translations[o.lang_selected].description.text=i),class:"w-full"},null,8,["modelValue"])])])):q("",!0),s("div",He,[s("div",Je,[Ge,o.form.image_url?(U(),z("div",Ke,[s("img",{src:o.form.image_url,style:{"max-width":"200px"}},null,8,Qe)])):q("",!0),a(h,{mode:"basic",name:"demo[]",url:"/api/upload",accept:"image/*",customUpload:"",auto:!0,onUploader:e[3]||(e[3]=i=>o.onUploadImage(i)),class:"mt-3"})])]),o.form.id?(U(),z("div",Xe,[a(u,{label:"Tipologia biglietto",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[4]||(e[4]=i=>o.addTicket())})])):q("",!0),o.form.id&&o.lang_selected?(U(),Z(v,{key:2,value:o.form.tickets,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[5]||(e[5]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave,reorderableColumns:!0,onRowReorder:o.onRowReorder},{empty:b(()=>[P(" Nessun biglietto trovato. ")]),default:b(()=>[a(g,{rowReorder:"",headerStyle:"width: 3rem",reorderableColumn:!1}),a(g,{header:"Tipo biglietto",style:{"min-width":"150px"},field:"name"},{body:b(({data:i})=>{var c;return[i.translations[o.lang_selected].name?(U(),z("span",Ye,M((c=i.translations[o.lang_selected].name)==null?void 0:c.text),1)):q("",!0)]}),editor:b(({data:i,field:c})=>[a(p,{modelValue:i.translations[o.lang_selected][c].text,"onUpdate:modelValue":C=>i.translations[o.lang_selected][c].text=C,name:"ticket_name_"+o.lang_selected,id:"ticket_name_"+o.lang_selected,type:"text"},null,8,["modelValue","onUpdate:modelValue","name","id"])]),_:1}),a(g,{header:"Descrizione",field:"description"},{body:b(({data:i})=>{var c;return[i.translations[o.lang_selected].description?(U(),z("span",Ze,M((c=i.translations[o.lang_selected].description)==null?void 0:c.text),1)):q("",!0)]}),editor:b(({data:i,field:c})=>[s("div",$e,[a(f,{modelValue:i.translations[o.lang_selected][c].text,"onUpdate:modelValue":C=>i.translations[o.lang_selected][c].text=C,class:"w-full",name:"desc_"+o.lang_selected},null,8,["modelValue","onUpdate:modelValue","name"])])]),_:1}),a(g,{header:"Prezzo",field:"price",bodyStyle:"min-width: 6rem"},{body:b(({data:i})=>[P(" € "+M((+i.price).toFixed(2)),1)]),editor:b(({data:i,field:c})=>[a(p,{modelValue:i[c],"onUpdate:modelValue":C=>i[c]=C},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(g,{header:"Stato",field:"public",bodyStyle:"min-width: 6rem"},{body:b(({data:i,field:c})=>[a(l,{modelValue:i[c],"onUpdate:modelValue":C=>i[c]=C,onChange:C=>o.onPublicTicket(i)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),editor:b(({data:i,field:c})=>[a(l,{modelValue:i[c],"onUpdate:modelValue":C=>i[c]=C},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(g,{rowEditor:!0,bodyStyle:"text-align:center; padding-right:0;min-width: 6rem"}),a(g,{header:"",style:{width:"3rem","padding-left":"0"}},{body:b(({data:i,index:c})=>[s("div",eo,[H(a(u,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:C=>o.onDeleteTicket(i,c)},null,8,["onClick"]),[[E,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave","onRowReorder"])):q("",!0),s("div",oo,[a(u,{label:"Annulla",text:"",onClick:e[6]||(e[6]=i=>t.$emit("onClose"))}),a(u,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const no=K(Fe,[["render",to]]),io={props:["location_id"],setup(t){J(()=>{x.value=!0,d.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},d.value.page=0,v()});const e=G(),n=k(),o=k(),V=k(),x=k(!0),d=k(),r=k(0),f=k(!1),{showLoader:h,hideLoader:u}=oe(),g=Ue(),p=I(()=>g.responseCourses),l=_e();I(()=>l.submitDialog);function v(){h(),setTimeout(()=>{S()},Math.random()*1e3+250)}const S=async function(){x.value=!0,await g.fetchAllCourses(t.location_id).then(()=>{x.value=!1,u()}).catch(F=>{x.value=!1,u(),B(e,F)})},E=function(F){V.value=F,f.value=!0},i=function(F){V.value=F;let R="Sei sicuro di voler archiviare questo percorso?";l.setDialog("Archivia percorso","Archivia","Annulla",R),l.setBtnSubmit(!1),l.setDynamicDialogVisibility(!0)},c=function(F){const R=Object.assign({},F);let W={it:{name:R.translations.it.name.text,description:R.translations.it.description.text},en:{name:R.translations.en.name.text,description:R.translations.en.description.text}};R.translations=W;const D={course:R,location_id:t.location_id};g.updateCourse(D).then(()=>{u(),O(e,{message:"Percorso modificato correttamente",error:!1}),S()}).catch(m=>{u(),B(e,m)})},C=function(){return V.value&&V.value.id?"Modifica percorso":"Aggiungi percorso"},L=function(){S(),f.value=!1};return N(t,()=>{t.location_id&&S()}),{dt:n,responseCourses:p,loading:x,totalRecords:r,lazyParams:d,op:o,visible:f,currentCourse:V,loadLazyData:v,onEditCourse:E,closeDialog:L,getHeader:C,updateCourse:c,onArchiveCourse:i}},components:{CourseDialog:no}},ao={class:"flex justify-content-end mt-4 mb-3"},so={class:"flex justify-content-center"};function lo(t,e,n,o,V,x){const d=_("Button"),r=_("Column"),f=_("InputSwitch"),h=_("DataTable"),u=_("CourseDialog"),g=_("Dialog"),p=te("tooltip");return U(),z(Y,null,[s("div",ao,[a(d,{label:"Percorso",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=l=>o.onEditCourse({}))})]),a(h,{value:o.responseCourses.courses,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[P(" Nessun percorso trovato. ")]),default:b(()=>[a(r,{header:"Nome"},{body:b(({data:l})=>{var v;return[P(M((v=l.translations.it.name)==null?void 0:v.text),1)]}),_:1}),a(r,{header:"Tipologie biglietti"},{body:b(({data:l})=>[(U(!0),z(Y,null,re(l.tickets,v=>{var S;return U(),z("div",{key:v.id},M((S=v.translations.it.name)==null?void 0:S.text),1)}),128))]),_:1}),a(r,{header:"Prezzo"},{body:b(({data:l})=>[(U(!0),z(Y,null,re(l.tickets,v=>(U(),z("div",{key:v.id}," € "+M((+v.price).toFixed(2)),1))),128))]),_:1}),a(r,{header:"Stato"},{body:b(({data:l})=>[a(f,{modelValue:l.public,"onUpdate:modelValue":v=>l.public=v,onChange:v=>o.updateCourse(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(r,{header:""},{body:b(({data:l})=>[s("div",so,[H(a(d,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditCourse(l),class:"mr-2"},null,8,["onClick"]),[[p,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(g,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=l=>o.visible=l),modal:"",header:o.getHeader(),style:{width:"70rem"},onHide:e[4]||(e[4]=l=>o.closeDialog())},{default:b(()=>[a(u,{course:o.currentCourse,location_id:n.location_id,onOnSubmit:e[1]||(e[1]=l=>o.closeDialog()),onOnClose:e[2]||(e[2]=l=>o.closeDialog())},null,8,["course","location_id"])]),_:1},8,["visible","header"])],64)}const co=K(io,[["render",lo]]),ro={props:["location"],setup(t,e){J(()=>{t.location&&(n.value=Object.assign({},t.location))});const n=k({}),{showLoader:o,hideLoader:V}=oe(),x=G(),d=k("it"),r=Te(),f=Ee(),h=ye(),u=I(()=>r.languages),g=I(()=>f.responseUploads),p=async function(){o();let l={it:{booking_title:n.value.translations.it.booking_title.text,booking_description:n.value.translations.it.booking_description.text},en:{booking_title:n.value.translations.en.booking_title.text,booking_description:n.value.translations.en.booking_description.text}};const v={location_id:n.value.id,location:{...n.value}};v.location.translations={...l},await h.updateLocation(v).then(()=>{V(),O(x,{message:"Location aggiornata correttamente",error:!1})}).catch(S=>{V(),B(x,S)})};return N(()=>t.location,l=>{l&&(n.value=Object.assign({},l))},{deep:!0}),{form:n,lang_selected:d,uploadedImage:g,languages:u,onSubmit:p}},components:{Form:se}},uo={class:"col-12 flex justify-content-end m-0 p-0 align-items-center mt-4"},mo={class:"flex gap-3"},_o={key:0,class:"formgrid col-6 card mt-3"},fo={class:"col-12 mt-0 p-0"},go={class:"field"},po={key:1,class:"formgrid col-6 card mt-3"},vo={class:"col-12 mt-0 p-0"},bo={class:"field"},ho={class:"flex align-items-center justify-content-end mt-6"};function ko(t,e,n,o,V,x){const d=_("Dropdown"),r=_("Editor"),f=_("Button"),h=_("Form");return o.form?(U(),Z(h,{key:0,onSubmit:o.onSubmit,class:"banner"},{default:b(()=>[s("div",uo,[a(d,{options:o.languages,optionLabel:"name",optionValue:"value",class:"m-2 capitalize dropdown-lng",modelValue:o.lang_selected,"onUpdate:modelValue":e[0]||(e[0]=u=>o.lang_selected=u)},null,8,["options","modelValue"])]),s("div",mo,[o.form.translations?(U(),z("div",_o,[s("h3",fo,"Titolo ("+M(o.lang_selected.toUpperCase())+")",1),s("div",go,[a(r,{modelValue:o.form.translations[o.lang_selected].booking_title.text,"onUpdate:modelValue":e[1]||(e[1]=u=>o.form.translations[o.lang_selected].booking_title.text=u),editorStyle:"height: 320px"},null,8,["modelValue"])])])):q("",!0),o.form.translations?(U(),z("div",po,[s("h3",vo,"Descrizione ("+M(o.lang_selected.toUpperCase())+")",1),s("div",bo,[a(r,{modelValue:o.form.translations[o.lang_selected].booking_description.text,"onUpdate:modelValue":e[2]||(e[2]=u=>o.form.translations[o.lang_selected].booking_description.text=u),editorStyle:"height: 320px"},null,8,["modelValue"])])])):q("",!0)]),s("div",ho,[a(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit"])):q("",!0)}const Co=K(ro,[["render",ko]]);class ne{static async fetchAll(e){return e?(await X("/admin/booking_rules",e)).data:{}}static async getCourses(e){return(await X("/admin/booking_rules/courses",e)).data}static async getTickets(e){return(await X("/admin/booking_rules/tickets",e)).data}static async addConfiguration(e){return await $("/admin/booking_rules",e)}static async updateConfiguration(e){return await de(`/admin/booking_rules/${e.booking_rule.id}`,e)}static async deleteConfiguration(e){return e==null?{}:await ue(`/admin/booking_rules/${e}`)}}const ve=me({id:"configuration",state:()=>({configuration:{},configurations:[],response_configurations:{},response_courses:{},response_tickets:{}}),getters:{allConfigurations:t=>t.configurations,responseConfigurations:t=>t.response_configurations,getTotalConfigurations:t=>t.response_configurations?t.response_configurations.total:0,getCurrentConfiguration:t=>t.configuration,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets},actions:{async fetchAllConfigurations(t){await ne.fetchAll(t).then(e=>{this.response_configurations=e,this.configurations=e.configurations})},async getAllCourses(t){await ne.getCourses(t).then(e=>{this.response_courses=ze(e)})},async getAllTickets(t){await ne.getTickets(t).then(e=>{this.response_tickets=e})},async addConfiguration(t){await ne.addConfiguration(t).then()},async updateConfiguration(t){await ne.updateConfiguration(t).then()},async deleteConfiguration(t){t!=null&&await ne.deleteConfiguration(t).then()}}}),yo={props:["config","location_id","course_id","duplicate"],setup(t,e){J(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.from_date&&(n.value.from_date=Ce(n.value.from_date)),n.value.to_date&&(n.value.to_date=Ce(n.value.to_date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_rule_slots=[]),W()});const n=k({}),o=k([]),V=k(!1),x=fe({name_config:ge().required("Nome configurazione obbligatoria")}),{showLoader:d,hideLoader:r}=oe(),f=G(),h=xe(),u=k(!1),g=ve(),p=I(()=>h.allCategories),l=I(()=>g.responseTickets),v=I(()=>g.responseCourses),S=function(){d();const D=Object.assign({},n.value);D.from_date&&(D.from_date=le(D.from_date)),D.to_date&&(D.to_date=le(D.to_date)),D.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(y=>{y.available_seats!=""&&y.start_at!=""&&D.booking_rule_slots.push(y)});const m={booking_rule:D};g.addConfiguration(m).then(()=>{r(),O(f,{message:"Configurazione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(y=>{r(),B(f,y)})},E=function(){d();const D=Object.assign({},n.value);D.from_date&&(D.from_date=le(D.from_date)),D.to_date&&(D.to_date=le(D.to_date)),D.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(y=>{y.available_seats!=""&&y.start_at!=""&&D.booking_rule_slots.push(y)});const m={booking_rule:D};g.updateConfiguration(m).then(()=>{r(),O(f,{message:"Configurazione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(y=>{r(),B(f,y)})},i=function(){n.value.id?E():S()},c=function(){let D={};D.price=0,n.value.tickets.unshift(D),o.value.push(n.value.tickets[0])},C=function(D){let{newData:m,index:y}=D;n.value.booking_rule_slots[y]=m},L=function(){let D={start_at:"",available_seats:"",id:"-1"};n.value.booking_rule_slots.push(D),o.value.push(D)},F=function(D,m){n.value.booking_rule_slots.splice(m,1)},R=function(D){D?n.value.wdays=[0,1,2,3,4,5,6]:n.value.wdays=[]},W=function(){const D=new Map;D.set("location_id",n.value.location_id),D.set("course_id",n.value.course_id),g.getAllTickets(D).catch(m=>{B(f,m)})};return N(p,()=>{n.value.category||(n.value.category=p.value[0])}),{form:n,schema:x,loading:u,editingRows:o,check_all:V,onSubmit:i,addTicket:c,onRowEditSave:C,checkAll:R,deleteSlot:F,addSlot:L,fetchAllTickets:W,categories:p,responseCourses:v,responseTickets:l}},components:{Form:se,InputTextWithValidation:pe}};const xo={class:"formgrid grid mt-3"},wo={class:"field col-12"},Vo={class:"field flex flex-column col-6"},Do=s("label",{for:"location"},"Percorso",-1),So={class:"field col-3"},To=s("label",{from:"date_from"},"Dal",-1),Eo={class:"field col-3"},Uo=s("label",{from:"date_to"},"Al",-1),Ao={class:"field col-12 mt-3"},Bo=s("label",null,"Giorni",-1),Io={class:"card flex flex-wrap gap-3 mt-2"},jo={class:"flex align-items-center mr-4"},Ro=s("label",{for:"all",class:"ml-2"}," Tutti i giorni ",-1),zo={class:"flex align-items-center"},Lo=s("label",{for:"lun",class:"ml-2"}," Lun ",-1),Mo={class:"flex align-items-center"},Fo=s("label",{for:"mar",class:"ml-2"}," Mar ",-1),Oo={class:"flex align-items-center"},No=s("label",{for:"mer",class:"ml-2"}," Mer ",-1),Po={class:"flex align-items-center"},Wo=s("label",{for:"gio",class:"ml-2"}," Gio ",-1),qo={class:"flex align-items-center"},Ho=s("label",{for:"ven",class:"ml-2"}," Ven ",-1),Jo={class:"flex align-items-center"},Go=s("label",{for:"sab",class:"ml-2"}," Sab ",-1),Ko={class:"flex align-items-center"},Qo=s("label",{for:"dom",class:"ml-2"}," Dom ",-1),Xo={class:"field col-3 mt-3"},Yo=s("label",null,"Biglietti",-1),Zo={for:"ticket.id",class:"ml-2 flex align-items-center"},$o={class:"inline-block",style:{"min-width":"150px"}},et={class:"text-right"},ot=s("div",{class:"col-9"},null,-1),tt={class:"col-8 mt-3"},nt={class:"field flex justify-content-between align-items-end mt-4 mb-3"},it=s("label",null,"Orari",-1),at={class:"flex justify-content-center"},st={class:"flex align-items-center justify-content-end mt-6"};function lt(t,e,n,o,V,x){const d=_("InputTextWithValidation"),r=_("Dropdown"),f=_("Calendar"),h=_("Checkbox"),u=_("Button"),g=_("InputMask"),p=_("Column"),l=_("InputNumber"),v=_("DataTable"),S=_("Form"),E=te("tooltip");return U(),Z(S,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:b(()=>[s("div",xo,[s("div",wo,[a(d,{name:"name_config",label:"Nome configurazione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.name=i),id:"name_config",type:"text"},null,8,["modelValue"])]),s("div",Vo,[Do,a(r,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.course_id=i),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[2]||(e[2]=i=>{o.form.booking_rule_ticket_ids=[],o.fetchAllTickets()})},null,8,["modelValue","options"])]),s("div",So,[To,a(f,{inputId:"date_from",modelValue:o.form.from_date,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.from_date=i),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),s("div",Eo,[Uo,a(f,{inputId:"date_to",modelValue:o.form.to_date,"onUpdate:modelValue":e[4]||(e[4]=i=>o.form.to_date=i),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),s("div",Ao,[Bo,s("div",Io,[s("div",jo,[a(h,{modelValue:o.check_all,"onUpdate:modelValue":[e[5]||(e[5]=i=>o.check_all=i),e[6]||(e[6]=i=>o.checkAll(i))],inputId:"all",name:"week",binary:!0},null,8,["modelValue"]),Ro]),s("div",zo,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[7]||(e[7]=i=>o.form.wdays=i),inputId:"lun",name:"week",value:1},null,8,["modelValue"]),Lo]),s("div",Mo,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[8]||(e[8]=i=>o.form.wdays=i),inputId:"mar",name:"week",value:2},null,8,["modelValue"]),Fo]),s("div",Oo,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[9]||(e[9]=i=>o.form.wdays=i),inputId:"mer",name:"week",value:3},null,8,["modelValue"]),No]),s("div",Po,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[10]||(e[10]=i=>o.form.wdays=i),inputId:"gio",name:"week",value:4},null,8,["modelValue"]),Wo]),s("div",qo,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[11]||(e[11]=i=>o.form.wdays=i),inputId:"ven",name:"week",value:5},null,8,["modelValue"]),Ho]),s("div",Jo,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[12]||(e[12]=i=>o.form.wdays=i),inputId:"sab",name:"week",value:6},null,8,["modelValue"]),Go]),s("div",Ko,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[13]||(e[13]=i=>o.form.wdays=i),inputId:"dom",name:"week",value:0},null,8,["modelValue"]),Qo])])]),s("div",Xo,[Yo,(U(!0),z(Y,null,re(o.responseTickets.tickets,i=>{var c;return U(),z("div",{key:i.id,class:"flex align-items-center mb-2 mt-2"},[a(h,{modelValue:o.form.booking_rule_ticket_ids,"onUpdate:modelValue":e[14]||(e[14]=C=>o.form.booking_rule_ticket_ids=C),inputId:i.id+"",value:i.id},null,8,["modelValue","inputId","value"]),s("label",Zo,[s("div",$o,M((c=i.translations)==null?void 0:c.it.name.text),1),s("div",et,"€ "+M(i.price),1)])])}),128))]),ot,s("div",tt,[s("div",nt,[it,a(u,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[15]||(e[15]=i=>o.addSlot())})]),a(v,{value:o.form.booking_rule_slots,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[16]||(e[16]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:b(()=>[P(" Nessuno slot orario trovato. ")]),default:b(()=>[a(p,{header:"Ora",field:"start_at"},{editor:b(({data:i,field:c})=>[a(g,{id:"basic",modelValue:i[c],"onUpdate:modelValue":C=>i[c]=C,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{header:"Posti",field:"available_seats"},{editor:b(({data:i,field:c})=>[a(l,{modelValue:i[c],"onUpdate:modelValue":C=>i[c]=C,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),a(p,{header:"",style:{width:"3rem","padding-left":"0"}},{body:b(({data:i,index:c})=>[s("div",at,[H(a(u,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:C=>o.deleteSlot(i,c)},null,8,["onClick"]),[[E,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","editingRows","onRowEditSave"])])]),s("div",st,[a(u,{label:"Annulla",text:"",onClick:e[17]||(e[17]=i=>t.$emit("onClose"))}),a(u,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const ct=K(yo,[["render",lt]]),rt={props:["location_id"],setup(t){J(()=>{d.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,t.location_id&&i(t.location_id)});const e=G(),n=k(),o=k(),V=k(),x=k(),d=k(!0),r=k(),f=k(0),h=k(!1),u=k(),g=k(!1),p=ve(),l=I(()=>p.responseConfigurations),v=_e(),S=I(()=>v.submitDialog),E=I(()=>p.responseCourses),i=async function(m){const y=new Map;y.set("location_id",m),await p.getAllCourses(y).then(()=>{d.value=!1}).catch(j=>{d.value=!1,B(e,j)})},c=async function(m){if(!m)return;d.value=!0;const y=new Map;y.set("location_id",t.location_id),y.set("course_id",m),await p.fetchAllConfigurations(y).then(()=>{d.value=!1}).catch(j=>{d.value=!1,B(e,j)})},C=function(m){V.value=m;let y="Sei sicuro di voler eliminare questa configurazione?";v.setDialog("Elimina configurazione","Elimina","Annulla",y),v.setBtnSubmit(!1),v.setDynamicDialogVisibility(!0)},L=async function(){V.value&&await p.deleteConfiguration(V.value).then(()=>{d.value=!1,O(e,{message:"Configurazione eliminata correttamente",error:!1}),c(u.value)}).catch(m=>{d.value=!1,B(e,m)})},F=function(m,y){x.value=m,h.value=!0,g.value=y},R=function(m){return m.map(j=>Le.local(2022,1,2+j).setLocale("it").toFormat("ccc")).join(", ")},W=function(m){u.value=m,c(u.value),h.value=!1},D=function(){return g.value?"Duplica configurazione":x.value&&x.value.id&&!g.value?"Modifica configurazione":"Nuova configurazione"};return N(S,m=>{S.value&&L()}),N(E,()=>{E.value.courses&&E.value.courses[0]&&(u.value=E.value.courses[0].id,c(u.value))}),N(t,()=>{t.location_id&&i(t.location_id)}),{dt:n,responseConfigurations:l,loading:d,totalRecords:f,lazyParams:r,op:o,visible:h,currentConfiguration:x,responseCourses:E,course_id:u,flag_duplicate:g,fromMMDDtoDDMM:Ce,onDeleteConfiguration:L,confirmDelete:C,onEditConfiguration:F,fetchAllConfigurations:c,convertWdays:R,closeDialog:W,getHeader:D}},components:{ConfigurationDialog:ct}},dt={class:"flex justify-content-between mt-4 mb-3"},ut={class:"field flex flex-column"},mt=s("label",{for:"location"},"Percorso",-1),_t={class:"capitalize"},ft={class:"flex justify-content-center"};function gt(t,e,n,o,V,x){const d=_("Dropdown"),r=_("Button"),f=_("Column"),h=_("DataTable"),u=_("ConfigurationDialog"),g=_("Dialog"),p=te("tooltip");return U(),z(Y,null,[s("div",dt,[s("div",ut,[mt,a(d,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=l=>o.course_id=l),options:o.responseCourses.courses,optionLabel:"translations.it.name.text",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=l=>o.fetchAllConfigurations(o.course_id))},null,8,["modelValue","options"])]),a(r,{label:"Configurazione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=l=>o.onEditConfiguration({},!1))})]),a(h,{value:o.responseConfigurations.booking_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[P(" Nessuna configurazione trovata. ")]),default:b(()=>[a(f,{header:"Nome",field:"name"}),a(f,{header:"Dal Al"},{body:b(({data:l})=>[P(M(o.fromMMDDtoDDMM(l.from_date))+" - "+M(o.fromMMDDtoDDMM(l.to_date)),1)]),_:1}),a(f,{header:"Valida il",field:"week"},{body:b(({data:l})=>[s("div",_t,M(o.convertWdays(l.wdays)),1)]),_:1}),a(f,{header:""},{body:b(({data:l})=>[s("div",ft,[H(a(r,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditConfiguration(l,!0)},null,8,["onClick"]),[[p,"Duplica",void 0,{top:!0}]]),H(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditConfiguration(l,!1)},null,8,["onClick"]),[[p,"Modifica",void 0,{top:!0}]]),H(a(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.confirmDelete(l.id)},null,8,["onClick"]),[[p,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(g,{visible:o.visible,"onUpdate:visible":e[5]||(e[5]=l=>o.visible=l),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:b(()=>[a(u,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=l=>o.closeDialog(l)),onOnClose:e[4]||(e[4]=l=>o.visible=!1),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const pt=K(rt,[["render",gt]]);class Q{static async fetchAll(e){return e?(await X("/admin/booking_exception_rules",e)).data:{}}static async getCourses(e){return(await X("/admin/booking_exception_rules/courses",e)).data}static async getTickets(e){return(await X("/admin/booking_exception_rules/tickets",e)).data}static async addBookingException(e){return await $("/admin/booking_exception_rules",e)}static async updateBookingException(e){return await de(`/admin/booking_exception_rules/${e.booking_exception_rule.id}`,e)}static async deleteBookingException(e){return e==null?{}:await ue(`/admin/booking_exception_rules/${e}`)}static async fetchAllClosings(e){return e?(await X(`/admin/booking_exception_rules/closings?location_id=${e.get("location_id")}`)).data:{}}static async createClosing(e){return await $("/admin/booking_exception_rules/closings",e)}static async deleteClosing(e){return await $("/admin/booking_exception_rules/delete_closings",e)}}const be=me({id:"booking_exception",state:()=>({booking_exception:{},booking_exceptions:[],response_booking_exceptions:{},response_courses:{},response_tickets:{},response_closings:{}}),getters:{allBookingExceptions:t=>t.booking_exceptions,responseBookingExceptions:t=>t.response_booking_exceptions,getTotalBookingExceptions:t=>t.response_booking_exceptions?t.response_booking_exceptions.total:0,getCurrentBookingException:t=>t.booking_exception,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets,responseClosings:t=>t.response_closings},actions:{async fetchAllBookingExceptions(t){await Q.fetchAll(t).then(e=>{this.response_booking_exceptions=e,this.booking_exceptions=e.booking_exceptions})},async fetchAllClosings(t){await Q.fetchAllClosings(t).then(e=>{this.response_closings=e})},async getAllCourses(t){await Q.getCourses(t).then(e=>{this.response_courses=e})},async getAllTickets(t){await Q.getTickets(t).then(e=>{this.response_tickets=e})},async addBookingException(t){await Q.addBookingException(t).then()},async updateBookingException(t){await Q.updateBookingException(t).then()},async deleteBookingException(t){t!=null&&await Q.deleteBookingException(t).then()},async addClosing(t){await Q.createClosing(t).then()},async deleteClosing(t){await Q.deleteClosing(t).then()}}}),vt={props:["config","location_id","course_id","duplicate"],setup(t,e){J(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.date&&(n.value.date=ee(n.value.date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_exception_rule_slots=[]),R()});const n=k({}),o=k([]),V=fe({name:ge().required("Nome eccezione obbligatoria")}),{showLoader:x,hideLoader:d}=oe(),r=G(),f=xe(),h=k(!1),u=ve(),g=be(),p=I(()=>f.allCategories),l=I(()=>u.responseTickets),v=I(()=>u.responseCourses),S=function(){x();const m=Object.assign({},n.value);m.date&&(m.date=ae(m.date)),m.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(j=>{j.available_seats!=""&&j.start_at!=""&&m.booking_exception_rule_slots.push(j)});const y={booking_exception_rule:m};g.addBookingException(y).then(()=>{d(),O(r,{message:"Eccezione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(j=>{d(),B(r,j)})},E=function(){x();const m=Object.assign({},n.value);m.date&&(m.date=ae(m.date)),m.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(j=>{j.available_seats!=""&&j.start_at!=""&&m.booking_exception_rule_slots.push(j)});const y={booking_exception_rule:m};g.updateBookingException(y).then(()=>{d(),O(r,{message:"Eccezione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(j=>{d(),B(r,j)})},i=function(){n.value.id?E():S()},c=function(){let m={};m.price=0,n.value.tickets.unshift(m),o.value.push(n.value.tickets[0])},C=function(m){let{newData:y,index:j}=m;n.value.booking_exception_rule_slots[j]=y},L=function(){let m={start_at:"",available_seats:"",id:"-1"};n.value.booking_exception_rule_slots.push(m),o.value.push(m)},F=function(m,y){n.value.booking_exception_rule_slots.splice(y,1)},R=function(){const m=new Map;m.set("location_id",n.value.location_id),m.set("course_id",n.value.course_id),u.getAllTickets(m).catch(y=>{B(r,y)})},W=function(){e.emit("onSubmit",n.value)},D=function(){n.value.booking_exception_rule_ticket_ids=[],R()};return N(p,()=>{n.value.category||(n.value.category=p.value[0])}),{form:n,schema:V,loading:h,editingRows:o,onSubmit:i,addTicket:c,onRowEditSave:C,deleteSlot:F,addSlot:L,fetchAllTickets:R,resetForm:W,onCourseChanged:D,categories:p,responseTickets:l,responseCourses:v}},components:{Form:se,InputTextWithValidation:pe}},bt={class:"formgrid grid mt-3"},ht={class:"field col-12"},kt={class:"field flex flex-column col-6"},Ct=s("label",{for:"location"},"Percorso",-1),yt={class:"field col-3"},xt=s("label",{from:"date"},"Il",-1),wt=s("div",{class:"field col-3"},null,-1),Vt={class:"field col-3 mt-3"},Dt=s("label",null,"Biglietti",-1),St={key:0,class:"block mb-2 text-red-500"},Tt=["for"],Et={class:"inline-block",style:{"min-width":"150px"}},Ut={class:"text-right"},At=s("div",{class:"col-9"},null,-1),Bt={class:"field col-8 mt-3"},It={class:"field flex justify-content-between align-items-end mt-4 mb-3"},jt=s("label",null,"Orari",-1),Rt={class:"flex justify-content-center"},zt={class:"flex align-items-center justify-content-end mt-6"};function Lt(t,e,n,o,V,x){const d=_("InputTextWithValidation"),r=_("Dropdown"),f=_("Calendar"),h=_("Checkbox"),u=_("Button"),g=_("InputMask"),p=_("Column"),l=_("InputNumber"),v=_("DataTable"),S=_("Form"),E=te("tooltip");return U(),Z(S,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:b(()=>[s("div",bt,[s("div",ht,[a(d,{name:"name",label:"Nome eccezione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.name=i)},null,8,["modelValue"])]),s("div",kt,[Ct,a(r,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.course_id=i),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:o.onCourseChanged},null,8,["modelValue","options","onChange"])]),s("div",yt,[xt,a(f,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[2]||(e[2]=i=>o.form.date=i),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),wt,s("div",Vt,[Dt,o.form.booking_exception_rule_ticket_ids&&o.form.booking_exception_rule_ticket_ids.length===0?(U(),z("small",St," Selezionare almeno un biglietto ")):q("",!0),(U(!0),z(Y,null,re(o.responseTickets.tickets,i=>{var c;return U(),z("div",{key:i.id,class:"flex align-items-center mb-2"},[a(h,{modelValue:o.form.booking_exception_rule_ticket_ids,"onUpdate:modelValue":e[3]||(e[3]=C=>o.form.booking_exception_rule_ticket_ids=C),inputId:i.id+"",name:"category",value:i.id},null,8,["modelValue","inputId","value"]),s("label",{for:i.id+"",class:"ml-2 flex align-items-center"},[s("div",Et,M((c=i.translations)==null?void 0:c.it.name.text),1),s("div",Ut,"€ "+M(i.price),1)],8,Tt)])}),128))]),At,s("div",Bt,[s("div",It,[jt,a(u,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[4]||(e[4]=i=>o.addSlot())})]),a(v,{value:o.form.booking_exception_rule_slots,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[5]||(e[5]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:b(()=>[P(" Nessuno slot orario trovato. ")]),default:b(()=>[a(p,{header:"Ora",field:"start_at"},{editor:b(({data:i,field:c})=>[a(g,{id:"basic",modelValue:i[c],"onUpdate:modelValue":C=>i[c]=C,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{header:"Posti",field:"available_seats"},{editor:b(({data:i,field:c})=>[a(l,{modelValue:i[c],"onUpdate:modelValue":C=>i[c]=C,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),a(p,{header:"",style:{width:"3rem","padding-left":"0"}},{body:b(({data:i,index:c})=>[s("div",Rt,[H(a(u,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:C=>o.deleteSlot(i,c)},null,8,["onClick"]),[[E,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])])]),s("div",zt,[a(u,{label:"Annulla",text:"",onClick:e[6]||(e[6]=i=>o.resetForm())}),a(u,{label:"Conferma",type:"submit",disabled:o.form.booking_exception_rule_ticket_ids&&o.form.booking_exception_rule_ticket_ids.length===0},null,8,["disabled"])])]),_:1},8,["onSubmit","validation-schema"])}const Mt=K(vt,[["render",Lt]]),Ft={props:["location_id"],setup(t){J(()=>{d.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,t.location_id&&c(t.location_id)});const e=G(),n=k(),o=k(),V=k(),x=k(),d=k(!0),r=k(),f=k(0),h=k(!1);k([]);const u=k(),g=k(!1),p=ve(),l=be(),v=I(()=>l.responseBookingExceptions),S=_e(),E=I(()=>S.submitDialog),i=I(()=>p.responseCourses),c=async function(m){const y=new Map;y.set("location_id",m),await p.getAllCourses(y).then(()=>{d.value=!1}).catch(j=>{d.value=!1,B(e,j)})},C=async function(m){if(!m)return;d.value=!0;const y=new Map;y.set("location_id",t.location_id),y.set("course_id",m),await l.fetchAllBookingExceptions(y).then(()=>{d.value=!1}).catch(j=>{d.value=!1,B(e,j)})},L=function(m){V.value=m;let y="Sei sicuro di voler eliminare questa eccezione?";S.setDialog("Elimina eccezione","Elimina","Annulla",y),S.setBtnSubmit(!1),S.setDynamicDialogVisibility(!0)},F=async function(){V.value&&await l.deleteBookingException(V.value).then(()=>{d.value=!1,O(e,{message:"Eccezione eliminata correttamente",error:!1}),C(u.value)}).catch(m=>{d.value=!1,B(e,m)})},R=function(m,y){x.value=m,h.value=!0,g.value=y},W=function(m){u.value=m,C(m),h.value=!1},D=function(){return g.value?"Duplica eccezione":x.value&&x.value.id&&!g.value?"Modifica eccezione":"Nuova eccezione"};return N(E,m=>{m&&F()}),N(i,()=>{i.value&&i.value.courses&&i.value.courses.length>0&&(u.value=i.value.courses[0].id,C(u.value))}),N(t,()=>{t.location_id&&c(t.location_id)}),{dt:n,responseBookingExceptions:v,loading:d,totalRecords:f,lazyParams:r,op:o,visible:h,currentConfiguration:x,responseCourses:i,course_id:u,flag_duplicate:g,onDeleteConfigurationException:F,confirmDelete:L,onEditConfiguration:R,getHeader:D,closeDialog:W,fetchAllBookingExceptions:C,formatPrettyDate:ee}},components:{BookingExceptionDialog:Mt}},Ot={class:"flex justify-content-between mt-4 mb-3"},Nt={class:"field flex flex-column"},Pt=s("label",{for:"location"},"Percorso",-1),Wt={class:"flex justify-content-center"};function qt(t,e,n,o,V,x){const d=_("Dropdown"),r=_("Button"),f=_("Column"),h=_("DataTable"),u=_("BookingExceptionDialog"),g=_("Dialog"),p=te("tooltip");return U(),z(Y,null,[s("div",Ot,[s("div",Nt,[Pt,a(d,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=l=>o.course_id=l),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=l=>o.fetchAllBookingExceptions(o.course_id))},null,8,["modelValue","options"])]),a(r,{label:"Eccezione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=l=>o.onEditConfiguration({},!1))})]),a(h,{value:o.responseBookingExceptions.booking_exception_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[P(" Nessuna eccezione trovata. ")]),default:b(()=>[a(f,{header:"Nome",field:"name"}),a(f,{header:"Il"},{body:b(({data:l})=>[P(M(o.formatPrettyDate(l.date)),1)]),_:1}),a(f,{header:""},{body:b(({data:l})=>[s("div",Wt,[H(a(r,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditConfiguration(l,!0)},null,8,["onClick"]),[[p,"Duplica",void 0,{top:!0}]]),H(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditConfiguration(l,!1)},null,8,["onClick"]),[[p,"Modifica",void 0,{top:!0}]]),H(a(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.confirmDelete(l.id)},null,8,["onClick"]),[[p,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(g,{visible:o.visible,"onUpdate:visible":e[4]||(e[4]=l=>o.visible=l),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:b(()=>[a(u,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=l=>o.closeDialog(l)),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const Ht=K(Ft,[["render",qt]]),Jt={props:["location_id","closing"],setup(t,e){J(()=>{t.closing&&t.closing.id?(n.value=Object.assign({},t.closing),n.value.date&&(n.value.date=ee(n.value.date))):n.value.location_id=t.location_id});const n=k({}),o=fe({name:ge().required("Nome chiusura obbligatoria")}),{showLoader:V,hideLoader:x}=oe(),d=G(),r=ye(),f=be(),h=I(()=>r.allLocations),u=function(v){V(),f.addClosing(v).then(()=>{x(),O(d,{message:"Chiusura aggiunta correttamente",error:!1}),e.emit("onSubmit")}).catch(S=>{x(),B(d,S)})},g=function(v){V(),f.updateBookingException(v).then(()=>{x(),O(d,{message:"Chiusura modificata correttamente",error:!1}),e.emit("onSubmit")}).catch(S=>{x(),B(d,S)})};return{form:n,schema:o,onSubmit:function(){const v=Object.assign({},n.value);v.date&&(v.date=ae(v.date),v.location_id=t.location_id);const S={booking_exception_rule:v};n.value.id?g(S):u(S)},resetForm:function(){e.emit("onSubmit",n.value)},locations:h}},components:{Form:se,InputTextWithValidation:pe}},Gt={class:"formgrid grid mt-3"},Kt={class:"field col-6"},Qt={class:"field col-6 flex flex-column"},Xt=s("label",{from:"from_date"},"Il",-1),Yt={class:"flex align-items-center justify-content-end mt-6"};function Zt(t,e,n,o,V,x){const d=_("InputTextWithValidation"),r=_("Calendar"),f=_("Button"),h=_("Form");return U(),Z(h,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:b(()=>[s("div",Gt,[s("div",Kt,[a(d,{name:"name",label:"Nome chiusura*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=u=>o.form.name=u)},null,8,["modelValue"])]),s("div",Qt,[Xt,a(r,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[1]||(e[1]=u=>o.form.date=u),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),s("div",Yt,[a(f,{label:"Annulla",text:"",onClick:e[2]||(e[2]=u=>o.resetForm())}),a(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const $t=K(Jt,[["render",Zt]]),en={props:["location_id"],setup(t){J(()=>{d.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,t.location_id&&l()});const e=G(),n=k(),o=k(),V=k(),x=k(),d=k(!0),r=k(),f=k(!1),h=be(),u=_e(),g=I(()=>u.submitDialog),p=I(()=>h.responseClosings),l=async function(){const C=new Map;C.set("location_id",t.location_id),await h.fetchAllClosings(C).then(()=>{d.value=!1}).catch(L=>{d.value=!1,B(e,L)})},v=function(C){V.value=C;let L="Sei sicuro di voler eliminare questa chiusura?";u.setDialog("Elimina chiusura","Elimina","Annulla",L),u.setBtnSubmit(!1),u.setDynamicDialogVisibility(!0)},S=async function(){if(!V.value)return;const C={location_id:t.location_id,date:V.value};await h.deleteClosing(C).then(()=>{d.value=!1,O(e,{message:"Chiusura eliminata correttamente",error:!1}),l()}).catch(L=>{d.value=!1,B(e,L)})},E=function(C){x.value=C,f.value=!0},i=function(){l(),f.value=!1},c=function(){return x.value&&x.value.id?"Modifica chiusura":"Nuova chiusura"};return N(g,C=>{g.value&&S()}),N(t,()=>{t.location_id&&l()}),{dt:n,responseClosings:p,loading:d,lazyParams:r,op:o,visible:f,currentClosing:x,formatPrettyDate:ee,onDeleteClosing:S,confirmDelete:v,onEditConfiguration:E,closeDialog:i,getHeader:c}},components:{ClosingDialog:$t}},on={class:"flex justify-content-end mt-4 mb-3"},tn={class:"flex justify-content-center"};function nn(t,e,n,o,V,x){const d=_("Button"),r=_("Column"),f=_("DataTable"),h=_("ClosingDialog"),u=_("Dialog"),g=te("tooltip");return U(),z(Y,null,[s("div",on,[a(d,{label:"Chiusura",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=p=>o.onEditConfiguration({}))})]),a(f,{value:o.responseClosings.closings,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[P(" Nessuna chiusura trovata. ")]),default:b(()=>[a(r,{header:"Nome",field:"name"}),a(r,{header:"Il"},{body:b(({data:p})=>[P(M(o.formatPrettyDate(p.date)),1)]),_:1}),a(r,{header:""},{body:b(({data:p})=>[s("div",tn,[H(a(d,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:l=>o.onEditConfiguration(p)},null,8,["onClick"]),[[g,"Modifica",void 0,{top:!0}]]),H(a(d,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:l=>o.confirmDelete(p.date)},null,8,["onClick"]),[[g,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(u,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=p=>o.visible=p),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:b(()=>[a(h,{onOnSubmit:e[1]||(e[1]=p=>o.closeDialog()),onOnClose:e[2]||(e[2]=p=>o.visible=!1),location_id:n.location_id,closing:o.currentClosing},null,8,["location_id","closing"])]),_:1},8,["visible","header"])],64)}const an=K(en,[["render",nn]]),sn={setup(){J(()=>{p()});const t=k({}),e=ye(),n=k(),o=k(),V=k(),{showLoader:x,hideLoader:d}=oe(),r=G(),f=k(!1),h=k({}),u=I(()=>e.allLocations),g=I(()=>e.getCurrentLocation),p=async function(){await e.fetchAllLocations().then(()=>{g.value&&(t.value.location=g.value,h.value=JSON.parse(JSON.stringify(g.value)),v())})},l=function(){e.updateCurrenLocation(t.value.location),h.value=JSON.parse(JSON.stringify(t.value.location)),v()},v=function(){o.value=ee(t.value.location.calendar_visible_from),V.value=ee(t.value.location.calendar_visible_to)},S=async function(){x();let E={calendar_visible_from:ae(o.value),calendar_visible_to:ae(V.value),location_id:t.value.location.id};await e.updateLocation(E).then(()=>{d(),O(r,{message:"Data aggiornata correttamente",error:!1}),o.value=Se(o.value),V.value=Se(V.value),f.value=!1}).catch(i=>{d(),B(r,i)})};return N(u,()=>{t.value.location_id=u.value[0].id}),{form:t,courseTable:n,calendar_visible_from:o,calendar_visible_to:V,active:f,locationCopy:h,locations:u,onChangeLocation:l,updateVisibility:S,fetchAllLocations:p,formatPrettyDate:ee}},components:{CourseTable:co,OpeningsTable:pt,BookingExceptionTable:Ht,ClosingsTable:an,LocationTable:Co}};const ln=s("h1",null,"Configurazioni",-1),cn={class:"flex align-items-center justify-content-between"},rn={class:"field col-3 flex flex-column"},dn=s("label",{for:"location"},"Location",-1),un={class:"col-9 flex justify-content-end"},mn={class:"col-12 field"},_n=s("label",{class:"ml-1"},"Finestra di visibilità",-1),fn={class:"flex align-items-center mt-2 ml-0 pl-0 gap-5"};function gn(t,e,n,o,V,x){var i;const d=_("Dropdown"),r=_("Calendar"),f=_("Inplace"),h=_("Card"),u=_("LocationTable"),g=_("TabPanel"),p=_("CourseTable"),l=_("OpeningsTable"),v=_("BookingExceptionTable"),S=_("ClosingsTable"),E=_("TabView");return U(),z("div",null,[ln,s("div",cn,[s("div",rn,[dn,a(d,{modelValue:o.form.location,"onUpdate:modelValue":e[0]||(e[0]=c=>o.form.location=c),options:o.locations,optionLabel:"name",placeholder:"",name:"location",onChange:e[1]||(e[1]=c=>o.onChangeLocation())},null,8,["modelValue","options"])]),s("div",un,[o.form.location?(U(),Z(h,{key:0,style:{width:"30rem"}},{content:b(()=>[s("div",mn,[_n,s("div",fn,[a(f,{closable:!0,onClose:e[3]||(e[3]=c=>o.updateVisibility()),active:o.active},{display:b(()=>[P(" Dal: "+M(o.calendar_visible_from),1)]),content:b(()=>[a(r,{inputId:"date",modelValue:o.calendar_visible_from,"onUpdate:modelValue":e[2]||(e[2]=c=>o.calendar_visible_from=c),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"]),a(f,{closable:!0,onClose:e[5]||(e[5]=c=>o.updateVisibility()),active:o.active},{display:b(()=>[P(" Al: "+M(o.calendar_visible_to),1)]),content:b(()=>[a(r,{inputId:"date",modelValue:o.calendar_visible_to,"onUpdate:modelValue":e[4]||(e[4]=c=>o.calendar_visible_to=c),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"])])])]),_:1})):q("",!0)])]),(i=o.form.location)!=null&&i.id?(U(),Z(E,{key:0},{default:b(()=>[a(g,{header:"Location"},{default:b(()=>[a(u,{location:o.locationCopy},null,8,["location"])]),_:1}),a(g,{header:"Percorsi"},{default:b(()=>{var c;return[a(p,{location_id:(c=o.form.location)==null?void 0:c.id,ref:"courseTable"},null,8,["location_id"])]}),_:1}),a(g,{header:"Aperture"},{default:b(()=>[a(l,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),a(g,{header:"Eccezioni"},{default:b(()=>[a(v,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),a(g,{header:"Chiusure"},{default:b(()=>[a(S,{location_id:o.form.location.id},null,8,["location_id"])]),_:1})]),_:1})):q("",!0)])}const En=K(sn,[["render",gn]]);export{En as default};
