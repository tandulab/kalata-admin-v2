import{l as M,B as j,C as N,A as q,m as z,o as D,a as A,p,c as k,z as P,i as W,_ as G,r as f,v as H,b as w,q as T,w as g,h as B,f as a,t as R,g as d,x as S,s as J,e as K,F as Q}from"../index94667.js";import{e as y,p as X,a as Y,s as V,u as Z}from"./helpers94667.js";import{f as ee,a as oe,b as E}from"./formatData94667.js";import{c as te,a as x}from"./index.esm94667.js";import{F as I}from"./vee-validate.esm94667.js";import{I as ne}from"./InputTextWithValidation94667.js";import{D as U}from"./datetime94667.js";/* empty css                                                                            */class h{static async fetchAll(){return(await M("/admin/guides")).data}static async addGuide(e){return await j("/admin/guides",e)}static async updateGuide(e){return await N(`/admin/guides/${e.guide.id}`,e)}static async deleteGuide(e){return await q(`/admin/guides/${e}`)}}const O=z({id:"guide",state:()=>({guide:{},guides:[],response_guides:{}}),getters:{allGuides:t=>t.guides,responseGuides:t=>t.response_guides,getCurrentGuide:t=>t.guide},actions:{async fetchAllGuides(){await h.fetchAll().then(t=>{this.response_guides=t})},async addGuide(t){await h.addGuide(t).then()},async updateGuide(t){await h.updateGuide(t).then()},async deleteGuide(t){await h.deleteGuide(t).then()}}}),ae={setup(){D(()=>{u.value=!0,n.value={first:0,rows:e.value.rows,sortField:null,sortOrder:null},n.value.page=0,v()});const t=A(),e=p(),l=p(),o=p(),_=p(),u=p(!0),n=p(),r=p(0),c=O(),s=k(()=>c.responseGuides),i=P(),m=k(()=>i.submitDialog);function v(){u.value=!0,setTimeout(()=>{C()},Math.random()*1e3+250)}const C=async function(){await c.fetchAllGuides().then(()=>{u.value=!1}).catch(b=>{u.value=!1,y(t,b)})},$=function(b){_.value=b;let L="Sei sicuro di voler eliminare questa guida?";i.setDialog("Elimina guida","Elimina","Annulla",L),i.setBtnSubmit(!1),i.setDynamicDialogVisibility(!0)},F=async function(){await c.deleteGuide(_.value).then(()=>{u.value=!1,V(t,{message:"Guida eliminata correttamente",error:!1}),C()}).catch(b=>{u.value=!1,y(t,b)})};return W(m,b=>{b&&F()}),{dt:e,responseGuides:s,loading:u,totalRecords:r,lazyParams:n,currentOrder:l,op:o,loadLazyData:v,onDeleteGuide:F,confirmDelete:$,formatDataAndHourFromUnixTimestamps:ee,formatPrettyDate:oe,prettyPaymentStatus:X,prettyTicketType:Y}}},ie={class:"flex justify-content-center"};function le(t,e,l,o,_,u){const n=f("Column"),r=f("Button"),c=f("DataTable"),s=H("tooltip");return w(),T(c,{value:o.responseGuides.guides,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:g(()=>[B(" Nessuna guida trovata. ")]),default:g(()=>[a(n,{header:"Guida",field:"name"},{body:g(({data:i})=>[B(R(i.last_name)+" "+R(i.first_name),1)]),_:1}),a(n,{header:"Email",field:"email"}),a(n,{header:"Telefono",field:"phone_number"}),a(n,{header:"Ente",field:"notes"}),a(n,{header:""},{body:g(({data:i})=>[d("div",ie,[S(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:m=>t.$emit("onEdit",i)},null,8,["onClick"]),[[s,"Modifica",void 0,{top:!0}]]),S(a(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:m=>o.confirmDelete(i.id)},null,8,["onClick"]),[[s,"Elimina",void 0,{top:!0}]]),S(a(r,{link:"",icon:"pi pi-download",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:m=>t.$emit("onDownloadReport",i)},null,8,["onClick"]),[[s,"Download Report",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const se=G(ae,[["render",le]]),de={props:["guide"],setup(t,e){D(()=>{t.guide&&(l.value=Object.assign({},t.guide))});const l=p({}),o=te({first_name:x().required("Nome obbligatorio"),last_name:x().required("Cognome obbligatorio"),email:x().required("Email obbligatoria")}),{showLoader:_,hideLoader:u}=Z(),n=A(),r=O(),c=function(){_();const m={guide:l.value};r.addGuide(m).then(()=>{u(),V(n,{message:"Guida aggiunta correttamente",error:!1}),e.emit("onSubmit")}).catch(v=>{y(n,v)})},s=function(){_();const m={guide:l.value};r.updateGuide(m).then(()=>{u(),V(n,{message:"Guida modificata correttamente",error:!1}),e.emit("onSubmit")}).catch(v=>{u(),y(n,v)})};return{form:l,schema:o,onSubmit:function(){l.value.id?s():c()}}},components:{Form:I,InputTextWithValidation:ne}},re={class:"formgrid grid mt-3"},ue={class:"field col-6 flex flex-column mb-0"},me={class:"field col-6 mb-0"},ce={class:"formgrid grid"},fe={class:"field col-6 flex flex-column"},pe={class:"field col-6 flex flex-column"},_e=d("label",{for:"phone_number"},"Telefono",-1),ge={class:"formgrid grid"},be={class:"field col-12 flex flex-column"},ve=d("label",{for:"notes"},"Ente",-1),he={class:"flex align-items-center justify-content-end mt-6"};function ye(t,e,l,o,_,u){const n=f("InputTextWithValidation"),r=f("InputText"),c=f("Button"),s=f("Form");return w(),T(s,{"validation-schema":o.schema,onSubmit:o.onSubmit},{default:g(()=>[d("div",re,[d("div",ue,[a(n,{name:"first_name",label:"Nome*",modelValue:o.form.first_name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.first_name=i)},null,8,["modelValue"])]),d("div",me,[a(n,{name:"last_name",label:"Cognome*",modelValue:o.form.last_name,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.last_name=i)},null,8,["modelValue"])])]),d("div",ce,[d("div",fe,[a(n,{name:"email",label:"Email*",modelValue:o.form.email,"onUpdate:modelValue":e[2]||(e[2]=i=>o.form.email=i)},null,8,["modelValue"])]),d("div",pe,[_e,a(r,{name:"phone_number",modelValue:o.form.phone_number,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.phone_number=i)},null,8,["modelValue"])])]),d("div",ge,[d("div",be,[ve,a(r,{name:"notes",modelValue:o.form.notes,"onUpdate:modelValue":e[4]||(e[4]=i=>o.form.notes=i)},null,8,["modelValue"])])]),d("div",he,[a(c,{label:"Annulla",text:""}),a(c,{label:"Conferma",type:"submit"})])]),_:1},8,["validation-schema","onSubmit"])}const De=G(de,[["render",ye]]),Ge={props:["guide"],setup(t,e){D(()=>{l.value.start_date=U.now().minus({months:1}).toFormat("dd/MM/yyyy"),l.value.end_date=U.now().toFormat("dd/MM/yyyy")});const l=p({});return{form:l,onSubmit:function(){let _="/admin/guides/download?start_date="+E(l.value.start_date)+"&end_date="+E(l.value.end_date)+"&guide_id="+t.guide.id;J.get(_,{responseType:"blob"}).then(u=>{var n=new Blob([u.data],{type:"application/pdf"}),r=URL.createObjectURL(n);window.open(r),e.emit("onSubmit")})}}},components:{Form:I}},we={class:"formgrid grid mt-3"},Se={class:"field col-6 flex flex-column"},xe=d("label",{from:"start_date"},"Filtra Dal",-1),Ve={class:"field col-6 flex flex-column"},Te=d("label",{from:"end_date"},"Al",-1),Ce={class:"flex align-items-center justify-content-end mt-6"};function Fe(t,e,l,o,_,u){const n=f("Calendar"),r=f("Button"),c=f("Form");return w(),T(c,{onSubmit:o.onSubmit},{default:g(()=>[d("div",we,[d("div",Se,[xe,a(n,{inputId:"start_date",modelValue:o.form.start_date,"onUpdate:modelValue":e[0]||(e[0]=s=>o.form.start_date=s),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),d("div",Ve,[Te,a(n,{inputId:"end_date",modelValue:o.form.end_date,"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.end_date=s),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),d("div",Ce,[a(r,{label:"Annulla",text:""}),a(r,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const ke=G(Ge,[["render",Fe]]),Be={setup(){D(()=>{});const t=p(!1),e=p(!1),l=p(),o=p({});return{visibleDialog:t,guideTable:l,currentGuide:o,visibleFilterDialog:e,onSubmit:function(){t.value=!1,l.value.loadLazyData(),o.value={}},onShowDialog:function(){o.value={},t.value=!0},onEdit:function(s){o.value=s,t.value=!0},onDownloadReport:function(s){o.value=s,e.value=!0},closeDialog:function(){e.value=!1}}},components:{GuideTable:se,GuideDialog:De,ReportGuideDialog:ke}},Re=d("h1",null,"Guide",-1),Ee={class:"flex justify-content-end mt-4 mb-3"};function Ue(t,e,l,o,_,u){const n=f("Button"),r=f("GuideTable"),c=f("GuideDialog"),s=f("Dialog"),i=f("ReportGuideDialog");return w(),K(Q,null,[Re,d("div",Ee,[a(n,{label:"Guida",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=m=>o.onShowDialog())})]),a(r,{ref:"guideTable",onOnEdit:e[1]||(e[1]=m=>o.onEdit(m)),onOnDownloadReport:e[2]||(e[2]=m=>o.onDownloadReport(m))},null,512),a(s,{visible:o.visibleDialog,"onUpdate:visible":e[3]||(e[3]=m=>o.visibleDialog=m),modal:"",header:"Guida",style:{width:"50rem"}},{default:g(()=>[a(c,{guide:o.currentGuide,onOnSubmit:o.onSubmit},null,8,["guide","onOnSubmit"])]),_:1},8,["visible"]),a(s,{visible:o.visibleFilterDialog,"onUpdate:visible":e[4]||(e[4]=m=>o.visibleFilterDialog=m),modal:"",header:"Report guida",style:{width:"50rem"}},{default:g(()=>[a(i,{guide:o.currentGuide,onOnSubmit:o.closeDialog},null,8,["guide","onOnSubmit"])]),_:1},8,["visible"])],64)}const qe=G(Be,[["render",Ue]]);export{qe as default};
