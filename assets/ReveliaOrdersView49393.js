import{O as J}from"./OrderFilter49393.js";import{o as L,x as K,c as B,a as W,l as u,i as X,_ as j,r as D,p as Y,b as z,e as S,g as w,f as a,w as i,F as Z,h as _,t as c,n as E,s as P,q as A}from"../index49393.js";import{u as $}from"./order49393.js";import{u as ee,p as te,e as T,s as ae}from"./helpers49393.js";import{f as oe,a as ne,b as re}from"./formatData49393.js";import"./location49393.js";import"./datetime49393.js";import"./attraction49393.js";const se={props:["filters"],setup(b,d){L(()=>{e.value=!0,s.value={first:0,rows:O.value.rows,sortField:null,sortOrder:null},s.value.page=0});const f=$(),{showLoader:o,hideLoader:m}=ee(),h=K(),y=B(()=>h.submitDialog),r=B(()=>f.responseOrders),p=W(),O=u(),C=u(),t=u(),e=u(!0),s=u(),g=u(0),R=u([]),x=u(),F=u();function k(){e.value=!0,setTimeout(()=>{V()},Math.random()*1e3+250)}const V=async function(){const n=new Map;Object.entries(b.filters).forEach(([l,v])=>{v&&((l=="date_from"||l=="date_to")&&v?n.set(l,re(v)):n.set(l,v))}),n.set("page",s.value.page+1),n.set("per_page",s.value.rows),await f.fetchAllReveliaOrders(n).then(()=>{e.value=!1}).catch(l=>{e.value=!1,T(p,l)})},q=n=>{s.value=n,k()},M=n=>{t.value.toggle(n)},N=function(n){const l={course_name:n.course_name,start_at:n.start_at};d.emit("updateFilters",l)},U=async function(){o(),await f.downloadOrderCsv(b.filters.attraction_id).then(()=>{m()}).catch(n=>{m(),T(p,n)})},H=function(n,l){x.value=n,F.value=l;let v="Sei sicuro di voler eliminare questa prenotazione?";h.setDialog("Elimina prenotazione","Elimina","Annulla",v),h.setBtnSubmit(!1),h.setDynamicDialogVisibility(!0)},G=async function(){const n={order_id:x.value,event_id:F.value};o(),await f.deleteOrder(n).then(()=>{m(),ae(p,{message:"Prenotazione eliminata correttamente",error:!1}),k()}).catch(l=>{m(),T(p,l)})},Q=async function(n,l){const v={order_id:n,event_id:l};o(),await f.downloadOrderPDF(v).then(()=>{m()}).catch(I=>{m(),T(p,I)})};return X(y,n=>{n&&G()}),{dt:O,responseOrders:r,loading:e,totalRecords:g,lazyParams:s,currentOrder:C,op:t,expandedRows:R,loadLazyData:k,toggle:M,openDialog:N,onPage:q,openPDF:Q,downloadCsv:U,confirmDelete:H,formatDataAndHourFromUnixTimestamps:oe,formatPrettyDate:ne,prettyPaymentStatus:te}}};const ie={class:"flex justify-content-end mt-4 mb-3"},de={class:"order-table"},le={key:0},ce=w("br",null,null,-1),ue={class:"uppercase"},_e={key:0},me={class:"flex justify-content-center"};function pe(b,d,f,o,m,h){const y=D("Button"),r=D("Column"),p=D("Badge"),O=D("DataTable"),C=Y("tooltip");return z(),S(Z,null,[w("div",ie,[a(y,{label:"CSV Prenotazioni",icon:"pi pi-download",rounded:"",outlined:"",onClick:d[0]||(d[0]=t=>o.downloadCsv()),disabled:o.responseOrders.total==0},null,8,["disabled"])]),w("div",de,[a(O,{value:o.responseOrders.orders,totalRecords:o.responseOrders.total,lazy:!0,paginator:!0,rows:30,ref:"dt",loading:o.loading,stripedRows:"",onPage:d[1]||(d[1]=t=>o.onPage(t)),expandedRows:o.expandedRows,"onUpdate:expandedRows":d[2]||(d[2]=t=>o.expandedRows=t)},{empty:i(()=>[_(" Nessuna prenotazione trovata. ")]),expansion:i(t=>[a(O,{value:t.data.events,class:"m-4 mx-4"},{empty:i(()=>[_(" Nessuna prenotazione trovata. ")]),default:i(()=>[a(r,{header:"Data prenotazione"},{body:i(({data:e})=>{var s;return[_(c(o.formatPrettyDate((s=e.date_configuration)==null?void 0:s.date_event)),1)]}),_:1}),a(r,{header:"Cliente"},{body:i(()=>[_(c(t.data.user_name)+" "+c(t.data.user_surname),1),ce,w("span",ue,c(t.data.tax_code),1)]),_:2},1024),a(r,{header:"Telefono"},{body:i(()=>[_(c(t.data.user_phone),1)]),_:2},1024),a(r,{header:"Cap"},{body:i(()=>[_(c(t.data.user_zip),1)]),_:2},1024),a(r,{header:"Orario visita"},{body:i(({data:e})=>{var s,g;return[_(c((s=e.date_configuration)==null?void 0:s.start_at)+" - "+c((g=e.date_configuration)==null?void 0:g.end_at),1)]}),_:1}),a(r,{header:"Guida"},{body:i(({data:e})=>{var s,g,R,x;return[_(c((g=(s=e.date_configuration)==null?void 0:s.guide)==null?void 0:g.first_name)+" "+c((x=(R=e.date_configuration)==null?void 0:R.guide)==null?void 0:x.last_name),1)]}),_:1}),a(r,{header:"Q.tà"},{body:i(()=>{var e;return[_(c((e=t.data.order_items[0])==null?void 0:e.quantity),1)]}),_:2},1024),a(r,{header:"Prezzo"},{body:i(()=>{var e;return[_(" € "+c((e=t.data.order_items[0])==null?void 0:e.price),1)]}),_:2},1024),a(r,{header:"Stato"},{body:i(({data:e})=>[e.status?(z(),S("div",_e,[a(p,{value:o.prettyPaymentStatus(e.status),class:E([e.status,"px-3 border-round-lg"])},null,8,["value","class"])])):P("",!0)]),_:1}),a(r,{header:""},{body:i(({data:e})=>[w("div",me,[A(a(y,{link:"",icon:"pi pi-print",target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:s=>o.openPDF(t.data.id,e.id)},null,8,["onClick"]),[[C,"Stampa",void 0,{top:!0}]]),A(a(y,{link:"",icon:"pi pi-trash",target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:s=>o.confirmDelete(t.data.id,e.id)},null,8,["onClick"]),[[C,"Elimina",void 0,{top:!0}]])])]),_:2},1024)]),_:2},1032,["value"])]),default:i(()=>[a(r,{header:"Codice prenotazione",field:"order_number",ref:"order_number"},null,512),a(r,{header:"Email",field:"user_email",ref:"user_email"},null,512),a(r,{header:"Data ordine",field:"created_at",ref:"created_at"},{body:i(({data:t})=>[_(c(o.formatDataAndHourFromUnixTimestamps(t.created_at)),1)]),_:1},512),a(r,{header:"Stato"},{body:i(({data:t})=>[t.status?(z(),S("div",le,[a(p,{value:o.prettyPaymentStatus(t.status),class:E([t.status,"px-3 border-round-lg"])},null,8,["value","class"])])):P("",!0)]),_:1}),a(r,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows"])])],64)}const fe=j(se,[["render",pe]]),ve={setup(){L(()=>{});const b=u({}),d=u(),f=u(!0);return{form:b,reveliaOrderTable:d,isRevelia:f,filterTable:function(m){b.value=m,d.value.loadLazyData()}}},components:{OrderFilter:J,ReveliaOrderTable:fe}},be=w("h1",null,"Prenotazioni e incassi",-1);function ye(b,d,f,o,m,h){const y=D("OrderFilter"),r=D("ReveliaOrderTable");return z(),S("div",null,[be,a(y,{onOnSubmit:d[0]||(d[0]=p=>o.filterTable(p)),revelia:o.isRevelia},null,8,["revelia"]),a(r,{filters:o.form,ref:"reveliaOrderTable"},null,8,["filters"])])}const Te=j(ve,[["render",ye]]);export{Te as default};
