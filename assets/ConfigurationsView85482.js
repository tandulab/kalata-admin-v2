import{u as we}from"./location85482.js";import{u as ne,e as B,s as F,f as Ee}from"./helpers85482.js";import{x as G,z as Z,B as de,y as ue,A as me,o as K,l as k,a as J,u as Ae,c as R,i as O,_ as Q,r as f,m as oe,b as I,s as ee,w as p,g as s,f as a,e as L,t as N,q as X,h as P,p as q,v as _e,F as Y,D as re}from"../index85482.js";import{c as fe,a as ge}from"./index.esm85482.js";import{F as pe}from"./vee-validate.esm85482.js";import{I as ve}from"./InputTextWithValidation85482.js";import{u as ye}from"./category85482.js";import{d as Ce,e as le,a as $,b as ae,g as xe}from"./formatData85482.js";import{D as Be}from"./datetime85482.js";import"./attraction85482.js";import"./_commonjsHelpers85482.js";/* empty css                                                                            */class ce{static async fetchAll(e){return(await G(`/admin/locations/${e}/courses`)).data}static async addCourse(e){return(await Z(`/admin/locations/${e.location_id}/courses`,e)).data.course}static async updateCourse(e){return(await de(`/admin/locations/${e.location_id}/courses/${e.course.id}`,e)).data.course}static async deleteCourse(e){return await ue(`/admin/courses/${e}`)}}const Ve=me({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:t=>t.courses,responseCourses:t=>t.response_courses,getTotalCourses:t=>t.response_courses?t.response_courses.total:0,getCurrentCourse:t=>t.course},actions:{async fetchAllCourses(t){await ce.fetchAll(t).then(e=>{this.response_courses=e,this.courses=e.courses})},async addCourse(t){await ce.addCourse(t).then(e=>{this.course=e})},async updateCourse(t){await ce.updateCourse(t).then(e=>{this.course=e})},async deleteCourse(t){await ce.deleteCourse(t).then()}}});class ie{static async fetchAll(e){return(await G(`/admin/courses/${e}/tickets`)).data}static async addTicket(e){return await Z(`/admin/courses/${e.course_id}/tickets`,e)}static async updateTicket(e){return await de(`/admin/courses/${e.course_id}/tickets/${e.ticket.id}`,e)}static async updateAllTickets(e){const n=e.course_id;return delete e.course_id,await Z(`/admin/courses/${n}/tickets/update_tickets`,e)}static async deleteTicket(e){return await ue(`/admin/courses/${e.course_id}/tickets/${e.ticket_id}`)}}const Ue=me({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{}}),getters:{allTickets:t=>t.tickets,responseTickets:t=>t.response_tickets,getTotalTickets:t=>t.response_tickets?t.response_tickets.total:0,getCurrentTicket:t=>t.ticket},actions:{async fetchAllTickets(t){await ie.fetchAll(t).then(e=>{this.response_tickets=e,this.tickets=e.tickets})},async addTicket(t){await ie.addTicket(t).then()},async updateTicket(t){await ie.updateTicket(t).then()},async deleteTicket(t){await ie.deleteTicket(t).then()},async updateAllTickets(t){await ie.updateAllTickets(t)}}}),Ie={props:["course","location_id"],setup(t,e){K(()=>{t.course&&t.course.id?(n.value=Object.assign({},t.course),j()):n.value.translations={it:{name:{id:null,text:""},description:{id:null,text:""}},en:{name:{id:null,text:""},description:{id:null,text:""}}},n.value.tickets=[]});const n=k({}),o=k([]),D=k("it"),w=fe({name:ge().required("Nome percorso obbligatorio")}),{showLoader:r,hideLoader:c}=ne(),m=J(),v=Ve(),u=ye(),b=Ue(),g=Ae(),l=k(!1),h=R(()=>v.allCourses),V=R(()=>u.allCategories),_=R(()=>b.responseTickets),i=R(()=>v.getCurrentCourse),C=R(()=>g.languages),S=function(T){r(),v.addCourse(T).then(()=>{c(),F(m,{message:"Percorso aggiunto correttamente",error:!1}),e.emit("onSubmit")}).catch(E=>{c(),B(m,E)})},j=async function(){let T=t.course.id?t.course.id:i.value.id;r(),await b.fetchAllTickets(T).then(()=>{c()}).catch(E=>{c(),B(m,E)})},M=function(T){r(),v.updateCourse(T).then(()=>{c(),F(m,{message:"Percorso modificato correttamente",error:!1}),e.emit("onSubmit")}).catch(E=>{c(),B(m,E)})},z=function(){const T=Object.assign({},n.value);let E={it:{name:T.translations.it.name.text,description:T.translations.it.description.text},en:{name:T.translations.en.name.text,description:T.translations.en.description.text}};T.translations=E,T.name=T.translations.it.name,T.description=T.translations.it.description;const U={course:T,location_id:t.location_id};n.value.id?M(U):S(U)},W=function(){let E={translations:{en:{name:{text:"",id:null},description:{text:"",id:null}},it:{name:{text:"",id:null},description:{text:"",id:null}}},price:0};n.value.tickets.push(E),o.value.push(E)},x=function(T,E){T.id?d(T):n.value.tickets.splice(E,1)},d=async function(T){const E={course_id:t.course.id?t.course.id:i.value.id,ticket_id:T.id};r(),await b.deleteTicket(E).then(()=>{c(),F(m,{message:"Biglietto eliminato correttamente",error:!1}),j()}).catch(U=>{c(),B(m,U)})},y=function(T){let{newData:E,index:U}=T;n.value.tickets[U]=E;let ke={it:{name:E.translations.it.name.text,description:E.translations.it.description.text},en:{name:E.translations.en.name.text,description:E.translations.en.description.text}};E.translations=ke,E.name=E.translations.it.name,E.description=E.translations.it.description,E.id?se(E):A(E)},A=async function(T){const E={course_id:t.course.id?t.course.id:i.value.id,ticket:T};await b.addTicket(E).then(()=>{c(),F(m,{message:"Biglietto aggiunto correttamente",error:!1}),j()}).catch(U=>{c(),B(m,U)})},se=async function(T){const E={course_id:t.course.id?t.course.id:i.value.id,ticket:T};await b.updateTicket(E).then(()=>{c(),F(m,{message:"Biglietto aggiornato correttamente",error:!1}),j()}).catch(U=>{c(),B(m,U)})},De=function(T){let E={it:{name:T.translations.it.name.text,description:T.translations.it.description.text},en:{name:T.translations.en.name.text,description:T.translations.en.description.text}};T.translations=E,T.id?se(T):A(T)},Te=async T=>{let E=T.value;E.forEach((U,ke)=>{U.position=ke+1;let Se={it:{name:U.translations.it.name.text,description:U.translations.it.description.text},en:{name:U.translations.en.name.text,description:U.translations.en.description.text}};U.translations=Se,U.name=U.translations.it.name,U.description=U.translations.it.description});try{const U={course_id:t.course.id?t.course.id:i.value.id,tickets:E};await b.updateAllTickets(U),j(),F(m,{message:"Ordine biglietti aggiornato",error:!1})}catch(U){B(m,U)}};return O(V,()=>{n.value.category||(n.value.category=V.value[0])}),O(_,()=>{_.value&&_.value.tickets.length>0?n.value.tickets=Object.assign([],_.value.tickets):n.value.tickets=[]}),O(i,()=>{n.value=Object.assign({},i.value)}),{form:n,schema:w,loading:l,editingRows:o,response_tickets:_,lang_selected:D,onSubmit:z,addTicket:W,onDeleteTicket:x,onRowEditSave:y,updateTicketsApi:se,onPublicTicket:De,onRowReorder:Te,courses:h,categories:V,languages:C}},components:{Form:pe,InputTextWithValidation:ve}},Re={class:"col-12 flex justify-content-end m-0 p-0 align-items-center"},je={key:0,class:"formgrid grid mt-3"},ze={class:"field col-12"},Me={class:"field col-12"},Le={for:"description"},Ne={key:1,class:"flex justify-content-end mt-4 mb-3"},Fe={key:0},Oe={key:0},Pe={class:"w-full"},We={class:"flex justify-content-center"},qe={class:"flex align-items-center justify-content-end mt-6"};function He(t,e,n,o,D,w){const r=f("Dropdown"),c=f("InputTextWithValidation"),m=f("Textarea"),v=f("Button"),u=f("Column"),b=f("InputText"),g=f("InputSwitch"),l=f("DataTable"),h=f("Form"),V=oe("tooltip");return I(),ee(h,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:p(()=>[s("div",Re,[a(r,{options:o.languages,optionLabel:"name",optionValue:"value",class:"m-2 capitalize dropdown-lng",modelValue:o.lang_selected,"onUpdate:modelValue":e[0]||(e[0]=_=>o.lang_selected=_)},null,8,["options","modelValue"])]),o.lang_selected&&o.form&&o.form.translations?(I(),L("div",je,[s("div",ze,[a(c,{name:"name",label:"Nome percorso* ("+o.lang_selected.toUpperCase()+")",modelValue:o.form.translations[o.lang_selected].name.text,"onUpdate:modelValue":e[1]||(e[1]=_=>o.form.translations[o.lang_selected].name.text=_)},null,8,["label","modelValue"])]),s("div",Me,[s("label",Le,"Descrizione ("+N(o.lang_selected.toUpperCase())+")",1),a(m,{rows:"5",cols:"30",name:"description",id:"description",label:"Nome percorso*",modelValue:o.form.translations[o.lang_selected].description.text,"onUpdate:modelValue":e[2]||(e[2]=_=>o.form.translations[o.lang_selected].description.text=_),class:"w-full"},null,8,["modelValue"])])])):X("",!0),o.form.id?(I(),L("div",Ne,[a(v,{label:"Tipologia biglietto",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[3]||(e[3]=_=>o.addTicket())})])):X("",!0),o.form.id&&o.lang_selected?(I(),ee(l,{key:2,value:o.form.tickets,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[4]||(e[4]=_=>o.editingRows=_),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave,reorderableColumns:!0,onRowReorder:o.onRowReorder},{empty:p(()=>[P(" Nessun biglietto trovato. ")]),default:p(()=>[a(u,{rowReorder:"",headerStyle:"width: 3rem",reorderableColumn:!1}),a(u,{header:"Tipo biglietto",style:{"min-width":"150px"},field:"name"},{body:p(({data:_})=>{var i;return[_.translations[o.lang_selected].name?(I(),L("span",Fe,N((i=_.translations[o.lang_selected].name)==null?void 0:i.text),1)):X("",!0)]}),editor:p(({data:_,field:i})=>[a(b,{modelValue:_.translations[o.lang_selected][i].text,"onUpdate:modelValue":C=>_.translations[o.lang_selected][i].text=C,name:"ticket_name_"+o.lang_selected,id:"ticket_name_"+o.lang_selected,type:"text"},null,8,["modelValue","onUpdate:modelValue","name","id"])]),_:1}),a(u,{header:"Descrizione",field:"description"},{body:p(({data:_})=>{var i;return[_.translations[o.lang_selected].description?(I(),L("span",Oe,N((i=_.translations[o.lang_selected].description)==null?void 0:i.text),1)):X("",!0)]}),editor:p(({data:_,field:i})=>[s("div",Pe,[a(m,{modelValue:_.translations[o.lang_selected][i].text,"onUpdate:modelValue":C=>_.translations[o.lang_selected][i].text=C,class:"w-full",name:"desc_"+o.lang_selected},null,8,["modelValue","onUpdate:modelValue","name"])])]),_:1}),a(u,{header:"Prezzo",field:"price",bodyStyle:"min-width: 6rem"},{body:p(({data:_})=>[P(" â‚¬ "+N((+_.price).toFixed(2)),1)]),editor:p(({data:_,field:i})=>[a(b,{modelValue:_[i],"onUpdate:modelValue":C=>_[i]=C},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(u,{header:"Stato",field:"public",bodyStyle:"min-width: 6rem"},{body:p(({data:_,field:i})=>[a(g,{modelValue:_[i],"onUpdate:modelValue":C=>_[i]=C,onChange:C=>o.onPublicTicket(_)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),editor:p(({data:_,field:i})=>[a(g,{modelValue:_[i],"onUpdate:modelValue":C=>_[i]=C},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(u,{rowEditor:!0,bodyStyle:"text-align:center; padding-right:0;min-width: 6rem"}),a(u,{header:"",style:{width:"3rem","padding-left":"0"}},{body:p(({data:_,index:i})=>[s("div",We,[q(a(v,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:C=>o.onDeleteTicket(_,i)},null,8,["onClick"]),[[V,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave","onRowReorder"])):X("",!0),s("div",qe,[a(v,{label:"Annulla",text:"",onClick:e[5]||(e[5]=_=>t.$emit("onClose"))}),a(v,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const Ge=Q(Ie,[["render",He]]),Ke={props:["location_id"],setup(t){K(()=>{w.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,h()});const e=J(),n=k(),o=k(),D=k(),w=k(!0),r=k(),c=k(0),m=k(!1),{showLoader:v,hideLoader:u}=ne(),b=Ve(),g=R(()=>b.responseCourses),l=_e();R(()=>l.submitDialog);function h(){v(),setTimeout(()=>{V()},Math.random()*1e3+250)}const V=async function(){w.value=!0,await b.fetchAllCourses(t.location_id).then(()=>{w.value=!1,u()}).catch(M=>{w.value=!1,u(),B(e,M)})},_=function(M){D.value=M,m.value=!0},i=function(M){D.value=M;let z="Sei sicuro di voler archiviare questo percorso?";l.setDialog("Archivia percorso","Archivia","Annulla",z),l.setBtnSubmit(!1),l.setDynamicDialogVisibility(!0)},C=function(M){const z=Object.assign({},M);let W={it:{name:z.translations.it.name.text,description:z.translations.it.description.text},en:{name:z.translations.en.name.text,description:z.translations.en.description.text}};z.translations=W;const x={course:z,location_id:t.location_id};b.updateCourse(x).then(()=>{u(),F(e,{message:"Percorso modificato correttamente",error:!1}),V()}).catch(d=>{u(),B(e,d)})},S=function(){return D.value&&D.value.id?"Modifica percorso":"Aggiungi percorso"},j=function(){V(),m.value=!1};return O(t,()=>{t.location_id&&V()}),{dt:n,responseCourses:g,loading:w,totalRecords:c,lazyParams:r,op:o,visible:m,currentCourse:D,loadLazyData:h,onEditCourse:_,closeDialog:j,getHeader:S,updateCourse:C,onArchiveCourse:i}},components:{CourseDialog:Ge}},Je={class:"flex justify-content-end mt-4 mb-3"},Qe={class:"flex justify-content-center"};function Xe(t,e,n,o,D,w){const r=f("Button"),c=f("Column"),m=f("InputSwitch"),v=f("DataTable"),u=f("CourseDialog"),b=f("Dialog"),g=oe("tooltip");return I(),L(Y,null,[s("div",Je,[a(r,{label:"Percorso",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=l=>o.onEditCourse({}))})]),a(v,{value:o.responseCourses.courses,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:p(()=>[P(" Nessun percorso trovato. ")]),default:p(()=>[a(c,{header:"Nome"},{body:p(({data:l})=>{var h;return[P(N((h=l.translations.it.name)==null?void 0:h.text),1)]}),_:1}),a(c,{header:"Tipologie biglietti"},{body:p(({data:l})=>[(I(!0),L(Y,null,re(l.tickets,h=>{var V;return I(),L("div",{key:h.id},N((V=h.translations.it.name)==null?void 0:V.text),1)}),128))]),_:1}),a(c,{header:"Prezzo"},{body:p(({data:l})=>[(I(!0),L(Y,null,re(l.tickets,h=>(I(),L("div",{key:h.id}," â‚¬ "+N((+h.price).toFixed(2)),1))),128))]),_:1}),a(c,{header:"Stato"},{body:p(({data:l})=>[a(m,{modelValue:l.public,"onUpdate:modelValue":h=>l.public=h,onChange:h=>o.updateCourse(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(c,{header:""},{body:p(({data:l})=>[s("div",Qe,[q(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.onEditCourse(l),class:"mr-2"},null,8,["onClick"]),[[g,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(b,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=l=>o.visible=l),modal:"",header:o.getHeader(),style:{width:"70rem"},onHide:e[4]||(e[4]=l=>o.closeDialog())},{default:p(()=>[a(u,{course:o.currentCourse,location_id:n.location_id,onOnSubmit:e[1]||(e[1]=l=>o.closeDialog()),onOnClose:e[2]||(e[2]=l=>o.closeDialog())},null,8,["course","location_id"])]),_:1},8,["visible","header"])],64)}const Ye=Q(Ke,[["render",Xe]]);class te{static async fetchAll(e){return e?(await G("/admin/booking_rules",e)).data:{}}static async getCourses(e){return(await G("/admin/booking_rules/courses",e)).data}static async getTickets(e){return(await G("/admin/booking_rules/tickets",e)).data}static async addConfiguration(e){return await Z("/admin/booking_rules",e)}static async updateConfiguration(e){return await de(`/admin/booking_rules/${e.booking_rule.id}`,e)}static async deleteConfiguration(e){return e==null?{}:await ue(`/admin/booking_rules/${e}`)}}const be=me({id:"configuration",state:()=>({configuration:{},configurations:[],response_configurations:{},response_courses:{},response_tickets:{}}),getters:{allConfigurations:t=>t.configurations,responseConfigurations:t=>t.response_configurations,getTotalConfigurations:t=>t.response_configurations?t.response_configurations.total:0,getCurrentConfiguration:t=>t.configuration,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets},actions:{async fetchAllConfigurations(t){await te.fetchAll(t).then(e=>{this.response_configurations=e,this.configurations=e.configurations})},async getAllCourses(t){await te.getCourses(t).then(e=>{this.response_courses=Ee(e)})},async getAllTickets(t){await te.getTickets(t).then(e=>{this.response_tickets=e})},async addConfiguration(t){await te.addConfiguration(t).then()},async updateConfiguration(t){await te.updateConfiguration(t).then()},async deleteConfiguration(t){t!=null&&await te.deleteConfiguration(t).then()}}}),Ze={props:["config","location_id","course_id","duplicate"],setup(t,e){K(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.from_date&&(n.value.from_date=Ce(n.value.from_date)),n.value.to_date&&(n.value.to_date=Ce(n.value.to_date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_rule_slots=[]),W()});const n=k({}),o=k([]),D=k(!1),w=fe({name_config:ge().required("Nome configurazione obbligatoria")}),{showLoader:r,hideLoader:c}=ne(),m=J(),v=ye(),u=k(!1),b=be(),g=R(()=>v.allCategories),l=R(()=>b.responseTickets),h=R(()=>b.responseCourses),V=function(){r();const x=Object.assign({},n.value);x.from_date&&(x.from_date=le(x.from_date)),x.to_date&&(x.to_date=le(x.to_date)),x.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(y=>{y.available_seats!=""&&y.start_at!=""&&x.booking_rule_slots.push(y)});const d={booking_rule:x};b.addConfiguration(d).then(()=>{c(),F(m,{message:"Configurazione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(y=>{c(),B(m,y)})},_=function(){r();const x=Object.assign({},n.value);x.from_date&&(x.from_date=le(x.from_date)),x.to_date&&(x.to_date=le(x.to_date)),x.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(y=>{y.available_seats!=""&&y.start_at!=""&&x.booking_rule_slots.push(y)});const d={booking_rule:x};b.updateConfiguration(d).then(()=>{c(),F(m,{message:"Configurazione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(y=>{c(),B(m,y)})},i=function(){n.value.id?_():V()},C=function(){let x={};x.price=0,n.value.tickets.unshift(x),o.value.push(n.value.tickets[0])},S=function(x){let{newData:d,index:y}=x;n.value.booking_rule_slots[y]=d},j=function(){let x={start_at:"",available_seats:"",id:"-1"};n.value.booking_rule_slots.push(x),o.value.push(x)},M=function(x,d){n.value.booking_rule_slots.splice(d,1)},z=function(x){x?n.value.wdays=[0,1,2,3,4,5,6]:n.value.wdays=[]},W=function(){const x=new Map;x.set("location_id",n.value.location_id),x.set("course_id",n.value.course_id),b.getAllTickets(x).catch(d=>{B(m,d)})};return O(g,()=>{n.value.category||(n.value.category=g.value[0])}),{form:n,schema:w,loading:u,editingRows:o,check_all:D,onSubmit:i,addTicket:C,onRowEditSave:S,checkAll:z,deleteSlot:M,addSlot:j,fetchAllTickets:W,categories:g,responseCourses:h,responseTickets:l}},components:{Form:pe,InputTextWithValidation:ve}};const $e={class:"formgrid grid mt-3"},eo={class:"field col-12"},oo={class:"field flex flex-column col-6"},to=s("label",{for:"location"},"Percorso",-1),no={class:"field col-3"},io=s("label",{from:"date_from"},"Dal",-1),ao={class:"field col-3"},so=s("label",{from:"date_to"},"Al",-1),lo={class:"field col-12 mt-3"},co=s("label",null,"Giorni",-1),ro={class:"card flex flex-wrap gap-3 mt-2"},uo={class:"flex align-items-center mr-4"},mo=s("label",{for:"all",class:"ml-2"}," Tutti i giorni ",-1),_o={class:"flex align-items-center"},fo=s("label",{for:"lun",class:"ml-2"}," Lun ",-1),go={class:"flex align-items-center"},po=s("label",{for:"mar",class:"ml-2"}," Mar ",-1),vo={class:"flex align-items-center"},bo=s("label",{for:"mer",class:"ml-2"}," Mer ",-1),ho={class:"flex align-items-center"},ko=s("label",{for:"gio",class:"ml-2"}," Gio ",-1),Co={class:"flex align-items-center"},yo=s("label",{for:"ven",class:"ml-2"}," Ven ",-1),xo={class:"flex align-items-center"},wo=s("label",{for:"sab",class:"ml-2"}," Sab ",-1),Vo={class:"flex align-items-center"},Do=s("label",{for:"dom",class:"ml-2"}," Dom ",-1),To={class:"field col-3 mt-3"},So=s("label",null,"Biglietti",-1),Eo={for:"ticket.id",class:"ml-2 flex align-items-center"},Ao={class:"inline-block",style:{"min-width":"150px"}},Bo={class:"text-right"},Uo=s("div",{class:"col-9"},null,-1),Io={class:"col-8 mt-3"},Ro={class:"field flex justify-content-between align-items-end mt-4 mb-3"},jo=s("label",null,"Orari",-1),zo={class:"flex justify-content-center"},Mo={class:"flex align-items-center justify-content-end mt-6"};function Lo(t,e,n,o,D,w){const r=f("InputTextWithValidation"),c=f("Dropdown"),m=f("Calendar"),v=f("Checkbox"),u=f("Button"),b=f("InputMask"),g=f("Column"),l=f("InputNumber"),h=f("DataTable"),V=f("Form"),_=oe("tooltip");return I(),ee(V,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:p(()=>[s("div",$e,[s("div",eo,[a(r,{name:"name_config",label:"Nome configurazione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.name=i),id:"name_config",type:"text"},null,8,["modelValue"])]),s("div",oo,[to,a(c,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.course_id=i),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[2]||(e[2]=i=>{o.form.booking_rule_ticket_ids=[],o.fetchAllTickets()})},null,8,["modelValue","options"])]),s("div",no,[io,a(m,{inputId:"date_from",modelValue:o.form.from_date,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.from_date=i),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),s("div",ao,[so,a(m,{inputId:"date_to",modelValue:o.form.to_date,"onUpdate:modelValue":e[4]||(e[4]=i=>o.form.to_date=i),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),s("div",lo,[co,s("div",ro,[s("div",uo,[a(v,{modelValue:o.check_all,"onUpdate:modelValue":[e[5]||(e[5]=i=>o.check_all=i),e[6]||(e[6]=i=>o.checkAll(i))],inputId:"all",name:"week",binary:!0},null,8,["modelValue"]),mo]),s("div",_o,[a(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[7]||(e[7]=i=>o.form.wdays=i),inputId:"lun",name:"week",value:1},null,8,["modelValue"]),fo]),s("div",go,[a(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[8]||(e[8]=i=>o.form.wdays=i),inputId:"mar",name:"week",value:2},null,8,["modelValue"]),po]),s("div",vo,[a(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[9]||(e[9]=i=>o.form.wdays=i),inputId:"mer",name:"week",value:3},null,8,["modelValue"]),bo]),s("div",ho,[a(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[10]||(e[10]=i=>o.form.wdays=i),inputId:"gio",name:"week",value:4},null,8,["modelValue"]),ko]),s("div",Co,[a(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[11]||(e[11]=i=>o.form.wdays=i),inputId:"ven",name:"week",value:5},null,8,["modelValue"]),yo]),s("div",xo,[a(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[12]||(e[12]=i=>o.form.wdays=i),inputId:"sab",name:"week",value:6},null,8,["modelValue"]),wo]),s("div",Vo,[a(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[13]||(e[13]=i=>o.form.wdays=i),inputId:"dom",name:"week",value:0},null,8,["modelValue"]),Do])])]),s("div",To,[So,(I(!0),L(Y,null,re(o.responseTickets.tickets,i=>{var C;return I(),L("div",{key:i.id,class:"flex align-items-center mb-2 mt-2"},[a(v,{modelValue:o.form.booking_rule_ticket_ids,"onUpdate:modelValue":e[14]||(e[14]=S=>o.form.booking_rule_ticket_ids=S),inputId:i.id+"",value:i.id},null,8,["modelValue","inputId","value"]),s("label",Eo,[s("div",Ao,N((C=i.translations)==null?void 0:C.it.name.text),1),s("div",Bo,"â‚¬ "+N(i.price),1)])])}),128))]),Uo,s("div",Io,[s("div",Ro,[jo,a(u,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[15]||(e[15]=i=>o.addSlot())})]),a(h,{value:o.form.booking_rule_slots,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[16]||(e[16]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:p(()=>[P(" Nessuno slot orario trovato. ")]),default:p(()=>[a(g,{header:"Ora",field:"start_at"},{editor:p(({data:i,field:C})=>[a(b,{id:"basic",modelValue:i[C],"onUpdate:modelValue":S=>i[C]=S,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(g,{header:"Posti",field:"available_seats"},{editor:p(({data:i,field:C})=>[a(l,{modelValue:i[C],"onUpdate:modelValue":S=>i[C]=S,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(g,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),a(g,{header:"",style:{width:"3rem","padding-left":"0"}},{body:p(({data:i,index:C})=>[s("div",zo,[q(a(u,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:S=>o.deleteSlot(i,C)},null,8,["onClick"]),[[_,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","editingRows","onRowEditSave"])])]),s("div",Mo,[a(u,{label:"Annulla",text:"",onClick:e[17]||(e[17]=i=>t.$emit("onClose"))}),a(u,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const No=Q(Ze,[["render",Lo]]),Fo={props:["location_id"],setup(t){K(()=>{r.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,t.location_id&&i(t.location_id)});const e=J(),n=k(),o=k(),D=k(),w=k(),r=k(!0),c=k(),m=k(0),v=k(!1),u=k(),b=k(!1),g=be(),l=R(()=>g.responseConfigurations),h=_e(),V=R(()=>h.submitDialog),_=R(()=>g.responseCourses),i=async function(d){const y=new Map;y.set("location_id",d),await g.getAllCourses(y).then(()=>{r.value=!1}).catch(A=>{r.value=!1,B(e,A)})},C=async function(d){if(!d)return;r.value=!0;const y=new Map;y.set("location_id",t.location_id),y.set("course_id",d),await g.fetchAllConfigurations(y).then(()=>{r.value=!1}).catch(A=>{r.value=!1,B(e,A)})},S=function(d){D.value=d;let y="Sei sicuro di voler eliminare questa configurazione?";h.setDialog("Elimina configurazione","Elimina","Annulla",y),h.setBtnSubmit(!1),h.setDynamicDialogVisibility(!0)},j=async function(){D.value&&await g.deleteConfiguration(D.value).then(()=>{r.value=!1,F(e,{message:"Configurazione eliminata correttamente",error:!1}),C(u.value)}).catch(d=>{r.value=!1,B(e,d)})},M=function(d,y){w.value=d,v.value=!0,b.value=y},z=function(d){return d.map(A=>Be.local(2022,1,2+A).setLocale("it").toFormat("ccc")).join(", ")},W=function(d){u.value=d,C(u.value),v.value=!1},x=function(){return b.value?"Duplica configurazione":w.value&&w.value.id&&!b.value?"Modifica configurazione":"Nuova configurazione"};return O(V,d=>{V.value&&j()}),O(_,()=>{_.value.courses&&_.value.courses[0]&&(u.value=_.value.courses[0].id,C(u.value))}),O(t,()=>{t.location_id&&i(t.location_id)}),{dt:n,responseConfigurations:l,loading:r,totalRecords:m,lazyParams:c,op:o,visible:v,currentConfiguration:w,responseCourses:_,course_id:u,flag_duplicate:b,fromMMDDtoDDMM:Ce,onDeleteConfiguration:j,confirmDelete:S,onEditConfiguration:M,fetchAllConfigurations:C,convertWdays:z,closeDialog:W,getHeader:x}},components:{ConfigurationDialog:No}},Oo={class:"flex justify-content-between mt-4 mb-3"},Po={class:"field flex flex-column"},Wo=s("label",{for:"location"},"Percorso",-1),qo={class:"capitalize"},Ho={class:"flex justify-content-center"};function Go(t,e,n,o,D,w){const r=f("Dropdown"),c=f("Button"),m=f("Column"),v=f("DataTable"),u=f("ConfigurationDialog"),b=f("Dialog"),g=oe("tooltip");return I(),L(Y,null,[s("div",Oo,[s("div",Po,[Wo,a(r,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=l=>o.course_id=l),options:o.responseCourses.courses,optionLabel:"translations.it.name.text",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=l=>o.fetchAllConfigurations(o.course_id))},null,8,["modelValue","options"])]),a(c,{label:"Configurazione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=l=>o.onEditConfiguration({},!1))})]),a(v,{value:o.responseConfigurations.booking_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:p(()=>[P(" Nessuna configurazione trovata. ")]),default:p(()=>[a(m,{header:"Nome",field:"name"}),a(m,{header:"Dal Al"},{body:p(({data:l})=>[P(N(o.fromMMDDtoDDMM(l.from_date))+" - "+N(o.fromMMDDtoDDMM(l.to_date)),1)]),_:1}),a(m,{header:"Valida il",field:"week"},{body:p(({data:l})=>[s("div",qo,N(o.convertWdays(l.wdays)),1)]),_:1}),a(m,{header:""},{body:p(({data:l})=>[s("div",Ho,[q(a(c,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.onEditConfiguration(l,!0)},null,8,["onClick"]),[[g,"Duplica",void 0,{top:!0}]]),q(a(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.onEditConfiguration(l,!1)},null,8,["onClick"]),[[g,"Modifica",void 0,{top:!0}]]),q(a(c,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.confirmDelete(l.id)},null,8,["onClick"]),[[g,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(b,{visible:o.visible,"onUpdate:visible":e[5]||(e[5]=l=>o.visible=l),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:p(()=>[a(u,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=l=>o.closeDialog(l)),onOnClose:e[4]||(e[4]=l=>o.visible=!1),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const Ko=Q(Fo,[["render",Go]]);class H{static async fetchAll(e){return e?(await G("/admin/booking_exception_rules",e)).data:{}}static async getCourses(e){return(await G("/admin/booking_exception_rules/courses",e)).data}static async getTickets(e){return(await G("/admin/booking_exception_rules/tickets",e)).data}static async addBookingException(e){return await Z("/admin/booking_exception_rules",e)}static async updateBookingException(e){return await de(`/admin/booking_exception_rules/${e.booking_exception_rule.id}`,e)}static async deleteBookingException(e){return e==null?{}:await ue(`/admin/booking_exception_rules/${e}`)}static async fetchAllClosings(e){return e?(await G(`/admin/booking_exception_rules/closings?location_id=${e.get("location_id")}`)).data:{}}static async createClosing(e){return await Z("/admin/booking_exception_rules/closings",e)}static async deleteClosing(e){return await Z("/admin/booking_exception_rules/delete_closings",e)}}const he=me({id:"booking_exception",state:()=>({booking_exception:{},booking_exceptions:[],response_booking_exceptions:{},response_courses:{},response_tickets:{},response_closings:{}}),getters:{allBookingExceptions:t=>t.booking_exceptions,responseBookingExceptions:t=>t.response_booking_exceptions,getTotalBookingExceptions:t=>t.response_booking_exceptions?t.response_booking_exceptions.total:0,getCurrentBookingException:t=>t.booking_exception,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets,responseClosings:t=>t.response_closings},actions:{async fetchAllBookingExceptions(t){await H.fetchAll(t).then(e=>{this.response_booking_exceptions=e,this.booking_exceptions=e.booking_exceptions})},async fetchAllClosings(t){await H.fetchAllClosings(t).then(e=>{this.response_closings=e})},async getAllCourses(t){await H.getCourses(t).then(e=>{this.response_courses=e})},async getAllTickets(t){await H.getTickets(t).then(e=>{this.response_tickets=e})},async addBookingException(t){await H.addBookingException(t).then()},async updateBookingException(t){await H.updateBookingException(t).then()},async deleteBookingException(t){t!=null&&await H.deleteBookingException(t).then()},async addClosing(t){await H.createClosing(t).then()},async deleteClosing(t){await H.deleteClosing(t).then()}}}),Jo={props:["config","location_id","course_id","duplicate"],setup(t,e){K(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.date&&(n.value.date=$(n.value.date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_exception_rule_slots=[]),z()});const n=k({}),o=k([]),D=fe({name:ge().required("Nome eccezione obbligatoria")}),{showLoader:w,hideLoader:r}=ne(),c=J(),m=ye(),v=k(!1),u=be(),b=he(),g=R(()=>m.allCategories),l=R(()=>u.responseTickets),h=R(()=>u.responseCourses),V=function(){w();const d=Object.assign({},n.value);d.date&&(d.date=ae(d.date)),d.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(A=>{A.available_seats!=""&&A.start_at!=""&&d.booking_exception_rule_slots.push(A)});const y={booking_exception_rule:d};b.addBookingException(y).then(()=>{r(),F(c,{message:"Eccezione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(A=>{r(),B(c,A)})},_=function(){w();const d=Object.assign({},n.value);d.date&&(d.date=ae(d.date)),d.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(A=>{A.available_seats!=""&&A.start_at!=""&&d.booking_exception_rule_slots.push(A)});const y={booking_exception_rule:d};b.updateBookingException(y).then(()=>{r(),F(c,{message:"Eccezione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(A=>{r(),B(c,A)})},i=function(){n.value.id?_():V()},C=function(){let d={};d.price=0,n.value.tickets.unshift(d),o.value.push(n.value.tickets[0])},S=function(d){let{newData:y,index:A}=d;n.value.booking_exception_rule_slots[A]=y},j=function(){let d={start_at:"",available_seats:"",id:"-1"};n.value.booking_exception_rule_slots.push(d),o.value.push(d)},M=function(d,y){n.value.booking_exception_rule_slots.splice(y,1)},z=function(){const d=new Map;d.set("location_id",n.value.location_id),d.set("course_id",n.value.course_id),u.getAllTickets(d).catch(y=>{B(c,y)})},W=function(){e.emit("onSubmit",n.value)},x=function(){n.value.booking_exception_rule_ticket_ids=[],z()};return O(g,()=>{n.value.category||(n.value.category=g.value[0])}),{form:n,schema:D,loading:v,editingRows:o,onSubmit:i,addTicket:C,onRowEditSave:S,deleteSlot:M,addSlot:j,fetchAllTickets:z,resetForm:W,onCourseChanged:x,categories:g,responseTickets:l,responseCourses:h}},components:{Form:pe,InputTextWithValidation:ve}},Qo={class:"formgrid grid mt-3"},Xo={class:"field col-12"},Yo={class:"field flex flex-column col-6"},Zo=s("label",{for:"location"},"Percorso",-1),$o={class:"field col-3"},et=s("label",{from:"date"},"Il",-1),ot=s("div",{class:"field col-3"},null,-1),tt={class:"field col-3 mt-3"},nt=s("label",null,"Biglietti",-1),it={key:0,class:"block mb-2 text-red-500"},at=["for"],st={class:"inline-block",style:{"min-width":"150px"}},lt={class:"text-right"},ct=s("div",{class:"col-9"},null,-1),rt={class:"field col-8 mt-3"},dt={class:"field flex justify-content-between align-items-end mt-4 mb-3"},ut=s("label",null,"Orari",-1),mt={class:"flex justify-content-center"},_t={class:"flex align-items-center justify-content-end mt-6"};function ft(t,e,n,o,D,w){const r=f("InputTextWithValidation"),c=f("Dropdown"),m=f("Calendar"),v=f("Checkbox"),u=f("Button"),b=f("InputMask"),g=f("Column"),l=f("InputNumber"),h=f("DataTable"),V=f("Form"),_=oe("tooltip");return I(),ee(V,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:p(()=>[s("div",Qo,[s("div",Xo,[a(r,{name:"name",label:"Nome eccezione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.name=i)},null,8,["modelValue"])]),s("div",Yo,[Zo,a(c,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.course_id=i),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:o.onCourseChanged},null,8,["modelValue","options","onChange"])]),s("div",$o,[et,a(m,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[2]||(e[2]=i=>o.form.date=i),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),ot,s("div",tt,[nt,o.form.booking_exception_rule_ticket_ids&&o.form.booking_exception_rule_ticket_ids.length===0?(I(),L("small",it," Selezionare almeno un biglietto ")):X("",!0),(I(!0),L(Y,null,re(o.responseTickets.tickets,i=>{var C;return I(),L("div",{key:i.id,class:"flex align-items-center mb-2"},[a(v,{modelValue:o.form.booking_exception_rule_ticket_ids,"onUpdate:modelValue":e[3]||(e[3]=S=>o.form.booking_exception_rule_ticket_ids=S),inputId:i.id+"",name:"category",value:i.id},null,8,["modelValue","inputId","value"]),s("label",{for:i.id+"",class:"ml-2 flex align-items-center"},[s("div",st,N((C=i.translations)==null?void 0:C.it.name.text),1),s("div",lt,"â‚¬ "+N(i.price),1)],8,at)])}),128))]),ct,s("div",rt,[s("div",dt,[ut,a(u,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[4]||(e[4]=i=>o.addSlot())})]),a(h,{value:o.form.booking_exception_rule_slots,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[5]||(e[5]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:p(()=>[P(" Nessuno slot orario trovato. ")]),default:p(()=>[a(g,{header:"Ora",field:"start_at"},{editor:p(({data:i,field:C})=>[a(b,{id:"basic",modelValue:i[C],"onUpdate:modelValue":S=>i[C]=S,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(g,{header:"Posti",field:"available_seats"},{editor:p(({data:i,field:C})=>[a(l,{modelValue:i[C],"onUpdate:modelValue":S=>i[C]=S,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(g,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),a(g,{header:"",style:{width:"3rem","padding-left":"0"}},{body:p(({data:i,index:C})=>[s("div",mt,[q(a(u,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:S=>o.deleteSlot(i,C)},null,8,["onClick"]),[[_,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])])]),s("div",_t,[a(u,{label:"Annulla",text:"",onClick:e[6]||(e[6]=i=>o.resetForm())}),a(u,{label:"Conferma",type:"submit",disabled:o.form.booking_exception_rule_ticket_ids&&o.form.booking_exception_rule_ticket_ids.length===0},null,8,["disabled"])])]),_:1},8,["onSubmit","validation-schema"])}const gt=Q(Jo,[["render",ft]]),pt={props:["location_id"],setup(t){K(()=>{r.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,t.location_id&&C(t.location_id)});const e=J(),n=k(),o=k(),D=k(),w=k(),r=k(!0),c=k(),m=k(0),v=k(!1);k([]);const u=k(),b=k(!1),g=be(),l=he(),h=R(()=>l.responseBookingExceptions),V=_e(),_=R(()=>V.submitDialog),i=R(()=>g.responseCourses),C=async function(d){const y=new Map;y.set("location_id",d),await g.getAllCourses(y).then(()=>{r.value=!1}).catch(A=>{r.value=!1,B(e,A)})},S=async function(d){if(!d)return;r.value=!0;const y=new Map;y.set("location_id",t.location_id),y.set("course_id",d),await l.fetchAllBookingExceptions(y).then(()=>{r.value=!1}).catch(A=>{r.value=!1,B(e,A)})},j=function(d){D.value=d;let y="Sei sicuro di voler eliminare questa eccezione?";V.setDialog("Elimina eccezione","Elimina","Annulla",y),V.setBtnSubmit(!1),V.setDynamicDialogVisibility(!0)},M=async function(){D.value&&await l.deleteBookingException(D.value).then(()=>{r.value=!1,F(e,{message:"Eccezione eliminata correttamente",error:!1}),S(u.value)}).catch(d=>{r.value=!1,B(e,d)})},z=function(d,y){w.value=d,v.value=!0,b.value=y},W=function(d){u.value=d,S(d),v.value=!1},x=function(){return b.value?"Duplica eccezione":w.value&&w.value.id&&!b.value?"Modifica eccezione":"Nuova eccezione"};return O(_,d=>{d&&M()}),O(i,()=>{i.value&&i.value.courses&&i.value.courses.length>0&&(u.value=i.value.courses[0].id,S(u.value))}),O(t,()=>{t.location_id&&C(t.location_id)}),{dt:n,responseBookingExceptions:h,loading:r,totalRecords:m,lazyParams:c,op:o,visible:v,currentConfiguration:w,responseCourses:i,course_id:u,flag_duplicate:b,onDeleteConfigurationException:M,confirmDelete:j,onEditConfiguration:z,getHeader:x,closeDialog:W,fetchAllBookingExceptions:S,formatPrettyDate:$}},components:{BookingExceptionDialog:gt}},vt={class:"flex justify-content-between mt-4 mb-3"},bt={class:"field flex flex-column"},ht=s("label",{for:"location"},"Percorso",-1),kt={class:"flex justify-content-center"};function Ct(t,e,n,o,D,w){const r=f("Dropdown"),c=f("Button"),m=f("Column"),v=f("DataTable"),u=f("BookingExceptionDialog"),b=f("Dialog"),g=oe("tooltip");return I(),L(Y,null,[s("div",vt,[s("div",bt,[ht,a(r,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=l=>o.course_id=l),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=l=>o.fetchAllBookingExceptions(o.course_id))},null,8,["modelValue","options"])]),a(c,{label:"Eccezione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=l=>o.onEditConfiguration({},!1))})]),a(v,{value:o.responseBookingExceptions.booking_exception_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:p(()=>[P(" Nessuna eccezione trovata. ")]),default:p(()=>[a(m,{header:"Nome",field:"name"}),a(m,{header:"Il"},{body:p(({data:l})=>[P(N(o.formatPrettyDate(l.date)),1)]),_:1}),a(m,{header:""},{body:p(({data:l})=>[s("div",kt,[q(a(c,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.onEditConfiguration(l,!0)},null,8,["onClick"]),[[g,"Duplica",void 0,{top:!0}]]),q(a(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.onEditConfiguration(l,!1)},null,8,["onClick"]),[[g,"Modifica",void 0,{top:!0}]]),q(a(c,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.confirmDelete(l.id)},null,8,["onClick"]),[[g,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(b,{visible:o.visible,"onUpdate:visible":e[4]||(e[4]=l=>o.visible=l),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:p(()=>[a(u,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=l=>o.closeDialog(l)),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const yt=Q(pt,[["render",Ct]]),xt={props:["location_id","closing"],setup(t,e){K(()=>{t.closing&&t.closing.id?(n.value=Object.assign({},t.closing),n.value.date&&(n.value.date=$(n.value.date))):n.value.location_id=t.location_id});const n=k({}),o=fe({name:ge().required("Nome chiusura obbligatoria")}),{showLoader:D,hideLoader:w}=ne(),r=J(),c=we(),m=he(),v=R(()=>c.allLocations),u=function(h){D(),m.addClosing(h).then(()=>{w(),F(r,{message:"Chiusura aggiunta correttamente",error:!1}),e.emit("onSubmit")}).catch(V=>{w(),B(r,V)})},b=function(h){D(),m.updateBookingException(h).then(()=>{w(),F(r,{message:"Chiusura modificata correttamente",error:!1}),e.emit("onSubmit")}).catch(V=>{w(),B(r,V)})};return{form:n,schema:o,onSubmit:function(){const h=Object.assign({},n.value);h.date&&(h.date=ae(h.date),h.location_id=t.location_id);const V={booking_exception_rule:h};n.value.id?b(V):u(V)},resetForm:function(){e.emit("onSubmit",n.value)},locations:v}},components:{Form:pe,InputTextWithValidation:ve}},wt={class:"formgrid grid mt-3"},Vt={class:"field col-6"},Dt={class:"field col-6 flex flex-column"},Tt=s("label",{from:"from_date"},"Il",-1),St={class:"flex align-items-center justify-content-end mt-6"};function Et(t,e,n,o,D,w){const r=f("InputTextWithValidation"),c=f("Calendar"),m=f("Button"),v=f("Form");return I(),ee(v,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:p(()=>[s("div",wt,[s("div",Vt,[a(r,{name:"name",label:"Nome chiusura*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=u=>o.form.name=u)},null,8,["modelValue"])]),s("div",Dt,[Tt,a(c,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[1]||(e[1]=u=>o.form.date=u),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),s("div",St,[a(m,{label:"Annulla",text:"",onClick:e[2]||(e[2]=u=>o.resetForm())}),a(m,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const At=Q(xt,[["render",Et]]),Bt={props:["location_id"],setup(t){K(()=>{r.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,t.location_id&&l()});const e=J(),n=k(),o=k(),D=k(),w=k(),r=k(!0),c=k(),m=k(!1),v=he(),u=_e(),b=R(()=>u.submitDialog),g=R(()=>v.responseClosings),l=async function(){const S=new Map;S.set("location_id",t.location_id),await v.fetchAllClosings(S).then(()=>{r.value=!1}).catch(j=>{r.value=!1,B(e,j)})},h=function(S){D.value=S;let j="Sei sicuro di voler eliminare questa chiusura?";u.setDialog("Elimina chiusura","Elimina","Annulla",j),u.setBtnSubmit(!1),u.setDynamicDialogVisibility(!0)},V=async function(){if(!D.value)return;const S={location_id:t.location_id,date:D.value};await v.deleteClosing(S).then(()=>{r.value=!1,F(e,{message:"Chiusura eliminata correttamente",error:!1}),l()}).catch(j=>{r.value=!1,B(e,j)})},_=function(S){w.value=S,m.value=!0},i=function(){l(),m.value=!1},C=function(){return w.value&&w.value.id?"Modifica chiusura":"Nuova chiusura"};return O(b,S=>{b.value&&V()}),O(t,()=>{t.location_id&&l()}),{dt:n,responseClosings:g,loading:r,lazyParams:c,op:o,visible:m,currentClosing:w,formatPrettyDate:$,onDeleteClosing:V,confirmDelete:h,onEditConfiguration:_,closeDialog:i,getHeader:C}},components:{ClosingDialog:At}},Ut={class:"flex justify-content-end mt-4 mb-3"},It={class:"flex justify-content-center"};function Rt(t,e,n,o,D,w){const r=f("Button"),c=f("Column"),m=f("DataTable"),v=f("ClosingDialog"),u=f("Dialog"),b=oe("tooltip");return I(),L(Y,null,[s("div",Ut,[a(r,{label:"Chiusura",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=g=>o.onEditConfiguration({}))})]),a(m,{value:o.responseClosings.closings,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:p(()=>[P(" Nessuna chiusura trovata. ")]),default:p(()=>[a(c,{header:"Nome",field:"name"}),a(c,{header:"Il"},{body:p(({data:g})=>[P(N(o.formatPrettyDate(g.date)),1)]),_:1}),a(c,{header:""},{body:p(({data:g})=>[s("div",It,[q(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:l=>o.onEditConfiguration(g)},null,8,["onClick"]),[[b,"Modifica",void 0,{top:!0}]]),q(a(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:l=>o.confirmDelete(g.date)},null,8,["onClick"]),[[b,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(u,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=g=>o.visible=g),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:p(()=>[a(v,{onOnSubmit:e[1]||(e[1]=g=>o.closeDialog()),onOnClose:e[2]||(e[2]=g=>o.visible=!1),location_id:n.location_id,closing:o.currentClosing},null,8,["location_id","closing"])]),_:1},8,["visible","header"])],64)}const jt=Q(Bt,[["render",Rt]]),zt={setup(){K(()=>{b()});const t=k({}),e=we(),n=k(),o=k(),D=k(),{showLoader:w,hideLoader:r}=ne(),c=J(),m=k(!1),v=R(()=>e.allLocations),u=R(()=>e.getCurrentLocation),b=async function(){await e.fetchAllLocations().then(()=>{u.value&&(t.value.location=u.value,l())})},g=function(){e.updateCurrenLocation(t.value.location),l()},l=function(){o.value=$(t.value.location.calendar_visible_from),D.value=$(t.value.location.calendar_visible_to)},h=async function(){w();let V={calendar_visible_from:ae(o.value),calendar_visible_to:ae(D.value),location_id:t.value.location.id};await e.updateLocation(V).then(()=>{r(),F(c,{message:"Data aggiornata correttamente",error:!1}),o.value=xe(o.value),D.value=xe(D.value),m.value=!1}).catch(_=>{r(),B(c,_)})};return O(v,()=>{t.value.location_id=v.value[0].id}),{form:t,courseTable:n,calendar_visible_from:o,calendar_visible_to:D,active:m,locations:v,onChangeLocation:g,updateVisibility:h,formatPrettyDate:$}},components:{CourseTable:Ye,OpeningsTable:Ko,BookingExceptionTable:yt,ClosingsTable:jt}};const Mt=s("h1",null,"Configurazioni",-1),Lt={class:"flex align-items-center justify-content-between"},Nt={class:"field col-3 flex flex-column"},Ft=s("label",{for:"location"},"Location",-1),Ot={class:"col-9 flex justify-content-end"},Pt={class:"col-12 field"},Wt=s("label",{class:"ml-1"},"Finestra di visibilitÃ ",-1),qt={class:"flex align-items-center mt-2 ml-0 pl-0 gap-5"};function Ht(t,e,n,o,D,w){var _;const r=f("Dropdown"),c=f("Calendar"),m=f("Inplace"),v=f("Card"),u=f("CourseTable"),b=f("TabPanel"),g=f("OpeningsTable"),l=f("BookingExceptionTable"),h=f("ClosingsTable"),V=f("TabView");return I(),L("div",null,[Mt,s("div",Lt,[s("div",Nt,[Ft,a(r,{modelValue:o.form.location,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.location=i),options:o.locations,optionLabel:"name",placeholder:"",name:"location",onChange:e[1]||(e[1]=i=>o.onChangeLocation())},null,8,["modelValue","options"])]),s("div",Ot,[o.form.location?(I(),ee(v,{key:0,style:{width:"30rem"}},{content:p(()=>[s("div",Pt,[Wt,s("div",qt,[a(m,{closable:!0,onClose:e[3]||(e[3]=i=>o.updateVisibility()),active:o.active},{display:p(()=>[P(" Dal: "+N(o.calendar_visible_from),1)]),content:p(()=>[a(c,{inputId:"date",modelValue:o.calendar_visible_from,"onUpdate:modelValue":e[2]||(e[2]=i=>o.calendar_visible_from=i),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"]),a(m,{closable:!0,onClose:e[5]||(e[5]=i=>o.updateVisibility()),active:o.active},{display:p(()=>[P(" Al: "+N(o.calendar_visible_to),1)]),content:p(()=>[a(c,{inputId:"date",modelValue:o.calendar_visible_to,"onUpdate:modelValue":e[4]||(e[4]=i=>o.calendar_visible_to=i),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"])])])]),_:1})):X("",!0)])]),(_=o.form.location)!=null&&_.id?(I(),ee(V,{key:0},{default:p(()=>[a(b,{header:"Percorsi"},{default:p(()=>{var i;return[a(u,{location_id:(i=o.form.location)==null?void 0:i.id,ref:"courseTable"},null,8,["location_id"])]}),_:1}),a(b,{header:"Aperture"},{default:p(()=>[a(g,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),a(b,{header:"Eccezioni"},{default:p(()=>[a(l,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),a(b,{header:"Chiusure"},{default:p(()=>[a(h,{location_id:o.form.location.id},null,8,["location_id"])]),_:1})]),_:1})):X("",!0)])}const an=Q(zt,[["render",Ht]]);export{an as default};
