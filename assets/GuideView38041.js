import{o as h,a as U,l as _,c as F,v as A,i as M,_ as y,r as f,p as j,b as x,x as V,w as b,h as k,f as n,t as R,g as s,q as S,m as N,e as q,F as z}from"../index38041.js";import{e as D,p as P,a as W,s as w,u as H}from"./helpers38041.js";import{f as J,a as K,b as B}from"./formatData38041.js";import{u as I}from"./guide38041.js";import{c as Q,a as G}from"./index.esm38041.js";import{F as O}from"./vee-validate.esm38041.js";import{I as X}from"./InputTextWithValidation38041.js";import{D as E}from"./datetime38041.js";/* empty css                                                                            */const Y={setup(){h(()=>{u.value=!0,t.value={first:0,rows:o.value.rows,sortField:null,sortOrder:null},t.value.page=0,v()});const d=U(),o=_(),l=_(),e=_(),p=_(),u=_(!0),t=_(),r=_(0),c=I(),i=F(()=>c.responseGuides),a=A(),m=F(()=>a.submitDialog);function v(){u.value=!0,setTimeout(()=>{T()},Math.random()*1e3+250)}const T=async function(){await c.fetchAllGuides().then(()=>{u.value=!1}).catch(g=>{u.value=!1,D(d,g)})},L=function(g){p.value=g;let $="Sei sicuro di voler eliminare questa guida?";a.setDialog("Elimina guida","Elimina","Annulla",$),a.setBtnSubmit(!1),a.setDynamicDialogVisibility(!0)},C=async function(){await c.deleteGuide(p.value).then(()=>{u.value=!1,w(d,{message:"Guida eliminata correttamente",error:!1}),T()}).catch(g=>{u.value=!1,D(d,g)})};return M(m,g=>{g&&C()}),{dt:o,responseGuides:i,loading:u,totalRecords:r,lazyParams:t,currentOrder:l,op:e,loadLazyData:v,onDeleteGuide:C,confirmDelete:L,formatDataAndHourFromUnixTimestamps:J,formatPrettyDate:K,prettyPaymentStatus:P,prettyTicketType:W}}},Z={class:"flex justify-content-center"};function ee(d,o,l,e,p,u){const t=f("Column"),r=f("Button"),c=f("DataTable"),i=j("tooltip");return x(),V(c,{value:e.responseGuides.guides,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:""},{empty:b(()=>[k(" Nessuna guida trovata. ")]),default:b(()=>[n(t,{header:"Guida",field:"name"},{body:b(({data:a})=>[k(R(a.last_name)+" "+R(a.first_name),1)]),_:1}),n(t,{header:"Email",field:"email"}),n(t,{header:"Telefono",field:"phone_number"}),n(t,{header:"Ente",field:"notes"}),n(t,{header:""},{body:b(({data:a})=>[s("div",Z,[S(n(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:m=>d.$emit("onEdit",a)},null,8,["onClick"]),[[i,"Modifica",void 0,{top:!0}]]),S(n(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:m=>e.confirmDelete(a.id)},null,8,["onClick"]),[[i,"Elimina",void 0,{top:!0}]]),S(n(r,{link:"",icon:"pi pi-download",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:m=>d.$emit("onDownloadReport",a)},null,8,["onClick"]),[[i,"Download Report",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const oe=y(Y,[["render",ee]]),te={props:["guide"],setup(d,o){h(()=>{d.guide&&(l.value=Object.assign({},d.guide))});const l=_({}),e=Q({first_name:G().required("Nome obbligatorio"),last_name:G().required("Cognome obbligatorio"),email:G().required("Email obbligatoria")}),{showLoader:p,hideLoader:u}=H(),t=U(),r=I(),c=function(){p();const m={guide:l.value};r.addGuide(m).then(()=>{u(),w(t,{message:"Guida aggiunta correttamente",error:!1}),o.emit("onSubmit")}).catch(v=>{D(t,v)})},i=function(){p();const m={guide:l.value};r.updateGuide(m).then(()=>{u(),w(t,{message:"Guida modificata correttamente",error:!1}),o.emit("onSubmit")}).catch(v=>{u(),D(t,v)})};return{form:l,schema:e,onSubmit:function(){l.value.id?i():c()}}},components:{Form:O,InputTextWithValidation:X}},ne={class:"formgrid grid mt-3"},ae={class:"field col-6 flex flex-column mb-0"},le={class:"field col-6 mb-0"},ie={class:"formgrid grid"},se={class:"field col-6 flex flex-column"},de={class:"field col-6 flex flex-column"},re=s("label",{for:"phone_number"},"Telefono",-1),ue={class:"formgrid grid"},me={class:"field col-12 flex flex-column"},ce=s("label",{for:"notes"},"Ente",-1),fe={class:"flex align-items-center justify-content-end mt-6"};function _e(d,o,l,e,p,u){const t=f("InputTextWithValidation"),r=f("InputText"),c=f("Button"),i=f("Form");return x(),V(i,{"validation-schema":e.schema,onSubmit:e.onSubmit},{default:b(()=>[s("div",ne,[s("div",ae,[n(t,{name:"first_name",label:"Nome*",modelValue:e.form.first_name,"onUpdate:modelValue":o[0]||(o[0]=a=>e.form.first_name=a)},null,8,["modelValue"])]),s("div",le,[n(t,{name:"last_name",label:"Cognome*",modelValue:e.form.last_name,"onUpdate:modelValue":o[1]||(o[1]=a=>e.form.last_name=a)},null,8,["modelValue"])])]),s("div",ie,[s("div",se,[n(t,{name:"email",label:"Email*",modelValue:e.form.email,"onUpdate:modelValue":o[2]||(o[2]=a=>e.form.email=a)},null,8,["modelValue"])]),s("div",de,[re,n(r,{name:"phone_number",modelValue:e.form.phone_number,"onUpdate:modelValue":o[3]||(o[3]=a=>e.form.phone_number=a)},null,8,["modelValue"])])]),s("div",ue,[s("div",me,[ce,n(r,{name:"notes",modelValue:e.form.notes,"onUpdate:modelValue":o[4]||(o[4]=a=>e.form.notes=a)},null,8,["modelValue"])])]),s("div",fe,[n(c,{label:"Annulla",text:""}),n(c,{label:"Conferma",type:"submit"})])]),_:1},8,["validation-schema","onSubmit"])}const pe=y(te,[["render",_e]]),be={props:["guide"],setup(d,o){h(()=>{l.value.start_date=E.now().minus({months:1}).toFormat("dd/MM/yyyy"),l.value.end_date=E.now().toFormat("dd/MM/yyyy")});const l=_({});return{form:l,onSubmit:function(){let p="/admin/guides/download?start_date="+B(l.value.start_date)+"&end_date="+B(l.value.end_date)+"&guide_id="+d.guide.id;N.get(p,{responseType:"blob"}).then(u=>{var t=new Blob([u.data],{type:"application/pdf"}),r=URL.createObjectURL(t);window.open(r),o.emit("onSubmit")})}}},components:{Form:O}},ge={class:"formgrid grid mt-3"},ve={class:"field col-6 flex flex-column"},De=s("label",{from:"start_date"},"Filtra Dal",-1),he={class:"field col-6 flex flex-column"},ye=s("label",{from:"end_date"},"Al",-1),xe={class:"flex align-items-center justify-content-end mt-6"};function Se(d,o,l,e,p,u){const t=f("Calendar"),r=f("Button"),c=f("Form");return x(),V(c,{onSubmit:e.onSubmit},{default:b(()=>[s("div",ge,[s("div",ve,[De,n(t,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":o[0]||(o[0]=i=>e.form.start_date=i),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),s("div",he,[ye,n(t,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":o[1]||(o[1]=i=>e.form.end_date=i),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),s("div",xe,[n(r,{label:"Annulla",text:""}),n(r,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const Ge=y(be,[["render",Se]]),we={setup(){h(()=>{});const d=_(!1),o=_(!1),l=_(),e=_({});return{visibleDialog:d,guideTable:l,currentGuide:e,visibleFilterDialog:o,onSubmit:function(){d.value=!1,l.value.loadLazyData(),e.value={}},onShowDialog:function(){e.value={},d.value=!0},onEdit:function(i){e.value=i,d.value=!0},onDownloadReport:function(i){e.value=i,o.value=!0},closeDialog:function(){o.value=!1}}},components:{GuideTable:oe,GuideDialog:pe,ReportGuideDialog:Ge}},Ve=s("h1",null,"Guide",-1),Te={class:"flex justify-content-end mt-4 mb-3"};function Ce(d,o,l,e,p,u){const t=f("Button"),r=f("GuideTable"),c=f("GuideDialog"),i=f("Dialog"),a=f("ReportGuideDialog");return x(),q(z,null,[Ve,s("div",Te,[n(t,{label:"Guida",icon:"pi pi-plus",rounded:"",outlined:"",onClick:o[0]||(o[0]=m=>e.onShowDialog())})]),n(r,{ref:"guideTable",onOnEdit:o[1]||(o[1]=m=>e.onEdit(m)),onOnDownloadReport:o[2]||(o[2]=m=>e.onDownloadReport(m))},null,512),n(i,{visible:e.visibleDialog,"onUpdate:visible":o[3]||(o[3]=m=>e.visibleDialog=m),modal:"",header:"Guida",style:{width:"50rem"}},{default:b(()=>[n(c,{guide:e.currentGuide,onOnSubmit:e.onSubmit},null,8,["guide","onOnSubmit"])]),_:1},8,["visible"]),n(i,{visible:e.visibleFilterDialog,"onUpdate:visible":o[4]||(o[4]=m=>e.visibleFilterDialog=m),modal:"",header:"Report guida",style:{width:"50rem"}},{default:b(()=>[n(a,{guide:e.currentGuide,onOnSubmit:e.closeDialog},null,8,["guide","onOnSubmit"])]),_:1},8,["visible"])],64)}const $e=y(we,[["render",Ce]]);export{$e as default};
