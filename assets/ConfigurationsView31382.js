import{u as ke}from"./location31382.js";import{u as ee,e as A,s as z}from"./helpers31382.js";import{y as q,A as $,C as le,z as ce,B as re,o as H,l as C,a as G,c as B,i as R,_ as K,r as u,p as Y,b as U,v as X,w as v,g as l,f as a,e as N,s as ae,h as F,t as O,q as P,x as de,F as J,D as se}from"../index31382.js";import{c as ue,a as me}from"./index.esm31382.js";import{F as _e}from"./vee-validate.esm31382.js";import{I as fe}from"./InputTextWithValidation31382.js";import{u as be}from"./category31382.js";import{e as pe,g as te,a as Q,b as oe,h as he}from"./formatData31382.js";import{D as ye}from"./datetime31382.js";import"./attraction31382.js";import"./_commonjsHelpers31382.js";class ne{static async fetchAll(e){return(await q(`/admin/locations/${e}/courses`)).data}static async addCourse(e){return(await $(`/admin/locations/${e.location_id}/courses`,e)).data.course}static async updateCourse(e){return(await le(`/admin/locations/${e.location_id}/courses/${e.course.id}`,e)).data.course}static async deleteCourse(e){return await ce(`/admin/courses/${e}`)}}const Ce=re({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:t=>t.courses,responseCourses:t=>t.response_courses,getTotalCourses:t=>t.response_courses?t.response_courses.total:0,getCurrentCourse:t=>t.course},actions:{async fetchAllCourses(t){await ne.fetchAll(t).then(e=>{this.response_courses=e,this.courses=e.courses})},async addCourse(t){await ne.addCourse(t).then(e=>{this.course=e})},async updateCourse(t){await ne.updateCourse(t).then(e=>{this.course=e})},async deleteCourse(t){await ne.deleteCourse(t).then()}}});class ie{static async fetchAll(e){return(await q(`/admin/courses/${e}/tickets`)).data}static async addTicket(e){return await $(`/admin/courses/${e.course_id}/tickets`,e)}static async updateTicket(e){return await le(`/admin/courses/${e.course_id}/tickets/${e.ticket.id}`,e)}static async deleteTicket(e){return await ce(`/admin/courses/${e.course_id}/tickets/${e.ticket_id}`)}}const we=re({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{}}),getters:{allTickets:t=>t.tickets,responseTickets:t=>t.response_tickets,getTotalTickets:t=>t.response_tickets?t.response_tickets.total:0,getCurrentTicket:t=>t.ticket},actions:{async fetchAllTickets(t){await ie.fetchAll(t).then(e=>{this.response_tickets=e,this.tickets=e.tickets})},async addTicket(t){await ie.addTicket(t).then()},async updateTicket(t){await ie.updateTicket(t).then()},async deleteTicket(t){await ie.deleteTicket(t).then()}}}),xe={props:["course","location_id"],setup(t,e){H(()=>{t.course&&t.course.id&&(n.value=Object.assign({},t.course),i()),n.value.tickets=[]});const n=C({}),o=C([]),V=ue({name:me().required("Nome percorso obbligatorio")}),{showLoader:w,hideLoader:c}=ee(),r=G(),f=Ce(),h=be(),d=we(),k=C(!1),_=B(()=>f.allCourses),s=B(()=>h.allCategories),b=B(()=>d.responseTickets),m=B(()=>f.getCurrentCourse),x=function(){w();const E={course:Object.assign({},n.value),location_id:t.location_id};f.addCourse(E).then(()=>{c(),z(r,{message:"Percorso aggiunto correttamente",error:!1}),e.emit("onSubmit")}).catch(M=>{c(),A(r,M)})},i=async function(){let p=t.course.id?t.course.id:m.value.id;w(),await d.fetchAllTickets(p).then(()=>{c()}).catch(E=>{c(),A(r,E)})},D=function(){w();const E={course:Object.assign({},n.value),location_id:t.location_id};f.updateCourse(E).then(()=>{c(),z(r,{message:"Percorso modificato correttamente",error:!1}),e.emit("onSubmit")}).catch(M=>{c(),A(r,M)})},S=function(){n.value.id?D():x()},I=function(){let p={name:"",description:"",price:0};n.value.tickets.push(p),o.value.push(p)},j=function(p,E){p.id?L(p):n.value.tickets.splice(E,1)},L=async function(p){const E={course_id:t.course.id?t.course.id:m.value.id,ticket_id:p.id};w(),await d.deleteTicket(E).then(()=>{c(),z(r,{message:"Biglietto eliminato correttamente",error:!1}),i()}).catch(M=>{c(),A(r,M)})},T=function(p){let{newData:E,index:M}=p;n.value.tickets[M]=E,E.id?g(E):y(E)},y=async function(p){const E={course_id:t.course.id?t.course.id:m.value.id,ticket:p};await d.addTicket(E).then(()=>{c(),z(r,{message:"Biglietto aggiunto correttamente",error:!1}),i()}).catch(M=>{c(),A(r,M)})},g=async function(p){const E={course_id:t.course.id?t.course.id:m.value.id,ticket:p};await d.updateTicket(E).then(()=>{c(),z(r,{message:"Biglietto aggiornato correttamente",error:!1}),i()}).catch(M=>{c(),A(r,M)})};return R(s,()=>{n.value.category||(n.value.category=s.value[0])}),R(b,()=>{b.value&&b.value.tickets.length>0&&(n.value.tickets=Object.assign([],b.value.tickets))}),R(m,()=>{n.value=Object.assign({},m.value)}),{form:n,schema:V,loading:k,editingRows:o,response_tickets:b,onSubmit:S,addTicket:I,onDeleteTicket:j,onRowEditSave:T,updateTicketsApi:g,courses:_,categories:s}},components:{Form:_e,InputTextWithValidation:fe}},Ve={class:"formgrid grid mt-3"},De={class:"field col-12"},Te={class:"field col-12"},Se=l("label",{for:"description"},"Descrizione",-1),Ee={key:0,class:"flex justify-content-end mt-4 mb-3"},Ae={class:"w-full"},Be={class:"flex justify-content-center"},Ue={class:"flex align-items-center justify-content-end mt-6"};function Ie(t,e,n,o,V,w){const c=u("InputTextWithValidation"),r=u("Textarea"),f=u("Button"),h=u("InputText"),d=u("Column"),k=u("InputSwitch"),_=u("DataTable"),s=u("Form"),b=Y("tooltip");return U(),X(s,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:v(()=>[l("div",Ve,[l("div",De,[a(c,{name:"name",label:"Nome percorso*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=m=>o.form.name=m)},null,8,["modelValue"])]),l("div",Te,[Se,a(r,{rows:"5",cols:"30",name:"description",label:"Nome percorso*",modelValue:o.form.description,"onUpdate:modelValue":e[1]||(e[1]=m=>o.form.description=m),class:"w-full"},null,8,["modelValue"])])]),o.form.id?(U(),N("div",Ee,[a(f,{label:"Tipologia biglietto",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=m=>o.addTicket())})])):ae("",!0),o.form.id?(U(),X(_,{key:1,value:o.form.tickets,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[3]||(e[3]=m=>o.editingRows=m),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:v(()=>[F(" Nessun biglietto trovato. ")]),default:v(()=>[a(d,{header:"Tipo biglietto",field:"name",style:{"min-width":"150px"}},{editor:v(({data:m,field:x})=>[a(h,{modelValue:m[x],"onUpdate:modelValue":i=>m[x]=i},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(d,{header:"Descrizione",field:"description"},{editor:v(({data:m,field:x})=>[l("div",Ae,[a(r,{modelValue:m[x],"onUpdate:modelValue":i=>m[x]=i,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),a(d,{header:"Prezzo",field:"price",bodyStyle:"min-width: 6rem"},{body:v(({data:m})=>[F(" € "+O((+m.price).toFixed(2)),1)]),editor:v(({data:m,field:x})=>[a(h,{modelValue:m[x],"onUpdate:modelValue":i=>m[x]=i},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(d,{header:"Stato",field:"public",bodyStyle:"min-width: 6rem"},{body:v(({data:m,field:x})=>[a(k,{modelValue:m[x],"onUpdate:modelValue":i=>m[x]=i,onChange:i=>o.updateTicketsApi(m)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),editor:v(({data:m,field:x})=>[a(k,{modelValue:m[x],"onUpdate:modelValue":i=>m[x]=i},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(d,{rowEditor:!0,bodyStyle:"text-align:center; padding-right:0;min-width: 6rem"}),a(d,{header:"",style:{width:"3rem","padding-left":"0"}},{body:v(({data:m,index:x})=>[l("div",Be,[P(a(f,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:i=>o.onDeleteTicket(m,x)},null,8,["onClick"]),[[b,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])):ae("",!0),l("div",Ue,[a(f,{label:"Annulla",text:"",onClick:e[4]||(e[4]=m=>t.$emit("onClose"))}),a(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const je=K(xe,[["render",Ie]]),ze={props:["location_id"],setup(t){H(()=>{w.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,b()});const e=G(),n=C(),o=C(),V=C(),w=C(!0),c=C(),r=C(0),f=C(!1),{showLoader:h,hideLoader:d}=ee(),k=Ce(),_=B(()=>k.responseCourses),s=de();B(()=>s.submitDialog);function b(){h(),setTimeout(()=>{m()},Math.random()*1e3+250)}const m=async function(){w.value=!0,await k.fetchAllCourses(t.location_id).then(()=>{w.value=!1,d()}).catch(j=>{w.value=!1,d(),A(e,j)})},x=function(j){V.value=j,f.value=!0},i=function(j){V.value=j;let L="Sei sicuro di voler archiviare questo percorso?";s.setDialog("Archivia percorso","Archivia","Annulla",L),s.setBtnSubmit(!1),s.setDynamicDialogVisibility(!0)},D=function(j){h();const L={course:j,location_id:t.location_id};k.updateCourse(L).then(()=>{d(),z(e,{message:"Percorso modificato correttamente",error:!1}),m()}).catch(T=>{d(),A(e,T)})},S=function(){return V.value&&V.value.id?"Modifica percorso":"Aggiungi percorso"},I=function(){};return R(t,()=>{t.location_id&&m()}),{dt:n,responseCourses:_,loading:w,totalRecords:r,lazyParams:c,op:o,visible:f,currentCourse:V,loadLazyData:b,onEditCourse:x,closeDialog:I,getHeader:S,updateCourse:D,onArchiveCourse:i}},components:{CourseDialog:je}},Me={class:"flex justify-content-end mt-4 mb-3"},Re={class:"flex justify-content-center"};function Le(t,e,n,o,V,w){const c=u("Button"),r=u("Column"),f=u("InputSwitch"),h=u("DataTable"),d=u("CourseDialog"),k=u("Dialog"),_=Y("tooltip");return U(),N(J,null,[l("div",Me,[a(c,{label:"Percorso",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=s=>o.onEditCourse({}))})]),a(h,{value:o.responseCourses.courses,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:v(()=>[F(" Nessun percorso trovato. ")]),default:v(()=>[a(r,{header:"Nome",field:"name"}),a(r,{header:"Tipologie biglietti"},{body:v(({data:s})=>[(U(!0),N(J,null,se(s.tickets,b=>(U(),N("div",{key:b.id},O(b.name),1))),128))]),_:1}),a(r,{header:"Prezzo"},{body:v(({data:s})=>[(U(!0),N(J,null,se(s.tickets,b=>(U(),N("div",{key:b.id}," € "+O((+b.price).toFixed(2)),1))),128))]),_:1}),a(r,{header:"Stato"},{body:v(({data:s})=>[a(f,{modelValue:s.public,"onUpdate:modelValue":b=>s.public=b,onChange:b=>o.updateCourse(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(r,{header:""},{body:v(({data:s})=>[l("div",Re,[P(a(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:b=>o.onEditCourse(s),class:"mr-2"},null,8,["onClick"]),[[_,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(k,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=s=>o.visible=s),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:v(()=>[a(d,{course:o.currentCourse,location_id:n.location_id,onOnSubmit:e[1]||(e[1]=s=>o.closeDialog()),onOnClose:e[2]||(e[2]=s=>o.visible=!1)},null,8,["course","location_id"])]),_:1},8,["visible","header"])],64)}const Ne=K(ze,[["render",Le]]);class Z{static async fetchAll(e){return e?(await q("/admin/booking_rules",e)).data:{}}static async getCourses(e){return(await q("/admin/booking_rules/courses",e)).data}static async getTickets(e){return(await q("/admin/booking_rules/tickets",e)).data}static async addConfiguration(e){return await $("/admin/booking_rules",e)}static async updateConfiguration(e){return await le(`/admin/booking_rules/${e.booking_rule.id}`,e)}static async deleteConfiguration(e){return e==null?{}:await ce(`/admin/booking_rules/${e}`)}}const ge=re({id:"configuration",state:()=>({configuration:{},configurations:[],response_configurations:{},response_courses:{},response_tickets:{}}),getters:{allConfigurations:t=>t.configurations,responseConfigurations:t=>t.response_configurations,getTotalConfigurations:t=>t.response_configurations?t.response_configurations.total:0,getCurrentConfiguration:t=>t.configuration,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets},actions:{async fetchAllConfigurations(t){await Z.fetchAll(t).then(e=>{this.response_configurations=e,this.configurations=e.configurations})},async getAllCourses(t){await Z.getCourses(t).then(e=>{this.response_courses=e})},async getAllTickets(t){await Z.getTickets(t).then(e=>{this.response_tickets=e})},async addConfiguration(t){await Z.addConfiguration(t).then()},async updateConfiguration(t){await Z.updateConfiguration(t).then()},async deleteConfiguration(t){t!=null&&await Z.deleteConfiguration(t).then()}}}),Oe={props:["config","location_id","course_id","duplicate"],setup(t,e){H(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.from_date&&(n.value.from_date=pe(n.value.from_date)),n.value.to_date&&(n.value.to_date=pe(n.value.to_date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_rule_slots=[]),T()});const n=C({}),o=C([]),V=C(!1),w=ue({name_config:me().required("Nome configurazione obbligatoria")}),{showLoader:c,hideLoader:r}=ee(),f=G(),h=be(),d=C(!1),k=ge(),_=B(()=>h.allCategories),s=B(()=>k.responseTickets),b=B(()=>k.responseCourses),m=function(){c();const y=Object.assign({},n.value);y.from_date&&(y.from_date=te(y.from_date)),y.to_date&&(y.to_date=te(y.to_date)),y.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(p=>{p.available_seats!=""&&p.start_at!=""&&y.booking_rule_slots.push(p)});const g={booking_rule:y};k.addConfiguration(g).then(()=>{r(),z(f,{message:"Configurazione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(p=>{r(),A(f,p)})},x=function(){c();const y=Object.assign({},n.value);y.from_date&&(y.from_date=te(y.from_date)),y.to_date&&(y.to_date=te(y.to_date)),y.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(p=>{p.available_seats!=""&&p.start_at!=""&&y.booking_rule_slots.push(p)});const g={booking_rule:y};k.updateConfiguration(g).then(()=>{r(),z(f,{message:"Configurazione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(p=>{r(),A(f,p)})},i=function(){n.value.id?x():m()},D=function(){let y={};y.price=0,n.value.tickets.unshift(y),o.value.push(n.value.tickets[0])},S=function(y){let{newData:g,index:p}=y;n.value.booking_rule_slots[p]=g;let M={start_at:"",available_seats:"",id:+n.value.booking_rule_slots[n.value.booking_rule_slots.length-1].id-1};n.value.booking_rule_slots.push(M),o.value=[M]},I=function(){let y={start_at:"",available_seats:"",id:"-1"};n.value.booking_rule_slots.push(y),o.value.push(y)},j=function(y,g){n.value.booking_rule_slots.splice(g,1)},L=function(y){y?n.value.wdays=[0,1,2,3,4,5,6]:n.value.wdays=[]},T=function(){const y=new Map;y.set("location_id",n.value.location_id),y.set("course_id",n.value.course_id),k.getAllTickets(y).catch(g=>{A(f,g)})};return R(_,()=>{n.value.category||(n.value.category=_.value[0])}),{form:n,schema:w,loading:d,editingRows:o,check_all:V,onSubmit:i,addTicket:D,onRowEditSave:S,checkAll:L,deleteSlot:j,addSlot:I,fetchAllTickets:T,categories:_,responseCourses:b,responseTickets:s}},components:{Form:_e,InputTextWithValidation:fe}};const Fe={class:"formgrid grid mt-3"},Pe={class:"field col-12"},We={class:"field flex flex-column col-6"},qe=l("label",{for:"location"},"Percorso",-1),He={class:"field col-3"},Ge=l("label",{from:"date_from"},"Dal",-1),Ke={class:"field col-3"},Je=l("label",{from:"date_to"},"Al",-1),Qe={class:"field col-12 mt-3"},Xe=l("label",null,"Giorni",-1),Ye={class:"card flex flex-wrap gap-3 mt-2"},Ze={class:"flex align-items-center mr-4"},$e=l("label",{for:"all",class:"ml-2"}," Tutti i giorni ",-1),eo={class:"flex align-items-center"},oo=l("label",{for:"lun",class:"ml-2"}," Lun ",-1),to={class:"flex align-items-center"},no=l("label",{for:"mar",class:"ml-2"}," Mar ",-1),io={class:"flex align-items-center"},ao=l("label",{for:"mer",class:"ml-2"}," Mer ",-1),so={class:"flex align-items-center"},lo=l("label",{for:"gio",class:"ml-2"}," Gio ",-1),co={class:"flex align-items-center"},ro=l("label",{for:"ven",class:"ml-2"}," Ven ",-1),uo={class:"flex align-items-center"},mo=l("label",{for:"sab",class:"ml-2"}," Sab ",-1),_o={class:"flex align-items-center"},fo=l("label",{for:"dom",class:"ml-2"}," Dom ",-1),go={class:"field col-3 mt-3"},vo=l("label",null,"Biglietti",-1),po=["for"],bo={class:"inline-block",style:{"min-width":"150px"}},ho={class:"text-right"},ko=l("div",{class:"col-9"},null,-1),Co={class:"col-8 mt-3"},yo={class:"field flex justify-content-between align-items-end mt-4 mb-3"},wo=l("label",null,"Orari",-1),xo={class:"flex justify-content-center"},Vo={class:"flex align-items-center justify-content-end mt-6"};function Do(t,e,n,o,V,w){const c=u("InputTextWithValidation"),r=u("Dropdown"),f=u("Calendar"),h=u("Checkbox"),d=u("Button"),k=u("InputMask"),_=u("Column"),s=u("InputNumber"),b=u("DataTable"),m=u("Form"),x=Y("tooltip");return U(),X(m,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:v(()=>[l("div",Fe,[l("div",Pe,[a(c,{name:"name_config",label:"Nome configurazione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.name=i),id:"name_config",type:"text"},null,8,["modelValue"])]),l("div",We,[qe,a(r,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.course_id=i),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[2]||(e[2]=i=>o.fetchAllTickets())},null,8,["modelValue","options"])]),l("div",He,[Ge,a(f,{inputId:"date_from",modelValue:o.form.from_date,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.from_date=i),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),l("div",Ke,[Je,a(f,{inputId:"date_to",modelValue:o.form.to_date,"onUpdate:modelValue":e[4]||(e[4]=i=>o.form.to_date=i),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),l("div",Qe,[Xe,l("div",Ye,[l("div",Ze,[a(h,{modelValue:o.check_all,"onUpdate:modelValue":[e[5]||(e[5]=i=>o.check_all=i),e[6]||(e[6]=i=>o.checkAll(i))],inputId:"all",name:"week",binary:!0},null,8,["modelValue"]),$e]),l("div",eo,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[7]||(e[7]=i=>o.form.wdays=i),inputId:"lun",name:"week",value:1},null,8,["modelValue"]),oo]),l("div",to,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[8]||(e[8]=i=>o.form.wdays=i),inputId:"mar",name:"week",value:2},null,8,["modelValue"]),no]),l("div",io,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[9]||(e[9]=i=>o.form.wdays=i),inputId:"mer",name:"week",value:3},null,8,["modelValue"]),ao]),l("div",so,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[10]||(e[10]=i=>o.form.wdays=i),inputId:"gio",name:"week",value:4},null,8,["modelValue"]),lo]),l("div",co,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[11]||(e[11]=i=>o.form.wdays=i),inputId:"ven",name:"week",value:5},null,8,["modelValue"]),ro]),l("div",uo,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[12]||(e[12]=i=>o.form.wdays=i),inputId:"sab",name:"week",value:6},null,8,["modelValue"]),mo]),l("div",_o,[a(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[13]||(e[13]=i=>o.form.wdays=i),inputId:"dom",name:"week",value:0},null,8,["modelValue"]),fo])])]),l("div",go,[vo,(U(!0),N(J,null,se(o.responseTickets.tickets,i=>(U(),N("div",{key:i.id,class:"flex align-items-center mb-2 mt-2"},[a(h,{modelValue:o.form.booking_rule_ticket_ids,"onUpdate:modelValue":e[14]||(e[14]=D=>o.form.booking_rule_ticket_ids=D),inputId:i.id+"",value:i.id},null,8,["modelValue","inputId","value"]),l("label",{for:i.id+"",class:"ml-2 flex align-items-center"},[l("div",bo,O(i.name),1),l("div",ho,"€ "+O(i.price),1)],8,po)]))),128))]),ko,l("div",Co,[l("div",yo,[wo,a(d,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[15]||(e[15]=i=>o.addSlot())})]),a(b,{value:o.form.booking_rule_slots,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[16]||(e[16]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:v(()=>[F(" Nessuno slot orario trovato. ")]),default:v(()=>[a(_,{header:"Ora",field:"start_at"},{editor:v(({data:i,field:D})=>[a(k,{id:"basic",modelValue:i[D],"onUpdate:modelValue":S=>i[D]=S,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(_,{header:"Posti",field:"available_seats"},{editor:v(({data:i,field:D})=>[a(s,{modelValue:i[D],"onUpdate:modelValue":S=>i[D]=S,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(_,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),a(_,{header:"",style:{width:"3rem","padding-left":"0"}},{body:v(({data:i,index:D})=>[l("div",xo,[P(a(d,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:S=>o.deleteSlot(i,D)},null,8,["onClick"]),[[x,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","editingRows","onRowEditSave"])])]),l("div",Vo,[a(d,{label:"Annulla",text:"",onClick:e[17]||(e[17]=i=>t.$emit("onClose"))}),a(d,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const To=K(Oe,[["render",Do]]),So={props:["location_id"],setup(t){H(()=>{c.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,t.location_id&&i(t.location_id)});const e=G(),n=C(),o=C(),V=C(),w=C(),c=C(!0),r=C(),f=C(0),h=C(!1),d=C(),k=C(!1),_=ge(),s=B(()=>_.responseConfigurations),b=de(),m=B(()=>b.submitDialog),x=B(()=>_.responseCourses),i=async function(g){const p=new Map;p.set("location_id",g),await _.getAllCourses(p).then(()=>{c.value=!1}).catch(E=>{c.value=!1,A(e,E)})},D=async function(g){if(!g)return;c.value=!0;const p=new Map;p.set("location_id",t.location_id),p.set("course_id",g),await _.fetchAllConfigurations(p).then(()=>{c.value=!1}).catch(E=>{c.value=!1,A(e,E)})},S=function(g){V.value=g;let p="Sei sicuro di voler eliminare questa configurazione?";b.setDialog("Elimina configurazione","Elimina","Annulla",p),b.setBtnSubmit(!1),b.setDynamicDialogVisibility(!0)},I=async function(){V.value&&await _.deleteConfiguration(V.value).then(()=>{c.value=!1,z(e,{message:"Configurazione eliminata correttamente",error:!1}),D(d.value)}).catch(g=>{c.value=!1,A(e,g)})},j=function(g,p){w.value=g,h.value=!0,k.value=p},L=function(g){return g.map(E=>ye.local(2022,1,2+E).setLocale("it").toFormat("ccc")).join(", ")},T=function(g){D(g),h.value=!1},y=function(){return k.value?"Duplica configurazione":w.value&&w.value.id&&!k.value?"Modifica configurazione":"Nuova configurazione"};return R(m,g=>{m.value&&I()}),R(x,()=>{x.value.courses&&x.value.courses[0]&&(d.value=x.value.courses[0].id,D(d.value))}),R(t,()=>{t.location_id&&i(t.location_id)}),{dt:n,responseConfigurations:s,loading:c,totalRecords:f,lazyParams:r,op:o,visible:h,currentConfiguration:w,responseCourses:x,course_id:d,flag_duplicate:k,fromMMDDtoDDMM:pe,onDeleteConfiguration:I,confirmDelete:S,onEditConfiguration:j,fetchAllConfigurations:D,convertWdays:L,closeDialog:T,getHeader:y}},components:{ConfigurationDialog:To}},Eo={class:"flex justify-content-between mt-4 mb-3"},Ao={class:"field flex flex-column"},Bo=l("label",{for:"location"},"Percorso",-1),Uo={class:"capitalize"},Io={class:"flex justify-content-center"};function jo(t,e,n,o,V,w){const c=u("Dropdown"),r=u("Button"),f=u("Column"),h=u("DataTable"),d=u("ConfigurationDialog"),k=u("Dialog"),_=Y("tooltip");return U(),N(J,null,[l("div",Eo,[l("div",Ao,[Bo,a(c,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=s=>o.course_id=s),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=s=>o.fetchAllConfigurations(o.course_id))},null,8,["modelValue","options"])]),a(r,{label:"Configurazione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=s=>o.onEditConfiguration({},!1))})]),a(h,{value:o.responseConfigurations.booking_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:v(()=>[F(" Nessuna configurazione trovata. ")]),default:v(()=>[a(f,{header:"Nome",field:"name"}),a(f,{header:"Dal Al"},{body:v(({data:s})=>[F(O(o.fromMMDDtoDDMM(s.from_date))+" - "+O(o.fromMMDDtoDDMM(s.to_date)),1)]),_:1}),a(f,{header:"Valida il",field:"week"},{body:v(({data:s})=>[l("div",Uo,O(o.convertWdays(s.wdays)),1)]),_:1}),a(f,{header:""},{body:v(({data:s})=>[l("div",Io,[P(a(r,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:b=>o.onEditConfiguration(s,!0)},null,8,["onClick"]),[[_,"Duplica",void 0,{top:!0}]]),P(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:b=>o.onEditConfiguration(s,!1)},null,8,["onClick"]),[[_,"Modifica",void 0,{top:!0}]]),P(a(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:b=>o.confirmDelete(s.id)},null,8,["onClick"]),[[_,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(k,{visible:o.visible,"onUpdate:visible":e[5]||(e[5]=s=>o.visible=s),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:v(()=>[a(d,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=s=>o.closeDialog(s)),onOnClose:e[4]||(e[4]=s=>o.visible=!1),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const zo=K(So,[["render",jo]]);class W{static async fetchAll(e){return e?(await q("/admin/booking_exception_rules",e)).data:{}}static async getCourses(e){return(await q("/admin/booking_exception_rules/courses",e)).data}static async getTickets(e){return(await q("/admin/booking_exception_rules/tickets",e)).data}static async addBookingException(e){return await $("/admin/booking_exception_rules",e)}static async updateBookingException(e){return await le(`/admin/booking_exception_rules/${e.booking_exception_rule.id}`,e)}static async deleteBookingException(e){return e==null?{}:await ce(`/admin/booking_exception_rules/${e}`)}static async fetchAllClosings(e){return e?(await q(`/admin/booking_exception_rules/closings?location_id=${e.get("location_id")}`)).data:{}}static async createClosing(e){return await $("/admin/booking_exception_rules/closings",e)}static async deleteClosing(e){return await $("/admin/booking_exception_rules/delete_closings",e)}}const ve=re({id:"booking_exception",state:()=>({booking_exception:{},booking_exceptions:[],response_booking_exceptions:{},response_courses:{},response_tickets:{},response_closings:{}}),getters:{allBookingExceptions:t=>t.booking_exceptions,responseBookingExceptions:t=>t.response_booking_exceptions,getTotalBookingExceptions:t=>t.response_booking_exceptions?t.response_booking_exceptions.total:0,getCurrentBookingException:t=>t.booking_exception,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets,responseClosings:t=>t.response_closings},actions:{async fetchAllBookingExceptions(t){await W.fetchAll(t).then(e=>{this.response_booking_exceptions=e,this.booking_exceptions=e.booking_exceptions})},async fetchAllClosings(t){await W.fetchAllClosings(t).then(e=>{this.response_closings=e})},async getAllCourses(t){await W.getCourses(t).then(e=>{this.response_courses=e})},async getAllTickets(t){await W.getTickets(t).then(e=>{this.response_tickets=e})},async addBookingException(t){await W.addBookingException(t).then()},async updateBookingException(t){await W.updateBookingException(t).then()},async deleteBookingException(t){t!=null&&await W.deleteBookingException(t).then()},async addClosing(t){await W.createClosing(t).then()},async deleteClosing(t){await W.deleteClosing(t).then()}}}),Mo={props:["config","location_id","course_id","duplicate"],setup(t,e){H(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.date&&(n.value.date=Q(n.value.date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_exception_rule_slots=[]),L()});const n=C({}),o=C([]),V=ue({name:me().required("Nome eccezione obbligatoria")}),{showLoader:w,hideLoader:c}=ee(),r=G(),f=be(),h=C(!1),d=ge(),k=ve(),_=B(()=>f.allCategories),s=B(()=>d.responseTickets),b=B(()=>d.responseCourses),m=function(){w();const T=Object.assign({},n.value);T.date&&(T.date=oe(T.date)),T.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(g=>{g.available_seats!=""&&g.start_at!=""&&T.booking_exception_rule_slots.push(g)});const y={booking_exception_rule:T};k.addBookingException(y).then(()=>{c(),z(r,{message:"Eccezione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(g=>{c(),A(r,g)})},x=function(){w();const T=Object.assign({},n.value);T.date&&(T.date=oe(T.date)),T.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(g=>{g.available_seats!=""&&g.start_at!=""&&T.booking_exception_rule_slots.push(g)});const y={booking_exception_rule:T};k.updateBookingException(y).then(()=>{c(),z(r,{message:"Eccezione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(g=>{c(),A(r,g)})},i=function(){n.value.id?x():m()},D=function(){let T={};T.price=0,n.value.tickets.unshift(T),o.value.push(n.value.tickets[0])},S=function(T){let{newData:y,index:g}=T;n.value.booking_exception_rule_slots[g]=y;let E={start_at:"",available_seats:"",id:+n.value.booking_exception_rule_slots[n.value.booking_exception_rule_slots.length-1].id-1};n.value.booking_exception_rule_slots.push(E),o.value=[E]},I=function(){let T={start_at:"",available_seats:"",id:"-1"};n.value.booking_exception_rule_slots.push(T),o.value.push(T)},j=function(T,y){n.value.booking_exception_rule_slots.splice(y,1)},L=function(){const T=new Map;T.set("location_id",n.value.location_id),T.set("course_id",n.value.course_id),d.getAllTickets(T).catch(y=>{A(r,y)})};return R(_,()=>{n.value.category||(n.value.category=_.value[0])}),{form:n,schema:V,loading:h,editingRows:o,onSubmit:i,addTicket:D,onRowEditSave:S,deleteSlot:j,addSlot:I,fetchAllTickets:L,categories:_,responseTickets:s,responseCourses:b}},components:{Form:_e,InputTextWithValidation:fe}},Ro={class:"formgrid grid mt-3"},Lo={class:"field col-12"},No={class:"field flex flex-column col-6"},Oo=l("label",{for:"location"},"Percorso",-1),Fo={class:"field col-3"},Po=l("label",{from:"date"},"Il",-1),Wo=l("div",{class:"field col-3"},null,-1),qo={class:"field col-3 mt-3"},Ho=l("label",null,"Biglietti",-1),Go=["for"],Ko={class:"inline-block",style:{"min-width":"150px"}},Jo={class:"text-right"},Qo=l("div",{class:"col-9"},null,-1),Xo={class:"field col-8 mt-3"},Yo={class:"field flex justify-content-between align-items-end mt-4 mb-3"},Zo=l("label",null,"Orari",-1),$o={class:"flex justify-content-center"},et={class:"flex align-items-center justify-content-end mt-6"};function ot(t,e,n,o,V,w){const c=u("InputTextWithValidation"),r=u("Dropdown"),f=u("Calendar"),h=u("Checkbox"),d=u("Button"),k=u("InputMask"),_=u("Column"),s=u("InputNumber"),b=u("DataTable"),m=u("Form"),x=Y("tooltip");return U(),X(m,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:v(()=>[l("div",Ro,[l("div",Lo,[a(c,{name:"name",label:"Nome eccezione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.name=i)},null,8,["modelValue"])]),l("div",No,[Oo,a(r,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.course_id=i),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[2]||(e[2]=i=>o.fetchAllTickets())},null,8,["modelValue","options"])]),l("div",Fo,[Po,a(f,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.date=i),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),Wo,l("div",qo,[Ho,(U(!0),N(J,null,se(o.responseTickets.tickets,i=>(U(),N("div",{key:i.id,class:"flex align-items-center mb-2"},[a(h,{modelValue:o.form.booking_exception_rule_ticket_ids,"onUpdate:modelValue":e[4]||(e[4]=D=>o.form.booking_exception_rule_ticket_ids=D),inputId:i.id+"",name:"category",value:i.id},null,8,["modelValue","inputId","value"]),l("label",{for:i.id+"",class:"ml-2 flex align-items-center"},[l("div",Ko,O(i.name),1),l("div",Jo,"€ "+O(i.price),1)],8,Go)]))),128))]),Qo,l("div",Xo,[l("div",Yo,[Zo,a(d,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[5]||(e[5]=i=>o.addSlot())})]),a(b,{value:o.form.booking_exception_rule_slots,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[6]||(e[6]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:v(()=>[F(" Nessuno slot orario trovato. ")]),default:v(()=>[a(_,{header:"Ora",field:"start_at"},{editor:v(({data:i,field:D})=>[a(k,{id:"basic",modelValue:i[D],"onUpdate:modelValue":S=>i[D]=S,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(_,{header:"Posti",field:"available_seats"},{editor:v(({data:i,field:D})=>[a(s,{modelValue:i[D],"onUpdate:modelValue":S=>i[D]=S,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(_,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),a(_,{header:"",style:{width:"3rem","padding-left":"0"}},{body:v(({data:i,index:D})=>[l("div",$o,[P(a(d,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:S=>o.deleteSlot(i,D)},null,8,["onClick"]),[[x,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])])]),l("div",et,[a(d,{label:"Annulla",text:""}),a(d,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const tt=K(Mo,[["render",ot]]),nt={props:["location_id"],setup(t){H(()=>{c.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,t.location_id&&D(t.location_id)});const e=G(),n=C(),o=C(),V=C(),w=C(),c=C(!0),r=C(),f=C(0),h=C(!1);C([]);const d=C(),k=C(!1),_=ge(),s=ve(),b=B(()=>s.responseBookingExceptions),m=de(),x=B(()=>m.submitDialog),i=B(()=>_.responseCourses),D=async function(g){const p=new Map;p.set("location_id",g),await _.getAllCourses(p).then(()=>{c.value=!1}).catch(E=>{c.value=!1,A(e,E)})},S=async function(g){if(!g)return;c.value=!0;const p=new Map;p.set("location_id",t.location_id),p.set("course_id",g),await s.fetchAllBookingExceptions(p).then(()=>{c.value=!1}).catch(E=>{c.value=!1,A(e,E)})},I=function(g){V.value=g;let p="Sei sicuro di voler eliminare questa eccezione?";m.setDialog("Elimina eccezione","Elimina","Annulla",p),m.setBtnSubmit(!1),m.setDynamicDialogVisibility(!0)},j=async function(){V.value&&await s.deleteBookingException(V.value).then(()=>{c.value=!1,z(e,{message:"Eccezione eliminata correttamente",error:!1}),S(d.value)}).catch(g=>{c.value=!1,A(e,g)})},L=function(g,p){w.value=g,h.value=!0,k.value=p},T=function(g){S(g),h.value=!1},y=function(){return k.value?"Duplica eccezione":w.value&&w.value.id&&!k.value?"Modifica eccezione":"Nuova eccezione"};return R(x,g=>{g&&j()}),R(i,()=>{i.value&&i.value.courses&&i.value.courses.length>0&&(d.value=i.value.courses[0].id,S(d.value))}),R(t,()=>{t.location_id&&D(t.location_id)}),{dt:n,responseBookingExceptions:b,loading:c,totalRecords:f,lazyParams:r,op:o,visible:h,currentConfiguration:w,responseCourses:i,course_id:d,flag_duplicate:k,onDeleteConfigurationException:j,confirmDelete:I,onEditConfiguration:L,getHeader:y,closeDialog:T,fetchAllBookingExceptions:S,formatPrettyDate:Q}},components:{BookingExceptionDialog:tt}},it={class:"flex justify-content-between mt-4 mb-3"},at={class:"field flex flex-column"},st=l("label",{for:"location"},"Percorso",-1),lt={class:"flex justify-content-center"};function ct(t,e,n,o,V,w){const c=u("Dropdown"),r=u("Button"),f=u("Column"),h=u("DataTable"),d=u("BookingExceptionDialog"),k=u("Dialog"),_=Y("tooltip");return U(),N(J,null,[l("div",it,[l("div",at,[st,a(c,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=s=>o.course_id=s),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=s=>o.fetchAllBookingExceptions(o.course_id))},null,8,["modelValue","options"])]),a(r,{label:"Eccezione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=s=>o.onEditConfiguration({},!1))})]),a(h,{value:o.responseBookingExceptions.booking_exception_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:v(()=>[F(" Nessuna eccezione trovata. ")]),default:v(()=>[a(f,{header:"Nome",field:"name"}),a(f,{header:"Il"},{body:v(({data:s})=>[F(O(o.formatPrettyDate(s.date)),1)]),_:1}),a(f,{header:""},{body:v(({data:s})=>[l("div",lt,[P(a(r,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:b=>o.onEditConfiguration(s,!0)},null,8,["onClick"]),[[_,"Duplica",void 0,{top:!0}]]),P(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:b=>o.onEditConfiguration(s,!1)},null,8,["onClick"]),[[_,"Modifica",void 0,{top:!0}]]),P(a(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:b=>o.confirmDelete(s.id)},null,8,["onClick"]),[[_,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(k,{visible:o.visible,"onUpdate:visible":e[4]||(e[4]=s=>o.visible=s),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:v(()=>[a(d,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=s=>o.closeDialog(s)),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const rt=K(nt,[["render",ct]]),dt={props:["location_id","closing"],setup(t,e){H(()=>{t.closing&&t.closing.id?(n.value=Object.assign({},t.closing),n.value.date&&(n.value.date=Q(n.value.date))):n.value.location_id=t.location_id});const n=C({}),o=ue({name:me().required("Nome chiusura obbligatoria")}),{showLoader:V,hideLoader:w}=ee(),c=G(),r=ke(),f=ve(),h=B(()=>r.allLocations),d=function(s){V(),f.addClosing(s).then(()=>{w(),z(c,{message:"Chiusura aggiunta correttamente",error:!1}),e.emit("onSubmit")}).catch(b=>{w(),A(c,b)})},k=function(s){V(),f.updateBookingException(s).then(()=>{w(),z(c,{message:"Chiusura modificata correttamente",error:!1}),e.emit("onSubmit")}).catch(b=>{w(),A(c,b)})};return{form:n,schema:o,onSubmit:function(){const s=Object.assign({},n.value);s.date&&(s.date=oe(s.date),s.location_id=t.location_id);const b={booking_exception_rule:s};n.value.id?k(b):d(b)},locations:h}},components:{Form:_e,InputTextWithValidation:fe}},ut={class:"formgrid grid mt-3"},mt={class:"field col-6"},_t={class:"field col-6 flex flex-column"},ft=l("label",{from:"from_date"},"Il",-1),gt={class:"flex align-items-center justify-content-end mt-6"};function vt(t,e,n,o,V,w){const c=u("InputTextWithValidation"),r=u("Calendar"),f=u("Button"),h=u("Form");return U(),X(h,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:v(()=>[l("div",ut,[l("div",mt,[a(c,{name:"name",label:"Nome chiusura*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=d=>o.form.name=d)},null,8,["modelValue"])]),l("div",_t,[ft,a(r,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[1]||(e[1]=d=>o.form.date=d),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),l("div",gt,[a(f,{label:"Annulla",text:""}),a(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const pt=K(dt,[["render",vt]]),bt={props:["location_id"],setup(t){H(()=>{c.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,t.location_id&&s()});const e=G(),n=C(),o=C(),V=C(),w=C(),c=C(!0),r=C(),f=C(!1),h=ve(),d=de(),k=B(()=>d.submitDialog),_=B(()=>h.responseClosings),s=async function(){const S=new Map;S.set("location_id",t.location_id),await h.fetchAllClosings(S).then(()=>{c.value=!1}).catch(I=>{c.value=!1,A(e,I)})},b=function(S){V.value=S;let I="Sei sicuro di voler eliminare questa chiusura?";d.setDialog("Elimina chiusura","Elimina","Annulla",I),d.setBtnSubmit(!1),d.setDynamicDialogVisibility(!0)},m=async function(){if(!V.value)return;const S={location_id:t.location_id,date:V.value};await h.deleteClosing(S).then(()=>{c.value=!1,z(e,{message:"Chiusura eliminata correttamente",error:!1}),s()}).catch(I=>{c.value=!1,A(e,I)})},x=function(S){w.value=S,f.value=!0},i=function(){s(),f.value=!1},D=function(){return w.value&&w.value.id?"Modifica chiusura":"Nuova chiusura"};return R(k,S=>{k.value&&m()}),R(t,()=>{t.location_id&&s()}),{dt:n,responseClosings:_,loading:c,lazyParams:r,op:o,visible:f,currentClosing:w,formatPrettyDate:Q,onDeleteClosing:m,confirmDelete:b,onEditConfiguration:x,closeDialog:i,getHeader:D}},components:{ClosingDialog:pt}},ht={class:"flex justify-content-end mt-4 mb-3"},kt={class:"flex justify-content-center"};function Ct(t,e,n,o,V,w){const c=u("Button"),r=u("Column"),f=u("DataTable"),h=u("ClosingDialog"),d=u("Dialog"),k=Y("tooltip");return U(),N(J,null,[l("div",ht,[a(c,{label:"Chiusura",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=_=>o.onEditConfiguration({}))})]),a(f,{value:o.responseClosings.closings,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:v(()=>[F(" Nessuna chiusura trovata. ")]),default:v(()=>[a(r,{header:"Nome",field:"name"}),a(r,{header:"Il"},{body:v(({data:_})=>[F(O(o.formatPrettyDate(_.date)),1)]),_:1}),a(r,{header:""},{body:v(({data:_})=>[l("div",kt,[P(a(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:s=>o.onEditConfiguration(_)},null,8,["onClick"]),[[k,"Modifica",void 0,{top:!0}]]),P(a(c,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:s=>o.confirmDelete(_.date)},null,8,["onClick"]),[[k,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(d,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=_=>o.visible=_),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:v(()=>[a(h,{onOnSubmit:e[1]||(e[1]=_=>o.closeDialog()),onOnClose:e[2]||(e[2]=_=>o.visible=!1),location_id:n.location_id,closing:o.currentClosing},null,8,["location_id","closing"])]),_:1},8,["visible","header"])],64)}const yt=K(bt,[["render",Ct]]),wt={setup(){H(()=>{k()});const t=C({}),e=ke(),n=C(),o=C(),V=C(),{showLoader:w,hideLoader:c}=ee(),r=G(),f=C(!1),h=B(()=>e.allLocations),d=B(()=>e.getCurrentLocation),k=async function(){await e.fetchAllLocations().then(()=>{d.value&&(t.value.location=d.value,s())})},_=function(){e.updateCurrenLocation(t.value.location),s()},s=function(){o.value=Q(t.value.location.calendar_visible_from),V.value=Q(t.value.location.calendar_visible_to)},b=async function(){w();let m={calendar_visible_from:oe(o.value),calendar_visible_to:oe(V.value),location_id:t.value.location.id};await e.updateLocation(m).then(()=>{c(),z(r,{message:"Data aggiornata correttamente",error:!1}),o.value=he(o.value),V.value=he(V.value),f.value=!1}).catch(x=>{c(),A(r,x)})};return R(h,()=>{t.value.location_id=h.value[0].id}),{form:t,courseTable:n,calendar_visible_from:o,calendar_visible_to:V,active:f,locations:h,onChangeLocation:_,updateVisibility:b,formatPrettyDate:Q}},components:{CourseTable:Ne,OpeningsTable:zo,BookingExceptionTable:rt,ClosingsTable:yt}};const xt=l("h1",null,"Configurazioni",-1),Vt={class:"flex align-items-center justify-content-between"},Dt={class:"field col-3 flex flex-column"},Tt=l("label",{for:"location"},"Location",-1),St={class:"col-9 flex justify-content-end"},Et={class:"col-12 field"},At=l("label",{class:"ml-1"},"Finestra di visibilità",-1),Bt={class:"flex align-items-center mt-2 ml-0 pl-0 gap-5"};function Ut(t,e,n,o,V,w){var x;const c=u("Dropdown"),r=u("Calendar"),f=u("Inplace"),h=u("Card"),d=u("CourseTable"),k=u("TabPanel"),_=u("OpeningsTable"),s=u("BookingExceptionTable"),b=u("ClosingsTable"),m=u("TabView");return U(),N("div",null,[xt,l("div",Vt,[l("div",Dt,[Tt,a(c,{modelValue:o.form.location,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.location=i),options:o.locations,optionLabel:"name",placeholder:"",name:"location",onChange:e[1]||(e[1]=i=>o.onChangeLocation())},null,8,["modelValue","options"])]),l("div",St,[o.form.location?(U(),X(h,{key:0,style:{width:"30rem"}},{content:v(()=>[l("div",Et,[At,l("div",Bt,[a(f,{closable:!0,onClose:e[3]||(e[3]=i=>o.updateVisibility()),active:o.active},{display:v(()=>[F(" Dal: "+O(o.calendar_visible_from),1)]),content:v(()=>[a(r,{inputId:"date",modelValue:o.calendar_visible_from,"onUpdate:modelValue":e[2]||(e[2]=i=>o.calendar_visible_from=i),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"]),a(f,{closable:!0,onClose:e[5]||(e[5]=i=>o.updateVisibility()),active:o.active},{display:v(()=>[F(" Al: "+O(o.calendar_visible_to),1)]),content:v(()=>[a(r,{inputId:"date",modelValue:o.calendar_visible_to,"onUpdate:modelValue":e[4]||(e[4]=i=>o.calendar_visible_to=i),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"])])])]),_:1})):ae("",!0)])]),(x=o.form.location)!=null&&x.id?(U(),X(m,{key:0},{default:v(()=>[a(k,{header:"Percorsi"},{default:v(()=>{var i;return[a(d,{location_id:(i=o.form.location)==null?void 0:i.id,ref:"courseTable"},null,8,["location_id"])]}),_:1}),a(k,{header:"Aperture"},{default:v(()=>[a(_,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),a(k,{header:"Eccezioni"},{default:v(()=>[a(s,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),a(k,{header:"Chiusure"},{default:v(()=>[a(b,{location_id:o.form.location.id},null,8,["location_id"])]),_:1})]),_:1})):ae("",!0)])}const qt=K(wt,[["render",Ut]]);export{qt as default};
