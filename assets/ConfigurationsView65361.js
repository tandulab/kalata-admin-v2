import{u as ge}from"./location65361.js";import{u as ne,s as N,e as U}from"./helpers65361.js";import{A as ie,C as ae,z as le,B as se,o as q,l as k,a as J,c as B,i as M,_ as W,r as u,b as A,v as ee,w as g,g as s,f as i,h as F,t as R,x as re,p as X,e as I,F as P,D as $,q as L,y as K,s as ve}from"../index65361.js";import{u as be}from"./attraction65361.js";import{c as ce,a as Q}from"./index.esm65361.js";import{F as de}from"./vee-validate.esm65361.js";import{I as ue}from"./InputTextWithValidation65361.js";import{u as me}from"./category65361.js";import{e as te,g as Y,a as fe,b as _e}from"./formatData65361.js";import{D as he}from"./datetime65361.js";import"./_commonjsHelpers65361.js";/* empty css                                                                            */class Z{static async fetchAll(){return{courses:[{name:'Percorso "Gentile da Fabriano a Brescia"',tickets:[{name:"Biglietto intero",price:"8",id:"1",description:"-"},{name:"Biglietto ridotto",price:"6",id:"2",description:"Il biglietto ridotto è riservato a: visitatori di età compresa tra i 6 e i 25 anni, residenti nel Comune di Brescia"},{name:"Biglietto gratuito",price:"0",id:"3",description:"Il biglietto gratuito è riservato a: visitatori di età compresa tra 0 e 5 anni, persone con disabilità (con accompagnatore per chi lo necessita), titolari Abbonamento Musei Lombardia Valle d'Aosta e Formula Extra, guide turistiche abilitate, giornalisti accreditati (previa comunicazione all’indirizzo e-mail booking@kalata.it)"}],enabled:!0,id:1}]}}static async addCourse(e){return await ie("/admin/courses",e)}static async updateCourse(e){return await ae(`/admin/courses/${e.course.id}`,e)}static async deleteCourse(e){return await le(`/admin/courses/${e}`)}}const ke=se({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:t=>t.courses,responseCourses:t=>t.response_courses,getTotalCourses:t=>t.response_courses?t.response_courses.total:0,getCurrentCourse:t=>t.course},actions:{async fetchAllCourses(){await Z.fetchAll().then(t=>{this.response_courses=t,this.courses=t.courses})},async addCourse(t){await Z.addCourse(t).then()},async updateCourse(t){await Z.updateCourse(t).then()},async deleteCourse(t){await Z.deleteCourse(t).then()}}}),Ce={props:["course"],setup(t,e){q(()=>{t.course&&t.course.id?n.value=Object.assign({},t.course):(n.value.tickets=[],a())});const n=k({}),o=k([]),T=ce({name:Q().required("Nome percorso obbligatorio"),address:Q().required("Luogo di ritrovo obbligatorio"),price:Q().required("Importo biglietto obbligatorio")}),{showLoader:x,hideLoader:c}=ne(),d=J(),p=be(),v=me(),C=k(!1),_=B(()=>p.allAttractions),b=B(()=>v.allCategories),r=function(){x();const h=Object.assign({},n.value);h.ticket_configurations=[{price:h.price,name:"Biglietto intero"}];const V={attraction:h};p.addAttraction(V).then(()=>{c(),N(d,{message:"Bene aggiunto correttamente",error:!1}),e.emit("onSubmit")}).catch(E=>{c(),U(d,E)})},l=function(){x();const V={attraction:Object.assign({},n.value)};p.updateAttraction(V).then(()=>{c(),N(d,{message:"Chiusura modificata correttamente",error:!1}),e.emit("onSubmit")}).catch(E=>{c(),U(d,E)})},y=function(){n.value.id?l():r()},a=function(){let h={};h.price=0,n.value.tickets.unshift(h),o.value.push(n.value.tickets[0])};return M(b,()=>{n.value.category||(n.value.category=b.value[0])}),{form:n,schema:T,loading:C,editingRows:o,onSubmit:y,addTicket:a,attractions:_,categories:b}},components:{Form:de,InputTextWithValidation:ue}},ye={class:"formgrid grid mt-3"},xe={class:"field col-12"},we={class:"flex justify-content-end mt-4 mb-3"},Ve={class:"w-full"},De={class:"flex align-items-center justify-content-end mt-6"};function Se(t,e,n,o,T,x){const c=u("InputTextWithValidation"),d=u("Button"),p=u("InputText"),v=u("Column"),C=u("Textarea"),_=u("DataTable"),b=u("Form");return A(),ee(b,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:g(()=>[s("div",ye,[s("div",xe,[i(c,{name:"name",label:"Nome percorso*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.name=r)},null,8,["modelValue"])])]),s("div",we,[i(d,{label:"Tipologia biglietto",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[1]||(e[1]=r=>o.addTicket())})]),i(_,{value:o.form.tickets,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[2]||(e[2]=r=>o.editingRows=r),editMode:"row",dataKey:"id"},{empty:g(()=>[F(" Nessun biglietto trovato. ")]),default:g(()=>[i(v,{header:"Tipo biglietto",field:"name",style:{"min-width":"150px"}},{editor:g(({data:r,field:l})=>[i(p,{modelValue:r[l],"onUpdate:modelValue":y=>r[l]=y},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(v,{header:"Descrizione",field:"description"},{editor:g(({data:r,field:l})=>[s("div",Ve,[i(C,{modelValue:r[l],"onUpdate:modelValue":y=>r[l]=y,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),i(v,{header:"Prezzo",field:"price"},{body:g(({data:r})=>[F(" € "+R((+r.price).toFixed(2)),1)]),editor:g(({data:r,field:l})=>[i(p,{modelValue:r[l],"onUpdate:modelValue":y=>r[l]=y},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(v,{rowEditor:!0,style:{width:"10%","min-width":"8rem"},bodyStyle:"text-align:center"})]),_:1},8,["value","loading","editingRows"]),s("div",De,[i(d,{label:"Annulla",text:""}),i(d,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const Ee=W(Ce,[["render",Se]]),Te={setup(){q(()=>{x.value=!0,c.value={first:0,rows:e.value.rows,sortField:null,sortOrder:null},c.value.page=0,r()});const t=J(),e=k(),n=k(),o=k(),T=k(),x=k(!0),c=k(),d=k(0),p=k(!1),v=ke(),C=B(()=>v.responseCourses),_=re(),b=B(()=>_.submitDialog);function r(){x.value=!0,setTimeout(()=>{l()},Math.random()*1e3+250)}const l=async function(){await v.fetchAllCourses().then(()=>{x.value=!1}).catch(E=>{x.value=!1,U(t,E)})},y=function(E){o.value=E;let j="Sei sicuro di voler eliminare questo percorso?";_.setDialog("Elimina percorso","Elimina","Annulla",j),_.setBtnSubmit(!1),_.setDynamicDialogVisibility(!0)},a=async function(){await v.deleteCourse(o.value).then(()=>{x.value=!1,N(t,{message:"Percorso eliminato correttamente",error:!1}),r()}).catch(E=>{x.value=!1,U(t,E)})},h=function(){},V=function(E){T.value=E,p.value=!0};return M(b,E=>{E&&a()}),{dt:e,responseCourses:C,loading:x,totalRecords:d,lazyParams:c,op:n,visible:p,currentCourse:T,loadLazyData:r,onDeleteCourse:a,confirmDelete:y,addCourse:h,onEditCourse:V}},components:{CourseDialog:Ee}},Be={class:"flex justify-content-end mt-4 mb-3"},Ae={class:"flex justify-content-center"};function Ue(t,e,n,o,T,x){const c=u("Button"),d=u("Column"),p=u("InputSwitch"),v=u("DataTable"),C=u("CourseDialog"),_=u("Dialog"),b=X("tooltip");return A(),I(P,null,[s("div",Be,[i(c,{label:"Percorso",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=r=>o.onEditCourse({}))})]),i(v,{value:o.responseCourses.courses,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:g(()=>[F(" Nessun percorso trovato. ")]),default:g(()=>[i(d,{header:"Nome",field:"name"}),i(d,{header:"Tipologie biglietti"},{body:g(({data:r})=>[(A(!0),I(P,null,$(r.tickets,l=>(A(),I("div",{key:l.id},R(l.name),1))),128))]),_:1}),i(d,{header:"Prezzo"},{body:g(({data:r})=>[(A(!0),I(P,null,$(r.tickets,l=>(A(),I("div",{key:l.id}," € "+R((+l.price).toFixed(2)),1))),128))]),_:1}),i(d,{header:"Stato"},{body:g(({data:r})=>[i(p,{modelValue:r.enabled,"onUpdate:modelValue":l=>r.enabled=l},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(d,{header:""},{body:g(({data:r})=>[s("div",Ae,[L(i(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:l=>o.onEditCourse(r)},null,8,["onClick"]),[[b,"Modifica",void 0,{top:!0}]]),L(i(c,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:l=>o.confirmDelete(r.id)},null,8,["onClick"]),[[b,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),i(_,{visible:o.visible,"onUpdate:visible":e[1]||(e[1]=r=>o.visible=r),modal:"",header:"Modifica percorso",style:{width:"70rem"}},{default:g(()=>[i(C,{course:o.currentCourse},null,8,["course"])]),_:1},8,["visible"])],64)}const ze=W(Te,[["render",Ue]]);class G{static async fetchAll(e){return e?(await K("/admin/booking_rules",e)).data:{}}static async getCourses(e){return(await K("/admin/booking_rules/courses",e)).data}static async getTickets(e){return(await K("/admin/booking_rules/tickets",e)).data}static async addConfiguration(e){return await ie("/admin/booking_rules",e)}static async updateConfiguration(e){return await ae(`/admin/booking_rules/${e.booking_rule.id}`,e)}static async deleteConfiguration(e){return e==null?{}:await le(`/admin/booking_rules/${e}`)}}const oe=se({id:"configuration",state:()=>({configuration:{},configurations:[],response_configurations:{},response_courses:{},response_tickets:{}}),getters:{allConfigurations:t=>t.configurations,responseConfigurations:t=>t.response_configurations,getTotalConfigurations:t=>t.response_configurations?t.response_configurations.total:0,getCurrentConfiguration:t=>t.configuration,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets},actions:{async fetchAllConfigurations(t){await G.fetchAll(t).then(e=>{this.response_configurations=e,this.configurations=e.configurations})},async getAllCourses(t){await G.getCourses(t).then(e=>{this.response_courses=e})},async getAllTickets(t){await G.getTickets(t).then(e=>{this.response_tickets=e})},async addConfiguration(t){await G.addConfiguration(t).then()},async updateConfiguration(t){await G.updateConfiguration(t).then()},async deleteConfiguration(t){t!=null&&await G.deleteConfiguration(t).then()}}}),Ie={props:["config","location_id","course_id","duplicate"],setup(t,e){q(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.from_date&&(n.value.from_date=te(n.value.from_date)),n.value.to_date&&(n.value.to_date=te(n.value.to_date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_rule_slots=[]),w();let m={start_at:"",available_seats:"",id:"-1"};n.value.booking_rule_slots.push(m)});const n=k({}),o=k([]),T=k(!1),x=ce({name_config:Q().required("Nome configurazione obbligatoria")}),{showLoader:c,hideLoader:d}=ne(),p=J(),v=me(),C=k(!1),_=oe(),b=B(()=>v.allCategories),r=B(()=>_.responseTickets),l=B(()=>_.responseCourses),y=function(){c();const m=Object.assign({},n.value);m.from_date&&(m.from_date=Y(m.from_date)),m.to_date&&(m.to_date=Y(m.to_date)),m.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(f=>{f.available_seats!=""&&f.start_at!=""&&m.booking_rule_slots.push(f)});const D={booking_rule:m};_.addConfiguration(D).then(()=>{d(),N(p,{message:"Configurazione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(f=>{d(),U(p,f)})},a=function(){c();const m=Object.assign({},n.value);m.from_date&&(m.from_date=Y(m.from_date)),m.to_date&&(m.to_date=Y(m.to_date)),m.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(f=>{f.available_seats!=""&&f.start_at!=""&&m.booking_rule_slots.push(f)});const D={booking_rule:m};_.updateConfiguration(D).then(()=>{d(),N(p,{message:"Configurazione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(f=>{d(),U(p,f)})},h=function(){n.value.id?a():y()},V=function(){let m={};m.price=0,n.value.tickets.unshift(m),o.value.push(n.value.tickets[0])},E=function(m){let{newData:D,index:f}=m;n.value.booking_rule_slots[f]=D;let z={start_at:"",available_seats:"",id:+n.value.booking_rule_slots[n.value.booking_rule_slots.length-1].id-1};n.value.booking_rule_slots.push(z),o.value=[z]},j=function(m,D){n.value.booking_rule_slots.splice(D,1)},O=function(m){m?n.value.wdays=[0,1,2,3,4,5,6]:n.value.wdays=[]},w=function(){const m=new Map;m.set("location_id",n.value.location_id),m.set("course_id",n.value.course_id),_.getAllTickets(m).catch(D=>{U(p,D)})};return M(b,()=>{n.value.category||(n.value.category=b.value[0])}),{form:n,schema:x,loading:C,editingRows:o,check_all:T,onSubmit:h,addTicket:V,onRowEditSave:E,checkAll:O,deleteSlot:j,categories:b,responseCourses:l,responseTickets:r}},components:{Form:de,InputTextWithValidation:ue}};const Me={class:"formgrid grid mt-3"},Re={class:"field col-12"},je={class:"field flex flex-column col-6"},Le=s("label",{for:"location"},"Percorso",-1),Ne={class:"field col-3"},Fe=s("label",{from:"date_from"},"Dal",-1),Oe={class:"field col-3"},Pe=s("label",{from:"date_to"},"Al",-1),qe={class:"field col-12 mt-3"},We=s("label",null,"Giorni",-1),Ge={class:"card flex flex-wrap gap-3"},He={class:"flex align-items-center mr-4"},Ke=s("label",{for:"all",class:"ml-2"}," Tutti i giorni ",-1),Je={class:"flex align-items-center"},Qe=s("label",{for:"lun",class:"ml-2"}," Lun ",-1),Xe={class:"flex align-items-center"},Ye=s("label",{for:"mar",class:"ml-2"}," Mar ",-1),Ze={class:"flex align-items-center"},$e=s("label",{for:"mer",class:"ml-2"}," Mer ",-1),eo={class:"flex align-items-center"},oo=s("label",{for:"gio",class:"ml-2"}," Gio ",-1),to={class:"flex align-items-center"},no=s("label",{for:"ven",class:"ml-2"}," Ven ",-1),io={class:"flex align-items-center"},ao=s("label",{for:"sab",class:"ml-2"}," Sab ",-1),lo={class:"flex align-items-center"},so=s("label",{for:"dom",class:"ml-2"}," Dom ",-1),ro={class:"field col-3 mt-3"},co=s("label",null,"Biglietti",-1),uo=["for"],mo={class:"inline-block",style:{"min-width":"150px"}},_o={class:"text-right"},fo=s("div",{class:"col-9"},null,-1),po={class:"field col-8 mt-3"},go=s("label",null,"Orari",-1),vo={class:"flex justify-content-center"},bo={class:"flex align-items-center justify-content-end mt-6"};function ho(t,e,n,o,T,x){const c=u("InputTextWithValidation"),d=u("Dropdown"),p=u("Calendar"),v=u("Checkbox"),C=u("InputText"),_=u("Column"),b=u("Button"),r=u("DataTable"),l=u("Form"),y=X("tooltip");return A(),ee(l,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:g(()=>[s("div",Me,[s("div",Re,[i(c,{name:"name_config",label:"Nome configurazione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=a=>o.form.name=a),id:"name_config",type:"text"},null,8,["modelValue"])]),s("div",je,[Le,i(d,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.course_id=a),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location"},null,8,["modelValue","options"])]),s("div",Ne,[Fe,i(p,{inputId:"date_from",modelValue:o.form.from_date,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.from_date=a),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),s("div",Oe,[Pe,i(p,{inputId:"date_to",modelValue:o.form.to_date,"onUpdate:modelValue":e[3]||(e[3]=a=>o.form.to_date=a),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),s("div",qe,[We,s("div",Ge,[s("div",He,[i(v,{modelValue:o.check_all,"onUpdate:modelValue":[e[4]||(e[4]=a=>o.check_all=a),e[5]||(e[5]=a=>o.checkAll(a))],inputId:"all",name:"week",binary:!0},null,8,["modelValue"]),Ke]),s("div",Je,[i(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[6]||(e[6]=a=>o.form.wdays=a),inputId:"lun",name:"week",value:1},null,8,["modelValue"]),Qe]),s("div",Xe,[i(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[7]||(e[7]=a=>o.form.wdays=a),inputId:"mar",name:"week",value:2},null,8,["modelValue"]),Ye]),s("div",Ze,[i(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[8]||(e[8]=a=>o.form.wdays=a),inputId:"mer",name:"week",value:3},null,8,["modelValue"]),$e]),s("div",eo,[i(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[9]||(e[9]=a=>o.form.wdays=a),inputId:"gio",name:"week",value:4},null,8,["modelValue"]),oo]),s("div",to,[i(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[10]||(e[10]=a=>o.form.wdays=a),inputId:"ven",name:"week",value:5},null,8,["modelValue"]),no]),s("div",io,[i(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[11]||(e[11]=a=>o.form.wdays=a),inputId:"sab",name:"week",value:6},null,8,["modelValue"]),ao]),s("div",lo,[i(v,{modelValue:o.form.wdays,"onUpdate:modelValue":e[12]||(e[12]=a=>o.form.wdays=a),inputId:"dom",name:"week",value:0},null,8,["modelValue"]),so])])]),s("div",ro,[co,(A(!0),I(P,null,$(o.responseTickets.tickets,a=>(A(),I("div",{key:a.id,class:"flex align-items-center mb-2"},[i(v,{modelValue:o.form.booking_rule_ticket_ids,"onUpdate:modelValue":e[13]||(e[13]=h=>o.form.booking_rule_ticket_ids=h),inputId:a.id,name:"category",value:a.id},null,8,["modelValue","inputId","value"]),s("label",{for:a.id,class:"ml-2 flex align-items-center"},[s("div",mo,R(a.name),1),s("div",_o,"€ "+R(a.price),1)],8,uo)]))),128))]),fo,s("div",po,[go,i(r,{value:o.form.booking_rule_slots,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[14]||(e[14]=a=>o.editingRows=a),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:g(()=>[F(" Nessuno slot orario trovato. ")]),default:g(()=>[i(_,{header:"Ora",field:"start_at"},{editor:g(({data:a,field:h})=>[i(C,{modelValue:a[h],"onUpdate:modelValue":V=>a[h]=V},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(_,{header:"Posti",field:"available_seats"},{editor:g(({data:a,field:h})=>[i(C,{modelValue:a[h],"onUpdate:modelValue":V=>a[h]=V},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(_,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),i(_,{header:"",style:{width:"3rem","padding-left":"0"}},{body:g(({data:a,index:h})=>[s("div",vo,[L(i(b,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:V=>o.deleteSlot(a,h)},null,8,["onClick"]),[[y,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","editingRows","onRowEditSave"])])]),s("div",bo,[i(b,{label:"Annulla",text:""}),i(b,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const ko=W(Ie,[["render",ho]]),Co={props:["location_id"],setup(t){q(()=>{c.value=!0,d.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},d.value.page=0,t.location_id&&h(t.location_id)});const e=J(),n=k(),o=k(),T=k(),x=k(),c=k(!0),d=k(),p=k(0),v=k(!1),C=k(),_=k(!1),b=oe(),r=B(()=>b.responseConfigurations),l=re(),y=B(()=>l.submitDialog),a=B(()=>b.responseCourses),h=async function(f){const S=new Map;S.set("location_id",f),await b.getAllCourses(S).then(()=>{c.value=!1}).catch(z=>{c.value=!1,U(e,z)})},V=async function(f){if(!f)return;c.value=!0;const S=new Map;S.set("location_id",t.location_id),S.set("course_id",f),await b.fetchAllConfigurations(S).then(()=>{c.value=!1}).catch(z=>{c.value=!1,U(e,z)})},E=function(f){T.value=f;let S="Sei sicuro di voler eliminare questa configurazione?";l.setDialog("Elimina configurazione","Elimina","Annulla",S),l.setBtnSubmit(!1),l.setDynamicDialogVisibility(!0)},j=async function(){T.value&&await b.deleteConfiguration(T.value).then(()=>{c.value=!1,N(e,{message:"Configurazione eliminata correttamente",error:!1}),V(C.value)}).catch(f=>{c.value=!1,U(e,f)})},O=function(f,S){x.value=f,v.value=!0,_.value=S},w=function(f){return f.map(z=>he.local(2022,1,2+z).setLocale("it").toFormat("ccc")).join(", ")},m=function(f){V(f),v.value=!1},D=function(){return _.value?"Duplica configurazione":x.value&&x.value.id&&!_.value?"Modifica configurazione":"Nuova configurazione"};return M(y,f=>{y.value&&j()}),M(a,()=>{C.value=a.value.courses[0].id,V(C.value)}),M(t,()=>{t.location_id&&h(t.location_id)}),{dt:n,responseConfigurations:r,loading:c,totalRecords:p,lazyParams:d,op:o,visible:v,currentConfiguration:x,responseCourses:a,course_id:C,flag_duplicate:_,fromMMDDtoDDMM:te,onDeleteConfiguration:j,confirmDelete:E,onEditConfiguration:O,fetchAllConfigurations:V,convertWdays:w,closeDialog:m,getHeader:D}},components:{ConfigurationDialog:ko}},yo={class:"flex justify-content-between mt-4 mb-3"},xo={class:"field flex flex-column"},wo=s("label",{for:"location"},"Percorso",-1),Vo={class:"capitalize"},Do={class:"flex justify-content-center"};function So(t,e,n,o,T,x){const c=u("Dropdown"),d=u("Button"),p=u("Column"),v=u("InputSwitch"),C=u("DataTable"),_=u("ConfigurationDialog"),b=u("Dialog"),r=X("tooltip");return A(),I(P,null,[s("div",yo,[s("div",xo,[wo,i(c,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=l=>o.course_id=l),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=l=>o.fetchAllConfigurations(o.course_id))},null,8,["modelValue","options"])]),i(d,{label:"Configurazione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=l=>o.onEditConfiguration({},!1))})]),i(C,{value:o.responseConfigurations.booking_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:g(()=>[F(" Nessuna configurazione trovata. ")]),default:g(()=>[i(p,{header:"Nome",field:"name"}),i(p,{header:"Dal Al"},{body:g(({data:l})=>[F(R(o.fromMMDDtoDDMM(l.from_date))+" - "+R(o.fromMMDDtoDDMM(l.to_date)),1)]),_:1}),i(p,{header:"Valida il",field:"week"},{body:g(({data:l})=>[s("div",Vo,R(o.convertWdays(l.wdays)),1)]),_:1}),i(p,{header:"Stato"},{body:g(({data:l})=>[i(v,{modelValue:l.enabled,"onUpdate:modelValue":y=>l.enabled=y},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(p,{header:""},{body:g(({data:l})=>[s("div",Do,[L(i(d,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:y=>o.onEditConfiguration(l,!0)},null,8,["onClick"]),[[r,"Duplica",void 0,{top:!0}]]),L(i(d,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:y=>o.onEditConfiguration(l,!1)},null,8,["onClick"]),[[r,"Modifica",void 0,{top:!0}]]),L(i(d,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:y=>o.confirmDelete(l.id)},null,8,["onClick"]),[[r,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),i(b,{visible:o.visible,"onUpdate:visible":e[4]||(e[4]=l=>o.visible=l),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:g(()=>[i(_,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=l=>o.closeDialog(l)),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const Eo=W(Co,[["render",So]]);class H{static async fetchAll(e){return e?(await K("/admin/booking_exception_rules",e)).data:{}}static async getCourses(e){return(await K("/admin/booking_exception_rules/courses",e)).data}static async getTickets(e){return(await K("/admin/booking_exception_rules/tickets",e)).data}static async addBookingException(e){return await ie("/admin/booking_exception_rules",e)}static async updateBookingException(e){return await ae(`/admin/booking_exception_rules/${e.booking_rule.id}`,e)}static async deleteBookingException(e){return e==null?{}:await le(`/admin/booking_exception_rules/${e}`)}}const pe=se({id:"booking_exception",state:()=>({booking_exception:{},booking_exceptions:[],response_booking_exceptions:{},response_courses:{},response_tickets:{}}),getters:{allBookingExceptions:t=>t.booking_exceptions,responseBookingExceptions:t=>t.response_booking_exceptions,getTotalBookingExceptions:t=>t.response_booking_exceptions?t.response_booking_exceptions.total:0,getCurrentBookingException:t=>t.booking_exception,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets},actions:{async fetchAllBookingExceptions(t){await H.fetchAll(t).then(e=>{this.response_booking_exceptions=e,this.booking_exceptions=e.booking_exceptions})},async getAllCourses(t){await H.getCourses(t).then(e=>{this.response_courses=e})},async getAllTickets(t){await H.getTickets(t).then(e=>{this.response_tickets=e})},async addBookingException(t){await H.addBookingException(t).then()},async updateBookingException(t){await H.updateBookingException(t).then()},async deleteBookingException(t){t!=null&&await H.deleteBookingException(t).then()}}}),To={props:["config","location_id","course_id","duplicate"],setup(t,e){q(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.date&&(n.value.date=fe(n.value.date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_exception_rule_slots=[]),O();let w={start_at:"",available_seats:"",id:"-1"};n.value.booking_exception_rule_slots.push(w)});const n=k({}),o=k([]),T=ce({name:Q().required("Nome eccezione obbligatoria")}),{showLoader:x,hideLoader:c}=ne(),d=J(),p=me(),v=k(!1),C=oe(),_=pe(),b=B(()=>p.allCategories),r=B(()=>C.responseTickets),l=B(()=>C.responseCourses),y=function(){x();const w=Object.assign({},n.value);w.date&&(w.date=_e(w.date)),w.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(D=>{D.available_seats!=""&&D.start_at!=""&&w.booking_exception_rule_slots.push(D)});const m={booking_exception_rule:w};_.addBookingException(m).then(()=>{c(),N(d,{message:"Eccezione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(D=>{c(),U(d,D)})},a=function(){x();const w=Object.assign({},n.value);w.date&&(w.date=_e(w.date)),w.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(D=>{D.available_seats!=""&&D.start_at!=""&&w.booking_exception_rule_slots.push(D)});const m={booking_exception_rule:w};_.updateBookingException(m).then(()=>{c(),N(d,{message:"Eccezione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(D=>{c(),U(d,D)})},h=function(){n.value.id?a():y()},V=function(){let w={};w.price=0,n.value.tickets.unshift(w),o.value.push(n.value.tickets[0])},E=function(w){let{newData:m,index:D}=w;n.value.booking_exception_rule_slots[D]=m;let S={start_at:"",available_seats:"",id:+n.value.booking_exception_rule_slots[n.value.booking_exception_rule_slots.length-1].id-1};n.value.booking_exception_rule_slots.push(S),o.value=[S]},j=function(w,m){n.value.booking_exception_rule_slots.splice(m,1)},O=function(){const w=new Map;w.set("location_id",n.value.location_id),w.set("course_id",n.value.course_id),C.getAllTickets(w).catch(m=>{U(d,m)})};return M(b,()=>{n.value.category||(n.value.category=b.value[0])}),{form:n,schema:T,loading:v,editingRows:o,onSubmit:h,addTicket:V,onRowEditSave:E,deleteSlot:j,categories:b,responseTickets:r,responseCourses:l}},components:{Form:de,InputTextWithValidation:ue}},Bo={class:"formgrid grid mt-3"},Ao={class:"field col-12"},Uo={class:"field flex flex-column col-6"},zo=s("label",{for:"location"},"Percorso",-1),Io={class:"field col-3"},Mo=s("label",{from:"date"},"Il",-1),Ro=s("div",{class:"field col-3"},null,-1),jo={class:"field col-3 mt-3"},Lo=s("label",null,"Biglietti",-1),No=["for"],Fo={class:"inline-block",style:{"min-width":"150px"}},Oo={class:"text-right"},Po=s("div",{class:"col-9"},null,-1),qo={class:"field col-8 mt-3"},Wo=s("label",null,"Orari",-1),Go={class:"flex justify-content-center"},Ho={class:"flex align-items-center justify-content-end mt-6"};function Ko(t,e,n,o,T,x){const c=u("InputTextWithValidation"),d=u("Dropdown"),p=u("Calendar"),v=u("Checkbox"),C=u("InputText"),_=u("Column"),b=u("Button"),r=u("DataTable"),l=u("Form"),y=X("tooltip");return A(),ee(l,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:g(()=>[s("div",Bo,[s("div",Ao,[i(c,{name:"name",label:"Nome eccezione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=a=>o.form.name=a)},null,8,["modelValue"])]),s("div",Uo,[zo,i(d,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.course_id=a),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location"},null,8,["modelValue","options"])]),s("div",Io,[Mo,i(p,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.date=a),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),Ro,s("div",jo,[Lo,(A(!0),I(P,null,$(o.responseTickets.tickets,a=>(A(),I("div",{key:a.id,class:"flex align-items-center mb-2"},[i(v,{modelValue:o.form.booking_exception_rule_ticket_ids,"onUpdate:modelValue":e[3]||(e[3]=h=>o.form.booking_exception_rule_ticket_ids=h),inputId:a.id,name:"category",value:a.id},null,8,["modelValue","inputId","value"]),s("label",{for:a.id,class:"ml-2 flex align-items-center"},[s("div",Fo,R(a.name),1),s("div",Oo,"€ "+R(a.price),1)],8,No)]))),128))]),Po,s("div",qo,[Wo,i(r,{value:o.form.booking_exception_rule_slots,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[4]||(e[4]=a=>o.editingRows=a),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:g(()=>[F(" Nessuno slot orario trovato. ")]),default:g(()=>[i(_,{header:"Ora",field:"start_at"},{editor:g(({data:a,field:h})=>[i(C,{modelValue:a[h],"onUpdate:modelValue":V=>a[h]=V},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(_,{header:"Posti",field:"available_seats"},{editor:g(({data:a,field:h})=>[i(C,{modelValue:a[h],"onUpdate:modelValue":V=>a[h]=V},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(_,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),i(_,{header:"",style:{width:"3rem","padding-left":"0"}},{body:g(({data:a,index:h})=>[s("div",Go,[L(i(b,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:V=>o.deleteSlot(a,h)},null,8,["onClick"]),[[y,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])])]),s("div",Ho,[i(b,{label:"Annulla",text:""}),i(b,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const Jo=W(To,[["render",Ko]]),Qo={props:["location_id"],setup(t){q(()=>{if(c.value=!0,d.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},d.value.page=0,t.location_id){debugger;V(t.location_id)}});const e=J(),n=k(),o=k(),T=k(),x=k(),c=k(!0),d=k(),p=k(0),v=k(!1);k([]);const C=k(),_=k(!1),b=oe(),r=pe(),l=B(()=>r.responseBookingExceptions),y=re(),a=B(()=>y.submitDialog),h=B(()=>b.responseCourses),V=async function(f){const S=new Map;S.set("location_id",f),await b.getAllCourses(S).then(()=>{c.value=!1}).catch(z=>{c.value=!1,U(e,z)})},E=async function(f){if(!f)return;c.value=!0;const S=new Map;S.set("location_id",t.location_id),S.set("course_id",f),await r.fetchAllBookingExceptions(S).then(()=>{c.value=!1}).catch(z=>{c.value=!1,U(e,z)})},j=function(f){T.value=f;let S="Sei sicuro di voler eliminare questa eccezione?";y.setDialog("Elimina eccezione","Elimina","Annulla",S),y.setBtnSubmit(!1),y.setDynamicDialogVisibility(!0)},O=async function(){T.value&&await r.deleteBookingException(T.value).then(()=>{c.value=!1,N(e,{message:"Eccezione eliminata correttamente",error:!1}),E(C.value)}).catch(f=>{c.value=!1,U(e,f)})},w=function(f,S){x.value=f,v.value=!0,_.value=S},m=function(f){E(f),v.value=!1},D=function(){return _.value?"Duplica eccezione":x.value&&x.value.id&&!_.value?"Modifica eccezione":"Nuova eccezione"};return M(a,f=>{f&&O()}),M(h,()=>{C.value=h.value.courses[0].id,E(C.value)}),M(t,()=>{t.location_id&&V(t.location_id)}),{dt:n,responseBookingExceptions:l,loading:c,totalRecords:p,lazyParams:d,op:o,visible:v,currentConfiguration:x,responseCourses:h,course_id:C,flag_duplicate:_,onDeleteConfigurationException:O,confirmDelete:j,onEditConfiguration:w,getHeader:D,closeDialog:m,fetchAllBookingExceptions:E,formatPrettyDate:fe}},components:{BookingExceptionDialog:Jo}},Xo={class:"flex justify-content-between mt-4 mb-3"},Yo={class:"field flex flex-column"},Zo=s("label",{for:"location"},"Percorso",-1),$o={class:"flex justify-content-center"};function et(t,e,n,o,T,x){const c=u("Dropdown"),d=u("Button"),p=u("Column"),v=u("InputSwitch"),C=u("DataTable"),_=u("BookingExceptionDialog"),b=u("Dialog"),r=X("tooltip");return A(),I(P,null,[s("div",Xo,[s("div",Yo,[Zo,i(c,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=l=>o.course_id=l),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=l=>o.fetchAllBookingExceptions(o.course_id))},null,8,["modelValue","options"])]),i(d,{label:"Eccezione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=l=>o.onEditConfiguration({},!1))})]),i(C,{value:o.responseBookingExceptions.booking_exception_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:g(()=>[F(" Nessuna eccezione trovata. ")]),default:g(()=>[i(p,{header:"Nome",field:"name"}),i(p,{header:"Il"},{body:g(({data:l})=>[F(R(o.formatPrettyDate(l.date)),1)]),_:1}),i(p,{header:"Stato"},{body:g(({data:l})=>[i(v,{modelValue:l.enabled,"onUpdate:modelValue":y=>l.enabled=y},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(p,{header:""},{body:g(({data:l})=>[s("div",$o,[L(i(d,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:y=>o.onEditConfiguration(l,!0)},null,8,["onClick"]),[[r,"Duplica",void 0,{top:!0}]]),L(i(d,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:y=>o.onEditConfiguration(l,!1)},null,8,["onClick"]),[[r,"Modifica",void 0,{top:!0}]]),L(i(d,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:y=>o.confirmDelete(l.id)},null,8,["onClick"]),[[r,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),i(b,{visible:o.visible,"onUpdate:visible":e[4]||(e[4]=l=>o.visible=l),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:g(()=>[i(_,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=l=>o.closeDialog(l)),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const ot=W(Qo,[["render",et]]),tt={setup(){q(()=>{o()});const t=k({}),e=ge(),n=B(()=>e.allLocations),o=async function(){await e.fetchAllLocations()};return M(n,()=>{t.value.location_id=n.value[0].id}),{form:t,locations:n}},components:{CourseTable:ze,OpeningsTable:Eo,BookingExceptionTable:ot}},nt=s("h1",null,"Configurazioni",-1),it={class:"field col-3 flex flex-column"},at=s("label",{for:"location"},"Location",-1);function lt(t,e,n,o,T,x){const c=u("Dropdown"),d=u("CourseTable"),p=u("TabPanel"),v=u("OpeningsTable"),C=u("BookingExceptionTable"),_=u("TabView");return A(),I("div",null,[nt,s("div",it,[at,i(c,{modelValue:o.form.location_id,"onUpdate:modelValue":e[0]||(e[0]=b=>o.form.location_id=b),options:o.locations,optionLabel:"name",optionValue:"id",placeholder:"",name:"location"},null,8,["modelValue","options"])]),o.form.location_id?(A(),ee(_,{key:0},{default:g(()=>[i(p,{header:"Percorsi"},{default:g(()=>[i(d)]),_:1}),i(p,{header:"Aperture"},{default:g(()=>[i(v,{location_id:o.form.location_id},null,8,["location_id"])]),_:1}),i(p,{header:"Eccezioni"},{default:g(()=>[i(C,{location_id:o.form.location_id},null,8,["location_id"])]),_:1})]),_:1})):ve("",!0)])}const kt=W(tt,[["render",lt]]);export{kt as default};
