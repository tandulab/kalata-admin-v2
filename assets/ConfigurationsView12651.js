import{u as xe}from"./location12651.js";import{u as ie,e as B,s as O,f as Te}from"./helpers12651.js";import{y as G,A as ne,C as de,z as ue,B as me,o as K,l as C,a as J,u as Se,c as I,i as F,_ as Q,r as u,p as oe,b as U,v as ee,w as p,g as l,f as a,e as L,t as R,s as Z,h as P,q as W,x as _e,F as X,D as re}from"../index12651.js";import{c as fe,a as ge}from"./index.esm12651.js";import{F as pe}from"./vee-validate.esm12651.js";import{I as ve}from"./InputTextWithValidation12651.js";import{u as Ce}from"./category12651.js";import{d as ke,e as se,a as $,b as ae,g as ye}from"./formatData12651.js";import{D as Ee}from"./datetime12651.js";import"./attraction12651.js";import"./_commonjsHelpers12651.js";class le{static async fetchAll(e){return(await G(`/admin/locations/${e}/courses`)).data}static async addCourse(e){return(await ne(`/admin/locations/${e.location_id}/courses`,e)).data.course}static async updateCourse(e){return(await de(`/admin/locations/${e.location_id}/courses/${e.course.id}`,e)).data.course}static async deleteCourse(e){return await ue(`/admin/courses/${e}`)}}const we=me({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:t=>t.courses,responseCourses:t=>t.response_courses,getTotalCourses:t=>t.response_courses?t.response_courses.total:0,getCurrentCourse:t=>t.course},actions:{async fetchAllCourses(t){await le.fetchAll(t).then(e=>{this.response_courses=e,this.courses=e.courses})},async addCourse(t){await le.addCourse(t).then(e=>{this.course=e})},async updateCourse(t){await le.updateCourse(t).then(e=>{this.course=e})},async deleteCourse(t){await le.deleteCourse(t).then()}}});class ce{static async fetchAll(e){return(await G(`/admin/courses/${e}/tickets`)).data}static async addTicket(e){return await ne(`/admin/courses/${e.course_id}/tickets`,e)}static async updateTicket(e){return await de(`/admin/courses/${e.course_id}/tickets/${e.ticket.id}`,e)}static async deleteTicket(e){return await ue(`/admin/courses/${e.course_id}/tickets/${e.ticket_id}`)}}const Ae=me({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{}}),getters:{allTickets:t=>t.tickets,responseTickets:t=>t.response_tickets,getTotalTickets:t=>t.response_tickets?t.response_tickets.total:0,getCurrentTicket:t=>t.ticket},actions:{async fetchAllTickets(t){await ce.fetchAll(t).then(e=>{this.response_tickets=e,this.tickets=e.tickets})},async addTicket(t){await ce.addTicket(t).then()},async updateTicket(t){await ce.updateTicket(t).then()},async deleteTicket(t){await ce.deleteTicket(t).then()}}}),Be={props:["course","location_id"],setup(t,e){K(()=>{t.course&&t.course.id?(n.value=Object.assign({},t.course),j()):n.value.translations={it:{name:{id:null,text:""},description:{id:null,text:""}},en:{name:{id:null,text:""},description:{id:null,text:""}}},n.value.tickets=[]});const n=C({}),o=C([]),w=C("it"),x=fe({name:ge().required("Nome percorso obbligatorio")}),{showLoader:r,hideLoader:c}=ie(),m=J(),b=we(),g=Ce(),_=Ae(),f=Se(),s=C(!1),h=I(()=>b.allCourses),E=I(()=>g.allCategories),d=I(()=>_.responseTickets),i=I(()=>b.getCurrentCourse),y=I(()=>f.languages),D=function(S){r(),b.addCourse(S).then(()=>{c(),O(m,{message:"Percorso aggiunto correttamente",error:!1}),e.emit("onSubmit")}).catch(A=>{c(),B(m,A)})},j=async function(){let S=t.course.id?t.course.id:i.value.id;r(),await _.fetchAllTickets(S).then(()=>{c()}).catch(A=>{c(),B(m,A)})},M=function(S){r(),b.updateCourse(S).then(()=>{c(),O(m,{message:"Percorso modificato correttamente",error:!1}),e.emit("onSubmit")}).catch(A=>{c(),B(m,A)})},z=function(){const S=Object.assign({},n.value);let A={it:{name:S.translations.it.name.text,description:S.translations.it.description.text},en:{name:S.translations.en.name.text,description:S.translations.en.description.text}};S.translations=A,S.name=S.translations.it.name,S.description=S.translations.it.description;const q={course:S,location_id:t.location_id};n.value.id?M(q):D(q)},T=function(){let A={translations:{en:{name:{text:"",id:null},description:{text:"",id:null}},it:{name:{text:"",id:null},description:{text:"",id:null}}},price:0};n.value.tickets.push(A),o.value.push(A)},k=function(S,A){S.id?v(S):n.value.tickets.splice(A,1)},v=async function(S){const A={course_id:t.course.id?t.course.id:i.value.id,ticket_id:S.id};r(),await _.deleteTicket(A).then(()=>{c(),O(m,{message:"Biglietto eliminato correttamente",error:!1}),j()}).catch(q=>{c(),B(m,q)})},V=function(S){let{newData:A,index:q}=S;n.value.tickets[q]=A;let De={it:{name:A.translations.it.name.text,description:A.translations.it.description.text},en:{name:A.translations.en.name.text,description:A.translations.en.description.text}};A.translations=De,A.name=A.translations.it.name,A.description=A.translations.it.description,A.id?Y(A):N(A)},N=async function(S){const A={course_id:t.course.id?t.course.id:i.value.id,ticket:S};await _.addTicket(A).then(()=>{c(),O(m,{message:"Biglietto aggiunto correttamente",error:!1}),j()}).catch(q=>{c(),B(m,q)})},Y=async function(S){const A={course_id:t.course.id?t.course.id:i.value.id,ticket:S};await _.updateTicket(A).then(()=>{c(),O(m,{message:"Biglietto aggiornato correttamente",error:!1}),j()}).catch(q=>{c(),B(m,q)})},Ve=function(S){let A={it:{name:S.translations.it.name.text,description:S.translations.it.description.text},en:{name:S.translations.en.name.text,description:S.translations.en.description.text}};S.translations=A,S.id?Y(S):N(S)};return F(E,()=>{n.value.category||(n.value.category=E.value[0])}),F(d,()=>{d.value&&d.value.tickets.length>0&&(n.value.tickets=Object.assign([],d.value.tickets))}),F(i,()=>{n.value=Object.assign({},i.value)}),{form:n,schema:x,loading:s,editingRows:o,response_tickets:d,lang_selected:w,onSubmit:z,addTicket:T,onDeleteTicket:k,onRowEditSave:V,updateTicketsApi:Y,onPublicTicket:Ve,courses:h,categories:E,languages:y}},components:{Form:pe,InputTextWithValidation:ve}},Ue={class:"col-12 flex justify-content-end m-0 p-0 align-items-center"},Ie={key:0,class:"formgrid grid mt-3"},je={class:"field col-12"},ze={class:"field col-12"},Me={for:"description"},Re={key:1,class:"flex justify-content-end mt-4 mb-3"},Le={key:0},Ne={key:0},Oe={class:"w-full"},Fe={class:"flex justify-content-center"},Pe={class:"flex align-items-center justify-content-end mt-6"};function We(t,e,n,o,w,x){const r=u("Dropdown"),c=u("InputTextWithValidation"),m=u("Textarea"),b=u("Button"),g=u("InputText"),_=u("Column"),f=u("InputSwitch"),s=u("DataTable"),h=u("Form"),E=oe("tooltip");return U(),ee(h,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:p(()=>[l("div",Ue,[a(r,{options:o.languages,optionLabel:"name",optionValue:"value",class:"m-2 capitalize dropdown-lng",modelValue:o.lang_selected,"onUpdate:modelValue":e[0]||(e[0]=d=>o.lang_selected=d)},null,8,["options","modelValue"])]),o.lang_selected&&o.form&&o.form.translations?(U(),L("div",Ie,[l("div",je,[a(c,{name:"name",label:"Nome percorso* ("+o.lang_selected.toUpperCase()+")",modelValue:o.form.translations[o.lang_selected].name.text,"onUpdate:modelValue":e[1]||(e[1]=d=>o.form.translations[o.lang_selected].name.text=d)},null,8,["label","modelValue"])]),l("div",ze,[l("label",Me,"Descrizione ("+R(o.lang_selected.toUpperCase())+")",1),a(m,{rows:"5",cols:"30",name:"description",id:"description",label:"Nome percorso*",modelValue:o.form.translations[o.lang_selected].description.text,"onUpdate:modelValue":e[2]||(e[2]=d=>o.form.translations[o.lang_selected].description.text=d),class:"w-full"},null,8,["modelValue"])])])):Z("",!0),o.form.id?(U(),L("div",Re,[a(b,{label:"Tipologia biglietto",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[3]||(e[3]=d=>o.addTicket())})])):Z("",!0),o.form.id&&o.lang_selected?(U(),ee(s,{key:2,value:o.form.tickets,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[4]||(e[4]=d=>o.editingRows=d),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:p(()=>[P(" Nessun biglietto trovato. ")]),default:p(()=>[a(_,{header:"Tipo biglietto",style:{"min-width":"150px"},field:"name"},{body:p(({data:d})=>{var i;return[d.translations[o.lang_selected].name?(U(),L("span",Le,R((i=d.translations[o.lang_selected].name)==null?void 0:i.text),1)):Z("",!0)]}),editor:p(({data:d,field:i})=>[a(g,{modelValue:d.translations[o.lang_selected][i].text,"onUpdate:modelValue":y=>d.translations[o.lang_selected][i].text=y,name:"ticket_name_"+o.lang_selected,id:"ticket_name_"+o.lang_selected,type:"text"},null,8,["modelValue","onUpdate:modelValue","name","id"])]),_:1}),a(_,{header:"Descrizione",field:"description"},{body:p(({data:d})=>{var i;return[d.translations[o.lang_selected].description?(U(),L("span",Ne,R((i=d.translations[o.lang_selected].description)==null?void 0:i.text),1)):Z("",!0)]}),editor:p(({data:d,field:i})=>[l("div",Oe,[a(m,{modelValue:d.translations[o.lang_selected][i].text,"onUpdate:modelValue":y=>d.translations[o.lang_selected][i].text=y,class:"w-full",name:"desc_"+o.lang_selected},null,8,["modelValue","onUpdate:modelValue","name"])])]),_:1}),a(_,{header:"Prezzo",field:"price",bodyStyle:"min-width: 6rem"},{body:p(({data:d})=>[P(" € "+R((+d.price).toFixed(2)),1)]),editor:p(({data:d,field:i})=>[a(g,{modelValue:d[i],"onUpdate:modelValue":y=>d[i]=y},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(_,{header:"Stato",field:"public",bodyStyle:"min-width: 6rem"},{body:p(({data:d,field:i})=>[a(f,{modelValue:d[i],"onUpdate:modelValue":y=>d[i]=y,onChange:y=>o.onPublicTicket(d)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),editor:p(({data:d,field:i})=>[a(f,{modelValue:d[i],"onUpdate:modelValue":y=>d[i]=y},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(_,{rowEditor:!0,bodyStyle:"text-align:center; padding-right:0;min-width: 6rem"}),a(_,{header:"",style:{width:"3rem","padding-left":"0"}},{body:p(({data:d,index:i})=>[l("div",Fe,[W(a(b,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:y=>o.onDeleteTicket(d,i)},null,8,["onClick"]),[[E,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])):Z("",!0),l("div",Pe,[a(b,{label:"Annulla",text:"",onClick:e[5]||(e[5]=d=>t.$emit("onClose"))}),a(b,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const qe=Q(Be,[["render",We]]),He={props:["location_id"],setup(t){K(()=>{x.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,h()});const e=J(),n=C(),o=C(),w=C(),x=C(!0),r=C(),c=C(0),m=C(!1),{showLoader:b,hideLoader:g}=ie(),_=we(),f=I(()=>_.responseCourses),s=_e();I(()=>s.submitDialog);function h(){b(),setTimeout(()=>{E()},Math.random()*1e3+250)}const E=async function(){x.value=!0,await _.fetchAllCourses(t.location_id).then(()=>{x.value=!1,g()}).catch(M=>{x.value=!1,g(),B(e,M)})},d=function(M){w.value=M,m.value=!0},i=function(M){w.value=M;let z="Sei sicuro di voler archiviare questo percorso?";s.setDialog("Archivia percorso","Archivia","Annulla",z),s.setBtnSubmit(!1),s.setDynamicDialogVisibility(!0)},y=function(M){const z=Object.assign({},M);let T={it:{name:z.translations.it.name.text,description:z.translations.it.description.text},en:{name:z.translations.en.name.text,description:z.translations.en.description.text}};z.translations=T;const k={course:z,location_id:t.location_id};_.updateCourse(k).then(()=>{g(),O(e,{message:"Percorso modificato correttamente",error:!1}),E()}).catch(v=>{g(),B(e,v)})},D=function(){return w.value&&w.value.id?"Modifica percorso":"Aggiungi percorso"},j=function(){E(),m.value=!1};return F(t,()=>{t.location_id&&E()}),{dt:n,responseCourses:f,loading:x,totalRecords:c,lazyParams:r,op:o,visible:m,currentCourse:w,loadLazyData:h,onEditCourse:d,closeDialog:j,getHeader:D,updateCourse:y,onArchiveCourse:i}},components:{CourseDialog:qe}},Ge={class:"flex justify-content-end mt-4 mb-3"},Ke={class:"flex justify-content-center"};function Je(t,e,n,o,w,x){const r=u("Button"),c=u("Column"),m=u("InputSwitch"),b=u("DataTable"),g=u("CourseDialog"),_=u("Dialog"),f=oe("tooltip");return U(),L(X,null,[l("div",Ge,[a(r,{label:"Percorso",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=s=>o.onEditCourse({}))})]),a(b,{value:o.responseCourses.courses,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:p(()=>[P(" Nessun percorso trovato. ")]),default:p(()=>[a(c,{header:"Nome"},{body:p(({data:s})=>{var h;return[P(R((h=s.translations.it.name)==null?void 0:h.text),1)]}),_:1}),a(c,{header:"Tipologie biglietti"},{body:p(({data:s})=>[(U(!0),L(X,null,re(s.tickets,h=>{var E;return U(),L("div",{key:h.id},R((E=h.translations.it.name)==null?void 0:E.text),1)}),128))]),_:1}),a(c,{header:"Prezzo"},{body:p(({data:s})=>[(U(!0),L(X,null,re(s.tickets,h=>(U(),L("div",{key:h.id}," € "+R((+h.price).toFixed(2)),1))),128))]),_:1}),a(c,{header:"Stato"},{body:p(({data:s})=>[a(m,{modelValue:s.public,"onUpdate:modelValue":h=>s.public=h,onChange:h=>o.updateCourse(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(c,{header:""},{body:p(({data:s})=>[l("div",Ke,[W(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.onEditCourse(s),class:"mr-2"},null,8,["onClick"]),[[f,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(_,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=s=>o.visible=s),modal:"",header:o.getHeader(),style:{width:"70rem"},onHide:e[4]||(e[4]=s=>o.closeDialog())},{default:p(()=>[a(g,{course:o.currentCourse,location_id:n.location_id,onOnSubmit:e[1]||(e[1]=s=>o.closeDialog()),onOnClose:e[2]||(e[2]=s=>o.closeDialog())},null,8,["course","location_id"])]),_:1},8,["visible","header"])],64)}const Qe=Q(He,[["render",Je]]);class te{static async fetchAll(e){return e?(await G("/admin/booking_rules",e)).data:{}}static async getCourses(e){return(await G("/admin/booking_rules/courses",e)).data}static async getTickets(e){return(await G("/admin/booking_rules/tickets",e)).data}static async addConfiguration(e){return await ne("/admin/booking_rules",e)}static async updateConfiguration(e){return await de(`/admin/booking_rules/${e.booking_rule.id}`,e)}static async deleteConfiguration(e){return e==null?{}:await ue(`/admin/booking_rules/${e}`)}}const be=me({id:"configuration",state:()=>({configuration:{},configurations:[],response_configurations:{},response_courses:{},response_tickets:{}}),getters:{allConfigurations:t=>t.configurations,responseConfigurations:t=>t.response_configurations,getTotalConfigurations:t=>t.response_configurations?t.response_configurations.total:0,getCurrentConfiguration:t=>t.configuration,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets},actions:{async fetchAllConfigurations(t){await te.fetchAll(t).then(e=>{this.response_configurations=e,this.configurations=e.configurations})},async getAllCourses(t){await te.getCourses(t).then(e=>{this.response_courses=Te(e)})},async getAllTickets(t){await te.getTickets(t).then(e=>{this.response_tickets=e})},async addConfiguration(t){await te.addConfiguration(t).then()},async updateConfiguration(t){await te.updateConfiguration(t).then()},async deleteConfiguration(t){t!=null&&await te.deleteConfiguration(t).then()}}}),Xe={props:["config","location_id","course_id","duplicate"],setup(t,e){K(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.from_date&&(n.value.from_date=ke(n.value.from_date)),n.value.to_date&&(n.value.to_date=ke(n.value.to_date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_rule_slots=[]),T()});const n=C({}),o=C([]),w=C(!1),x=fe({name_config:ge().required("Nome configurazione obbligatoria")}),{showLoader:r,hideLoader:c}=ie(),m=J(),b=Ce(),g=C(!1),_=be(),f=I(()=>b.allCategories),s=I(()=>_.responseTickets),h=I(()=>_.responseCourses),E=function(){r();const k=Object.assign({},n.value);k.from_date&&(k.from_date=se(k.from_date)),k.to_date&&(k.to_date=se(k.to_date)),k.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(V=>{V.available_seats!=""&&V.start_at!=""&&k.booking_rule_slots.push(V)});const v={booking_rule:k};_.addConfiguration(v).then(()=>{c(),O(m,{message:"Configurazione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(V=>{c(),B(m,V)})},d=function(){r();const k=Object.assign({},n.value);k.from_date&&(k.from_date=se(k.from_date)),k.to_date&&(k.to_date=se(k.to_date)),k.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(V=>{V.available_seats!=""&&V.start_at!=""&&k.booking_rule_slots.push(V)});const v={booking_rule:k};_.updateConfiguration(v).then(()=>{c(),O(m,{message:"Configurazione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(V=>{c(),B(m,V)})},i=function(){n.value.id?d():E()},y=function(){let k={};k.price=0,n.value.tickets.unshift(k),o.value.push(n.value.tickets[0])},D=function(k){let{newData:v,index:V}=k;n.value.booking_rule_slots[V]=v;let Y={start_at:"",available_seats:"",id:+n.value.booking_rule_slots[n.value.booking_rule_slots.length-1].id-1};n.value.booking_rule_slots.push(Y),o.value=[Y]},j=function(){let k={start_at:"",available_seats:"",id:"-1"};n.value.booking_rule_slots.push(k),o.value.push(k)},M=function(k,v){n.value.booking_rule_slots.splice(v,1)},z=function(k){k?n.value.wdays=[0,1,2,3,4,5,6]:n.value.wdays=[]},T=function(){const k=new Map;k.set("location_id",n.value.location_id),k.set("course_id",n.value.course_id),_.getAllTickets(k).catch(v=>{B(m,v)})};return F(f,()=>{n.value.category||(n.value.category=f.value[0])}),{form:n,schema:x,loading:g,editingRows:o,check_all:w,onSubmit:i,addTicket:y,onRowEditSave:D,checkAll:z,deleteSlot:M,addSlot:j,fetchAllTickets:T,categories:f,responseCourses:h,responseTickets:s}},components:{Form:pe,InputTextWithValidation:ve}};const Ye={class:"formgrid grid mt-3"},Ze={class:"field col-12"},$e={class:"field flex flex-column col-6"},eo=l("label",{for:"location"},"Percorso",-1),oo={class:"field col-3"},to=l("label",{from:"date_from"},"Dal",-1),no={class:"field col-3"},io=l("label",{from:"date_to"},"Al",-1),ao={class:"field col-12 mt-3"},so=l("label",null,"Giorni",-1),lo={class:"card flex flex-wrap gap-3 mt-2"},co={class:"flex align-items-center mr-4"},ro=l("label",{for:"all",class:"ml-2"}," Tutti i giorni ",-1),uo={class:"flex align-items-center"},mo=l("label",{for:"lun",class:"ml-2"}," Lun ",-1),_o={class:"flex align-items-center"},fo=l("label",{for:"mar",class:"ml-2"}," Mar ",-1),go={class:"flex align-items-center"},po=l("label",{for:"mer",class:"ml-2"}," Mer ",-1),vo={class:"flex align-items-center"},bo=l("label",{for:"gio",class:"ml-2"}," Gio ",-1),ho={class:"flex align-items-center"},ko=l("label",{for:"ven",class:"ml-2"}," Ven ",-1),Co={class:"flex align-items-center"},yo=l("label",{for:"sab",class:"ml-2"}," Sab ",-1),xo={class:"flex align-items-center"},wo=l("label",{for:"dom",class:"ml-2"}," Dom ",-1),Vo={class:"field col-3 mt-3"},Do=l("label",null,"Biglietti",-1),To={for:"ticket.id",class:"ml-2 flex align-items-center"},So={class:"inline-block",style:{"min-width":"150px"}},Eo={class:"text-right"},Ao=l("div",{class:"col-9"},null,-1),Bo={class:"col-8 mt-3"},Uo={class:"field flex justify-content-between align-items-end mt-4 mb-3"},Io=l("label",null,"Orari",-1),jo={class:"flex justify-content-center"},zo={class:"flex align-items-center justify-content-end mt-6"};function Mo(t,e,n,o,w,x){const r=u("InputTextWithValidation"),c=u("Dropdown"),m=u("Calendar"),b=u("Checkbox"),g=u("Button"),_=u("InputMask"),f=u("Column"),s=u("InputNumber"),h=u("DataTable"),E=u("Form"),d=oe("tooltip");return U(),ee(E,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:p(()=>[l("div",Ye,[l("div",Ze,[a(r,{name:"name_config",label:"Nome configurazione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.name=i),id:"name_config",type:"text"},null,8,["modelValue"])]),l("div",$e,[eo,a(c,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.course_id=i),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[2]||(e[2]=i=>o.fetchAllTickets())},null,8,["modelValue","options"])]),l("div",oo,[to,a(m,{inputId:"date_from",modelValue:o.form.from_date,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.from_date=i),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),l("div",no,[io,a(m,{inputId:"date_to",modelValue:o.form.to_date,"onUpdate:modelValue":e[4]||(e[4]=i=>o.form.to_date=i),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),l("div",ao,[so,l("div",lo,[l("div",co,[a(b,{modelValue:o.check_all,"onUpdate:modelValue":[e[5]||(e[5]=i=>o.check_all=i),e[6]||(e[6]=i=>o.checkAll(i))],inputId:"all",name:"week",binary:!0},null,8,["modelValue"]),ro]),l("div",uo,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[7]||(e[7]=i=>o.form.wdays=i),inputId:"lun",name:"week",value:1},null,8,["modelValue"]),mo]),l("div",_o,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[8]||(e[8]=i=>o.form.wdays=i),inputId:"mar",name:"week",value:2},null,8,["modelValue"]),fo]),l("div",go,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[9]||(e[9]=i=>o.form.wdays=i),inputId:"mer",name:"week",value:3},null,8,["modelValue"]),po]),l("div",vo,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[10]||(e[10]=i=>o.form.wdays=i),inputId:"gio",name:"week",value:4},null,8,["modelValue"]),bo]),l("div",ho,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[11]||(e[11]=i=>o.form.wdays=i),inputId:"ven",name:"week",value:5},null,8,["modelValue"]),ko]),l("div",Co,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[12]||(e[12]=i=>o.form.wdays=i),inputId:"sab",name:"week",value:6},null,8,["modelValue"]),yo]),l("div",xo,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[13]||(e[13]=i=>o.form.wdays=i),inputId:"dom",name:"week",value:0},null,8,["modelValue"]),wo])])]),l("div",Vo,[Do,(U(!0),L(X,null,re(o.responseTickets.tickets,i=>{var y;return U(),L("div",{key:i.id,class:"flex align-items-center mb-2 mt-2"},[a(b,{modelValue:o.form.booking_rule_ticket_ids,"onUpdate:modelValue":e[14]||(e[14]=D=>o.form.booking_rule_ticket_ids=D),inputId:i.id+"",value:i.id},null,8,["modelValue","inputId","value"]),l("label",To,[l("div",So,R((y=i.translations)==null?void 0:y.it.name.text),1),l("div",Eo,"€ "+R(i.price),1)])])}),128))]),Ao,l("div",Bo,[l("div",Uo,[Io,a(g,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[15]||(e[15]=i=>o.addSlot())})]),a(h,{value:o.form.booking_rule_slots,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[16]||(e[16]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:p(()=>[P(" Nessuno slot orario trovato. ")]),default:p(()=>[a(f,{header:"Ora",field:"start_at"},{editor:p(({data:i,field:y})=>[a(_,{id:"basic",modelValue:i[y],"onUpdate:modelValue":D=>i[y]=D,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(f,{header:"Posti",field:"available_seats"},{editor:p(({data:i,field:y})=>[a(s,{modelValue:i[y],"onUpdate:modelValue":D=>i[y]=D,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(f,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),a(f,{header:"",style:{width:"3rem","padding-left":"0"}},{body:p(({data:i,index:y})=>[l("div",jo,[W(a(g,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:D=>o.deleteSlot(i,y)},null,8,["onClick"]),[[d,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","editingRows","onRowEditSave"])])]),l("div",zo,[a(g,{label:"Annulla",text:"",onClick:e[17]||(e[17]=i=>t.$emit("onClose"))}),a(g,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const Ro=Q(Xe,[["render",Mo]]),Lo={props:["location_id"],setup(t){K(()=>{r.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,t.location_id&&i(t.location_id)});const e=J(),n=C(),o=C(),w=C(),x=C(),r=C(!0),c=C(),m=C(0),b=C(!1),g=C(),_=C(!1),f=be(),s=I(()=>f.responseConfigurations),h=_e(),E=I(()=>h.submitDialog),d=I(()=>f.responseCourses),i=async function(v){const V=new Map;V.set("location_id",v),await f.getAllCourses(V).then(()=>{r.value=!1}).catch(N=>{r.value=!1,B(e,N)})},y=async function(v){if(!v)return;r.value=!0;const V=new Map;V.set("location_id",t.location_id),V.set("course_id",v),await f.fetchAllConfigurations(V).then(()=>{r.value=!1}).catch(N=>{r.value=!1,B(e,N)})},D=function(v){w.value=v;let V="Sei sicuro di voler eliminare questa configurazione?";h.setDialog("Elimina configurazione","Elimina","Annulla",V),h.setBtnSubmit(!1),h.setDynamicDialogVisibility(!0)},j=async function(){w.value&&await f.deleteConfiguration(w.value).then(()=>{r.value=!1,O(e,{message:"Configurazione eliminata correttamente",error:!1}),y(g.value)}).catch(v=>{r.value=!1,B(e,v)})},M=function(v,V){x.value=v,b.value=!0,_.value=V},z=function(v){return v.map(N=>Ee.local(2022,1,2+N).setLocale("it").toFormat("ccc")).join(", ")},T=function(v){y(v),b.value=!1},k=function(){return _.value?"Duplica configurazione":x.value&&x.value.id&&!_.value?"Modifica configurazione":"Nuova configurazione"};return F(E,v=>{E.value&&j()}),F(d,()=>{d.value.courses&&d.value.courses[0]&&(g.value=d.value.courses[0].id,y(g.value))}),F(t,()=>{t.location_id&&i(t.location_id)}),{dt:n,responseConfigurations:s,loading:r,totalRecords:m,lazyParams:c,op:o,visible:b,currentConfiguration:x,responseCourses:d,course_id:g,flag_duplicate:_,fromMMDDtoDDMM:ke,onDeleteConfiguration:j,confirmDelete:D,onEditConfiguration:M,fetchAllConfigurations:y,convertWdays:z,closeDialog:T,getHeader:k}},components:{ConfigurationDialog:Ro}},No={class:"flex justify-content-between mt-4 mb-3"},Oo={class:"field flex flex-column"},Fo=l("label",{for:"location"},"Percorso",-1),Po={class:"capitalize"},Wo={class:"flex justify-content-center"};function qo(t,e,n,o,w,x){const r=u("Dropdown"),c=u("Button"),m=u("Column"),b=u("DataTable"),g=u("ConfigurationDialog"),_=u("Dialog"),f=oe("tooltip");return U(),L(X,null,[l("div",No,[l("div",Oo,[Fo,a(r,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=s=>o.course_id=s),options:o.responseCourses.courses,optionLabel:"translations.it.name.text",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=s=>o.fetchAllConfigurations(o.course_id))},null,8,["modelValue","options"])]),a(c,{label:"Configurazione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=s=>o.onEditConfiguration({},!1))})]),a(b,{value:o.responseConfigurations.booking_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:p(()=>[P(" Nessuna configurazione trovata. ")]),default:p(()=>[a(m,{header:"Nome",field:"name"}),a(m,{header:"Dal Al"},{body:p(({data:s})=>[P(R(o.fromMMDDtoDDMM(s.from_date))+" - "+R(o.fromMMDDtoDDMM(s.to_date)),1)]),_:1}),a(m,{header:"Valida il",field:"week"},{body:p(({data:s})=>[l("div",Po,R(o.convertWdays(s.wdays)),1)]),_:1}),a(m,{header:""},{body:p(({data:s})=>[l("div",Wo,[W(a(c,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.onEditConfiguration(s,!0)},null,8,["onClick"]),[[f,"Duplica",void 0,{top:!0}]]),W(a(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.onEditConfiguration(s,!1)},null,8,["onClick"]),[[f,"Modifica",void 0,{top:!0}]]),W(a(c,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.confirmDelete(s.id)},null,8,["onClick"]),[[f,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(_,{visible:o.visible,"onUpdate:visible":e[5]||(e[5]=s=>o.visible=s),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:p(()=>[a(g,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=s=>o.closeDialog(s)),onOnClose:e[4]||(e[4]=s=>o.visible=!1),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const Ho=Q(Lo,[["render",qo]]);class H{static async fetchAll(e){return e?(await G("/admin/booking_exception_rules",e)).data:{}}static async getCourses(e){return(await G("/admin/booking_exception_rules/courses",e)).data}static async getTickets(e){return(await G("/admin/booking_exception_rules/tickets",e)).data}static async addBookingException(e){return await ne("/admin/booking_exception_rules",e)}static async updateBookingException(e){return await de(`/admin/booking_exception_rules/${e.booking_exception_rule.id}`,e)}static async deleteBookingException(e){return e==null?{}:await ue(`/admin/booking_exception_rules/${e}`)}static async fetchAllClosings(e){return e?(await G(`/admin/booking_exception_rules/closings?location_id=${e.get("location_id")}`)).data:{}}static async createClosing(e){return await ne("/admin/booking_exception_rules/closings",e)}static async deleteClosing(e){return await ne("/admin/booking_exception_rules/delete_closings",e)}}const he=me({id:"booking_exception",state:()=>({booking_exception:{},booking_exceptions:[],response_booking_exceptions:{},response_courses:{},response_tickets:{},response_closings:{}}),getters:{allBookingExceptions:t=>t.booking_exceptions,responseBookingExceptions:t=>t.response_booking_exceptions,getTotalBookingExceptions:t=>t.response_booking_exceptions?t.response_booking_exceptions.total:0,getCurrentBookingException:t=>t.booking_exception,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets,responseClosings:t=>t.response_closings},actions:{async fetchAllBookingExceptions(t){await H.fetchAll(t).then(e=>{this.response_booking_exceptions=e,this.booking_exceptions=e.booking_exceptions})},async fetchAllClosings(t){await H.fetchAllClosings(t).then(e=>{this.response_closings=e})},async getAllCourses(t){await H.getCourses(t).then(e=>{this.response_courses=e})},async getAllTickets(t){await H.getTickets(t).then(e=>{this.response_tickets=e})},async addBookingException(t){await H.addBookingException(t).then()},async updateBookingException(t){await H.updateBookingException(t).then()},async deleteBookingException(t){t!=null&&await H.deleteBookingException(t).then()},async addClosing(t){await H.createClosing(t).then()},async deleteClosing(t){await H.deleteClosing(t).then()}}}),Go={props:["config","location_id","course_id","duplicate"],setup(t,e){K(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.date&&(n.value.date=$(n.value.date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_exception_rule_slots=[]),z()});const n=C({}),o=C([]),w=fe({name:ge().required("Nome eccezione obbligatoria")}),{showLoader:x,hideLoader:r}=ie(),c=J(),m=Ce(),b=C(!1),g=be(),_=he(),f=I(()=>m.allCategories),s=I(()=>g.responseTickets),h=I(()=>g.responseCourses),E=function(){x();const T=Object.assign({},n.value);T.date&&(T.date=ae(T.date)),T.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(v=>{v.available_seats!=""&&v.start_at!=""&&T.booking_exception_rule_slots.push(v)});const k={booking_exception_rule:T};_.addBookingException(k).then(()=>{r(),O(c,{message:"Eccezione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(v=>{r(),B(c,v)})},d=function(){x();const T=Object.assign({},n.value);T.date&&(T.date=ae(T.date)),T.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(v=>{v.available_seats!=""&&v.start_at!=""&&T.booking_exception_rule_slots.push(v)});const k={booking_exception_rule:T};_.updateBookingException(k).then(()=>{r(),O(c,{message:"Eccezione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(v=>{r(),B(c,v)})},i=function(){n.value.id?d():E()},y=function(){let T={};T.price=0,n.value.tickets.unshift(T),o.value.push(n.value.tickets[0])},D=function(T){let{newData:k,index:v}=T;n.value.booking_exception_rule_slots[v]=k;let N={start_at:"",available_seats:"",id:+n.value.booking_exception_rule_slots[n.value.booking_exception_rule_slots.length-1].id-1};n.value.booking_exception_rule_slots.push(N),o.value=[N]},j=function(){let T={start_at:"",available_seats:"",id:"-1"};n.value.booking_exception_rule_slots.push(T),o.value.push(T)},M=function(T,k){n.value.booking_exception_rule_slots.splice(k,1)},z=function(){const T=new Map;T.set("location_id",n.value.location_id),T.set("course_id",n.value.course_id),g.getAllTickets(T).catch(k=>{B(c,k)})};return F(f,()=>{n.value.category||(n.value.category=f.value[0])}),{form:n,schema:w,loading:b,editingRows:o,onSubmit:i,addTicket:y,onRowEditSave:D,deleteSlot:M,addSlot:j,fetchAllTickets:z,categories:f,responseTickets:s,responseCourses:h}},components:{Form:pe,InputTextWithValidation:ve}},Ko={class:"formgrid grid mt-3"},Jo={class:"field col-12"},Qo={class:"field flex flex-column col-6"},Xo=l("label",{for:"location"},"Percorso",-1),Yo={class:"field col-3"},Zo=l("label",{from:"date"},"Il",-1),$o=l("div",{class:"field col-3"},null,-1),et={class:"field col-3 mt-3"},ot=l("label",null,"Biglietti",-1),tt=["for"],nt={class:"inline-block",style:{"min-width":"150px"}},it={class:"text-right"},at=l("div",{class:"col-9"},null,-1),st={class:"field col-8 mt-3"},lt={class:"field flex justify-content-between align-items-end mt-4 mb-3"},ct=l("label",null,"Orari",-1),rt={class:"flex justify-content-center"},dt={class:"flex align-items-center justify-content-end mt-6"};function ut(t,e,n,o,w,x){const r=u("InputTextWithValidation"),c=u("Dropdown"),m=u("Calendar"),b=u("Checkbox"),g=u("Button"),_=u("InputMask"),f=u("Column"),s=u("InputNumber"),h=u("DataTable"),E=u("Form"),d=oe("tooltip");return U(),ee(E,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:p(()=>[l("div",Ko,[l("div",Jo,[a(r,{name:"name",label:"Nome eccezione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.name=i)},null,8,["modelValue"])]),l("div",Qo,[Xo,a(c,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.course_id=i),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[2]||(e[2]=i=>o.fetchAllTickets())},null,8,["modelValue","options"])]),l("div",Yo,[Zo,a(m,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.date=i),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),$o,l("div",et,[ot,(U(!0),L(X,null,re(o.responseTickets.tickets,i=>{var y;return U(),L("div",{key:i.id,class:"flex align-items-center mb-2"},[a(b,{modelValue:o.form.booking_exception_rule_ticket_ids,"onUpdate:modelValue":e[4]||(e[4]=D=>o.form.booking_exception_rule_ticket_ids=D),inputId:i.id+"",name:"category",value:i.id},null,8,["modelValue","inputId","value"]),l("label",{for:i.id+"",class:"ml-2 flex align-items-center"},[l("div",nt,R((y=i.translations)==null?void 0:y.it.name.text),1),l("div",it,"€ "+R(i.price),1)],8,tt)])}),128))]),at,l("div",st,[l("div",lt,[ct,a(g,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[5]||(e[5]=i=>o.addSlot())})]),a(h,{value:o.form.booking_exception_rule_slots,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[6]||(e[6]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:p(()=>[P(" Nessuno slot orario trovato. ")]),default:p(()=>[a(f,{header:"Ora",field:"start_at"},{editor:p(({data:i,field:y})=>[a(_,{id:"basic",modelValue:i[y],"onUpdate:modelValue":D=>i[y]=D,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(f,{header:"Posti",field:"available_seats"},{editor:p(({data:i,field:y})=>[a(s,{modelValue:i[y],"onUpdate:modelValue":D=>i[y]=D,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(f,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),a(f,{header:"",style:{width:"3rem","padding-left":"0"}},{body:p(({data:i,index:y})=>[l("div",rt,[W(a(g,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:D=>o.deleteSlot(i,y)},null,8,["onClick"]),[[d,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])])]),l("div",dt,[a(g,{label:"Annulla",text:""}),a(g,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const mt=Q(Go,[["render",ut]]),_t={props:["location_id"],setup(t){K(()=>{r.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,t.location_id&&y(t.location_id)});const e=J(),n=C(),o=C(),w=C(),x=C(),r=C(!0),c=C(),m=C(0),b=C(!1);C([]);const g=C(),_=C(!1),f=be(),s=he(),h=I(()=>s.responseBookingExceptions),E=_e(),d=I(()=>E.submitDialog),i=I(()=>f.responseCourses),y=async function(v){const V=new Map;V.set("location_id",v),await f.getAllCourses(V).then(()=>{r.value=!1}).catch(N=>{r.value=!1,B(e,N)})},D=async function(v){if(!v)return;r.value=!0;const V=new Map;V.set("location_id",t.location_id),V.set("course_id",v),await s.fetchAllBookingExceptions(V).then(()=>{r.value=!1}).catch(N=>{r.value=!1,B(e,N)})},j=function(v){w.value=v;let V="Sei sicuro di voler eliminare questa eccezione?";E.setDialog("Elimina eccezione","Elimina","Annulla",V),E.setBtnSubmit(!1),E.setDynamicDialogVisibility(!0)},M=async function(){w.value&&await s.deleteBookingException(w.value).then(()=>{r.value=!1,O(e,{message:"Eccezione eliminata correttamente",error:!1}),D(g.value)}).catch(v=>{r.value=!1,B(e,v)})},z=function(v,V){x.value=v,b.value=!0,_.value=V},T=function(v){D(v),b.value=!1},k=function(){return _.value?"Duplica eccezione":x.value&&x.value.id&&!_.value?"Modifica eccezione":"Nuova eccezione"};return F(d,v=>{v&&M()}),F(i,()=>{i.value&&i.value.courses&&i.value.courses.length>0&&(g.value=i.value.courses[0].id,D(g.value))}),F(t,()=>{t.location_id&&y(t.location_id)}),{dt:n,responseBookingExceptions:h,loading:r,totalRecords:m,lazyParams:c,op:o,visible:b,currentConfiguration:x,responseCourses:i,course_id:g,flag_duplicate:_,onDeleteConfigurationException:M,confirmDelete:j,onEditConfiguration:z,getHeader:k,closeDialog:T,fetchAllBookingExceptions:D,formatPrettyDate:$}},components:{BookingExceptionDialog:mt}},ft={class:"flex justify-content-between mt-4 mb-3"},gt={class:"field flex flex-column"},pt=l("label",{for:"location"},"Percorso",-1),vt={class:"flex justify-content-center"};function bt(t,e,n,o,w,x){const r=u("Dropdown"),c=u("Button"),m=u("Column"),b=u("DataTable"),g=u("BookingExceptionDialog"),_=u("Dialog"),f=oe("tooltip");return U(),L(X,null,[l("div",ft,[l("div",gt,[pt,a(r,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=s=>o.course_id=s),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=s=>o.fetchAllBookingExceptions(o.course_id))},null,8,["modelValue","options"])]),a(c,{label:"Eccezione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=s=>o.onEditConfiguration({},!1))})]),a(b,{value:o.responseBookingExceptions.booking_exception_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:p(()=>[P(" Nessuna eccezione trovata. ")]),default:p(()=>[a(m,{header:"Nome",field:"name"}),a(m,{header:"Il"},{body:p(({data:s})=>[P(R(o.formatPrettyDate(s.date)),1)]),_:1}),a(m,{header:""},{body:p(({data:s})=>[l("div",vt,[W(a(c,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.onEditConfiguration(s,!0)},null,8,["onClick"]),[[f,"Duplica",void 0,{top:!0}]]),W(a(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.onEditConfiguration(s,!1)},null,8,["onClick"]),[[f,"Modifica",void 0,{top:!0}]]),W(a(c,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.confirmDelete(s.id)},null,8,["onClick"]),[[f,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(_,{visible:o.visible,"onUpdate:visible":e[4]||(e[4]=s=>o.visible=s),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:p(()=>[a(g,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=s=>o.closeDialog(s)),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const ht=Q(_t,[["render",bt]]),kt={props:["location_id","closing"],setup(t,e){K(()=>{t.closing&&t.closing.id?(n.value=Object.assign({},t.closing),n.value.date&&(n.value.date=$(n.value.date))):n.value.location_id=t.location_id});const n=C({}),o=fe({name:ge().required("Nome chiusura obbligatoria")}),{showLoader:w,hideLoader:x}=ie(),r=J(),c=xe(),m=he(),b=I(()=>c.allLocations),g=function(s){w(),m.addClosing(s).then(()=>{x(),O(r,{message:"Chiusura aggiunta correttamente",error:!1}),e.emit("onSubmit")}).catch(h=>{x(),B(r,h)})},_=function(s){w(),m.updateBookingException(s).then(()=>{x(),O(r,{message:"Chiusura modificata correttamente",error:!1}),e.emit("onSubmit")}).catch(h=>{x(),B(r,h)})};return{form:n,schema:o,onSubmit:function(){const s=Object.assign({},n.value);s.date&&(s.date=ae(s.date),s.location_id=t.location_id);const h={booking_exception_rule:s};n.value.id?_(h):g(h)},locations:b}},components:{Form:pe,InputTextWithValidation:ve}},Ct={class:"formgrid grid mt-3"},yt={class:"field col-6"},xt={class:"field col-6 flex flex-column"},wt=l("label",{from:"from_date"},"Il",-1),Vt={class:"flex align-items-center justify-content-end mt-6"};function Dt(t,e,n,o,w,x){const r=u("InputTextWithValidation"),c=u("Calendar"),m=u("Button"),b=u("Form");return U(),ee(b,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:p(()=>[l("div",Ct,[l("div",yt,[a(r,{name:"name",label:"Nome chiusura*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=g=>o.form.name=g)},null,8,["modelValue"])]),l("div",xt,[wt,a(c,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[1]||(e[1]=g=>o.form.date=g),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),l("div",Vt,[a(m,{label:"Annulla",text:""}),a(m,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const Tt=Q(kt,[["render",Dt]]),St={props:["location_id"],setup(t){K(()=>{r.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,t.location_id&&s()});const e=J(),n=C(),o=C(),w=C(),x=C(),r=C(!0),c=C(),m=C(!1),b=he(),g=_e(),_=I(()=>g.submitDialog),f=I(()=>b.responseClosings),s=async function(){const D=new Map;D.set("location_id",t.location_id),await b.fetchAllClosings(D).then(()=>{r.value=!1}).catch(j=>{r.value=!1,B(e,j)})},h=function(D){w.value=D;let j="Sei sicuro di voler eliminare questa chiusura?";g.setDialog("Elimina chiusura","Elimina","Annulla",j),g.setBtnSubmit(!1),g.setDynamicDialogVisibility(!0)},E=async function(){if(!w.value)return;const D={location_id:t.location_id,date:w.value};await b.deleteClosing(D).then(()=>{r.value=!1,O(e,{message:"Chiusura eliminata correttamente",error:!1}),s()}).catch(j=>{r.value=!1,B(e,j)})},d=function(D){x.value=D,m.value=!0},i=function(){s(),m.value=!1},y=function(){return x.value&&x.value.id?"Modifica chiusura":"Nuova chiusura"};return F(_,D=>{_.value&&E()}),F(t,()=>{t.location_id&&s()}),{dt:n,responseClosings:f,loading:r,lazyParams:c,op:o,visible:m,currentClosing:x,formatPrettyDate:$,onDeleteClosing:E,confirmDelete:h,onEditConfiguration:d,closeDialog:i,getHeader:y}},components:{ClosingDialog:Tt}},Et={class:"flex justify-content-end mt-4 mb-3"},At={class:"flex justify-content-center"};function Bt(t,e,n,o,w,x){const r=u("Button"),c=u("Column"),m=u("DataTable"),b=u("ClosingDialog"),g=u("Dialog"),_=oe("tooltip");return U(),L(X,null,[l("div",Et,[a(r,{label:"Chiusura",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=f=>o.onEditConfiguration({}))})]),a(m,{value:o.responseClosings.closings,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:p(()=>[P(" Nessuna chiusura trovata. ")]),default:p(()=>[a(c,{header:"Nome",field:"name"}),a(c,{header:"Il"},{body:p(({data:f})=>[P(R(o.formatPrettyDate(f.date)),1)]),_:1}),a(c,{header:""},{body:p(({data:f})=>[l("div",At,[W(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:s=>o.onEditConfiguration(f)},null,8,["onClick"]),[[_,"Modifica",void 0,{top:!0}]]),W(a(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:s=>o.confirmDelete(f.date)},null,8,["onClick"]),[[_,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(g,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=f=>o.visible=f),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:p(()=>[a(b,{onOnSubmit:e[1]||(e[1]=f=>o.closeDialog()),onOnClose:e[2]||(e[2]=f=>o.visible=!1),location_id:n.location_id,closing:o.currentClosing},null,8,["location_id","closing"])]),_:1},8,["visible","header"])],64)}const Ut=Q(St,[["render",Bt]]),It={setup(){K(()=>{_()});const t=C({}),e=xe(),n=C(),o=C(),w=C(),{showLoader:x,hideLoader:r}=ie(),c=J(),m=C(!1),b=I(()=>e.allLocations),g=I(()=>e.getCurrentLocation),_=async function(){await e.fetchAllLocations().then(()=>{g.value&&(t.value.location=g.value,s())})},f=function(){e.updateCurrenLocation(t.value.location),s()},s=function(){o.value=$(t.value.location.calendar_visible_from),w.value=$(t.value.location.calendar_visible_to)},h=async function(){x();let E={calendar_visible_from:ae(o.value),calendar_visible_to:ae(w.value),location_id:t.value.location.id};await e.updateLocation(E).then(()=>{r(),O(c,{message:"Data aggiornata correttamente",error:!1}),o.value=ye(o.value),w.value=ye(w.value),m.value=!1}).catch(d=>{r(),B(c,d)})};return F(b,()=>{t.value.location_id=b.value[0].id}),{form:t,courseTable:n,calendar_visible_from:o,calendar_visible_to:w,active:m,locations:b,onChangeLocation:f,updateVisibility:h,formatPrettyDate:$}},components:{CourseTable:Qe,OpeningsTable:Ho,BookingExceptionTable:ht,ClosingsTable:Ut}};const jt=l("h1",null,"Configurazioni",-1),zt={class:"flex align-items-center justify-content-between"},Mt={class:"field col-3 flex flex-column"},Rt=l("label",{for:"location"},"Location",-1),Lt={class:"col-9 flex justify-content-end"},Nt={class:"col-12 field"},Ot=l("label",{class:"ml-1"},"Finestra di visibilità",-1),Ft={class:"flex align-items-center mt-2 ml-0 pl-0 gap-5"};function Pt(t,e,n,o,w,x){var d;const r=u("Dropdown"),c=u("Calendar"),m=u("Inplace"),b=u("Card"),g=u("CourseTable"),_=u("TabPanel"),f=u("OpeningsTable"),s=u("BookingExceptionTable"),h=u("ClosingsTable"),E=u("TabView");return U(),L("div",null,[jt,l("div",zt,[l("div",Mt,[Rt,a(r,{modelValue:o.form.location,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.location=i),options:o.locations,optionLabel:"name",placeholder:"",name:"location",onChange:e[1]||(e[1]=i=>o.onChangeLocation())},null,8,["modelValue","options"])]),l("div",Lt,[o.form.location?(U(),ee(b,{key:0,style:{width:"30rem"}},{content:p(()=>[l("div",Nt,[Ot,l("div",Ft,[a(m,{closable:!0,onClose:e[3]||(e[3]=i=>o.updateVisibility()),active:o.active},{display:p(()=>[P(" Dal: "+R(o.calendar_visible_from),1)]),content:p(()=>[a(c,{inputId:"date",modelValue:o.calendar_visible_from,"onUpdate:modelValue":e[2]||(e[2]=i=>o.calendar_visible_from=i),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"]),a(m,{closable:!0,onClose:e[5]||(e[5]=i=>o.updateVisibility()),active:o.active},{display:p(()=>[P(" Al: "+R(o.calendar_visible_to),1)]),content:p(()=>[a(c,{inputId:"date",modelValue:o.calendar_visible_to,"onUpdate:modelValue":e[4]||(e[4]=i=>o.calendar_visible_to=i),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"])])])]),_:1})):Z("",!0)])]),(d=o.form.location)!=null&&d.id?(U(),ee(E,{key:0},{default:p(()=>[a(_,{header:"Percorsi"},{default:p(()=>{var i;return[a(g,{location_id:(i=o.form.location)==null?void 0:i.id,ref:"courseTable"},null,8,["location_id"])]}),_:1}),a(_,{header:"Aperture"},{default:p(()=>[a(f,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),a(_,{header:"Eccezioni"},{default:p(()=>[a(s,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),a(_,{header:"Chiusure"},{default:p(()=>[a(h,{location_id:o.form.location.id},null,8,["location_id"])]),_:1})]),_:1})):Z("",!0)])}const en=Q(It,[["render",Pt]]);export{en as default};
