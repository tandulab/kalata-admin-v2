import{u as ae}from"./location90076.js";import{u as H,s as U,e as A}from"./helpers90076.js";import{A as ee,C as oe,z as te,B as ie,o as j,l as _,a as P,c as T,i as F,_ as L,r as c,b as D,v as W,w as g,g as a,f as t,h as I,t as E,x as J,p as N,e as B,F as R,D as q,q as z,s as le}from"../index90076.js";import{u as Q}from"./attraction90076.js";import{c as X,a as M}from"./index.esm90076.js";import{F as Y}from"./vee-validate.esm90076.js";import{I as Z}from"./InputTextWithValidation90076.js";import{u as $}from"./category90076.js";/* empty css                                                                            */class O{static async fetchAll(){return{courses:[{name:'Percorso "Gentile da Fabriano a Brescia"',tickets:[{name:"Biglietto intero",price:"8",id:"1",description:"-"},{name:"Biglietto ridotto",price:"6",id:"2",description:"Il biglietto ridotto è riservato a: visitatori di età compresa tra i 6 e i 25 anni, residenti nel Comune di Brescia"},{name:"Biglietto gratuito",price:"0",id:"3",description:"Il biglietto gratuito è riservato a: visitatori di età compresa tra 0 e 5 anni, persone con disabilità (con accompagnatore per chi lo necessita), titolari Abbonamento Musei Lombardia Valle d'Aosta e Formula Extra, guide turistiche abilitate, giornalisti accreditati (previa comunicazione all’indirizzo e-mail booking@kalata.it)"}],enabled:!0,id:1}]}}static async addCourse(o){return await ee("/admin/courses",o)}static async updateCourse(o){return await oe(`/admin/courses/${o.course.id}`,o)}static async deleteCourse(o){return await te(`/admin/courses/${o}`)}}const se=ie({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:n=>n.courses,responseCourses:n=>n.response_courses,getTotalCourses:n=>n.response_courses?n.response_courses.total:0,getCurrentCourse:n=>n.course},actions:{async fetchAllCourses(){await O.fetchAll().then(n=>{this.response_courses=n,this.courses=n.courses})},async addCourse(n){await O.addCourse(n).then()},async updateCourse(n){await O.updateCourse(n).then()},async deleteCourse(n){await O.deleteCourse(n).then()}}}),re={props:["course"],setup(n,o){j(()=>{n.course&&n.course.id?s.value=Object.assign({},n.course):(s.value.tickets=[],i())});const s=_({}),e=_([]),x=X({name:M().required("Nome percorso obbligatorio"),address:M().required("Luogo di ritrovo obbligatorio"),price:M().required("Importo biglietto obbligatorio")}),{showLoader:v,hideLoader:f}=H(),u=P(),d=Q(),p=$(),V=_(!1),b=T(()=>d.allAttractions),C=T(()=>p.allCategories),l=function(){v();const w=Object.assign({},s.value);w.ticket_configurations=[{price:w.price,name:"Biglietto intero"}];const k={attraction:w};d.addAttraction(k).then(()=>{f(),U(u,{message:"Bene aggiunto correttamente",error:!1}),o.emit("onSubmit")}).catch(m=>{f(),A(u,m)})},r=function(){v();const k={attraction:Object.assign({},s.value)};d.updateAttraction(k).then(()=>{f(),U(u,{message:"Chiusura modificata correttamente",error:!1}),o.emit("onSubmit")}).catch(m=>{f(),A(u,m)})},h=function(){s.value.id?r():l()},i=function(){let w={};w.price=0,s.value.tickets.unshift(w),e.value.push(s.value.tickets[0])};return F(C,()=>{s.value.category||(s.value.category=C.value[0])}),{form:s,schema:x,loading:V,editingRows:e,onSubmit:h,addTicket:i,attractions:b,categories:C}},components:{Form:Y,InputTextWithValidation:Z}},ce={class:"formgrid grid mt-3"},de={class:"field col-12"},ue={class:"flex justify-content-end mt-4 mb-3"},me={class:"w-full"},fe={class:"flex align-items-center justify-content-end mt-6"};function pe(n,o,s,e,x,v){const f=c("InputTextWithValidation"),u=c("Button"),d=c("InputText"),p=c("Column"),V=c("Textarea"),b=c("DataTable"),C=c("Form");return D(),W(C,{onSubmit:e.onSubmit,"validation-schema":e.schema},{default:g(()=>[a("div",ce,[a("div",de,[t(f,{name:"name",label:"Nome percorso*",modelValue:e.form.name,"onUpdate:modelValue":o[0]||(o[0]=l=>e.form.name=l)},null,8,["modelValue"])])]),a("div",ue,[t(u,{label:"Tipologia biglietto",icon:"pi pi-plus",rounded:"",outlined:"",onClick:o[1]||(o[1]=l=>e.addTicket())})]),t(b,{value:e.form.tickets,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",editingRows:e.editingRows,"onUpdate:editingRows":o[2]||(o[2]=l=>e.editingRows=l),editMode:"row",dataKey:"id"},{empty:g(()=>[I(" Nessun biglietto trovato. ")]),default:g(()=>[t(p,{header:"Tipo biglietto",field:"name",style:{"min-width":"150px"}},{editor:g(({data:l,field:r})=>[t(d,{modelValue:l[r],"onUpdate:modelValue":h=>l[r]=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{header:"Descrizione",field:"description"},{editor:g(({data:l,field:r})=>[a("div",me,[t(V,{modelValue:l[r],"onUpdate:modelValue":h=>l[r]=h,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),t(p,{header:"Prezzo",field:"price"},{body:g(({data:l})=>[I(" € "+E((+l.price).toFixed(2)),1)]),editor:g(({data:l,field:r})=>[t(d,{modelValue:l[r],"onUpdate:modelValue":h=>l[r]=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{rowEditor:!0,style:{width:"10%","min-width":"8rem"},bodyStyle:"text-align:center"})]),_:1},8,["value","loading","editingRows"]),a("div",fe,[t(u,{label:"Annulla",text:""}),t(u,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const ge=L(re,[["render",pe]]),_e={setup(){j(()=>{v.value=!0,f.value={first:0,rows:o.value.rows,sortField:null,sortOrder:null},f.value.page=0,l()});const n=P(),o=_(),s=_(),e=_(),x=_(),v=_(!0),f=_(),u=_(0),d=_(!1),p=se(),V=T(()=>p.responseCourses),b=J(),C=T(()=>b.submitDialog);function l(){v.value=!0,setTimeout(()=>{r()},Math.random()*1e3+250)}const r=async function(){await p.fetchAllCourses().then(()=>{v.value=!1}).catch(m=>{v.value=!1,A(n,m)})},h=function(m){e.value=m;let S="Sei sicuro di voler eliminare questo percorso?";b.setDialog("Elimina percorso","Elimina","Annulla",S),b.setBtnSubmit(!1),b.setDynamicDialogVisibility(!0)},i=async function(){await p.deleteCourse(e.value).then(()=>{v.value=!1,U(n,{message:"Percorso eliminato correttamente",error:!1}),l()}).catch(m=>{v.value=!1,A(n,m)})},w=function(){},k=function(m){x.value=m,d.value=!0};return F(C,m=>{m&&i()}),{dt:o,responseCourses:V,loading:v,totalRecords:u,lazyParams:f,op:s,visible:d,currentCourse:x,loadLazyData:l,onDeleteCourse:i,confirmDelete:h,addCourse:w,onEditCourse:k}},components:{CourseDialog:ge}},ve={class:"flex justify-content-end mt-4 mb-3"},be={class:"flex justify-content-center"};function he(n,o,s,e,x,v){const f=c("Button"),u=c("Column"),d=c("InputSwitch"),p=c("DataTable"),V=c("CourseDialog"),b=c("Dialog"),C=N("tooltip");return D(),B(R,null,[a("div",ve,[t(f,{label:"Percorso",icon:"pi pi-plus",rounded:"",outlined:"",onClick:o[0]||(o[0]=l=>e.onEditCourse({}))})]),t(p,{value:e.responseCourses.courses,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:""},{empty:g(()=>[I(" Nessun percorso trovato. ")]),default:g(()=>[t(u,{header:"Nome",field:"name"}),t(u,{header:"Tipologie biglietti"},{body:g(({data:l})=>[(D(!0),B(R,null,q(l.tickets,r=>(D(),B("div",{key:r.id},E(r.name),1))),128))]),_:1}),t(u,{header:"Prezzo"},{body:g(({data:l})=>[(D(!0),B(R,null,q(l.tickets,r=>(D(),B("div",{key:r.id}," € "+E((+r.price).toFixed(2)),1))),128))]),_:1}),t(u,{header:"Stato"},{body:g(({data:l})=>[t(d,{modelValue:l.enabled,"onUpdate:modelValue":r=>l.enabled=r},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(u,{header:""},{body:g(({data:l})=>[a("div",be,[z(t(f,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:r=>e.onEditCourse(l)},null,8,["onClick"]),[[C,"Modifica",void 0,{top:!0}]]),z(t(f,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:r=>e.confirmDelete(l.id)},null,8,["onClick"]),[[C,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),t(b,{visible:e.visible,"onUpdate:visible":o[1]||(o[1]=l=>e.visible=l),modal:"",header:"Modifica percorso",style:{width:"70rem"}},{default:g(()=>[t(V,{course:e.currentCourse},null,8,["course"])]),_:1},8,["visible"])],64)}const Ce=L(_e,[["render",he]]);class G{static async fetchAll(){return{configurations:[{course_name:'Percorso "Gentile da Fabriano a Brescia"',name:"Configurazione Lun, Merc, Giov, Ven",valid_from:"01/01/24",valid_to:"31/12/24",tickets:[{name:"Biglietto intero",price:"8",id:"1",description:"-"},{name:"Biglietto ridotto",price:"6",id:"2",description:"Il biglietto ridotto è riservato a: visitatori di età compresa tra i 6 e i 25 anni, residenti nel Comune di Brescia"},{name:"Biglietto gratuito",price:"0",id:"3",description:"Il biglietto gratuito è riservato a: visitatori di età compresa tra 0 e 5 anni, persone con disabilità (con accompagnatore per chi lo necessita), titolari Abbonamento Musei Lombardia Valle d'Aosta e Formula Extra, guide turistiche abilitate, giornalisti accreditati (previa comunicazione all’indirizzo e-mail booking@kalata.it)"}],week:"Lun, Merc, Giov, Ven",time_slots:[{time:"10:00",seats:"15",id:"1"},{time:"11:30",seats:"15",id:"2"},{time:"14:00",seats:"15",id:"3"},{time:"15:30",seats:"15",id:"4"}],enabled:!0,id:1},{course_name:'Percorso "Gentile da Fabriano a Brescia"',name:"Configurazione Mar",valid_from:"01/01/24",valid_to:"31/12/24",week:"Mar",tickets:[{name:"Biglietto intero",price:"8",id:"1",description:"-"},{name:"Biglietto ridotto",price:"6",id:"2",description:"Il biglietto ridotto è riservato a: visitatori di età compresa tra i 6 e i 25 anni, residenti nel Comune di Brescia"},{name:"Biglietto gratuito",price:"0",id:"3",description:"Il biglietto gratuito è riservato a: visitatori di età compresa tra 0 e 5 anni, persone con disabilità (con accompagnatore per chi lo necessita), titolari Abbonamento Musei Lombardia Valle d'Aosta e Formula Extra, guide turistiche abilitate, giornalisti accreditati (previa comunicazione all’indirizzo e-mail booking@kalata.it)"}],time_slots:[{time:"14:00",seats:"15"},{time:"15:30",seats:"15"}],enabled:!0,id:2}]}}static async addConfiguration(o){return await ee("/admin/configurations",o)}static async updateConfiguration(o){return await oe(`/admin/configurations/${o.configuration.id}`,o)}static async deleteConfiguration(o){return await te(`/admin/configurations/${o}`)}}const ne=ie({id:"configuration",state:()=>({configuration:{},configurations:[],response_configurations:{}}),getters:{allConfigurations:n=>n.configurations,responseConfigurations:n=>n.response_configurations,getTotalConfigurations:n=>n.response_configurations?n.response_configurations.total:0,getCurrentConfiguration:n=>n.configuration},actions:{async fetchAllConfigurations(){await G.fetchAll().then(n=>{this.response_configurations=n,this.configurations=n.configurations})},async addConfiguration(n){await G.addConfiguration(n).then()},async updateConfiguration(n){await G.updateConfiguration(n).then()},async deleteConfiguration(n){await G.deleteConfiguration(n).then()}}}),we={props:["config"],setup(n,o){j(()=>{if(n.config&&n.config.id)s.value=Object.assign({},n.config);else{let m={time:"",seats:"",id:"1"};s.value.time_slots=[],s.value.time_slots.push(m),e.value.push(m)}s.value.tickets=[{name:"Biglietto intero",price:"8",id:"1",description:"-"},{name:"Biglietto ridotto",price:"6",id:"2",description:"Il biglietto ridotto è riservato a: visitatori di età compresa tra i 6 e i 25 anni, residenti nel Comune di Brescia"},{name:"Biglietto gratuito",price:"0",id:"3",description:"Il biglietto gratuito è riservato a: visitatori di età compresa tra 0 e 5 anni, persone con disabilità (con accompagnatore per chi lo necessita), titolari Abbonamento Musei Lombardia Valle d'Aosta e Formula Extra, guide turistiche abilitate, giornalisti accreditati (previa comunicazione all’indirizzo e-mail booking@kalata.it)"}],b.value=[{name:'Percorso "Gentile da Fabriano a Brescia"',id:"1"}],s.value.course_id="1"});const s=_({}),e=_([]),x=X({name:M().required("Nome configuazione obbligatoria")}),{showLoader:v,hideLoader:f}=H(),u=P(),d=Q(),p=$(),V=_(!1),b=_([]),C=T(()=>d.allAttractions),l=T(()=>p.allCategories),r=function(){v();const m=Object.assign({},s.value);m.ticket_configurations=[{price:m.price,name:"Biglietto intero"}];const S={attraction:m};d.addAttraction(S).then(()=>{f(),U(u,{message:"Bene aggiunto correttamente",error:!1}),o.emit("onSubmit")}).catch(y=>{f(),A(u,y)})},h=function(){v();const S={attraction:Object.assign({},s.value)};d.updateAttraction(S).then(()=>{f(),U(u,{message:"Chiusura modificata correttamente",error:!1}),o.emit("onSubmit")}).catch(y=>{f(),A(u,y)})},i=function(){s.value.id?h():r()},w=function(){let m={};m.price=0,s.value.tickets.unshift(m),e.value.push(s.value.tickets[0])},k=function(){let m={time:"",seats:"",id:"2"};s.value.time_slots.push(m),e.value=[m]};return F(l,()=>{s.value.category||(s.value.category=l.value[0])}),{form:s,schema:x,loading:V,editingRows:e,courses:b,onSubmit:i,addTicket:w,onRowEditSave:k,attractions:C,categories:l}},components:{Form:Y,InputTextWithValidation:Z}},Ve={class:"formgrid grid mt-3"},ye={class:"field col-12"},ke={class:"field flex flex-column col-6"},xe=a("label",{for:"location"},"Percorso",-1),De={class:"field col-3"},Se=a("label",{from:"date_from"},"Dal",-1),Be={class:"field col-3"},Ae=a("label",{from:"date_to"},"Al",-1),Te={class:"field col-12 mt-3"},Ie=a("label",null,"Giorni",-1),ze={class:"card flex flex-wrap gap-3"},Ee={class:"flex align-items-center mr-4"},Ue=a("label",{for:"all",class:"ml-2"}," Tutti i giorni ",-1),Re={class:"flex align-items-center"},je=a("label",{for:"lun",class:"ml-2"}," Lun ",-1),Fe={class:"flex align-items-center"},Le=a("label",{for:"mar",class:"ml-2"}," Mar ",-1),Pe={class:"flex align-items-center"},Me=a("label",{for:"mer",class:"ml-2"}," Mer ",-1),Ne={class:"flex align-items-center"},Oe=a("label",{for:"gio",class:"ml-2"}," Gio ",-1),Ge={class:"flex align-items-center"},qe=a("label",{for:"ven",class:"ml-2"}," Ven ",-1),We={class:"flex align-items-center"},Ke=a("label",{for:"sab",class:"ml-2"}," Sab ",-1),He={class:"flex align-items-center"},Je=a("label",{for:"dom",class:"ml-2"}," Dom ",-1),Qe={class:"field col-3 mt-3"},Xe=a("label",null,"Biglietti",-1),Ye=["for"],Ze={class:"inline-block",style:{"min-width":"150px"}},$e=a("div",{class:"col-9"},null,-1),eo={class:"field col-8 mt-3"},oo=a("label",null,"Orari",-1),to={class:"flex justify-content-center"},io={class:"flex align-items-center justify-content-end mt-6"};function no(n,o,s,e,x,v){const f=c("InputTextWithValidation"),u=c("Dropdown"),d=c("Calendar"),p=c("Checkbox"),V=c("InputText"),b=c("Column"),C=c("Button"),l=c("DataTable"),r=c("Form"),h=N("tooltip");return D(),W(r,{onSubmit:e.onSubmit,"validation-schema":e.schema},{default:g(()=>[a("div",Ve,[a("div",ye,[t(f,{name:"name",label:"Nome configurazione*",modelValue:e.form.name,"onUpdate:modelValue":o[0]||(o[0]=i=>e.form.name=i)},null,8,["modelValue"])]),a("div",ke,[xe,t(u,{modelValue:e.form.course_id,"onUpdate:modelValue":o[1]||(o[1]=i=>e.form.course_id=i),options:e.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location"},null,8,["modelValue","options"])]),a("div",De,[Se,t(d,{inputId:"date_from",modelValue:e.form.valid_from,"onUpdate:modelValue":o[2]||(o[2]=i=>e.form.valid_from=i),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),a("div",Be,[Ae,t(d,{inputId:"date_to",modelValue:e.form.valid_to,"onUpdate:modelValue":o[3]||(o[3]=i=>e.form.valid_to=i),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),a("div",Te,[Ie,a("div",ze,[a("div",Ee,[t(p,{modelValue:e.form.week,"onUpdate:modelValue":o[4]||(o[4]=i=>e.form.week=i),inputId:"all",name:"week",value:"all"},null,8,["modelValue"]),Ue]),a("div",Re,[t(p,{modelValue:e.form.week,"onUpdate:modelValue":o[5]||(o[5]=i=>e.form.week=i),inputId:"lun",name:"week",value:"Lun"},null,8,["modelValue"]),je]),a("div",Fe,[t(p,{modelValue:e.form.week,"onUpdate:modelValue":o[6]||(o[6]=i=>e.form.week=i),inputId:"mar",name:"week",value:"Mar"},null,8,["modelValue"]),Le]),a("div",Pe,[t(p,{modelValue:e.form.week,"onUpdate:modelValue":o[7]||(o[7]=i=>e.form.week=i),inputId:"mer",name:"week",value:"Mer"},null,8,["modelValue"]),Me]),a("div",Ne,[t(p,{modelValue:e.form.week,"onUpdate:modelValue":o[8]||(o[8]=i=>e.form.week=i),inputId:"gio",name:"week",value:"Gio"},null,8,["modelValue"]),Oe]),a("div",Ge,[t(p,{modelValue:e.form.week,"onUpdate:modelValue":o[9]||(o[9]=i=>e.form.week=i),inputId:"ven",name:"week",value:"Ven"},null,8,["modelValue"]),qe]),a("div",We,[t(p,{modelValue:e.form.week,"onUpdate:modelValue":o[10]||(o[10]=i=>e.form.week=i),inputId:"sab",name:"week",value:"Sab"},null,8,["modelValue"]),Ke]),a("div",He,[t(p,{modelValue:e.form.week,"onUpdate:modelValue":o[11]||(o[11]=i=>e.form.week=i),inputId:"dom",name:"week",value:"Dom"},null,8,["modelValue"]),Je])])]),a("div",Qe,[Xe,(D(!0),B(R,null,q(e.form.tickets,i=>(D(),B("div",{key:i.id,class:"flex align-items-center mb-2"},[t(p,{modelValue:e.form.selected_tickets,"onUpdate:modelValue":o[12]||(o[12]=w=>e.form.selected_tickets=w),inputId:i.id,name:"category",value:i.name},null,8,["modelValue","inputId","value"]),a("label",{for:i.id,class:"ml-2"},[a("div",Ze,E(i.name),1),I(" € "+E(i.price),1)],8,Ye)]))),128))]),$e,a("div",eo,[oo,t(l,{value:e.form.time_slots,ref:"dt",loading:e.loading,stripedRows:"",editingRows:e.editingRows,"onUpdate:editingRows":o[13]||(o[13]=i=>e.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:e.onRowEditSave},{empty:g(()=>[I(" Nessuno slot orario trovato. ")]),default:g(()=>[t(b,{header:"Ora",field:"time"},{editor:g(({data:i,field:w})=>[t(V,{modelValue:i[w],"onUpdate:modelValue":k=>i[w]=k},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(b,{header:"Posti",field:"seats"},{editor:g(({data:i,field:w})=>[t(V,{modelValue:i[w],"onUpdate:modelValue":k=>i[w]=k},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(b,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),t(b,{header:"",style:{width:"3rem","padding-left":"0"}},{body:g(()=>[a("div",to,[z(t(C,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"}},null,512),[[h,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])])]),a("div",io,[t(C,{label:"Annulla",text:""}),t(C,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const ao=L(we,[["render",no]]),lo={setup(){j(()=>{v.value=!0,f.value={first:0,rows:o.value.rows,sortField:null,sortOrder:null},f.value.page=0,h(),p.value=[{name:'Percorso "Gentile da Fabriano a Brescia"',id:"1"}],V.value=p.value[0].id});const n=P(),o=_(),s=_(),e=_(),x=_(),v=_(!0),f=_(),u=_(0),d=_(!1),p=_([]),V=_(),b=ne(),C=T(()=>b.responseConfigurations),l=J(),r=T(()=>l.submitDialog);function h(){v.value=!0,setTimeout(()=>{i()},Math.random()*1e3+250)}const i=async function(){await b.fetchAllConfigurations().then(()=>{v.value=!1}).catch(y=>{v.value=!1,A(n,y)})},w=function(y){e.value=y;let K="Sei sicuro di voler eliminare questo percorso?";l.setDialog("Elimina percorso","Elimina","Annulla",K),l.setBtnSubmit(!1),l.setDynamicDialogVisibility(!0)},k=async function(){await b.deleteConfiguration(e.value).then(()=>{v.value=!1,U(n,{message:"Percorso eliminato correttamente",error:!1}),h()}).catch(y=>{v.value=!1,A(n,y)})},m=function(){},S=function(y){x.value=y,d.value=!0};return F(r,y=>{y&&k()}),{dt:o,responseConfigurations:C,loading:v,totalRecords:u,lazyParams:f,op:s,visible:d,currentConfiguration:x,courses:p,course_id:V,loadLazyData:h,onDeleteConfiguration:k,confirmDelete:w,addConfiguration:m,onEditConfiguration:S}},components:{ConfigurationDialog:ao}},so={class:"flex justify-content-between mt-4 mb-3"},ro={class:"field flex flex-column"},co=a("label",{for:"location"},"Percorso",-1),uo={class:"flex justify-content-center"};function mo(n,o,s,e,x,v){const f=c("Dropdown"),u=c("Button"),d=c("Column"),p=c("InputSwitch"),V=c("DataTable"),b=c("ConfigurationDialog"),C=c("Dialog"),l=N("tooltip");return D(),B(R,null,[a("div",so,[a("div",ro,[co,t(f,{modelValue:e.course_id,"onUpdate:modelValue":o[0]||(o[0]=r=>e.course_id=r),options:e.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location"},null,8,["modelValue","options"])]),t(u,{label:"Configurazione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:o[1]||(o[1]=r=>e.onEditConfiguration({}))})]),t(V,{value:e.responseConfigurations.configurations,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:""},{empty:g(()=>[I(" Nessuna configurazione trovata. ")]),default:g(()=>[t(d,{header:"Nome",field:"name"}),t(d,{header:"Dal Al"},{body:g(({data:r})=>[I(E(r.valid_from)+" - "+E(r.valid_to),1)]),_:1}),t(d,{header:"Percorso",field:"course_name"}),t(d,{header:"Valida il",field:"week"}),t(d,{header:"Stato"},{body:g(({data:r})=>[t(p,{modelValue:r.enabled,"onUpdate:modelValue":h=>r.enabled=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(d,{header:""},{body:g(({data:r})=>[a("div",uo,[z(t(u,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>e.onEditConfiguration(r)},null,8,["onClick"]),[[l,"Duplica",void 0,{top:!0}]]),z(t(u,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>e.onEditConfiguration(r)},null,8,["onClick"]),[[l,"Modifica",void 0,{top:!0}]]),z(t(u,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>e.confirmDelete(r.id)},null,8,["onClick"]),[[l,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),t(C,{visible:e.visible,"onUpdate:visible":o[2]||(o[2]=r=>e.visible=r),modal:"",header:"Modifica configurazione",style:{width:"70rem"}},{default:g(()=>[t(b,{config:e.currentConfiguration},null,8,["config"])]),_:1},8,["visible"])],64)}const fo=L(lo,[["render",mo]]),po={props:["config"],setup(n,o){j(()=>{if(n.config&&n.config.id)s.value=Object.assign({},n.config);else{let m={time:"",seats:"",id:"1"};s.value.time_slots=[],s.value.time_slots.push(m),e.value.push(m)}s.value.tickets=[{name:"Biglietto intero",price:"8",id:"1",description:"-"},{name:"Biglietto ridotto",price:"6",id:"2",description:"Il biglietto ridotto è riservato a: visitatori di età compresa tra i 6 e i 25 anni, residenti nel Comune di Brescia"},{name:"Biglietto gratuito",price:"0",id:"3",description:"Il biglietto gratuito è riservato a: visitatori di età compresa tra 0 e 5 anni, persone con disabilità (con accompagnatore per chi lo necessita), titolari Abbonamento Musei Lombardia Valle d'Aosta e Formula Extra, guide turistiche abilitate, giornalisti accreditati (previa comunicazione all’indirizzo e-mail booking@kalata.it)"}],b.value=[{name:'Percorso "Gentile da Fabriano a Brescia"',id:"1"}],s.value.course_id="1"});const s=_({}),e=_([]),x=X({name:M().required("Nome configuazione obbligatoria")}),{showLoader:v,hideLoader:f}=H(),u=P(),d=Q(),p=$(),V=_(!1),b=_([]),C=T(()=>d.allAttractions),l=T(()=>p.allCategories),r=function(){v();const m=Object.assign({},s.value);m.ticket_configurations=[{price:m.price,name:"Biglietto intero"}];const S={attraction:m};d.addAttraction(S).then(()=>{f(),U(u,{message:"Bene aggiunto correttamente",error:!1}),o.emit("onSubmit")}).catch(y=>{f(),A(u,y)})},h=function(){v();const S={attraction:Object.assign({},s.value)};d.updateAttraction(S).then(()=>{f(),U(u,{message:"Chiusura modificata correttamente",error:!1}),o.emit("onSubmit")}).catch(y=>{f(),A(u,y)})},i=function(){s.value.id?h():r()},w=function(){let m={};m.price=0,s.value.tickets.unshift(m),e.value.push(s.value.tickets[0])},k=function(){let m={time:"",seats:"",id:"2"};s.value.time_slots.push(m),e.value=[m]};return F(l,()=>{s.value.category||(s.value.category=l.value[0])}),{form:s,schema:x,loading:V,editingRows:e,courses:b,onSubmit:i,addTicket:w,onRowEditSave:k,attractions:C,categories:l}},components:{Form:Y,InputTextWithValidation:Z}},go={class:"formgrid grid mt-3"},_o={class:"field col-12"},vo={class:"field flex flex-column col-6"},bo=a("label",{for:"location"},"Percorso",-1),ho={class:"field col-3"},Co=a("label",{from:"date_from"},"Il",-1),wo=a("div",{class:"field col-3"},null,-1),Vo={class:"field col-3 mt-3"},yo=a("label",null,"Biglietti",-1),ko=["for"],xo={class:"inline-block",style:{"min-width":"150px"}},Do=a("div",{class:"col-9"},null,-1),So={class:"field col-8 mt-3"},Bo=a("label",null,"Orari",-1),Ao={class:"flex justify-content-center"},To={class:"flex align-items-center justify-content-end mt-6"};function Io(n,o,s,e,x,v){const f=c("InputTextWithValidation"),u=c("Dropdown"),d=c("Calendar"),p=c("Checkbox"),V=c("InputText"),b=c("Column"),C=c("Button"),l=c("DataTable"),r=c("Form"),h=N("tooltip");return D(),W(r,{onSubmit:e.onSubmit,"validation-schema":e.schema},{default:g(()=>[a("div",go,[a("div",_o,[t(f,{name:"name",label:"Nome configurazione*",modelValue:e.form.name,"onUpdate:modelValue":o[0]||(o[0]=i=>e.form.name=i)},null,8,["modelValue"])]),a("div",vo,[bo,t(u,{modelValue:e.form.course_id,"onUpdate:modelValue":o[1]||(o[1]=i=>e.form.course_id=i),options:e.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location"},null,8,["modelValue","options"])]),a("div",ho,[Co,t(d,{inputId:"date_from",modelValue:e.form.valid_from,"onUpdate:modelValue":o[2]||(o[2]=i=>e.form.valid_from=i),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),wo,a("div",Vo,[yo,(D(!0),B(R,null,q(e.form.tickets,i=>(D(),B("div",{key:i.id,class:"flex align-items-center mb-2"},[t(p,{modelValue:e.form.selected_tickets,"onUpdate:modelValue":o[3]||(o[3]=w=>e.form.selected_tickets=w),inputId:i.id,name:"category",value:i.name},null,8,["modelValue","inputId","value"]),a("label",{for:i.id,class:"ml-2"},[a("div",xo,E(i.name),1),I(" € "+E(i.price),1)],8,ko)]))),128))]),Do,a("div",So,[Bo,t(l,{value:e.form.time_slots,ref:"dt",loading:e.loading,stripedRows:"",editingRows:e.editingRows,"onUpdate:editingRows":o[4]||(o[4]=i=>e.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:e.onRowEditSave},{empty:g(()=>[I(" Nessuno slot orario trovato. ")]),default:g(()=>[t(b,{header:"Ora",field:"time"},{editor:g(({data:i,field:w})=>[t(V,{modelValue:i[w],"onUpdate:modelValue":k=>i[w]=k},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(b,{header:"Posti",field:"seats"},{editor:g(({data:i,field:w})=>[t(V,{modelValue:i[w],"onUpdate:modelValue":k=>i[w]=k},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(b,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),t(b,{header:"",style:{width:"3rem","padding-left":"0"}},{body:g(()=>[a("div",Ao,[z(t(C,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"}},null,512),[[h,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])])]),a("div",To,[t(C,{label:"Annulla",text:""}),t(C,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const zo=L(po,[["render",Io]]),Eo={setup(){j(()=>{v.value=!0,f.value={first:0,rows:o.value.rows,sortField:null,sortOrder:null},f.value.page=0,h(),p.value=[{name:'Percorso "Gentile da Fabriano a Brescia"',id:"1"}],V.value=p.value[0].id;const y=[{course_name:'Percorso "Gentile da Fabriano a Brescia"',name:"Apertura straordinaria Pasqua",valid_from:"31/03/24",tickets:[{name:"Biglietto intero",price:"8",id:"1",description:"-"},{name:"Biglietto ridotto",price:"6",id:"2",description:"Il biglietto ridotto è riservato a: visitatori di età compresa tra i 6 e i 25 anni, residenti nel Comune di Brescia"},{name:"Biglietto gratuito",price:"0",id:"3",description:"Il biglietto gratuito è riservato a: visitatori di età compresa tra 0 e 5 anni, persone con disabilità (con accompagnatore per chi lo necessita), titolari Abbonamento Musei Lombardia Valle d'Aosta e Formula Extra, guide turistiche abilitate, giornalisti accreditati (previa comunicazione all’indirizzo e-mail booking@kalata.it)"}],week:"Dom",time_slots:[{time:"10:00",seats:"15",id:"1"},{time:"11:30",seats:"15",id:"2"},{time:"14:00",seats:"15",id:"3"},{time:"15:30",seats:"15",id:"4"}],enabled:!0,id:1}];b.value=y});const n=P(),o=_(),s=_(),e=_(),x=_(),v=_(!0),f=_(),u=_(0),d=_(!1),p=_([]),V=_(),b=_(),C=ne(),l=J(),r=T(()=>l.submitDialog);function h(){v.value=!0,setTimeout(()=>{i()},Math.random()*1e3+250)}const i=async function(){await C.fetchAllConfigurations().then(()=>{v.value=!1}).catch(y=>{v.value=!1,A(n,y)})},w=function(y){e.value=y;let K="Sei sicuro di voler eliminare questo percorso?";l.setDialog("Elimina percorso","Elimina","Annulla",K),l.setBtnSubmit(!1),l.setDynamicDialogVisibility(!0)},k=async function(){await C.deleteConfiguration(e.value).then(()=>{v.value=!1,U(n,{message:"Percorso eliminato correttamente",error:!1}),h()}).catch(y=>{v.value=!1,A(n,y)})},m=function(){},S=function(y){x.value=y,d.value=!0};return F(r,y=>{y&&k()}),{dt:o,responseConfigurations:b,loading:v,totalRecords:u,lazyParams:f,op:s,visible:d,currentConfiguration:x,courses:p,course_id:V,loadLazyData:h,onDeleteConfiguration:k,confirmDelete:w,addConfiguration:m,onEditConfiguration:S}},components:{BookingExceptionDialog:zo}},Uo={class:"flex justify-content-between mt-4 mb-3"},Ro={class:"field flex flex-column"},jo=a("label",{for:"location"},"Percorso",-1),Fo={class:"flex justify-content-center"};function Lo(n,o,s,e,x,v){const f=c("Dropdown"),u=c("Button"),d=c("Column"),p=c("InputSwitch"),V=c("DataTable"),b=c("BookingExceptionDialog"),C=c("Dialog"),l=N("tooltip");return D(),B(R,null,[a("div",Uo,[a("div",Ro,[jo,t(f,{modelValue:e.course_id,"onUpdate:modelValue":o[0]||(o[0]=r=>e.course_id=r),options:e.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location"},null,8,["modelValue","options"])]),t(u,{label:"Configurazione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:o[1]||(o[1]=r=>e.onEditConfiguration({}))})]),t(V,{value:e.responseConfigurations,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:""},{empty:g(()=>[I(" Nessuna eccezione trovata. ")]),default:g(()=>[t(d,{header:"Nome",field:"name"}),t(d,{header:"Il"},{body:g(({data:r})=>[I(E(r.valid_from),1)]),_:1}),t(d,{header:"Percorso",field:"course_name"}),t(d,{header:"Stato"},{body:g(({data:r})=>[t(p,{modelValue:r.enabled,"onUpdate:modelValue":h=>r.enabled=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(d,{header:""},{body:g(({data:r})=>[a("div",Fo,[z(t(u,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>e.onEditConfiguration(r)},null,8,["onClick"]),[[l,"Duplica",void 0,{top:!0}]]),z(t(u,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>e.onEditConfiguration(r)},null,8,["onClick"]),[[l,"Modifica",void 0,{top:!0}]]),z(t(u,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>e.confirmDelete(r.id)},null,8,["onClick"]),[[l,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),t(C,{visible:e.visible,"onUpdate:visible":o[2]||(o[2]=r=>e.visible=r),modal:"",header:"Modifica configurazione",style:{width:"70rem"}},{default:g(()=>[t(b,{config:e.currentConfiguration},null,8,["config"])]),_:1},8,["visible"])],64)}const Po=L(Eo,[["render",Lo]]),Mo={setup(){j(()=>{e()});const n=_({}),o=ae(),s=T(()=>o.allLocations),e=async function(){await o.fetchAllLocations()};return F(s,()=>{n.value.location_id=s.value[0].id}),{form:n,locations:s}},components:{CourseTable:Ce,OpeningsTable:fo,BookingExceptionTable:Po}},No=a("h1",null,"Configurazioni",-1),Oo={class:"field col-3 flex flex-column"},Go=a("label",{for:"location"},"Location",-1);function qo(n,o,s,e,x,v){const f=c("Dropdown"),u=c("CourseTable"),d=c("TabPanel"),p=c("OpeningsTable"),V=c("BookingExceptionTable"),b=c("TabView");return D(),B("div",null,[No,a("div",Oo,[Go,t(f,{modelValue:e.form.location_id,"onUpdate:modelValue":o[0]||(o[0]=C=>e.form.location_id=C),options:e.locations,optionLabel:"name",optionValue:"id",placeholder:"",name:"location"},null,8,["modelValue","options"])]),e.form.location_id?(D(),W(b,{key:0},{default:g(()=>[t(d,{header:"Percorsi"},{default:g(()=>[t(u)]),_:1}),t(d,{header:"Aperture"},{default:g(()=>[t(p)]),_:1}),t(d,{header:"Eccezioni"},{default:g(()=>[t(V)]),_:1})]),_:1})):le("",!0)])}const et=L(Mo,[["render",qo]]);export{et as default};
