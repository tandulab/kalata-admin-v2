import{o as x,a as L,l as m,c as A,x as N,i as j,_ as C,r as d,p as O,b as T,v as E,w as y,h as z,f as i,g as f,q as B,e as F}from"../index60043.js";import{e as V,p as q,a as M,s as w,u as P}from"./helpers60043.js";import{f as W,a as $}from"./formatData60043.js";import{u as I}from"./attraction60043.js";import{c as R,a as k}from"./index.esm60043.js";import{F as H}from"./vee-validate.esm60043.js";import{I as G}from"./InputTextWithValidation60043.js";import{u as J}from"./category60043.js";import"./datetime60043.js";import"./_commonjsHelpers60043.js";const K={props:["attraction_id"],setup(c){x(()=>{e.value=!0,s.value={first:0,rows:a.value.rows,sortField:null,sortOrder:null},s.value.page=0,D()});const o=L(),a=m(),t=m(),v=m(),p=m(),e=m(!0),s=m(),r=m(0),u=I(),l=A(()=>u.responseAttractions),n=N(),g=A(()=>n.submitDialog);function D(){e.value=!0,setTimeout(()=>{S()},Math.random()*1e3+250)}const S=async function(){await u.fetchAllAttractions().then(()=>{e.value=!1}).catch(_=>{e.value=!1,V(o,_)})},b=function(_){p.value=_;let U="Sei sicuro di voler eliminare questo bene?";n.setDialog("Elimina bene","Elimina","Annulla",U),n.setBtnSubmit(!1),n.setDynamicDialogVisibility(!0)},h=async function(){await u.deleteAttraction(p.value).then(()=>{e.value=!1,w(o,{message:"Bene eliminato correttamente",error:!1}),D()}).catch(_=>{e.value=!1,V(o,_)})};return j(g,_=>{_&&h()}),{dt:a,responseAttractions:l,loading:e,totalRecords:r,lazyParams:s,currentOrder:t,op:v,loadLazyData:D,onDeleteAttraction:h,confirmDelete:b,formatDataAndHourFromUnixTimestamps:W,formatPrettyDate:$,prettyPaymentStatus:q,prettyTicketType:M}}},Q={class:"flex justify-content-center"};function X(c,o,a,t,v,p){const e=d("Column"),s=d("InputSwitch"),r=d("Button"),u=d("DataTable"),l=O("tooltip");return T(),E(u,{value:t.responseAttractions.attractions,lazy:!0,paginator:!1,ref:"dt",loading:t.loading,stripedRows:""},{empty:y(()=>[z(" Nessun bene trovato. ")]),default:y(()=>[i(e,{header:"Nome",field:"name"}),i(e,{header:"Link prenotazione biglietti",field:"permalink"}),i(e,{header:""},{body:y(({data:n})=>[i(s,{modelValue:n.online,"onUpdate:modelValue":g=>n.online=g},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(e,{header:""},{body:y(({data:n})=>[f("div",Q,[B(i(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:g=>c.$emit("onEdit",n)},null,8,["onClick"]),[[l,"Modifica",void 0,{top:!0}]]),B(i(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:g=>t.confirmDelete(n.id)},null,8,["onClick"]),[[l,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const Y=C(K,[["render",X]]),Z={props:["attraction"],setup(c,o){x(()=>{var b;c.attraction&&c.attraction.id&&(a.value=Object.assign({},c.attraction),a.value.price=(b=a.value.ticket_configurations[0])==null?void 0:b.price,delete a.value.ticket_configurations),S()});const a=m({}),t=R({name:k().required("Nome bene obbligatorio"),address:k().required("Luogo di ritrovo obbligatorio"),price:k().required("Importo biglietto obbligatorio")}),{showLoader:v,hideLoader:p}=P(),e=L(),s=I(),r=J(),u=A(()=>s.allAttractions),l=A(()=>r.allCategories),n=function(){v();const b=Object.assign({},a.value);b.ticket_configurations=[{price:b.price,name:"Biglietto intero"}];const h={attraction:b};s.addAttraction(h).then(()=>{p(),w(e,{message:"Bene aggiunto correttamente",error:!1}),o.emit("onSubmit")}).catch(_=>{p(),V(e,_)})},g=function(){v();const h={attraction:Object.assign({},a.value)};s.updateAttraction(h).then(()=>{p(),w(e,{message:"Chiusura modificata correttamente",error:!1}),o.emit("onSubmit")}).catch(_=>{p(),V(e,_)})},D=function(){a.value.id?g():n()},S=async function(){await r.fetchAllCategories()};return j(l,()=>{a.value.category||(a.value.category=l.value[0])}),{form:a,schema:t,onSubmit:D,attractions:u,categories:l}},components:{Form:H,InputTextWithValidation:G}},tt={class:"formgrid grid mt-3"},ot={class:"field col-12"},et={class:"field col-12"},nt={class:"field col-12"},at={class:"field col-12 flex flex-column"},it=f("label",{for:"category"},"Categoria",-1),lt={class:"flex align-items-center col-12"},rt=f("label",{for:"free_ticket",class:"ml-2"}," Biglietto gratuito ",-1),st={class:"flex align-items-center justify-content-end mt-6"};function ct(c,o,a,t,v,p){const e=d("InputTextWithValidation"),s=d("Dropdown"),r=d("Checkbox"),u=d("Button"),l=d("Form");return T(),E(l,{onSubmit:t.onSubmit,"validation-schema":t.schema},{default:y(()=>[f("div",tt,[f("div",ot,[i(e,{name:"name",label:"Nome bene*",modelValue:t.form.name,"onUpdate:modelValue":o[0]||(o[0]=n=>t.form.name=n)},null,8,["modelValue"])]),f("div",et,[i(e,{name:"address",label:"Luogo di ritrovo*",modelValue:t.form.address,"onUpdate:modelValue":o[1]||(o[1]=n=>t.form.address=n)},null,8,["modelValue"])]),f("div",nt,[i(e,{name:"price",label:"Importo biglietto*",modelValue:t.form.price,"onUpdate:modelValue":o[2]||(o[2]=n=>t.form.price=n)},null,8,["modelValue"])]),f("div",at,[it,i(s,{modelValue:t.form.category,"onUpdate:modelValue":o[3]||(o[3]=n=>t.form.category=n),options:t.categories,optionLabel:"label",optionValue:"value",placeholder:"",name:"category"},null,8,["modelValue","options"])])]),f("div",lt,[i(r,{modelValue:t.form.free_ticket,"onUpdate:modelValue":o[4]||(o[4]=n=>t.form.free_ticket=n),inputId:"free_ticket",binary:""},null,8,["modelValue"]),rt]),f("div",st,[i(u,{label:"Annulla",text:""}),i(u,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const dt=C(Z,[["render",ct]]),ut={setup(){x(()=>{});const c=m(!1),o=m({}),a=m(),t=m();return{form:o,attractionTable:a,visibleDialog:c,currentAttraction:t,filterTable:function(r){o.value=r,a.value.loadLazyData()},onShowDialog:function(){t.value={},c.value=!0},onEdit:function(r){t.value=r,c.value=!0},onSubmit:function(){a.value.loadLazyData(),c.value=!1}}},components:{AttractionTable:Y,AttractionDialog:dt}},mt=f("h1",null,"Beni",-1),ft={class:"flex justify-content-end mt-4 mb-3"};function pt(c,o,a,t,v,p){const e=d("Button"),s=d("AttractionTable"),r=d("AttractionDialog"),u=d("Dialog");return T(),F("div",null,[mt,f("div",ft,[i(e,{label:"Bene",icon:"pi pi-plus",rounded:"",outlined:"",onClick:o[0]||(o[0]=l=>t.onShowDialog())})]),i(s,{filters:t.form,ref:"attractionTable",onOnEdit:o[1]||(o[1]=l=>t.onEdit(l))},null,8,["filters"]),i(u,{visible:t.visibleDialog,"onUpdate:visible":o[3]||(o[3]=l=>t.visibleDialog=l),modal:"",header:"Bene",style:{width:"35rem"}},{default:y(()=>[i(r,{attraction:t.currentAttraction,onOnSubmit:o[2]||(o[2]=l=>t.onSubmit())},null,8,["attraction"])]),_:1},8,["visible"])])}const kt=C(ut,[["render",pt]]);export{kt as default};
