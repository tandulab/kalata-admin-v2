import{u as ye}from"./location74600.js";import{u as oe,e as j,s as O,f as ze}from"./helpers74600.js";import{x as Y,z as $,B as de,y as ue,A as me,o as J,l as C,a as K,u as Te,c as R,i as N,_ as Q,r as m,m as te,b as U,s as H,w as p,g as a,f as i,e as F,t as M,q as P,h as W,p as G,v as _e,F as Z,D as re}from"../index74600.js";import{c as fe,a as ge}from"./index.esm74600.js";import{F as le}from"./vee-validate.esm74600.js";import{I as pe}from"./InputTextWithValidation74600.js";import{u as xe}from"./category74600.js";import{u as Ee}from"./upload74600.js";import{d as Ce,e as se,a as ee,b as ae,g as Se}from"./formatData74600.js";import{D as Le}from"./datetime74600.js";import"./attraction74600.js";import"./_commonjsHelpers74600.js";/* empty css                                                                            */class ce{static async fetchAll(e){return(await Y(`/admin/locations/${e}/courses`)).data}static async addCourse(e){return(await $(`/admin/locations/${e.location_id}/courses`,e)).data.course}static async updateCourse(e){return(await de(`/admin/locations/${e.location_id}/courses/${e.course.id}`,e)).data.course}static async deleteCourse(e){return await ue(`/admin/courses/${e}`)}}const Ue=me({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:t=>t.courses,responseCourses:t=>t.response_courses,getTotalCourses:t=>t.response_courses?t.response_courses.total:0,getCurrentCourse:t=>t.course},actions:{async fetchAllCourses(t){await ce.fetchAll(t).then(e=>{this.response_courses=e,this.courses=e.courses})},async addCourse(t){await ce.addCourse(t).then(e=>{this.course=e})},async updateCourse(t){await ce.updateCourse(t).then(e=>{this.course=e})},async deleteCourse(t){await ce.deleteCourse(t).then()}}});class ie{static async fetchAll(e){return(await Y(`/admin/courses/${e}/tickets`)).data}static async addTicket(e){return await $(`/admin/courses/${e.course_id}/tickets`,e)}static async updateTicket(e){return await de(`/admin/courses/${e.course_id}/tickets/${e.ticket.id}`,e)}static async updateAllTickets(e){const n=e.course_id;return delete e.course_id,await $(`/admin/courses/${n}/tickets/update_tickets`,e)}static async deleteTicket(e){return await ue(`/admin/courses/${e.course_id}/tickets/${e.ticket_id}`)}}const Me=me({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{}}),getters:{allTickets:t=>t.tickets,responseTickets:t=>t.response_tickets,getTotalTickets:t=>t.response_tickets?t.response_tickets.total:0,getCurrentTicket:t=>t.ticket},actions:{async fetchAllTickets(t){await ie.fetchAll(t).then(e=>{this.response_tickets=e,this.tickets=e.tickets})},async addTicket(t){await ie.addTicket(t).then()},async updateTicket(t){await ie.updateTicket(t).then()},async deleteTicket(t){await ie.deleteTicket(t).then()},async updateAllTickets(t){await ie.updateAllTickets(t)}}}),Fe={props:["course","location_id"],setup(t,e){J(()=>{t.course&&t.course.id?(n.value=Object.assign({},t.course),L()):n.value.translations={it:{name:{id:null,text:""},description:{id:null,text:""}},en:{name:{id:null,text:""},description:{id:null,text:""}}},n.value.tickets=[]});const n=C({}),o=C([]),V=C("it"),x=fe({name:ge().required("Nome percorso obbligatorio")}),{showLoader:d,hideLoader:r}=oe(),f=K(),h=Ue(),u=xe(),b=Me(),v=Te(),s=C(!1),g=Ee(),D=R(()=>h.allCourses),B=R(()=>u.allCategories),l=R(()=>b.responseTickets),k=R(()=>h.getCurrentCourse),c=R(()=>v.languages),T=R(()=>g.responseUploads),A=function(w){d(),h.addCourse(w).then(()=>{r(),O(f,{message:"Percorso aggiunto correttamente",error:!1}),e.emit("onSubmit")}).catch(E=>{r(),j(f,E)})},L=async function(){let w=t.course.id?t.course.id:k.value.id;d(),await b.fetchAllTickets(w).then(()=>{r()}).catch(E=>{r(),j(f,E)})},q=function(w){d(),h.updateCourse(w).then(()=>{r(),O(f,{message:"Percorso modificato correttamente",error:!1}),e.emit("onSubmit")}).catch(E=>{r(),j(f,E)})},S=function(){const w=Object.assign({},n.value);let E={it:{name:w.translations.it.name.text,description:w.translations.it.description.text},en:{name:w.translations.en.name.text,description:w.translations.en.description.text}};w.translations=E,w.name=w.translations.it.name,w.description=w.translations.it.description;const I={course:w,location_id:t.location_id};n.value.id?q(I):A(I)},_=function(){let E={translations:{en:{name:{text:"",id:null},description:{text:"",id:null}},it:{name:{text:"",id:null},description:{text:"",id:null}}},price:0};n.value.tickets.push(E),o.value.push(E)},y=function(w,E){w.id?z(w):n.value.tickets.splice(E,1)},z=async function(w){const E={course_id:t.course.id?t.course.id:k.value.id,ticket_id:w.id};d(),await b.deleteTicket(E).then(()=>{r(),O(f,{message:"Biglietto eliminato correttamente",error:!1}),L()}).catch(I=>{r(),j(f,I)})},we=function(w){let{newData:E,index:I}=w;n.value.tickets[I]=E;let he={it:{name:E.translations.it.name.text,description:E.translations.it.description.text},en:{name:E.translations.en.name.text,description:E.translations.en.description.text}};E.translations=he,E.name=E.translations.it.name,E.description=E.translations.it.description,E.id?ke(E):Ve(E)},Ve=async function(w){const E={course_id:t.course.id?t.course.id:k.value.id,ticket:w};await b.addTicket(E).then(()=>{r(),O(f,{message:"Biglietto aggiunto correttamente",error:!1}),L()}).catch(I=>{r(),j(f,I)})},ke=async function(w){const E={course_id:t.course.id?t.course.id:k.value.id,ticket:w};await b.updateTicket(E).then(()=>{r(),O(f,{message:"Biglietto aggiornato correttamente",error:!1}),L()}).catch(I=>{r(),j(f,I)})},De=function(w){n.value.image_url=w},Ae=function(w){let E={it:{name:w.translations.it.name.text,description:w.translations.it.description.text},en:{name:w.translations.en.name.text,description:w.translations.en.description.text}};w.translations=E,w.id?ke(w):Ve(w)},Be=async w=>{let E=w.value;E.forEach((I,he)=>{I.position=he+1;let Re={it:{name:I.translations.it.name.text,description:I.translations.it.description.text},en:{name:I.translations.en.name.text,description:I.translations.en.description.text}};I.translations=Re,I.name=I.translations.it.name,I.description=I.translations.it.description});try{const I={course_id:t.course.id?t.course.id:k.value.id,tickets:E};await b.updateAllTickets(I),L(),O(f,{message:"Ordine biglietti aggiornato",error:!1})}catch(I){j(f,I)}},Ie=function(w){const E=w.files[0],I={upload:{filename:E.name,type:E.type,owner_id:t.course.id,owner_type:"Course"},file:E};g.uploadFile(I)},je=function(w){g.deleteFile(w).then(()=>{De(null)})};return N(B,()=>{n.value.category||(n.value.category=B.value[0])}),N(l,()=>{l.value&&l.value.tickets.length>0?n.value.tickets=Object.assign([],l.value.tickets):n.value.tickets=[]}),N(k,()=>{n.value=Object.assign({},k.value)}),N(T,()=>{debugger;let w=T.value.url;De(w)}),{form:n,schema:x,loading:s,editingRows:o,response_tickets:l,lang_selected:V,uploadedImage:T,onSubmit:S,addTicket:_,onDeleteTicket:y,onRowEditSave:we,updateTicketsApi:ke,onPublicTicket:Ae,onRowReorder:Be,onUploadImage:Ie,onDeleteFile:je,courses:D,categories:B,languages:c}},components:{Form:le,InputTextWithValidation:pe}};const Oe={class:"col-12 flex justify-content-end m-0 p-0 align-items-center"},Ne={key:0,class:"formgrid grid mt-3"},Pe={class:"field col-12"},We={class:"field col-12"},qe={for:"description"},He={class:"formgrid grid mt-3 banner"},Ge={class:"field col-6 flex flex-column"},Je=a("label",null,"Immagine",-1),Ke={key:0,class:"relative wrp-delete"},Qe=["src"],Xe={class:"field col-6 flex flex-column"},Ye={class:"field flex flex-column"},Ze=a("i",{class:"pi pi-link"},null,-1),$e={key:1,class:"flex justify-content-end mt-4 mb-3"},eo={key:0},oo={key:0},to={class:"w-full"},no={class:"flex justify-content-center"},io={class:"flex align-items-center justify-content-end mt-6"};function ao(t,e,n,o,V,x){const d=m("Dropdown"),r=m("InputTextWithValidation"),f=m("Textarea"),h=m("FileUpload"),u=m("InputText"),b=m("InputGroupAddon"),v=m("InputGroup"),s=m("Button"),g=m("Column"),D=m("InputSwitch"),B=m("DataTable"),l=m("Form"),k=te("tooltip");return U(),H(l,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:p(()=>[a("div",Oe,[i(d,{options:o.languages,optionLabel:"name",optionValue:"value",class:"m-2 capitalize dropdown-lng",modelValue:o.lang_selected,"onUpdate:modelValue":e[0]||(e[0]=c=>o.lang_selected=c)},null,8,["options","modelValue"])]),o.lang_selected&&o.form&&o.form.translations?(U(),F("div",Ne,[a("div",Pe,[i(r,{name:"name",label:"Nome percorso* ("+o.lang_selected.toUpperCase()+")",modelValue:o.form.translations[o.lang_selected].name.text,"onUpdate:modelValue":e[1]||(e[1]=c=>o.form.translations[o.lang_selected].name.text=c)},null,8,["label","modelValue"])]),a("div",We,[a("label",qe,"Descrizione ("+M(o.lang_selected.toUpperCase())+")",1),i(f,{rows:"5",cols:"30",name:"description",id:"description",label:"Nome percorso*",modelValue:o.form.translations[o.lang_selected].description.text,"onUpdate:modelValue":e[2]||(e[2]=c=>o.form.translations[o.lang_selected].description.text=c),class:"w-full"},null,8,["modelValue"])])])):P("",!0),a("div",He,[a("div",Ge,[Je,o.form.image_url?(U(),F("div",Ke,[a("img",{src:o.form.image_url,style:{"max-width":"200px"}},null,8,Qe)])):P("",!0),i(h,{mode:"basic",name:"demo[]",url:"/api/upload",accept:"image/*",customUpload:"",auto:!0,onUploader:e[3]||(e[3]=c=>o.onUploadImage(c)),class:"mt-3"})]),a("div",Xe,[a("div",Ye,[a("label",null,'Testo "Scopri di più" ('+M(o.lang_selected.toUpperCase())+")",1),o.lang_selected==="it"?(U(),H(u,{key:0,modelValue:o.form.discover_more_link_text,"onUpdate:modelValue":e[4]||(e[4]=c=>o.form.discover_more_link_text=c)},null,8,["modelValue"])):P("",!0),o.lang_selected==="en"?(U(),H(u,{key:1,modelValue:o.form.discover_more_link_text_en,"onUpdate:modelValue":e[5]||(e[5]=c=>o.form.discover_more_link_text_en=c)},null,8,["modelValue"])):P("",!0)]),a("label",null,'Link "Scopri di più" ('+M(o.lang_selected.toUpperCase())+")",1),i(v,null,{default:p(()=>[i(b,null,{default:p(()=>[Ze]),_:1}),o.lang_selected==="it"?(U(),H(u,{key:0,modelValue:o.form.discover_more_link,"onUpdate:modelValue":e[6]||(e[6]=c=>o.form.discover_more_link=c)},null,8,["modelValue"])):P("",!0),o.lang_selected==="en"?(U(),H(u,{key:1,modelValue:o.form.discover_more_link_en,"onUpdate:modelValue":e[7]||(e[7]=c=>o.form.discover_more_link_en=c)},null,8,["modelValue"])):P("",!0)]),_:1})])]),o.form.id?(U(),F("div",$e,[i(s,{label:"Tipologia biglietto",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[8]||(e[8]=c=>o.addTicket())})])):P("",!0),o.form.id&&o.lang_selected?(U(),H(B,{key:2,value:o.form.tickets,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[9]||(e[9]=c=>o.editingRows=c),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave,reorderableColumns:!0,onRowReorder:o.onRowReorder},{empty:p(()=>[W(" Nessun biglietto trovato. ")]),default:p(()=>[i(g,{rowReorder:"",headerStyle:"width: 3rem",reorderableColumn:!1}),i(g,{header:"Tipo biglietto",style:{"min-width":"150px"},field:"name"},{body:p(({data:c})=>{var T;return[c.translations[o.lang_selected].name?(U(),F("span",eo,M((T=c.translations[o.lang_selected].name)==null?void 0:T.text),1)):P("",!0)]}),editor:p(({data:c,field:T})=>[i(u,{modelValue:c.translations[o.lang_selected][T].text,"onUpdate:modelValue":A=>c.translations[o.lang_selected][T].text=A,name:"ticket_name_"+o.lang_selected,id:"ticket_name_"+o.lang_selected,type:"text"},null,8,["modelValue","onUpdate:modelValue","name","id"])]),_:1}),i(g,{header:"Descrizione",field:"description"},{body:p(({data:c})=>{var T;return[c.translations[o.lang_selected].description?(U(),F("span",oo,M((T=c.translations[o.lang_selected].description)==null?void 0:T.text),1)):P("",!0)]}),editor:p(({data:c,field:T})=>[a("div",to,[i(f,{modelValue:c.translations[o.lang_selected][T].text,"onUpdate:modelValue":A=>c.translations[o.lang_selected][T].text=A,class:"w-full",name:"desc_"+o.lang_selected},null,8,["modelValue","onUpdate:modelValue","name"])])]),_:1}),i(g,{header:"Prezzo",field:"price",bodyStyle:"min-width: 6rem"},{body:p(({data:c})=>[W(" € "+M((+c.price).toFixed(2)),1)]),editor:p(({data:c,field:T})=>[i(u,{modelValue:c[T],"onUpdate:modelValue":A=>c[T]=A},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(g,{header:"Stato",field:"public",bodyStyle:"min-width: 6rem"},{body:p(({data:c,field:T})=>[i(D,{modelValue:c[T],"onUpdate:modelValue":A=>c[T]=A,onChange:A=>o.onPublicTicket(c)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),editor:p(({data:c,field:T})=>[i(D,{modelValue:c[T],"onUpdate:modelValue":A=>c[T]=A},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(g,{rowEditor:!0,bodyStyle:"text-align:center; padding-right:0;min-width: 6rem"}),i(g,{header:"",style:{width:"3rem","padding-left":"0"}},{body:p(({data:c,index:T})=>[a("div",no,[G(i(s,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:A=>o.onDeleteTicket(c,T)},null,8,["onClick"]),[[k,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave","onRowReorder"])):P("",!0),a("div",io,[i(s,{label:"Annulla",text:"",onClick:e[10]||(e[10]=c=>t.$emit("onClose"))}),i(s,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const lo=Q(Fe,[["render",ao]]),so={props:["location_id"],setup(t){J(()=>{x.value=!0,d.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},d.value.page=0,g()});const e=K(),n=C(),o=C(),V=C(),x=C(!0),d=C(),r=C(0),f=C(!1),{showLoader:h,hideLoader:u}=oe(),b=Ue(),v=R(()=>b.responseCourses),s=_e();R(()=>s.submitDialog);function g(){h(),setTimeout(()=>{D()},Math.random()*1e3+250)}const D=async function(){x.value=!0,await b.fetchAllCourses(t.location_id).then(()=>{x.value=!1,u()}).catch(A=>{x.value=!1,u(),j(e,A)})},B=function(A){V.value=A,f.value=!0},l=function(A){V.value=A;let L="Sei sicuro di voler archiviare questo percorso?";s.setDialog("Archivia percorso","Archivia","Annulla",L),s.setBtnSubmit(!1),s.setDynamicDialogVisibility(!0)},k=function(A){const L=Object.assign({},A);let q={it:{name:L.translations.it.name.text,description:L.translations.it.description.text},en:{name:L.translations.en.name.text,description:L.translations.en.description.text}};L.translations=q;const S={course:L,location_id:t.location_id};b.updateCourse(S).then(()=>{u(),O(e,{message:"Percorso modificato correttamente",error:!1}),D()}).catch(_=>{u(),j(e,_)})},c=function(){return V.value&&V.value.id?"Modifica percorso":"Aggiungi percorso"},T=function(){D(),f.value=!1};return N(t,()=>{t.location_id&&D()}),{dt:n,responseCourses:v,loading:x,totalRecords:r,lazyParams:d,op:o,visible:f,currentCourse:V,loadLazyData:g,onEditCourse:B,closeDialog:T,getHeader:c,updateCourse:k,onArchiveCourse:l}},components:{CourseDialog:lo}},co={class:"flex justify-content-end mt-4 mb-3"},ro={class:"flex justify-content-center"};function uo(t,e,n,o,V,x){const d=m("Button"),r=m("Column"),f=m("InputSwitch"),h=m("DataTable"),u=m("CourseDialog"),b=m("Dialog"),v=te("tooltip");return U(),F(Z,null,[a("div",co,[i(d,{label:"Percorso",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=s=>o.onEditCourse({}))})]),i(h,{value:o.responseCourses.courses,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:p(()=>[W(" Nessun percorso trovato. ")]),default:p(()=>[i(r,{header:"Nome"},{body:p(({data:s})=>{var g;return[W(M((g=s.translations.it.name)==null?void 0:g.text),1)]}),_:1}),i(r,{header:"Tipologie biglietti"},{body:p(({data:s})=>[(U(!0),F(Z,null,re(s.tickets,g=>{var D;return U(),F("div",{key:g.id},M((D=g.translations.it.name)==null?void 0:D.text),1)}),128))]),_:1}),i(r,{header:"Prezzo"},{body:p(({data:s})=>[(U(!0),F(Z,null,re(s.tickets,g=>(U(),F("div",{key:g.id}," € "+M((+g.price).toFixed(2)),1))),128))]),_:1}),i(r,{header:"Stato"},{body:p(({data:s})=>[i(f,{modelValue:s.public,"onUpdate:modelValue":g=>s.public=g,onChange:g=>o.updateCourse(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),i(r,{header:""},{body:p(({data:s})=>[a("div",ro,[G(i(d,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:g=>o.onEditCourse(s),class:"mr-2"},null,8,["onClick"]),[[v,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),i(b,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=s=>o.visible=s),modal:"",header:o.getHeader(),style:{width:"70rem"},onHide:e[4]||(e[4]=s=>o.closeDialog())},{default:p(()=>[i(u,{course:o.currentCourse,location_id:n.location_id,onOnSubmit:e[1]||(e[1]=s=>o.closeDialog()),onOnClose:e[2]||(e[2]=s=>o.closeDialog())},null,8,["course","location_id"])]),_:1},8,["visible","header"])],64)}const mo=Q(so,[["render",uo]]),_o={props:["location"],setup(t,e){J(()=>{t.location&&(n.value=Object.assign({},t.location))});const n=C({}),{showLoader:o,hideLoader:V}=oe(),x=K(),d=C("it"),r=Te(),f=Ee(),h=ye(),u=R(()=>r.languages),b=R(()=>f.responseUploads),v=async function(){o();let s={it:{booking_title:n.value.translations.it.booking_title.text,booking_description:n.value.translations.it.booking_description.text},en:{booking_title:n.value.translations.en.booking_title.text,booking_description:n.value.translations.en.booking_description.text}};const g={location_id:n.value.id,location:{...n.value}};g.location.translations={...s},await h.updateLocation(g).then(()=>{V(),O(x,{message:"Location aggiornata correttamente",error:!1})}).catch(D=>{V(),j(x,D)})};return N(()=>t.location,s=>{s&&(n.value=Object.assign({},s))},{deep:!0}),{form:n,lang_selected:d,uploadedImage:b,languages:u,onSubmit:v}},components:{Form:le}},fo={class:"col-12 flex justify-content-end m-0 p-0 align-items-center mt-4"},go={class:"flex gap-3"},po={key:0,class:"formgrid col-6 card mt-3"},vo={class:"col-12 mt-0 p-0"},bo={class:"field"},ko={key:1,class:"formgrid col-6 card mt-3"},ho={class:"col-12 mt-0 p-0"},Co={class:"field"},yo={class:"flex align-items-center justify-content-end mt-6"};function xo(t,e,n,o,V,x){const d=m("Dropdown"),r=m("Editor"),f=m("Button"),h=m("Form");return o.form?(U(),H(h,{key:0,onSubmit:o.onSubmit,class:"banner"},{default:p(()=>[a("div",fo,[i(d,{options:o.languages,optionLabel:"name",optionValue:"value",class:"m-2 capitalize dropdown-lng",modelValue:o.lang_selected,"onUpdate:modelValue":e[0]||(e[0]=u=>o.lang_selected=u)},null,8,["options","modelValue"])]),a("div",go,[o.form.translations?(U(),F("div",po,[a("h3",vo,"Titolo ("+M(o.lang_selected.toUpperCase())+")",1),a("div",bo,[i(r,{modelValue:o.form.translations[o.lang_selected].booking_title.text,"onUpdate:modelValue":e[1]||(e[1]=u=>o.form.translations[o.lang_selected].booking_title.text=u),editorStyle:"height: 320px"},null,8,["modelValue"])])])):P("",!0),o.form.translations?(U(),F("div",ko,[a("h3",ho,"Descrizione ("+M(o.lang_selected.toUpperCase())+")",1),a("div",Co,[i(r,{modelValue:o.form.translations[o.lang_selected].booking_description.text,"onUpdate:modelValue":e[2]||(e[2]=u=>o.form.translations[o.lang_selected].booking_description.text=u),editorStyle:"height: 320px"},null,8,["modelValue"])])])):P("",!0)]),a("div",yo,[i(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit"])):P("",!0)}const wo=Q(_o,[["render",xo]]);class ne{static async fetchAll(e){return e?(await Y("/admin/booking_rules",e)).data:{}}static async getCourses(e){return(await Y("/admin/booking_rules/courses",e)).data}static async getTickets(e){return(await Y("/admin/booking_rules/tickets",e)).data}static async addConfiguration(e){return await $("/admin/booking_rules",e)}static async updateConfiguration(e){return await de(`/admin/booking_rules/${e.booking_rule.id}`,e)}static async deleteConfiguration(e){return e==null?{}:await ue(`/admin/booking_rules/${e}`)}}const ve=me({id:"configuration",state:()=>({configuration:{},configurations:[],response_configurations:{},response_courses:{},response_tickets:{}}),getters:{allConfigurations:t=>t.configurations,responseConfigurations:t=>t.response_configurations,getTotalConfigurations:t=>t.response_configurations?t.response_configurations.total:0,getCurrentConfiguration:t=>t.configuration,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets},actions:{async fetchAllConfigurations(t){await ne.fetchAll(t).then(e=>{this.response_configurations=e,this.configurations=e.configurations})},async getAllCourses(t){await ne.getCourses(t).then(e=>{this.response_courses=ze(e)})},async getAllTickets(t){await ne.getTickets(t).then(e=>{this.response_tickets=e})},async addConfiguration(t){await ne.addConfiguration(t).then()},async updateConfiguration(t){await ne.updateConfiguration(t).then()},async deleteConfiguration(t){t!=null&&await ne.deleteConfiguration(t).then()}}}),Vo={props:["config","location_id","course_id","duplicate"],setup(t,e){J(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.from_date&&(n.value.from_date=Ce(n.value.from_date)),n.value.to_date&&(n.value.to_date=Ce(n.value.to_date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_rule_slots=[]),q()});const n=C({}),o=C([]),V=C(!1),x=fe({name_config:ge().required("Nome configurazione obbligatoria")}),{showLoader:d,hideLoader:r}=oe(),f=K(),h=xe(),u=C(!1),b=ve(),v=R(()=>h.allCategories),s=R(()=>b.responseTickets),g=R(()=>b.responseCourses),D=function(){d();const S=Object.assign({},n.value);S.from_date&&(S.from_date=se(S.from_date)),S.to_date&&(S.to_date=se(S.to_date)),S.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(y=>{y.available_seats!=""&&y.start_at!=""&&S.booking_rule_slots.push(y)});const _={booking_rule:S};b.addConfiguration(_).then(()=>{r(),O(f,{message:"Configurazione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(y=>{r(),j(f,y)})},B=function(){d();const S=Object.assign({},n.value);S.from_date&&(S.from_date=se(S.from_date)),S.to_date&&(S.to_date=se(S.to_date)),S.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(y=>{y.available_seats!=""&&y.start_at!=""&&S.booking_rule_slots.push(y)});const _={booking_rule:S};b.updateConfiguration(_).then(()=>{r(),O(f,{message:"Configurazione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(y=>{r(),j(f,y)})},l=function(){n.value.id?B():D()},k=function(){let S={};S.price=0,n.value.tickets.unshift(S),o.value.push(n.value.tickets[0])},c=function(S){let{newData:_,index:y}=S;n.value.booking_rule_slots[y]=_},T=function(){let S={start_at:"",available_seats:"",id:"-1"};n.value.booking_rule_slots.push(S),o.value.push(S)},A=function(S,_){n.value.booking_rule_slots.splice(_,1)},L=function(S){S?n.value.wdays=[0,1,2,3,4,5,6]:n.value.wdays=[]},q=function(){const S=new Map;S.set("location_id",n.value.location_id),S.set("course_id",n.value.course_id),b.getAllTickets(S).catch(_=>{j(f,_)})};return N(v,()=>{n.value.category||(n.value.category=v.value[0])}),{form:n,schema:x,loading:u,editingRows:o,check_all:V,onSubmit:l,addTicket:k,onRowEditSave:c,checkAll:L,deleteSlot:A,addSlot:T,fetchAllTickets:q,categories:v,responseCourses:g,responseTickets:s}},components:{Form:le,InputTextWithValidation:pe}};const Do={class:"formgrid grid mt-3"},So={class:"field col-12"},To={class:"field flex flex-column col-6"},Eo=a("label",{for:"location"},"Percorso",-1),Uo={class:"field col-3"},Ao=a("label",{from:"date_from"},"Dal",-1),Bo={class:"field col-3"},Io=a("label",{from:"date_to"},"Al",-1),jo={class:"field col-12 mt-3"},Ro=a("label",null,"Giorni",-1),zo={class:"card flex flex-wrap gap-3 mt-2"},Lo={class:"flex align-items-center mr-4"},Mo=a("label",{for:"all",class:"ml-2"}," Tutti i giorni ",-1),Fo={class:"flex align-items-center"},Oo=a("label",{for:"lun",class:"ml-2"}," Lun ",-1),No={class:"flex align-items-center"},Po=a("label",{for:"mar",class:"ml-2"}," Mar ",-1),Wo={class:"flex align-items-center"},qo=a("label",{for:"mer",class:"ml-2"}," Mer ",-1),Ho={class:"flex align-items-center"},Go=a("label",{for:"gio",class:"ml-2"}," Gio ",-1),Jo={class:"flex align-items-center"},Ko=a("label",{for:"ven",class:"ml-2"}," Ven ",-1),Qo={class:"flex align-items-center"},Xo=a("label",{for:"sab",class:"ml-2"}," Sab ",-1),Yo={class:"flex align-items-center"},Zo=a("label",{for:"dom",class:"ml-2"}," Dom ",-1),$o={class:"field col-3 mt-3"},et=a("label",null,"Biglietti",-1),ot={for:"ticket.id",class:"ml-2 flex align-items-center"},tt={class:"inline-block",style:{"min-width":"150px"}},nt={class:"text-right"},it=a("div",{class:"col-9"},null,-1),at={class:"col-8 mt-3"},lt={class:"field flex justify-content-between align-items-end mt-4 mb-3"},st=a("label",null,"Orari",-1),ct={class:"flex justify-content-center"},rt={class:"flex align-items-center justify-content-end mt-6"};function dt(t,e,n,o,V,x){const d=m("InputTextWithValidation"),r=m("Dropdown"),f=m("Calendar"),h=m("Checkbox"),u=m("Button"),b=m("InputMask"),v=m("Column"),s=m("InputNumber"),g=m("DataTable"),D=m("Form"),B=te("tooltip");return U(),H(D,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:p(()=>[a("div",Do,[a("div",So,[i(d,{name:"name_config",label:"Nome configurazione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.form.name=l),id:"name_config",type:"text"},null,8,["modelValue"])]),a("div",To,[Eo,i(r,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=l=>o.form.course_id=l),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[2]||(e[2]=l=>{o.form.booking_rule_ticket_ids=[],o.fetchAllTickets()})},null,8,["modelValue","options"])]),a("div",Uo,[Ao,i(f,{inputId:"date_from",modelValue:o.form.from_date,"onUpdate:modelValue":e[3]||(e[3]=l=>o.form.from_date=l),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),a("div",Bo,[Io,i(f,{inputId:"date_to",modelValue:o.form.to_date,"onUpdate:modelValue":e[4]||(e[4]=l=>o.form.to_date=l),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),a("div",jo,[Ro,a("div",zo,[a("div",Lo,[i(h,{modelValue:o.check_all,"onUpdate:modelValue":[e[5]||(e[5]=l=>o.check_all=l),e[6]||(e[6]=l=>o.checkAll(l))],inputId:"all",name:"week",binary:!0},null,8,["modelValue"]),Mo]),a("div",Fo,[i(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[7]||(e[7]=l=>o.form.wdays=l),inputId:"lun",name:"week",value:1},null,8,["modelValue"]),Oo]),a("div",No,[i(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[8]||(e[8]=l=>o.form.wdays=l),inputId:"mar",name:"week",value:2},null,8,["modelValue"]),Po]),a("div",Wo,[i(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[9]||(e[9]=l=>o.form.wdays=l),inputId:"mer",name:"week",value:3},null,8,["modelValue"]),qo]),a("div",Ho,[i(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[10]||(e[10]=l=>o.form.wdays=l),inputId:"gio",name:"week",value:4},null,8,["modelValue"]),Go]),a("div",Jo,[i(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[11]||(e[11]=l=>o.form.wdays=l),inputId:"ven",name:"week",value:5},null,8,["modelValue"]),Ko]),a("div",Qo,[i(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[12]||(e[12]=l=>o.form.wdays=l),inputId:"sab",name:"week",value:6},null,8,["modelValue"]),Xo]),a("div",Yo,[i(h,{modelValue:o.form.wdays,"onUpdate:modelValue":e[13]||(e[13]=l=>o.form.wdays=l),inputId:"dom",name:"week",value:0},null,8,["modelValue"]),Zo])])]),a("div",$o,[et,(U(!0),F(Z,null,re(o.responseTickets.tickets,l=>{var k;return U(),F("div",{key:l.id,class:"flex align-items-center mb-2 mt-2"},[i(h,{modelValue:o.form.booking_rule_ticket_ids,"onUpdate:modelValue":e[14]||(e[14]=c=>o.form.booking_rule_ticket_ids=c),inputId:l.id+"",value:l.id},null,8,["modelValue","inputId","value"]),a("label",ot,[a("div",tt,M((k=l.translations)==null?void 0:k.it.name.text),1),a("div",nt,"€ "+M(l.price),1)])])}),128))]),it,a("div",at,[a("div",lt,[st,i(u,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[15]||(e[15]=l=>o.addSlot())})]),i(g,{value:o.form.booking_rule_slots,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[16]||(e[16]=l=>o.editingRows=l),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:p(()=>[W(" Nessuno slot orario trovato. ")]),default:p(()=>[i(v,{header:"Ora",field:"start_at"},{editor:p(({data:l,field:k})=>[i(b,{id:"basic",modelValue:l[k],"onUpdate:modelValue":c=>l[k]=c,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(v,{header:"Posti",field:"available_seats"},{editor:p(({data:l,field:k})=>[i(s,{modelValue:l[k],"onUpdate:modelValue":c=>l[k]=c,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(v,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),i(v,{header:"",style:{width:"3rem","padding-left":"0"}},{body:p(({data:l,index:k})=>[a("div",ct,[G(i(u,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:c=>o.deleteSlot(l,k)},null,8,["onClick"]),[[B,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","editingRows","onRowEditSave"])])]),a("div",rt,[i(u,{label:"Annulla",text:"",onClick:e[17]||(e[17]=l=>t.$emit("onClose"))}),i(u,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const ut=Q(Vo,[["render",dt]]),mt={props:["location_id"],setup(t){J(()=>{d.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,t.location_id&&l(t.location_id)});const e=K(),n=C(),o=C(),V=C(),x=C(),d=C(!0),r=C(),f=C(0),h=C(!1),u=C(),b=C(!1),v=ve(),s=R(()=>v.responseConfigurations),g=_e(),D=R(()=>g.submitDialog),B=R(()=>v.responseCourses),l=async function(_){const y=new Map;y.set("location_id",_),await v.getAllCourses(y).then(()=>{d.value=!1}).catch(z=>{d.value=!1,j(e,z)})},k=async function(_){if(!_)return;d.value=!0;const y=new Map;y.set("location_id",t.location_id),y.set("course_id",_),await v.fetchAllConfigurations(y).then(()=>{d.value=!1}).catch(z=>{d.value=!1,j(e,z)})},c=function(_){V.value=_;let y="Sei sicuro di voler eliminare questa configurazione?";g.setDialog("Elimina configurazione","Elimina","Annulla",y),g.setBtnSubmit(!1),g.setDynamicDialogVisibility(!0)},T=async function(){V.value&&await v.deleteConfiguration(V.value).then(()=>{d.value=!1,O(e,{message:"Configurazione eliminata correttamente",error:!1}),k(u.value)}).catch(_=>{d.value=!1,j(e,_)})},A=function(_,y){x.value=_,h.value=!0,b.value=y},L=function(_){return _.map(z=>Le.local(2022,1,2+z).setLocale("it").toFormat("ccc")).join(", ")},q=function(_){u.value=_,k(u.value),h.value=!1},S=function(){return b.value?"Duplica configurazione":x.value&&x.value.id&&!b.value?"Modifica configurazione":"Nuova configurazione"};return N(D,_=>{D.value&&T()}),N(B,()=>{B.value.courses&&B.value.courses[0]&&(u.value=B.value.courses[0].id,k(u.value))}),N(t,()=>{t.location_id&&l(t.location_id)}),{dt:n,responseConfigurations:s,loading:d,totalRecords:f,lazyParams:r,op:o,visible:h,currentConfiguration:x,responseCourses:B,course_id:u,flag_duplicate:b,fromMMDDtoDDMM:Ce,onDeleteConfiguration:T,confirmDelete:c,onEditConfiguration:A,fetchAllConfigurations:k,convertWdays:L,closeDialog:q,getHeader:S}},components:{ConfigurationDialog:ut}},_t={class:"flex justify-content-between mt-4 mb-3"},ft={class:"field flex flex-column"},gt=a("label",{for:"location"},"Percorso",-1),pt={class:"capitalize"},vt={class:"flex justify-content-center"};function bt(t,e,n,o,V,x){const d=m("Dropdown"),r=m("Button"),f=m("Column"),h=m("DataTable"),u=m("ConfigurationDialog"),b=m("Dialog"),v=te("tooltip");return U(),F(Z,null,[a("div",_t,[a("div",ft,[gt,i(d,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=s=>o.course_id=s),options:o.responseCourses.courses,optionLabel:"translations.it.name.text",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=s=>o.fetchAllConfigurations(o.course_id))},null,8,["modelValue","options"])]),i(r,{label:"Configurazione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=s=>o.onEditConfiguration({},!1))})]),i(h,{value:o.responseConfigurations.booking_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:p(()=>[W(" Nessuna configurazione trovata. ")]),default:p(()=>[i(f,{header:"Nome",field:"name"}),i(f,{header:"Dal Al"},{body:p(({data:s})=>[W(M(o.fromMMDDtoDDMM(s.from_date))+" - "+M(o.fromMMDDtoDDMM(s.to_date)),1)]),_:1}),i(f,{header:"Valida il",field:"week"},{body:p(({data:s})=>[a("div",pt,M(o.convertWdays(s.wdays)),1)]),_:1}),i(f,{header:""},{body:p(({data:s})=>[a("div",vt,[G(i(r,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:g=>o.onEditConfiguration(s,!0)},null,8,["onClick"]),[[v,"Duplica",void 0,{top:!0}]]),G(i(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:g=>o.onEditConfiguration(s,!1)},null,8,["onClick"]),[[v,"Modifica",void 0,{top:!0}]]),G(i(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:g=>o.confirmDelete(s.id)},null,8,["onClick"]),[[v,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),i(b,{visible:o.visible,"onUpdate:visible":e[5]||(e[5]=s=>o.visible=s),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:p(()=>[i(u,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=s=>o.closeDialog(s)),onOnClose:e[4]||(e[4]=s=>o.visible=!1),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const kt=Q(mt,[["render",bt]]);class X{static async fetchAll(e){return e?(await Y("/admin/booking_exception_rules",e)).data:{}}static async getCourses(e){return(await Y("/admin/booking_exception_rules/courses",e)).data}static async getTickets(e){return(await Y("/admin/booking_exception_rules/tickets",e)).data}static async addBookingException(e){return await $("/admin/booking_exception_rules",e)}static async updateBookingException(e){return await de(`/admin/booking_exception_rules/${e.booking_exception_rule.id}`,e)}static async deleteBookingException(e){return e==null?{}:await ue(`/admin/booking_exception_rules/${e}`)}static async fetchAllClosings(e){return e?(await Y(`/admin/booking_exception_rules/closings?location_id=${e.get("location_id")}`)).data:{}}static async createClosing(e){return await $("/admin/booking_exception_rules/closings",e)}static async deleteClosing(e){return await $("/admin/booking_exception_rules/delete_closings",e)}}const be=me({id:"booking_exception",state:()=>({booking_exception:{},booking_exceptions:[],response_booking_exceptions:{},response_courses:{},response_tickets:{},response_closings:{}}),getters:{allBookingExceptions:t=>t.booking_exceptions,responseBookingExceptions:t=>t.response_booking_exceptions,getTotalBookingExceptions:t=>t.response_booking_exceptions?t.response_booking_exceptions.total:0,getCurrentBookingException:t=>t.booking_exception,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets,responseClosings:t=>t.response_closings},actions:{async fetchAllBookingExceptions(t){await X.fetchAll(t).then(e=>{this.response_booking_exceptions=e,this.booking_exceptions=e.booking_exceptions})},async fetchAllClosings(t){await X.fetchAllClosings(t).then(e=>{this.response_closings=e})},async getAllCourses(t){await X.getCourses(t).then(e=>{this.response_courses=e})},async getAllTickets(t){await X.getTickets(t).then(e=>{this.response_tickets=e})},async addBookingException(t){await X.addBookingException(t).then()},async updateBookingException(t){await X.updateBookingException(t).then()},async deleteBookingException(t){t!=null&&await X.deleteBookingException(t).then()},async addClosing(t){await X.createClosing(t).then()},async deleteClosing(t){await X.deleteClosing(t).then()}}}),ht={props:["config","location_id","course_id","duplicate"],setup(t,e){J(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.date&&(n.value.date=ee(n.value.date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_exception_rule_slots=[]),L()});const n=C({}),o=C([]),V=fe({name:ge().required("Nome eccezione obbligatoria")}),{showLoader:x,hideLoader:d}=oe(),r=K(),f=xe(),h=C(!1),u=ve(),b=be(),v=R(()=>f.allCategories),s=R(()=>u.responseTickets),g=R(()=>u.responseCourses),D=function(){x();const _=Object.assign({},n.value);_.date&&(_.date=ae(_.date)),_.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(z=>{z.available_seats!=""&&z.start_at!=""&&_.booking_exception_rule_slots.push(z)});const y={booking_exception_rule:_};b.addBookingException(y).then(()=>{d(),O(r,{message:"Eccezione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(z=>{d(),j(r,z)})},B=function(){x();const _=Object.assign({},n.value);_.date&&(_.date=ae(_.date)),_.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(z=>{z.available_seats!=""&&z.start_at!=""&&_.booking_exception_rule_slots.push(z)});const y={booking_exception_rule:_};b.updateBookingException(y).then(()=>{d(),O(r,{message:"Eccezione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(z=>{d(),j(r,z)})},l=function(){n.value.id?B():D()},k=function(){let _={};_.price=0,n.value.tickets.unshift(_),o.value.push(n.value.tickets[0])},c=function(_){let{newData:y,index:z}=_;n.value.booking_exception_rule_slots[z]=y},T=function(){let _={start_at:"",available_seats:"",id:"-1"};n.value.booking_exception_rule_slots.push(_),o.value.push(_)},A=function(_,y){n.value.booking_exception_rule_slots.splice(y,1)},L=function(){const _=new Map;_.set("location_id",n.value.location_id),_.set("course_id",n.value.course_id),u.getAllTickets(_).catch(y=>{j(r,y)})},q=function(){e.emit("onSubmit",n.value)},S=function(){n.value.booking_exception_rule_ticket_ids=[],L()};return N(v,()=>{n.value.category||(n.value.category=v.value[0])}),{form:n,schema:V,loading:h,editingRows:o,onSubmit:l,addTicket:k,onRowEditSave:c,deleteSlot:A,addSlot:T,fetchAllTickets:L,resetForm:q,onCourseChanged:S,categories:v,responseTickets:s,responseCourses:g}},components:{Form:le,InputTextWithValidation:pe}},Ct={class:"formgrid grid mt-3"},yt={class:"field col-12"},xt={class:"field flex flex-column col-6"},wt=a("label",{for:"location"},"Percorso",-1),Vt={class:"field col-3"},Dt=a("label",{from:"date"},"Il",-1),St=a("div",{class:"field col-3"},null,-1),Tt={class:"field col-3 mt-3"},Et=a("label",null,"Biglietti",-1),Ut={key:0,class:"block mb-2 text-red-500"},At=["for"],Bt={class:"inline-block",style:{"min-width":"150px"}},It={class:"text-right"},jt=a("div",{class:"col-9"},null,-1),Rt={class:"field col-8 mt-3"},zt={class:"field flex justify-content-between align-items-end mt-4 mb-3"},Lt=a("label",null,"Orari",-1),Mt={class:"flex justify-content-center"},Ft={class:"flex align-items-center justify-content-end mt-6"};function Ot(t,e,n,o,V,x){const d=m("InputTextWithValidation"),r=m("Dropdown"),f=m("Calendar"),h=m("Checkbox"),u=m("Button"),b=m("InputMask"),v=m("Column"),s=m("InputNumber"),g=m("DataTable"),D=m("Form"),B=te("tooltip");return U(),H(D,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:p(()=>[a("div",Ct,[a("div",yt,[i(d,{name:"name",label:"Nome eccezione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.form.name=l)},null,8,["modelValue"])]),a("div",xt,[wt,i(r,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=l=>o.form.course_id=l),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:o.onCourseChanged},null,8,["modelValue","options","onChange"])]),a("div",Vt,[Dt,i(f,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[2]||(e[2]=l=>o.form.date=l),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),St,a("div",Tt,[Et,o.form.booking_exception_rule_ticket_ids&&o.form.booking_exception_rule_ticket_ids.length===0?(U(),F("small",Ut," Selezionare almeno un biglietto ")):P("",!0),(U(!0),F(Z,null,re(o.responseTickets.tickets,l=>{var k;return U(),F("div",{key:l.id,class:"flex align-items-center mb-2"},[i(h,{modelValue:o.form.booking_exception_rule_ticket_ids,"onUpdate:modelValue":e[3]||(e[3]=c=>o.form.booking_exception_rule_ticket_ids=c),inputId:l.id+"",name:"category",value:l.id},null,8,["modelValue","inputId","value"]),a("label",{for:l.id+"",class:"ml-2 flex align-items-center"},[a("div",Bt,M((k=l.translations)==null?void 0:k.it.name.text),1),a("div",It,"€ "+M(l.price),1)],8,At)])}),128))]),jt,a("div",Rt,[a("div",zt,[Lt,i(u,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[4]||(e[4]=l=>o.addSlot())})]),i(g,{value:o.form.booking_exception_rule_slots,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[5]||(e[5]=l=>o.editingRows=l),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:p(()=>[W(" Nessuno slot orario trovato. ")]),default:p(()=>[i(v,{header:"Ora",field:"start_at"},{editor:p(({data:l,field:k})=>[i(b,{id:"basic",modelValue:l[k],"onUpdate:modelValue":c=>l[k]=c,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(v,{header:"Posti",field:"available_seats"},{editor:p(({data:l,field:k})=>[i(s,{modelValue:l[k],"onUpdate:modelValue":c=>l[k]=c,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(v,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),i(v,{header:"",style:{width:"3rem","padding-left":"0"}},{body:p(({data:l,index:k})=>[a("div",Mt,[G(i(u,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:c=>o.deleteSlot(l,k)},null,8,["onClick"]),[[B,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])])]),a("div",Ft,[i(u,{label:"Annulla",text:"",onClick:e[6]||(e[6]=l=>o.resetForm())}),i(u,{label:"Conferma",type:"submit",disabled:o.form.booking_exception_rule_ticket_ids&&o.form.booking_exception_rule_ticket_ids.length===0},null,8,["disabled"])])]),_:1},8,["onSubmit","validation-schema"])}const Nt=Q(ht,[["render",Ot]]),Pt={props:["location_id"],setup(t){J(()=>{d.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,t.location_id&&k(t.location_id)});const e=K(),n=C(),o=C(),V=C(),x=C(),d=C(!0),r=C(),f=C(0),h=C(!1);C([]);const u=C(),b=C(!1),v=ve(),s=be(),g=R(()=>s.responseBookingExceptions),D=_e(),B=R(()=>D.submitDialog),l=R(()=>v.responseCourses),k=async function(_){const y=new Map;y.set("location_id",_),await v.getAllCourses(y).then(()=>{d.value=!1}).catch(z=>{d.value=!1,j(e,z)})},c=async function(_){if(!_)return;d.value=!0;const y=new Map;y.set("location_id",t.location_id),y.set("course_id",_),await s.fetchAllBookingExceptions(y).then(()=>{d.value=!1}).catch(z=>{d.value=!1,j(e,z)})},T=function(_){V.value=_;let y="Sei sicuro di voler eliminare questa eccezione?";D.setDialog("Elimina eccezione","Elimina","Annulla",y),D.setBtnSubmit(!1),D.setDynamicDialogVisibility(!0)},A=async function(){V.value&&await s.deleteBookingException(V.value).then(()=>{d.value=!1,O(e,{message:"Eccezione eliminata correttamente",error:!1}),c(u.value)}).catch(_=>{d.value=!1,j(e,_)})},L=function(_,y){x.value=_,h.value=!0,b.value=y},q=function(_){u.value=_,c(_),h.value=!1},S=function(){return b.value?"Duplica eccezione":x.value&&x.value.id&&!b.value?"Modifica eccezione":"Nuova eccezione"};return N(B,_=>{_&&A()}),N(l,()=>{l.value&&l.value.courses&&l.value.courses.length>0&&(u.value=l.value.courses[0].id,c(u.value))}),N(t,()=>{t.location_id&&k(t.location_id)}),{dt:n,responseBookingExceptions:g,loading:d,totalRecords:f,lazyParams:r,op:o,visible:h,currentConfiguration:x,responseCourses:l,course_id:u,flag_duplicate:b,onDeleteConfigurationException:A,confirmDelete:T,onEditConfiguration:L,getHeader:S,closeDialog:q,fetchAllBookingExceptions:c,formatPrettyDate:ee}},components:{BookingExceptionDialog:Nt}},Wt={class:"flex justify-content-between mt-4 mb-3"},qt={class:"field flex flex-column"},Ht=a("label",{for:"location"},"Percorso",-1),Gt={class:"flex justify-content-center"};function Jt(t,e,n,o,V,x){const d=m("Dropdown"),r=m("Button"),f=m("Column"),h=m("DataTable"),u=m("BookingExceptionDialog"),b=m("Dialog"),v=te("tooltip");return U(),F(Z,null,[a("div",Wt,[a("div",qt,[Ht,i(d,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=s=>o.course_id=s),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=s=>o.fetchAllBookingExceptions(o.course_id))},null,8,["modelValue","options"])]),i(r,{label:"Eccezione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=s=>o.onEditConfiguration({},!1))})]),i(h,{value:o.responseBookingExceptions.booking_exception_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:p(()=>[W(" Nessuna eccezione trovata. ")]),default:p(()=>[i(f,{header:"Nome",field:"name"}),i(f,{header:"Il"},{body:p(({data:s})=>[W(M(o.formatPrettyDate(s.date)),1)]),_:1}),i(f,{header:""},{body:p(({data:s})=>[a("div",Gt,[G(i(r,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:g=>o.onEditConfiguration(s,!0)},null,8,["onClick"]),[[v,"Duplica",void 0,{top:!0}]]),G(i(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:g=>o.onEditConfiguration(s,!1)},null,8,["onClick"]),[[v,"Modifica",void 0,{top:!0}]]),G(i(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:g=>o.confirmDelete(s.id)},null,8,["onClick"]),[[v,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),i(b,{visible:o.visible,"onUpdate:visible":e[4]||(e[4]=s=>o.visible=s),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:p(()=>[i(u,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=s=>o.closeDialog(s)),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const Kt=Q(Pt,[["render",Jt]]),Qt={props:["location_id","closing"],setup(t,e){J(()=>{t.closing&&t.closing.id?(n.value=Object.assign({},t.closing),n.value.date&&(n.value.date=ee(n.value.date))):n.value.location_id=t.location_id});const n=C({}),o=fe({name:ge().required("Nome chiusura obbligatoria")}),{showLoader:V,hideLoader:x}=oe(),d=K(),r=ye(),f=be(),h=R(()=>r.allLocations),u=function(g){V(),f.addClosing(g).then(()=>{x(),O(d,{message:"Chiusura aggiunta correttamente",error:!1}),e.emit("onSubmit")}).catch(D=>{x(),j(d,D)})},b=function(g){V(),f.updateBookingException(g).then(()=>{x(),O(d,{message:"Chiusura modificata correttamente",error:!1}),e.emit("onSubmit")}).catch(D=>{x(),j(d,D)})};return{form:n,schema:o,onSubmit:function(){const g=Object.assign({},n.value);g.date&&(g.date=ae(g.date),g.location_id=t.location_id);const D={booking_exception_rule:g};n.value.id?b(D):u(D)},resetForm:function(){e.emit("onSubmit",n.value)},locations:h}},components:{Form:le,InputTextWithValidation:pe}},Xt={class:"formgrid grid mt-3"},Yt={class:"field col-6"},Zt={class:"field col-6 flex flex-column"},$t=a("label",{from:"from_date"},"Il",-1),en={class:"flex align-items-center justify-content-end mt-6"};function on(t,e,n,o,V,x){const d=m("InputTextWithValidation"),r=m("Calendar"),f=m("Button"),h=m("Form");return U(),H(h,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:p(()=>[a("div",Xt,[a("div",Yt,[i(d,{name:"name",label:"Nome chiusura*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=u=>o.form.name=u)},null,8,["modelValue"])]),a("div",Zt,[$t,i(r,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[1]||(e[1]=u=>o.form.date=u),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),a("div",en,[i(f,{label:"Annulla",text:"",onClick:e[2]||(e[2]=u=>o.resetForm())}),i(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const tn=Q(Qt,[["render",on]]),nn={props:["location_id"],setup(t){J(()=>{d.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,t.location_id&&s()});const e=K(),n=C(),o=C(),V=C(),x=C(),d=C(!0),r=C(),f=C(!1),h=be(),u=_e(),b=R(()=>u.submitDialog),v=R(()=>h.responseClosings),s=async function(){const c=new Map;c.set("location_id",t.location_id),await h.fetchAllClosings(c).then(()=>{d.value=!1}).catch(T=>{d.value=!1,j(e,T)})},g=function(c){V.value=c;let T="Sei sicuro di voler eliminare questa chiusura?";u.setDialog("Elimina chiusura","Elimina","Annulla",T),u.setBtnSubmit(!1),u.setDynamicDialogVisibility(!0)},D=async function(){if(!V.value)return;const c={location_id:t.location_id,date:V.value};await h.deleteClosing(c).then(()=>{d.value=!1,O(e,{message:"Chiusura eliminata correttamente",error:!1}),s()}).catch(T=>{d.value=!1,j(e,T)})},B=function(c){x.value=c,f.value=!0},l=function(){s(),f.value=!1},k=function(){return x.value&&x.value.id?"Modifica chiusura":"Nuova chiusura"};return N(b,c=>{b.value&&D()}),N(t,()=>{t.location_id&&s()}),{dt:n,responseClosings:v,loading:d,lazyParams:r,op:o,visible:f,currentClosing:x,formatPrettyDate:ee,onDeleteClosing:D,confirmDelete:g,onEditConfiguration:B,closeDialog:l,getHeader:k}},components:{ClosingDialog:tn}},an={class:"flex justify-content-end mt-4 mb-3"},ln={class:"flex justify-content-center"};function sn(t,e,n,o,V,x){const d=m("Button"),r=m("Column"),f=m("DataTable"),h=m("ClosingDialog"),u=m("Dialog"),b=te("tooltip");return U(),F(Z,null,[a("div",an,[i(d,{label:"Chiusura",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=v=>o.onEditConfiguration({}))})]),i(f,{value:o.responseClosings.closings,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:p(()=>[W(" Nessuna chiusura trovata. ")]),default:p(()=>[i(r,{header:"Nome",field:"name"}),i(r,{header:"Il"},{body:p(({data:v})=>[W(M(o.formatPrettyDate(v.date)),1)]),_:1}),i(r,{header:""},{body:p(({data:v})=>[a("div",ln,[G(i(d,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:s=>o.onEditConfiguration(v)},null,8,["onClick"]),[[b,"Modifica",void 0,{top:!0}]]),G(i(d,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:s=>o.confirmDelete(v.date)},null,8,["onClick"]),[[b,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),i(u,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=v=>o.visible=v),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:p(()=>[i(h,{onOnSubmit:e[1]||(e[1]=v=>o.closeDialog()),onOnClose:e[2]||(e[2]=v=>o.visible=!1),location_id:n.location_id,closing:o.currentClosing},null,8,["location_id","closing"])]),_:1},8,["visible","header"])],64)}const cn=Q(nn,[["render",sn]]),rn={setup(){J(()=>{v()});const t=C({}),e=ye(),n=C(),o=C(),V=C(),{showLoader:x,hideLoader:d}=oe(),r=K(),f=C(!1),h=C({}),u=R(()=>e.allLocations),b=R(()=>e.getCurrentLocation),v=async function(){await e.fetchAllLocations().then(()=>{b.value&&(t.value.location=b.value,h.value=JSON.parse(JSON.stringify(b.value)),g())})},s=function(){e.updateCurrenLocation(t.value.location),h.value=JSON.parse(JSON.stringify(t.value.location)),g()},g=function(){o.value=ee(t.value.location.calendar_visible_from),V.value=ee(t.value.location.calendar_visible_to)},D=async function(){x();let B={calendar_visible_from:ae(o.value),calendar_visible_to:ae(V.value),location_id:t.value.location.id};await e.updateLocation(B).then(()=>{d(),O(r,{message:"Data aggiornata correttamente",error:!1}),o.value=Se(o.value),V.value=Se(V.value),f.value=!1}).catch(l=>{d(),j(r,l)})};return N(u,()=>{t.value.location_id=u.value[0].id}),{form:t,courseTable:n,calendar_visible_from:o,calendar_visible_to:V,active:f,locationCopy:h,locations:u,onChangeLocation:s,updateVisibility:D,fetchAllLocations:v,formatPrettyDate:ee}},components:{CourseTable:mo,OpeningsTable:kt,BookingExceptionTable:Kt,ClosingsTable:cn,LocationTable:wo}};const dn=a("h1",null,"Configurazioni",-1),un={class:"flex align-items-center justify-content-between"},mn={class:"field col-3 flex flex-column"},_n=a("label",{for:"location"},"Location",-1),fn={class:"col-9 flex justify-content-end"},gn={class:"col-12 field"},pn=a("label",{class:"ml-1"},"Finestra di visibilità",-1),vn={class:"flex align-items-center mt-2 ml-0 pl-0 gap-5"};function bn(t,e,n,o,V,x){var l;const d=m("Dropdown"),r=m("Calendar"),f=m("Inplace"),h=m("Card"),u=m("LocationTable"),b=m("TabPanel"),v=m("CourseTable"),s=m("OpeningsTable"),g=m("BookingExceptionTable"),D=m("ClosingsTable"),B=m("TabView");return U(),F("div",null,[dn,a("div",un,[a("div",mn,[_n,i(d,{modelValue:o.form.location,"onUpdate:modelValue":e[0]||(e[0]=k=>o.form.location=k),options:o.locations,optionLabel:"name",placeholder:"",name:"location",onChange:e[1]||(e[1]=k=>o.onChangeLocation())},null,8,["modelValue","options"])]),a("div",fn,[o.form.location?(U(),H(h,{key:0,style:{width:"30rem"}},{content:p(()=>[a("div",gn,[pn,a("div",vn,[i(f,{closable:!0,onClose:e[3]||(e[3]=k=>o.updateVisibility()),active:o.active},{display:p(()=>[W(" Dal: "+M(o.calendar_visible_from),1)]),content:p(()=>[i(r,{inputId:"date",modelValue:o.calendar_visible_from,"onUpdate:modelValue":e[2]||(e[2]=k=>o.calendar_visible_from=k),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"]),i(f,{closable:!0,onClose:e[5]||(e[5]=k=>o.updateVisibility()),active:o.active},{display:p(()=>[W(" Al: "+M(o.calendar_visible_to),1)]),content:p(()=>[i(r,{inputId:"date",modelValue:o.calendar_visible_to,"onUpdate:modelValue":e[4]||(e[4]=k=>o.calendar_visible_to=k),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"])])])]),_:1})):P("",!0)])]),(l=o.form.location)!=null&&l.id?(U(),H(B,{key:0},{default:p(()=>[i(b,{header:"Location"},{default:p(()=>[i(u,{location:o.locationCopy},null,8,["location"])]),_:1}),i(b,{header:"Percorsi"},{default:p(()=>{var k;return[i(v,{location_id:(k=o.form.location)==null?void 0:k.id,ref:"courseTable"},null,8,["location_id"])]}),_:1}),i(b,{header:"Aperture"},{default:p(()=>[i(s,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),i(b,{header:"Eccezioni"},{default:p(()=>[i(g,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),i(b,{header:"Chiusure"},{default:p(()=>[i(D,{location_id:o.form.location.id},null,8,["location_id"])]),_:1})]),_:1})):P("",!0)])}const Bn=Q(rn,[["render",bn]]);export{Bn as default};
