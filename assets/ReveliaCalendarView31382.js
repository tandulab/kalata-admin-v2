import"./location31382.js";import{D as x}from"./datetime31382.js";import{u as P}from"./order31382.js";import{u as H,e as V,s as L}from"./helpers31382.js";import{o as R,a as $,l as p,c as w,i as N,_ as k,r as v,b as A,v as q,w as g,f as i,g as d,y as W,A as J,C as K,z as Q,B as X,x as Y,p as Z,e as U,h as S,t as C,q as B,s as ee,d as te}from"../index31382.js";import{u as z}from"./attraction31382.js";import{i as ae,b as O,a as M}from"./formatData31382.js";import{u as oe}from"./guide31382.js";import{F as ne}from"./vee-validate.esm31382.js";import{c as le,a as G}from"./index.esm31382.js";import{I as ie}from"./InputTextWithValidation31382.js";import"./_commonjsHelpers31382.js";const se={setup(n,t){R(()=>{y(),l()});const o=$(),a=p({}),c=z(),_=P(),{showLoader:s,hideLoader:u}=H(),m=w(()=>c.allAttractions),f=w(()=>_.paymentStatus),l=function(){const b=x.local(),D=b.minus({months:1}).startOf("month");a.value.from_date=D.toFormat("dd/LL/yyyy"),a.value.to_date=b.toFormat("dd/LL/yyyy")},e=function(){l(),t.emit("onSubmit",a.value)},y=async function(){s(),await c.fetchAllAttractions().then(()=>{u(),t.emit("onSubmit",a.value)}).catch(b=>{u(),V(o,b)})};return N(m,()=>{a.value.attraction_id=m.value[0].id}),{form:a,attractions:m,attractionStore:c,statuses:f,resetForm:e}}},re={class:"formgrid grid px-0 align-items-center"},de={class:"field col-3 flex flex-column"},ue=d("label",{for:"typology"},"Bene",-1),ce={class:"field col-2"},me=d("label",{from:"from_date"},"Dal",-1),fe={class:"field col-2"},ve=d("label",{from:"to_date"},"Al",-1),_e={class:"flex col-12 justify-content-end pt-1"};function pe(n,t,o,a,c,_){const s=v("Dropdown"),u=v("Calendar"),m=v("Button"),f=v("AccordionTab"),l=v("Accordion");return A(),q(l,{activeIndex:0},{default:g(()=>[i(f,{header:"FILTRI"},{default:g(()=>[d("div",re,[d("div",de,[ue,i(s,{modelValue:a.form.attraction_id,"onUpdate:modelValue":t[0]||(t[0]=e=>a.form.attraction_id=e),options:a.attractions,optionLabel:"name",optionValue:"id"},null,8,["modelValue","options"])]),d("div",ce,[me,i(u,{inputId:"from_date",modelValue:a.form.from_date,"onUpdate:modelValue":t[1]||(t[1]=e=>a.form.from_date=e),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),d("div",fe,[ve,i(u,{inputId:"to_date",modelValue:a.form.to_date,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.to_date=e),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),d("div",_e,[i(m,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=e=>n.$emit("onSubmit",a.form))}),i(m,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=e=>a.resetForm())})])]),_:1})]),_:1})}const ge=k(se,[["render",pe]]);class F{static async fetchAllReveliaCalendar(t){return(await W("/admin/events/calendar",t)).data.calendar}static async addEventToCalendar(t){return(await J("/admin/events",t)).data}static async updateEventToCalendar(t){return(await K(`/admin/events/${t.id}`,t)).data}static async deleteEvent(t){return await Q(`/admin/events/${t}`)}}const j=X({id:"calendar",state:()=>({calendar:[]}),getters:{getCurrentCalendar:n=>n.calendar},actions:{async fetchAllReveliaCalendar(n){await F.fetchAllReveliaCalendar(n).then(t=>{const o=Object.keys(t)[0];this.calendar=t[o]})},async addEventToCalendar(n){await F.addEventToCalendar(n)},async deleteEvent(n){await F.deleteEvent(n)},async updateEventToCalendar(n){await F.updateEventToCalendar(n)}}}),ye={props:["filters"],setup(n){R(()=>{l.value=!0,e.value={first:0,rows:m.value.rows,sortField:null,sortOrder:null},e.value.page=0});const t=w(()=>c.getCurrentCalendar),o=Y(),a=w(()=>o.submitDialog),c=j(),{showLoader:_,hideLoader:s}=H(),u=$(),m=p(),f=p(),l=p(!0),e=p(),y=p();function b(){setTimeout(()=>{D()},Math.random()*1e3+250)}const D=async function(){const h=new Map;if(n.filters)for(let r in n.filters)r.includes("date")?h.set(r,O(n.filters[r])):h.set(r,n.filters[r]);l.value=!0,await c.fetchAllReveliaCalendar(h).then(()=>{l.value=!1}).catch(r=>{l.value=!1,V(u,r)})},T=function(h){y.value=h;let r="Sei sicuro di voler eliminare questo evento?";o.setDialog("Elimina Evento","Elimina","Annulla",r),o.setBtnSubmit(!1),o.setDynamicDialogVisibility(!0)},I=async function(){_(),await c.deleteEvent(y.value).then(()=>{s(),L(u,{message:"Evento eliminato correttamente",error:!1}),b()}).catch(h=>{s(),V(u,h)})};return N(a,h=>{h&&I()}),{dt:m,loading:l,lazyParams:e,op:f,reveliaCalendar:t,loadLazyData:b,formatDataFromSql:ae,confirmDelete:T}}},be={class:"order-table mt-3"};function he(n,t,o,a,c,_){const s=v("Column"),u=v("Button"),m=v("DataTable"),f=Z("tooltip");return A(),U("div",be,[i(m,{value:a.reveliaCalendar,lazy:!0,paginator:!1,rows:30,ref:"dt",loading:a.loading,stripedRows:""},{empty:g(()=>[S(" Nessuna configurazione trovata. ")]),default:g(()=>[i(s,{header:"Data"},{body:g(({data:l})=>{var e;return[S(C(a.formatDataFromSql((e=l.date_configuration)==null?void 0:e.date_event)),1)]}),_:1}),i(s,{header:"Ora"},{body:g(({data:l})=>{var e,y;return[S(C((e=l.date_configuration)==null?void 0:e.start_at)+" - "+C((y=l.date_configuration)==null?void 0:y.end_at),1)]}),_:1}),i(s,{header:"Guida"},{body:g(({data:l})=>{var e,y,b,D;return[S(C((y=(e=l.date_configuration)==null?void 0:e.guide)==null?void 0:y.first_name)+" "+C((D=(b=l.date_configuration)==null?void 0:b.guide)==null?void 0:D.last_name),1)]}),_:1}),i(s,{header:"Posti liberi",field:"available_tickets"}),i(s,{header:"Posti totali"},{body:g(({data:l})=>{var e;return[S(C((e=l.date_configuration)==null?void 0:e.max_seats),1)]}),_:1}),i(s,{style:{width:"10rem"}},{body:g(({data:l})=>[B(i(u,{link:"",icon:"pi pi-pencil",href:l.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:e=>n.$emit("onEditEvent",l)},null,8,["href","onClick"]),[[f,"Modifica",void 0,{top:!0}]]),B(i(u,{link:"",icon:"pi pi-clone",href:l.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:e=>n.$emit("onDuplicateEvent",l)},null,8,["href","onClick"]),[[f,"Duplica",void 0,{top:!0}]]),B(i(u,{link:"",icon:"pi pi-trash",href:l.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:e=>a.confirmDelete(l.id)},null,8,["href","onClick"]),[[f,"Elimina",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","loading"])])}const Ce=k(ye,[["render",he]]),De={props:["filters","current_event","duplicate"],setup(n,t){R(()=>{D(),n.current_event&&n.current_event.id&&b()});const o=p({}),a=z(),c=j(),_=oe(),s=p(!0),u=$(),m=w(()=>a.allAttractions),f=w(()=>_.allGuides),l=function(){t.emit("onSubmit",o.value)},e=le({max_seats:G().required("Campo obbligatorio"),min_seats:G().required("Campo obbligatorio")}),y=function(){o.value.date_event=x.now().toFormat("dd/MM/yyyy"),o.value.expire_at=x.now().toFormat("dd/MM/yyyy"),o.value.start_at=x.now().toFormat("HH:mm"),o.value.end_at=x.now().toFormat("HH:mm"),o.value.guide_id=f.value[0],n.filters&&(o.value.attraction_id=n.filters.attraction_id)},b=function(){o.value=Object.assign({},n.current_event),o.value.date_configuration&&(o.value.date_event=M(o.value.date_configuration.date_event),o.value.expire_at=M(o.value.date_configuration.expire_at),o.value.guide_id=o.value.date_configuration.guide,o.value.max_seats=o.value.date_configuration.max_seats,o.value.min_seats=o.value.date_configuration.min_seats,o.value.start_at=o.value.date_configuration.start_at,o.value.end_at=o.value.date_configuration.end_at)},D=async function(){s.value=!0,await _.fetchAllGuides().then(()=>{s.value=!1}).catch(r=>{s.value=!1,V(u,r)})},T=function(){let r=Object.assign({},o.value);if(r.date_event=O(r.date_event),r.expire_at=O(r.expire_at),r.guide_id=r.guide_id.id,r.id&&!n.duplicate){delete r.date_configuration;const E={id:r.id,attraction_id:r.attraction_id,date_configuration:r};h(E)}else{const E={attraction_id:r.attraction_id,date_configuration:r};I(E)}},I=async function(r){s.value=!0,await c.addEventToCalendar(r).then(()=>{s.value=!1,L(u,{message:"Evento aggiunto correttamente",error:!1}),t.emit("onAddEvent")}).catch(E=>{s.value=!1,V(u,E)})},h=async function(r){s.value=!0,await c.updateEventToCalendar(r).then(()=>{s.value=!1,L(u,{message:"Evento aggiornato correttamente",error:!1}),t.emit("onAddEvent")}).catch(E=>{s.value=!1,V(u,E)})};return N(f,()=>{o.value.id||y()}),{form:o,schema:e,attractions:m,guides:f,resetForm:l,onSubmit:T}},components:{Form:ne,InputTextWithValidation:ie}},Ee={class:"formgrid grid px-0 align-items-center mt-3"},Ve={class:"field col-12 flex flex-column"},we=d("label",{for:"typology"},"Bene",-1),Se={class:"field col-12"},xe=d("label",{from:"date_event"},"Data evento (Giorno in cui si effettuera la visita)",-1),Ae={class:"field col-3"},Fe=d("label",{from:"start_at"},"Dalle",-1),ke={class:"field col-3"},Te=d("label",{from:"end_at"},"Alle",-1),Ie={class:"field col-12"},Be=d("label",{from:"expire_at"},"Deadline acquisto",-1),Le={class:"field col-12 flex flex-column mb-1"},Oe=d("label",{for:"typology"},"Guida",-1),Re={key:0,class:"flex align-items-center"},$e={class:"flex align-items-center"},Ne={class:"field col-6 flex flex-column mt-3"},Ue={class:"field col-6 flex flex-column mt-3"},Me={class:"flex align-items-center justify-content-end mt-2"};function Ge(n,t,o,a,c,_){const s=v("Dropdown"),u=v("Calendar"),m=v("InputTextWithValidation"),f=v("Button"),l=v("Form");return A(),q(l,{onSubmit:a.onSubmit,"validation-schema":a.schema},{default:g(()=>[d("div",Ee,[d("div",Ve,[we,i(s,{modelValue:a.form.attraction_id,"onUpdate:modelValue":t[0]||(t[0]=e=>a.form.attraction_id=e),options:a.attractions,optionLabel:"name",optionValue:"id"},null,8,["modelValue","options"])]),d("div",Se,[xe,i(u,{inputId:"date_event",modelValue:a.form.date_event,"onUpdate:modelValue":t[1]||(t[1]=e=>a.form.date_event=e),dateFormat:"dd/mm/yy",manualInput:!1},null,8,["modelValue"])]),d("div",Ae,[Fe,i(u,{inputId:"start_at",modelValue:a.form.start_at,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.start_at=e),dateFormat:"HH:mm",manualInput:!1,timeOnly:""},null,8,["modelValue"])]),d("div",ke,[Te,i(u,{inputId:"end_at",modelValue:a.form.end_at,"onUpdate:modelValue":t[3]||(t[3]=e=>a.form.end_at=e),dateFormat:"HH:mm",manualInput:!1,timeOnly:""},null,8,["modelValue"])]),d("div",Ie,[Be,i(u,{inputId:"expire_at",modelValue:a.form.expire_at,"onUpdate:modelValue":t[4]||(t[4]=e=>a.form.expire_at=e),dateFormat:"dd/mm/yy",manualInput:!1},null,8,["modelValue"])]),d("div",Le,[Oe,i(s,{modelValue:a.form.guide_id,"onUpdate:modelValue":t[5]||(t[5]=e=>a.form.guide_id=e),options:a.guides},{value:g(e=>[e.value?(A(),U("div",Re,[d("div",null,C(e.value.first_name)+" "+C(e.value.last_name),1)])):ee("",!0)]),option:g(e=>[d("div",$e,[d("div",null,C(e.option.first_name)+" "+C(e.option.last_name),1)])]),_:1},8,["modelValue","options"])]),d("div",Ne,[i(m,{name:"min_seats",type:"number",label:"N.ro minimo partecipanti",modelValue:a.form.min_seats,"onUpdate:modelValue":t[6]||(t[6]=e=>a.form.min_seats=e)},null,8,["label","modelValue"])]),d("div",Ue,[i(m,{name:"max_seats",type:"number",label:"N.ro minimo partecipanti",modelValue:a.form.max_seats,"onUpdate:modelValue":t[7]||(t[7]=e=>a.form.max_seats=e)},null,8,["label","modelValue"])])]),d("div",Me,[i(f,{label:"Annulla",text:"",onClick:t[8]||(t[8]=e=>a.resetForm())}),i(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const He=k(De,[["render",Ge]]),qe=te({setup(){const n=p(),t=p({}),o=p(!1),a=p(),c=p(!1),_=p("Nuovo evento");return{reveliaCalendarTable:n,filters:t,visibleDialog:o,currentEvent:a,duplicate:c,headerDialog:_,onSubmit:function(e){a.value={},o.value=!1,t.value=e,n.value&&n.value.loadLazyData()},onShowDialog:function(){a.value={},c.value=!1,o.value=!0,_.value="Nuovo evento"},onEditEvent:function(e){a.value=e,c.value=!1,o.value=!0,_.value="Modifica evento"},onAddEvent:function(){a.value={},o.value=!1,n.value&&n.value.loadLazyData()},onDuplicateEvent:function(e){a.value=e,o.value=!0,c.value=!0,_.value="Duplica evento"}}},components:{ReveliaFiltersCalendar:ge,ReveliaCalendarTable:Ce,NewEventDialog:He}}),ze=d("h1",null,"Calendario",-1),je={class:"flex mt-6 justify-content-end"};function Pe(n,t,o,a,c,_){const s=v("ReveliaFiltersCalendar"),u=v("Button"),m=v("NewEventDialog"),f=v("Dialog"),l=v("ReveliaCalendarTable");return A(),U("div",null,[ze,i(s,{onOnSubmit:t[0]||(t[0]=e=>n.onSubmit(e))}),d("div",je,[i(u,{label:"Evento",icon:"pi pi-plus",rounded:"",outlined:"",onClick:t[1]||(t[1]=e=>n.onShowDialog())}),i(f,{visible:n.visibleDialog,"onUpdate:visible":t[2]||(t[2]=e=>n.visibleDialog=e),modal:"",header:n.headerDialog,style:{width:"30rem"}},{default:g(()=>[i(m,{current_event:n.currentEvent,onOnAddEvent:n.onAddEvent,filters:n.filters,duplicate:n.duplicate},null,8,["current_event","onOnAddEvent","filters","duplicate"])]),_:1},8,["visible","header"])]),i(l,{ref:"reveliaCalendarTable",filters:n.filters,onOnEditEvent:t[3]||(t[3]=e=>n.onEditEvent(e)),onOnDuplicateEvent:t[4]||(t[4]=e=>n.onDuplicateEvent(e))},null,8,["filters"])])}const lt=k(qe,[["render",Pe]]);export{lt as default};
