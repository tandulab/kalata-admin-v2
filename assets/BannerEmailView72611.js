import{y as j,C as M,B as L,o as E,a as I,l as v,c as N,_ as S,r as g,p as A,b as r,v as D,w as k,h as C,f as i,t as P,e as u,g as t,q as U,A as F,m as B,z as q,i as G,s as w}from"../index72611.js";import{e as R,u as $,s as H}from"./helpers72611.js";import{F as J}from"./vee-validate.esm72611.js";class T{static async fetchAll(){return(await j("/admin/banners")).data}static async updateBanner(e){return(await M(`/admin/banners/${e.banner.id}`,e)).data}}const z=L({id:"banner",state:()=>({banner:{},banners:[],response_banners:{}}),getters:{allBanners:n=>n.banners,responseBanners:n=>n.response_banners,getTotalBanners:n=>n.response_banners?n.response_banners.total:0,getCurrentBanner:n=>n.banner},actions:{async fetchAll(){await T.fetchAll().then(n=>{this.response_banners=n})},async updateBanner(n){await T.updateBanner(n).then()}}}),K={setup(){E(()=>{p.value=!0,f.value={first:0,rows:e.value.rows,sortField:null,sortOrder:null},f.value.page=0,_()});const n=I(),e=v(),a=v(),o=v(),p=v(!0),f=v(),d=v(0),c=z(),m=N(()=>c.responseBanners);function _(){p.value=!0,setTimeout(()=>{l()},Math.random()*1e3+250)}const l=async function(){await c.fetchAll().then(()=>{p.value=!1}).catch(b=>{p.value=!1,R(n,b)})};return{dt:e,responseBanners:m,loading:p,totalRecords:d,lazyParams:f,currentOrder:a,op:o,loadLazyData:_}}};const Q=["src"],W={key:1,class:"block"},X=["href"],Y={key:3},Z=["src"],ee={key:1,class:"block"},oe=["href"],ne={key:3,class:"block"},te=["src"],ae={key:1,class:"block"},le=["href"],se={key:3,class:"block"},ie={class:"flex justify-content-center"};function re(n,e,a,o,p,f){const d=g("Column"),c=g("Button"),m=g("DataTable"),_=A("tooltip");return r(),D(m,{value:o.responseBanners.banners,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:"",class:"banner"},{empty:k(()=>[C(" Nessun codice sconto trovato. ")]),default:k(()=>[i(d,{header:"Location",field:"location"},{body:k(({data:l})=>{var b;return[C(P(((b=l.location)==null?void 0:b.name)||"Tutte le location"),1)]}),_:1}),i(d,{header:"Banner header"},{body:k(({data:l})=>[l.image_url?(r(),u("img",{key:0,src:l.image_url},null,8,Q)):(r(),u("i",W,"Nessuna immagine caricata")),l.link?(r(),u("a",{key:2,href:l.link,class:"block",target:"_blank"},"Link",8,X)):(r(),u("i",Y,"Nessun link impostato"))]),_:1}),i(d,{header:"Banner footer (up)"},{body:k(({data:l})=>[l.image_foot_up_url?(r(),u("img",{key:0,src:l.image_foot_up_url},null,8,Z)):(r(),u("i",ee,"Nessuna immagine caricata")),l.link_foot_up?(r(),u("a",{key:2,href:l.link_foot_up,class:"block",target:"_blank"},"Link",8,oe)):(r(),u("i",ne,"Nessun link impostato"))]),_:1}),i(d,{header:"Banner footer (down)"},{body:k(({data:l})=>[l.image_foot_down_url?(r(),u("img",{key:0,src:l.image_foot_down_url},null,8,te)):(r(),u("i",ae,"Nessuna immagine caricata")),l.link_foot_down?(r(),u("a",{key:2,href:l.link_foot_down,class:"block",target:"_blank"},"Link",8,le)):(r(),u("i",se,"Nessun link impostato"))]),_:1}),i(d,{header:""},{body:k(({data:l})=>[t("div",ie,[U(i(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:b=>n.$emit("onEditBanner",l)},null,8,["onClick"]),[[_,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const de=S(K,[["render",re]]);class x{static async uploadFile(e){return(await F("uploads",e)).data}static async uploadResponse(e){const a={headers:{"Content-Type":e.file.type}};return delete B.defaults.headers.common.uid,delete B.defaults.headers.common.Uid,delete B.defaults.headers.common["token-type"],delete B.defaults.headers.common["access-token"],delete B.defaults.headers.common.client,await B.put(e.upload_url,e.file,a)}static async uploadDone(e){return(await F(`/uploads/${e}/done`,{})).data}static async deleteFile(e){const a=new Map;return(await q(`/uploads/${e}`,a)).data}}const ce=L({id:"upload",state:()=>({upload:{},uploads:[],response_uploads:{},upload_id:""}),getters:{allUploads:n=>n.uploads,responseUploads:n=>n.response_uploads,getCurrentUpload:n=>n.upload},actions:{async uploadFile(n){const e=n.file;await x.uploadFile(n).then(a=>{const o={file:e,upload_url:a.upload_url};return this.upload_id=a.upload.id,this.uploadResponse(o)})},async uploadResponse(n){await x.uploadResponse(n).then(()=>this.uploadDone())},async uploadDone(){await x.uploadDone(this.upload_id).then(n=>{this.response_uploads=n})},async deleteFile(n){await x.deleteFile(n)}}}),ue={props:["banner"],setup(n,e){E(()=>{n.banner&&(a.value=Object.assign({},n.banner))});const a=v({}),{showLoader:o,hideLoader:p}=$(),f=I(),d=z(),c=ce(),m=N(()=>c.responseUploads),_=function(h,y){const V=h.files[0],O={upload:{filename:V.name,type:V.type,owner_id:n.banner.id,owner_type:"Banner",banner_type:y},file:V};c.uploadFile(O)},l=function(){o();const h={banner:a.value};d.updateBanner(h).then(()=>{p(),H(f,{message:"Banner aggiornato correttamente",error:!1}),e.emit("onSubmit")}).catch(y=>{R(f,y)})},b=function(h,y){c.deleteFile(h).then(()=>{s(y,null)})},s=function(h,y){h=="header"?a.value.image_url=y:h=="footer_up"?a.value.image_foot_up_url=y:a.value.image_foot_down_url=y};return G(m,()=>{let h=m.value.url;s(m.value.banner_type,h)}),{form:a,uploadedImage:m,onSubmit:l,onUploadImage:_,onDeleteFile:b}},components:{Form:J}};const me={class:"formgrid grid flex-column mt-3"},_e={class:"field col-12 flex flex-column"},pe=t("label",{for:"location"},"Location",-1),fe={class:"formgrid grid card mt-3"},be=t("h3",{class:"col-12 mt-0 p-0"},"Banner header",-1),ge={class:"field col-6 flex flex-column"},he=t("label",null,"Immagine",-1),ve={key:0,class:"relative wrp-delete"},ye=["src"],ke={class:"field col-6 flex flex-column"},Be=t("label",{from:"to_date"},"Link banner header",-1),we={class:"formgrid grid card mt-3"},xe=t("h3",{class:"col-12 mt-0 p-0"},"Banner footer (up)",-1),De={class:"field col-6 flex flex-column"},Ue=t("label",null,"Immagine",-1),Ve={key:0,class:"relative wrp-delete"},Ee=["src"],Se={class:"field col-6 flex flex-column"},Ce=t("label",{from:"to_date"},"Link banner footer (up)",-1),Fe={class:"formgrid grid card mt-3"},Te=t("h3",{class:"col-12 mt-0 p-0"},"Banner footer (down)",-1),Le={class:"field col-6 flex flex-column"},Ie=t("label",null,"Immagine",-1),Ne={key:0,class:"relative wrp-delete"},Ae=["src"],Re={class:"field col-6 flex flex-column"},ze=t("label",{from:"to_date"},"Link banner footer (down)",-1),Oe={class:"formgrid grid card mt-3"},je=t("h3",{class:"col-12 mt-0 p-0"},"Testo email (biglietti standard)",-1),Me={class:"field"},Pe={class:"formgrid grid card mt-3"},qe=t("h3",{class:"col-12 mt-0 p-0"},"Testo email (biglietti a data aperta)",-1),Ge={class:"field"},$e={class:"flex align-items-center justify-content-end mt-6"};function He(n,e,a,o,p,f){const d=g("InputText"),c=g("Button"),m=g("FileUpload"),_=g("Editor"),l=g("Form"),b=A("tooltip");return o.form?(r(),D(l,{key:0,onSubmit:o.onSubmit,class:"banner"},{default:k(()=>[t("div",me,[t("div",_e,[pe,o.form.location?(r(),D(d,{key:0,modelValue:o.form.location.name,"onUpdate:modelValue":e[0]||(e[0]=s=>o.form.location.name=s),disabled:""},null,8,["modelValue"])):w("",!0)])]),t("div",fe,[be,t("div",ge,[he,o.form.image_url?(r(),u("div",ve,[o.form.image_url?U((r(),D(c,{key:0,icon:"pi pi-times",rounded:"","aria-label":"Cancel",class:"btn-delete-img",onClick:e[1]||(e[1]=s=>o.onDeleteFile(o.form.image.id,"header"))},null,512)),[[b,"Elimina",void 0,{top:!0}]]):w("",!0),t("img",{src:o.form.image_url},null,8,ye)])):w("",!0),i(m,{mode:"basic",name:"demo[]",url:"/api/upload",accept:"image/*",customUpload:"",auto:!0,onUploader:e[2]||(e[2]=s=>o.onUploadImage(s,"header")),class:"mt-3"})]),t("div",ke,[Be,i(d,{modelValue:o.form.link,"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.link=s)},null,8,["modelValue"])])]),t("div",we,[xe,t("div",De,[Ue,o.form.image_foot_up_url?(r(),u("div",Ve,[U(i(c,{icon:"pi pi-times",rounded:"","aria-label":"Cancel",class:"btn-delete-img",onClick:e[4]||(e[4]=s=>o.onDeleteFile(o.form.image_foot_up.id,"footer_up"))},null,512),[[b,"Elimina",void 0,{top:!0}]]),t("img",{src:o.form.image_foot_up_url},null,8,Ee)])):w("",!0),i(m,{mode:"basic",name:"demo[]",url:"/api/upload",accept:"image/*",customUpload:"",auto:!0,onUploader:e[5]||(e[5]=s=>o.onUploadImage(s,"footer_up")),class:"mt-3"})]),t("div",Se,[Ce,i(d,{modelValue:o.form.link_foot_up,"onUpdate:modelValue":e[6]||(e[6]=s=>o.form.link_foot_up=s)},null,8,["modelValue"])])]),t("div",Fe,[Te,t("div",Le,[Ie,o.form.image_foot_down_url?(r(),u("div",Ne,[U(i(c,{icon:"pi pi-times",rounded:"","aria-label":"Cancel",class:"btn-delete-img",onClick:e[7]||(e[7]=s=>o.onDeleteFile(o.form.image_foot_down.id,"footer_down"))},null,512),[[b,"Elimina",void 0,{top:!0}]]),t("img",{src:o.form.image_foot_down_url},null,8,Ae)])):w("",!0),i(m,{mode:"basic",name:"demo[]",url:"/api/upload",accept:"image/*",customUpload:"",auto:!0,onUploader:e[8]||(e[8]=s=>o.onUploadImage(s,"footer_down")),class:"mt-3"})]),t("div",Re,[ze,i(d,{modelValue:o.form.link_foot_down,"onUpdate:modelValue":e[9]||(e[9]=s=>o.form.link_foot_down=s)},null,8,["modelValue"])])]),t("div",Oe,[je,t("div",Me,[i(_,{modelValue:o.form.copy_standard,"onUpdate:modelValue":e[10]||(e[10]=s=>o.form.copy_standard=s),editorStyle:"height: 320px"},null,8,["modelValue"])])]),t("div",Pe,[qe,t("div",Ge,[i(_,{modelValue:o.form.copy_open,"onUpdate:modelValue":e[11]||(e[11]=s=>o.form.copy_open=s),editorStyle:"height: 320px"},null,8,["modelValue"])])]),t("div",$e,[i(c,{label:"Annulla",text:""}),i(c,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit"])):w("",!0)}const Je=S(ue,[["render",He]]),Ke={setup(){E(()=>{});const n=v(!1),e=v(),a=v({});return{visibleDialog:n,bannerEmailTable:e,currentBanner:a,onSubmit:function(){n.value=!1,e.value.loadLazyData()},openEditDialog:function(f){n.value=!0,a.value=f}}},components:{BannerEmailTable:de,BannerEmailDialog:Je}},Qe=t("h1",null,"Banner email",-1);function We(n,e,a,o,p,f){const d=g("BannerEmailTable"),c=g("BannerEmailDialog"),m=g("Dialog");return r(),u("div",null,[Qe,i(d,{ref:"bannerEmailTable",onOnEditBanner:e[0]||(e[0]=_=>o.openEditDialog(_))},null,512),i(m,{visible:o.visibleDialog,"onUpdate:visible":e[2]||(e[2]=_=>o.visibleDialog=_),modal:"",header:"Banner Email",style:{width:"50rem"}},{default:k(()=>[i(c,{onOnSubmit:e[1]||(e[1]=_=>o.onSubmit()),banner:o.currentBanner},null,8,["banner"])]),_:1},8,["visible"])])}const eo=S(Ke,[["render",We]]);export{eo as default};
